 Translation into languages with rich morphology presents special challenges for phrase-based meth-ods. Thus, Birch et al (2008) find that transla-tion quality achieved by a popular phrase-based sys-tem correlates significantly with a measure of target-side, but not source-side morphological complexity. Recently, several studies (Bojar, 2007; Avramidis and Koehn, 2009; Ramanathan et al., 2009; Yen-iterzi and Oflazer, 2010) proposed modeling target-side morphology in a phrase-based factored mod-els framework (Koehn and Hoang, 2007). Under this approach linguistic annotation of source sen-tences is analyzed using heuristics to identify rel-evant structural phenomena, whose occurrences are in turn used to compute additional relative frequency (maximum likelihood) estimates predicting target-side inflections. This approach makes it difficult to handle the complex interplay between different predictors for inflections. For example, the ac-cusative case is usually preserved in translation, so that nouns appearing in the direct object position of English clauses tend to be translated to words with accusative case markings in languages with richer morphology, and vice versa. However, there are exceptions. For example, some verbs that place their object in the accusative case in Czech may be rendered as prepositional constructions in English (Naughton, 2005):
Conversely, direct objects of some English verbs can be translated by nouns with genitive case markings in Czech:
Furthermore, English noun modifiers are often rendered by Czech possessive adjectives and a ver-bal complement in one language is commonly trans-lated by a nominalizing complement in another lan-guage, so that the part of speech (POS) of its head need not be preserved. These complications make it difficult to model morphological phenomena using closed-form estimates. This paper presents an alter-native approach based on exponential phrase mod-els, which can straightforwardly handle feature sets with arbitrarily elaborate source-side dependencies. We take as our starting point David Chiang X  X  Hiero system, which generalizes phrase-based translation to substrings with gaps (Chiang, 2007). Consider for instance the following set of context-free rules with a single non-terminal symbol:
It is one of many rule sets that would suffice to generate the English translation 1b for the French sentence 1a. 1a. d X  incolores id  X  ees vertes dorment furieusement 1b. colorless green ideas sleep furiously
As shown by Chiang (2007), a weighted gram-mar of this form can be collected and scored by sim-ple extensions of standard methods for phrase-based translation and efficiently combined with a language model in a CKY decoder to achieve large improve-ments over a state-of-the-art phrase-based system. The translation is chosen to be the target-side yield of the highest-scoring synchronous parse consistent with the source sentence. Although a variety of scores interpolated into the decision rule for phrase-based systems have been investigated over the years, only a handful have been discovered to be consis-tently useful. In this work we concentrate on ex-tending the target-given-source phrase model 1 . The model used in this work is based on the familiar equation for conditional exponential models: where ~ f ( X,Y ) is a vector of feature functions, ~w is a corresponding weight vector, so that ~w  X  ~ f ( X,Y ) = P i w i f i ( X,Y ) , and GEN ( X ) is a set of values corresponding to Y . For a target-given-source phrase model the predicted outcomes are target-side phrases r y , the model is conditioned on a source-side phrase r x together with some con-text, and each GEN ( X ) consists of target phrases r y co-occurring with a given source phrase r x in the grammar.

Maximum likelihood estimation for exponential model finds the values of weights that maximize the likelihood of the training data, or, equivalently, its logarithm: LL ( ~w ) = log where the expressions range over all training in-stances { m } . In this work we extend the objective using an ` 2 regularizer (Ng, 2004; Gao et al., 2007). We obtain the counts of instances and features from the standard heuristics used to extract the grammar from a word-aligned parallel corpus.

Exponential models and other classifiers have been used in several recent studies to condition phrase model probabilities on source-side context (Chan et al 2007; Carpuat and Wu 2007a; Carpuat and Wu 2007b). However, this has been gener-ally accomplished by training independent classi-fiers associated with different source phrases. This approach is not well suited to modeling target-language inflections, since parameters for the fea-tures associated with morphological markings and their predictors would be estimated separately from many, generally very small training sets, thereby preventing the model from making precisely the kind of generalization beyond specific phrases that we seek to obtain. Instead we continue the approach proposed in Subotin (2008), where a single model defined by the equations above is trained on all of the data, so that parameters for features that are shared by rule sets with difference source sides reflect cu-mulative feature counts, while the standard relative frequency model can be obtained as a special case of maximum likelihood estimation for a model con-taining only the features for rules. 2 Recently, Jeong et al (2010) independently proposed an exponential model with shared features for target-side morphol-ogy in application to lexical scores in a treelet-based system. The feature space for target-side inflection models used in this work consists of features tracking the source phrase and the corresponding target phrase together with its complete morphological tag, which will be referred to as rule features for brevity. The feature space also includes features tracking the source phrase together with the lemmatized repre-sentation of the target phrase, called lemma features below. Since there is little ambiguity in lemmati-zation for Czech, the lemma representations were for simplicity based on the most frequent lemma for each token. Finally, we include features associ-ating aspects of source-side annotation with inflec-tions of aligned target words. The models include features for three general classes of morphological types: number, case, and gender. We add inflec-tion features for all words aligned to at least one En-glish verb, adjective, noun, pronoun, or determiner, excepting definite and indefinite articles. A sepa-rate feature type marks cases where an intended in-flection category is not applicable to a target word falling under these criteria due to a POS mismatch between aligned words. 4.1 Number The inflection for number is particularly easy to model in translating from English, since it is gen-erally marked on the source side, and POS taggers based on the Penn treebank tag set attempt to infer it in cases where it is not. For word pairs whose source-side word is a verb, we add a feature marking the number of its subject, with separate features for noun and pronoun subjects. For word pairs whose source side is an adjective, we add a feature marking the number of the head of the smallest noun phrase that contains it. 4.2 Case Among the inflection types of Czech nouns, the only type that is not generally observed in English and does not belong to derivational morphology is in-flection for case. Czech marks seven cases: nomi-nal, genitive, dative, accusative, vocative, locative, and instrumental. Not all of these forms are overtly distinguished for all lexical items, and some words that function syntactically as nouns do not inflect at all. Czech adjectives also inflect for case and their case has to match the case of their governing noun. However, since the source sentence and its anno-tation contain a variety of predictors for case, we model it using only source-dependent features. The following feature types for case were included:  X  The structural role of the aligned source word  X  The preposition governing the smallest noun  X  An indicator for the presence of a possessive  X  An indicator for the presence of a numeral  X  An indication that aligned source word modi- X  The lemma of the verb governing the aligned
Features corresponding to aspects of the source word itself and features corresponding to aspects of the head of a noun phrase containing it were treated as separate types. 4.3 Gender Czech nouns belong to one of three cases: feminine, masculine, and neuter. Verbs and adjectives have to agree with nouns for gender, although this agree-ment is not marked in some forms of the verb. In contrast to number and case, Czech gender generally cannot be predicted from any aspect of the English source sentence, which necessitates the use of fea-tures that depend on another target-side word. This, in turn, requires a more elaborate decoding proce-dure, described in the next section. For verbs we add a feature associating the gender of the verb with the gender of its subject. For adjectives, we add a feature tracking the gender of the governing nouns. These dependencies are inferred from source-side annotation via word alignments, as depicted in fig-ure 1, without any use of target-side dependency parses. The procedure for decoding with non-local target-side feature dependencies is similar in its general outlines to the standard method of decoding with a language model, as described in Chiang (2007). The search space is organized into arrays called charts , each containing a set of items whose scores can be compared with one another for the purposes of prun-ing. Each rule that has matched the source sen-tence belongs to a rule chart associated with its location-anchored sequence of non-terminal and ter-minal source-side symbols and any of its aspects which may affect the score of a translation hypothe-sis when it is combined with another rule. In the case of the language model these aspects include any of its target-side words that are part of still incomplete n-grams. In the case of non-local target-side depen-dencies this includes any information about features needed for this rule X  X  estimate and tracking some target-side inflection beyond it or features tracking target-side inflections within this rule and needed for computation of another rule X  X  estimate. We shall re-fer to both these types of information as messages , alluding to the fact that it will need to be conveyed to another point in the derivation to finish the compu-tation. Thus, a rule chart for a rule with one non-terminal can be denoted as as D x i 1 i +1 Ax j j where we have introduced the symbol  X  to represent the set of messages associated with a given item in the chart. Each item in the chart is associated with a score s , based on any submodels and heuristic es-timates that can already be computed for that item and used to arrange the chart items into a priority queue. Combinations of one or more rules that span a substring of terminals are arranged into a differ-ent type of chart which we shall call span charts . A span chart has the form [ i 1 ,j 1 ;  X  1 ] , where  X  1 is a set of messages, and its items are likewise prioritized by a partial score s 1 .

The decoding procedure used in this work is based on the cube pruning method, fully described in Chi-ang (2007). Informally, whenever a rule chart is combined with one or more span charts correspond-ing to its non-terminals, we select best-scoring items from each chart and update derivation scores by per-forming any model computations that become pos-sible once we combine the corresponding items. Crucially, whenever an item in one of the charts crosses a pruning threshold, we discard the rest of that chart X  X  items, even though one of them could generate a better-scoring partial derivation in com-bination with an item from another chart. It is there-fore important to estimate incomplete model scores as well as we can. We estimate these scores by com-puting exponential models using all features without non-local dependencies.

Schematically, our decoding procedure can be il-lustrated by three elementary cases. We take the example of computing an estimate for a rule whose only terminal on both sides is a verb and which re-quires a feature tracking the target-side gender in-flection of the subject. We make use of a cache storing all computed numerators and denominators of the exponential model, which makes it easy to recompute an estimate given an additional feature and use the difference between it and the incomplete estimate to update the score of the partial deriva-tion. In the simplest case, illustrated in figure 2, the non-local feature depends on the position within the span of the rule X  X  non-terminal symbol, so that its model estimate can be computed when its rule chart is combined with the span chart for its non-terminal symbol. This is accomplished using a feature mes-sage , which indicates the gender inflection for the subject and is denoted as m f ( i ) , where the index i refers to the position of its  X  X ecipient X . Figure 3 illustrates the case where the non-local feature lies outside the rule X  X  span, but the estimated rule lies in-side a non-terminal of the rule which contains the feature dependency. This requires sending a rule message m r ( i ) , which includes information about the estimated rule (which also serves as a pointer to the score cache) and its feature dependency. The fi-nal example, shown in figure 4, illustrates the case where both types of messages need to be propagated until we reach a rule chart that spans both ends of the dependency. In this case, the full estimate for a rule is computed while combining charts neither of which corresponds directly to that rule.

A somewhat more formal account of the decod-ing procedure is given in figure 5, which shows a partial set of inference rules, generally following the formalism used in Chiang (2007), but simplifying it in several ways for brevity. Aside from the no-tation introduced above, we also make use of two updating functions. The message-updating function u m (  X  ) takes a set of messages and outputs another set that includes those messages m r ( k ) and m f ( k ) whose destination k lies outside the span i,j of the chart. The score-updating function u s (  X  ) computes those model estimates which can be completed us-ing a message in the set  X  and returns the difference between the new and old scores. As a consequence of translating into a morphologi-cally rich language, some inflected forms of target words are unobserved in training data and cannot be generated by the decoder under standard phrase-based approaches. Exponential models with shared features provide a straightforward way to estimate probabilities of unobserved inflections. This is ac-complished by extending the sets of target phrases GEN ( X ) over which the model is normalized by including some phrases which have not been ob-served in the original sets. When additional rule features with these unobserved target phrases are in-cluded in the model, their weights will be estimated even though they never appear in the training exam-ples (i.e, in the numerator of their likelihoods).
We generate unobserved morphological variants for target phrases starting from a generation proce-dure for target words. Morphological variants for words were generated using the  X  UFAL MORPHO tool (Kolovratn  X   X k and P  X  rikryl, 2008). The forms pro-duced by the tool from the lemma of an observed in-flected word form were subjected to several restric-tions:  X  For nouns, generated forms had to match the  X  For verbs, generated forms had to match the  X  For adjectives, generated forms had to match  X  For pronouns, excepting relative and interrog- X  Non-standard inflection forms for all POS were
The following criteria were used to select rules for which expanded inflection sets were generated:  X  The target phrase had to contain exactly one  X  If the target phrase contained prepositions or  X  The lemmatized form of the phrase had to ac-
The standard relative frequency estimates for the p ( X | Y ) phrase model and the lexical models do not provide reasonable values for the decoder scores for unobserved rules and words. In contrast, exponen-tial models with surface and lemma features can be straightforwardly trained for all of them. For the ex-periments described below we trained an exponen-tial model for the p ( Y | X ) lexical model. For greater speed we estimate the probabilities for the other two models using interpolated Kneser-Ney smooth-ing (Chen and Goodman, 1998), where the surface form of a rule or an aligned word pair plays to role of a trigram, the pairing of the source surface form with the lemmatized target form plays the role of a bigram, and the source surface form alone plays the role of a unigram. We investigate the models using the 2009 edition of the parallel treebank from  X  UFAL (Bojar and  X  Zabokrtsk  X  y, 2009), containing 8,029,801 sentence pairs from various genres. The corpus comes with automatically generated annotation and a random-ized split into training, development, and testing sets. Thus, the annotation for the development and testing sets provides a realistic reflection of what could be obtained for arbitrary source text. The English-side annotation follows the standards of the Penn Treebank and includes dependency parses and structural role labels such as subject and object. The Czech side is labeled with several layers of annota-tion, of which only the morphological tags and lem-mas are used in this study. The Czech tags follow the standards of the Prague Dependency Treebank 2.0.

The impact of the models on translation accuracy was investigated for two experimental conditions:  X  Small data set: trained on the news portion of  X  Large data set: trained on all the training data;
All conditions use word alignments produced by sequential iterations of IBM model 1, HMM, and IBM model 4 in GIZA++, followed by  X  X iag-and X  symmetrization (Koehn et al., 2003). Thresholds for phrase extraction and decoder pruning were set to values typical for the baseline system (Chiang, 2007). Unaligned words at the outer edges of rules or gaps were disallowed. A 5-gram language model with modified interpolated Kneser-Ney smoothing (Chen and Goodman, 1998) was trained by the SRILM toolkit (Stolcke, 2002) on a set of 208 mil-lion running words of text obtained by combining the monolingual Czech text distributed by the 2010 ACL MT workshop with the Czech portion of the training data. The decision rule was based on the standard log-linear interpolation of several models, with weights tuned by MERT on the development set (Och, 2003). The baselines consisted of the lan-guage model, two phrase translation models, two lexical models, and a brevity penalty.

The proposed exponential phrase model contains several modifications relative to a standard phrase model (called baseline A below) with potential to improve translation accuracy, including smoothed estimates and estimates incorporating target-side tags. To gain better insight into the role played by different elements of the model, we also tested a sec-ond baseline phrase model (baseline B), which at-tempted to isolate the exponential model itself from auxiliary modifications. Baseline B was different from the experimental condition in using a gram-mar limited to observed inflections and in replac-ing the exponential p ( Y | X ) phrase model by a rel-ative frequency phrase model. It was different from baseline A in computing the frequencies for the p ( Y | X ) phrase model based on counts of tagged target phrases and in using the same smoothed es-timates in the other models as were used in the ex-perimental condition. Parameter estimation was performed using a modi-fied version of the maximum entropy module from SciPy (Jones et al., 2001) and the LBFGS-B algo-rithm (Byrd et al., 1995). The objective included an ` 2 regularizer with the regularization trade-off set to 1. The amount of training data presented a practical challenge for parameter estimation. Sev-eral strategies were pursued to reduce the computa-tional expenses. Following the approach of Mann et al (2009), the training set was split into many approximately equal portions, for which parameters were estimated separately and then averaged for fea-tures observed in multiple portions. The sets of tar-get phrases for each source phrase prior to genera-tion of additional inflected variants were truncated by discarding extracted rules which were observed with frequency less than the 200-th most frequent target phrase for that source phrase.

Additional computational challenges remained due to an important difference between models with shared features and usual phrase models. Features appearing with source phrases found in development and testing data share their weights with features ap-pearing with other source phrases, so that filtering the training set for development and testing data af-fects the solution. Although there seems to be no reason why this would positively affect translation accuracy, to be methodologically strict we estimate parameters for rule and lemma features without in-flection features for larger models, and then com-bine them with weights for inflection feature esti-mated from a smaller portion of training data. This should affect model performance negatively, since it precludes learning trade-offs between evidence pro-vided by the different kinds of features, and there-fore it gives a conservative assessment of the re-sults that could be obtained at greater computational costs. The large data model used parameters for the inflection features estimated from the small data set. In the runs where exponential models were used they replaced the corresponding baseline phrase transla-tion model. Table 1 shows the results. Aside from the two base-lines described in section 7 and the full exponen-tial model, the table also reports results for an ex-ponential model that excluded gender-based features (and hence non-local target-side dependencies). The highest scores were achieved by the full exponential model, although baseline B produced surprisingly disparate effects for the two data sets. This sug-gests a complex interplay of the various aspects of the model and training data whose exploration could further improve the scores. Inclusion of gender-based features produced small but consistent im-provements. Table 2 shows a summary of the gram-mars.

We further illustrate general properties of these models using toy examples and the actual param-eters estimated from the large data set. Table 3 shows representative rules with two different source sides. The column marked  X  X o infl. X  shows model estimates computed without inflection features. One can see that for both rule sets the estimated probabil-ities for rules observed a single time is only slightly higher than probabilities for generated unobserved rules. However, rules with relatively high counts in the second set receive proportionally higher es-timates, while the difference between the singleton rule and the most frequent rule in the second set, which was observed 3 times, is smoothed away to an even greater extent. The last two columns show model estimates when various inflection features are included. There is a grammatical match between nominative case for the target word and subject po-sition for the aligned source word and between ac-cusative case for the target word and direct object role for the aligned source word. The other pair-ings represent grammatical mismatches. One can see that the probabilities for rules leading to correct case matches are considerably higher than the alter-natives with incorrect case matches. This paper has introduced a scalable exponential phrase model for target languages with complex morphology that can be trained on the full parallel corpus. We have showed how it can provide esti-mates for inflected forms unobserved in the training data and described decoding procedures for features with non-local target-side dependencies. The results suggest that the model should be especially useful for languages with sparser resources, but that per-formance improvements can be obtained even for a very large parallel corpus.
 I would like to thank Philip Resnik, Amy Weinberg, Hal Daum  X  e III, Chris Dyer, and the anonymous re-viewers for helpful comments relating to this work.
