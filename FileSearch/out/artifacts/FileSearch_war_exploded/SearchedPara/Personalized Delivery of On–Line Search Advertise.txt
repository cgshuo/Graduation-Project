 Search engines can earn millions of dollars each day through their sponsored search advertisement systems such as Adwords in Google, Overture in Yahoo. They sell the query words. There are millions of queries each day, however, frequencies of queries are quite different. For example, the query word  X  X pple nano X  may occur 10000 times each day while the query word  X  X athematic book X  may only happen 10 times. So a lot of advertisers may bid the keyword  X  X pple nano X  for advertisements. Only limited nano X . Therefore, sponsored systems often make use of auction principles. Though it may not be always true, most systems suppose that high positions in the advertisement space get more attention and more click-through rate (CTR), and the bidder may get more chances to draw consumer to its product page or homepage. With this idea, the be displayed, and in what order for each query. The ranking of advertisements has a strong impact on the revenue of the search engine from clicks of the ads. At the same prove user satisfactions. For this sake, most search engines rank the ads by taking into account of both bid values per click and the ad X  X  click-through rate. Some other sys-tems may also consider conversion rate of the advertisement, however it is difficult for a search engine system to get detail information regarding advertisement conversion. 
Most of past algorithms for delivery of online advertisements are based on common same word to query. As a matter of fact, different users show quite different interests to the same advertisements even if they query the same word. For example, user1 searches  X  X omputer X  only for this time while user 2 has queried this word and other semantically word. In this paper, we tackle the problems of personalized delivering advertisements based on individual user X  X  interests. In our approach, individual user X  X  interests are evaluated based on their query histories, advertisement click histories, as well as adver-advertisements with best revenue of search engines. Both of those objectives are com-plementary, since the first target is to satisfy user X  X  searches, and the second target is to increase the revenues of search engines. Our algorithm combines these two targets to-gether to raise the overall performances of the advertisement systems. 
Research group from Yahoo has built a static linear programming model [1] and a dynamic model [7] to maximize the utility slate for advertisement scheduling. Both of them make use of common search behaviors of users. In this study, we construct our interests. tisement schedule algorithm is addressed in section 3; user interest model is investi-conclude the paper. Mehta et al. use a trade-off function with the fraction of the bidder X  X  budget that has been spent so far, and it get the competitive rate 1  X  1/e [5]. Karp et al. indicate that no randomized online algorithm can have a competitive ratio better than 1  X  1/e for the bi-matching problem. Abrams, Mendelevitch, and Tomlin in yahoo research make use of stochastic information and model the allocating problem with column genera-tion linear programming model [1]. Mahdian, Nazerzadeh, and Saberi do not only consider the stochastic information but also consider whether the estimate of the query frequency is accurate [2]. Recently, Ghose and Yang use a dataset of several hundred keywords collected from a large nationwide retailer that advertises on Google, and they find that the presence of retailer-specific information in the keyword increase click-through rates, and the presence of brand-specific information in the keyword increases conversion rates [4]. There is a very important constraint for the advertisement bid with each keyword. Each advertisement has a budget each day. When the budget of the advertisement balance becomes 0, the advertisement will not be displayed when the query received by the search engine, even though all the other advertisements have not bidden this query word. The daily budget constrains the number of times their ads appear each day. In the generalized second price auction scheme, this constraint produces impact completely, the corresponding advertisement will be kept out from the auction sys-tem. Such situation will influence other advertisements cost per click with the same keywords, thus reduce the revenue of the search engine. Therefore, it is very impor-tant to protect all the advertisements from using up their daily budgets completely. query frequency can be predicted from history query log, but the data may have big differences with real values. 
With these two constraints, Abrams et al. propose an approach based on linear pro-gramming to optimize ads delivery [1]. In their approach, linear programming model with column generation is employed to find the optimal scheduling of advertisements [8]. For each linear programming, there is a dual problem for the prime problem (for more detail, see [8]). Then we can get a important parameter  X  j from solving the dual problem with column generation model. Where parameter  X  j is called a  X  X tility fac-tor X  associated with the appearance of bidder X  X  ad in response to query [7]. Keerthi et al. make use of  X  j to generate an algorithm for constructing an optimal slate of online advertisements [7]. They model the problem s with an optimal path approach search-ing (minimum path algorithm) to construc t an optimal slate. Their work obtains a good result from their simulation as long as the predicted clickthrough rate really reflects the real situation. This assumption is obviously too subjective. 
Feng Qiu and JunghooCho find that users ar e reluctant to provide any explicit in-put on their personal preference [10]. They study how a search engine can learn a user X  X  preference automatically based on users X  past click history and how it can use the user preference to personalize search results. Benjamin Piwowarski and Hugo Zaragoza in yahoo research find that query logs have the potential to partially allevi-ate the search engines from thousand of searches by providing a way to predict an-swers for a subset of queries and users without knowing the content of a document [11]. They present three different models for predicting user click, ranging from most specific ones (using only past user history for the query) to very general ones (aggre-gating data over all users for a given query). The former model has a very high preci-based on recall which reflects the probabilities that users will re-use the same query in search engine, then the probability to click the same document is very large. Our goal is to deliver a set of ads (slate) in response to a query of an individual user. Similar to [7], we denote the n bidders on one query by j = 0,..., n , and suppose that Generalized Second Price auction (GSP) is used to rank the advertisements [13]. Work [1] extends GSP to what is known as revenue ranking, where the ads are ranked not by bid values, but by general expected revenue of the search engine which is modeled as the product of the advertiser X  X  bid value A j and Q j which is called as qual-ity score, or clickability, for bidder j  X  X  ad. Let the number of indexes also indicate the revenue ranking. This quantity is supposed to be better to represent the value of bid-den ad than the raw bid value. Thus, the ads are ranked as: 
In this paper, we propose a new scheme called  X  X ersonalized revenue ranking X , where the ads are not ranked by general expected revenue, but ranked by personalized expected revenue which is taken into account of both bid values, and individual user X  X  when scheduling advertisements. Thus, in our proposed method, personalized revenue scheme ranks the advertisements as: 
With the principles of Generalized Second Price scheme [13]. In our personalized revenue ranking, we require that the ex pected cost per click (CPC) of bidder j p must be at least 
Because the limited space for displaying advertisements, only a subset of ads can be displayed for each query. We set m positions for displaying advertisements in the where k &lt; m , of the ordered set of ads { 1,..., n }. Since we assume a second-price auc-tion is used for the slot action, bidder j p in position p pays the bid occupying position p +1. In addition, there is a minimum bid  X  , which is paid by the these assumptions we wish to solve maximum problem: Maximize near to its budget. 
We make use of optimal path approach as in [7] to solve the optimal scheduling problems for the personalized delivery of the online ads, which successfully trans-forms dynamic programming to the optimal path problem. It is obvious that, if one gets more interest in an ad, he may have more probability to click the ad when it is displayed. Hence, we couple click-through rate of individual responded to one query. If a user feels that ad 1 is getting more relevant to his interest, he has more probability of clicking ad 1 when seeing these two ads. Therefore, how to model the user X  X  interests is a key point in our approach. We assume that interest score of a user to an ad is between 0 and 1. We cast it as a regression problem X  X hat is, to predict the Interest Score, given a set of features. Similar to work [3], we define user X  X  interest to an advertisement as: corresponding feature. Features may be anything, such as a session of queries per-formed by user u , overall query history of user u , or overall click history for ads. (We will discuss it in detail in the next section). 
Although our model for user interests to each ad seems like click through rate, but it is difficult to collect the value of click through rate. It can not be calculated as the number of clicks divided by the number of views (number of showing to users). Firstly, the number of views is limited when the same ad is viewed by the same user. Secondly, if one user has clicked one ad, he may not want to click the same ad again. collect the true value corresponded to pred icting user interest. However, if user u has actions to ads. In our implementation, if the interest score of user u to the clicked ad feature. Otherwise, it is decreased. The auto matically adjusting formula is defined as: query, and  X  is a small constant controlling the learning rate. As we known, there two types of history queries. One is session oriented, in which only the queries within the same access session of the user are taken into account to predict the user X  X  interests. Another one involves all the historical queries of the same user since he firstly registered to the system. In this paper, we define two measures for estimating user interest with respect to these two types of history queries. 5.1 User Interest with Queries in Session Many personalized search methods make use of history queries in the same session to expand the current search in order to derive the user X  X  search intention. In our work, we do not only use history queries to expand the search, but also to find more relevant ads to schedule for the user. For example, there are three ads in the figure 1. Ad 1 bids three keywords,  X  X hinkpad X ,  X  X deapad X  and  X  X otebook X ; ad 2 bids two keywords,  X  X hink-pad X  and  X  X otebook X ; and ad 3 bids five keywords,  X  X enove X ,  X  X otebook X ,  X  X BM think-pad X ,  X  X 200 X  and  X  X 400 X . 
We further suppose there are four queries in the same session from a user with a search engine. The history queries and current query are as following: 
To simplify the model, we just calculate the ratio of ad X  X  keywords over the total words in the user X  X  query session. So the user X  X  interest to ad j is defined as: number of keywords bidding for ad j , and N u,j is the number of those bidding keywords which also occur in any queries of user u , and  X  is Boolean function to indicate whether query q s contains some bidding keyword of ad j . In this example, the degrees get more interest in ad 3 in current query session. 
However, we have two objects for allocating these ads to current query. The first queries may not clearly indicate the user X  X  search intention). After expanding key-words, all three ads in the example may respond to the current query. The second object is to find user X  X  preference degree to those ads. In general, history queries which are more close in time to current query are more relevant and important to derive the user X  X  current intention for search, so the query position in the session should be taken into account. For such sake, we define session oriented user interest to ad j as: where s is the position index of query q s in the current session, and all other parame-in q 1 , q 2 and q 3 , and 1/5, 2/5, 3/5 are corresponding to these queries respectively. For each ad, we get: 1. f 0 (u,1)=(1/5+2/5+3/5)*2/3 =0.8; 2. f 0 (u,2)=(1/5+2/5+3/5)*2/2 =1.2; 3. f 0 (u,3)=(1/5+2/5+3/5+4/5+5/5)*5/5 =3; important than ad 1 and ad 2 to user u . This formula is based on both timestamp of key-words and the frequency of keywords in the query session. Our experiments show this consideration can significantly improve the performance of the advertisement system. 5.2 User Interest with Overall History Queries The basic idea of user interest model with respect to overall history queries is dis-cussed in this subsection. Firstly, there are some of keywords bidden for each ad, and each keyword in the queries indicates some intention of the user. However, there are different degrees of interests for each keyword individually. In this work, the second feature for the user interest model is defined as: where M j is the total number of keywords associated to ad j , and N u,j is the number of queries in logs, and | Q u | denotes the number of user u  X  X  history queries in logs, and k i,j the sum of individual keyword interests to ad j . 
For example, if an ad bid some keywords, such as  X  X obacco X ,  X  X etail X ,  X  X arijuana X , and  X  X et high X . There are two users querying  X  X obacco and pipes X , how to know their different interest degrees to the same ad? From history queries within three months, u 1 performed 218 queries and u 2 did 121 queries respectively. And the frequencies of query words of u 1 and u 2 are as in the following table. u  X  X  degree of interest to keyword  X  X etail X  is 5/218, and u 2 is 0. u 1  X  X  degree of interest to keyword  X  X arijuana X  is 13/218, and u 2 is 0. u 1  X  X  degree of interest to keyword  X  X et (4/121)*(1/4) respectively to u 1 and u 2 , and u 1  X  X  interest is bigger than u 2 .  X  X ap X ,  X  X uide X ,  X  X otel X  and  X  X lorida X . Ad 2 bids keywords  X  X ravel X ,  X  X ap X ,  X  X eorgina X  and  X  X niversity X . A user searches with query  X  X otel X  in search engine and the search engine delivers these two ads, so how different about scores of interests of these two ads to the same user. For history queries in three months, this user with id 220 got 332 queries. The frequencies of query words of user 220 are as following table: 
Therefore, the interest scores of this user are (129/332)*(4/4) and (39/332)*(3/4) respectively to ad 1 and ad 2 , and u get more interest in ad 1 than ad 2 . 5.3 User Interest with History Views and Clicks performed by u , and this feature produces negative impact to interest. Then we define the third feature as: where Clicks u,j is the number of clicking ad j of u . other word, u loses the interest to ad j . So the forth feature is the number of ad j show-fine the forth feature as: where Views u,j is the number of clicks when user u clicked on the ad j. 
We find that it is promising with our experiments when we set the two parameters  X  as 1/3, 1 respectively. Though advertisement visual features, such as visual or text description quality [12], may also influence the user X  X  interest to the advertise-ment, we ignore them in the current study. Figure 2 shows an example of our search advertisement scheduling. The left column shows the scheduled advertisements of our algorithm. In order to test our approach, we do not only evaluate the performance of predicting user X  X  interest to ads responded to each query, but also evaluate the performance of the personalized schedule algo-position of ads in the same search result page. If a user clicks the ad with largest pre-dicted degree of interest, we denote the click as an accurate click , and otherwise we denote this click as an error click. The accurate click ratio is defined as: formance the user interest model works. 
For the second objective, we evaluate revenue of our proposed approach against the baseline algorithm which schedule ads based on general click-through rate. 
We collect some ads bidden with multiple keywords. For each query, ads are scheduled and displayed on the pages of query results. We capture each ad X  X  degree of interests to different users, views and clicks of ads from each user. Then we compare the degree of interest of the clicked ad with other ads X . If the degree of interest of the clicked ad is the largest one, then we increase the number of the accurate clicks. If the degree of interest of the ad is not the largest one, we will improve the weight of each feature using equation (6). 
To evaluate our algorithm, we perform the following steps for each query: 1. Get all the ads bidden with the keyword contained in this query 2. Calculate all the features and the degree of interest as discussed in the section 3. Log those interest degrees, feature values, the number of views of ads showing 
We further perform the following actions when any click happens: 1. Record the cost of this click, and increase the number of clicks of this ad. 2. Check if this clicked ad X  X  degree of interest is the largest one. If yes, we in-
For baseline algorithm, we perform the following steps: for each query we get all the ads bidden with the keyword contained in this query, ordered by the bid per click users. 
In figure 3, there are nine bidders in response to query  X  X abric X . For different users, played ads. So d1 is the largest one when u1 queries  X  X abric X . If u1 click one ad from these 5 ads, we check if it is accurate click or not. If u1 click the ad with the largest degree of interest, we get more confidence for our prediction. Then, we increase the number of accurate clicks in order to increase the accurate click ratio. Otherwise, we should change the weight of features instead. 
Figure 4 shows that our simulation results are quite promising. Even through our accurate click ratio is very low in the beginning, it increases with consequently adjust-the weights of features automatically. 
From figure 5, we find that the feature weights of session history, global query his-tory, views of ads, and clicks of ads become more and more stable along increasing clicks. It tells us those features are very important for scheduling advertisements. But we also find the weight of quality score of ads has no fixed pattern in change.
Figure 6 shows the revenue improvement of our proposed scheduling mechanism over general click-through model. The revenue improvement of our proposed model is obvious, comparing with baseline algorithm, with about 28% increase. In this paper we proposed a framework for personalized delivery of online advertise-ments based on users X  past search histories. In particular, we use optimal network path approach to generate maximum utility slate. The proposed approach can generate implementation, we construct the user interest model with taking into account of both words associated with ads and words in users X  query history. 
We have conducted experiments to evaluate our approach. In our simulation ex-periments, we found that our model can predict user interest accurately. It shows that our method is both effective and easily applicable to real-word search engines. If the history queries are very limited, we should take the combining predictions. We are currently working on probabilistic schedule algorithm that can combine dynamic programming algorithm as in yahoo-research and our approach. In the future, we plan to expand our framework to take more user-specific information into consideration. Acknowledgement. This Work was supported in part by the University Research Committee under Grant No. RG069/05-06S/07R/GZG/FST and by the Science and Technology Development Fund of Macao Government under Grant No. 044/2006/A. 
