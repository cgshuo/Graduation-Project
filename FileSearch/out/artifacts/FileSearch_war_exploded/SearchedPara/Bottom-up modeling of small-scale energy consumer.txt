 1. Introduction
Optimal operation of the electrical power grid requires ef balancing between supply and demand in real time. Given this requirement, utilities, energy retailers and Distribution System
Operators (DSOs) need to estimate and schedule their aggregate energy portfolio (consumption/production) for an extended time horizon. Typically, slight increases or decreases in demand are dealt in Day-Ahead or Real-Time Energy Stock Markets, where additional supplies' procurement or surplus energy sale is possible ( Holmberg and Newbery, 2010 ). All in all, contemporary power systems can roughly forecast expected power demand and predict some of the power peaks, based on historical data, thus ensuring the proper operation of the power grid. However, the grid's quality of service is far from optimal, since it does not lead to major energy savings and grid stability. Were one able to perform small-scale consumer modeling and power peak smoothing, numerous pro-blems related to grid stability can be dealt with Symeonidis et al. (2011) .Todoso,onehastounderstandtheend-usehabitsofthe inelastic consumers, such as households or small businesses.
The residential sector accounts for a major portion of the overall energy consumption worldwide ( Eia, 2011 ); still, it remains as an uncharted and unattended  X  region  X  . First of all, real-time monitor-ing and control systems are mainly applied to the generation and transmission phases of the electrical grid, or to large commercial/ industrial consumers and not small-scale consumers. Additionally, there is little margin for demand control (and, thus, pro individual small-scale consumers and it can only be applied if the respective infrastructure is installed (smart meters, smart appli-ances). Practically, changes in small-scale consumption can only be achieved via changes in everyday consumer habits and activi-ties triggered by personalized pricing incentives (e.g. Time-of-Use pricing schemes, Albadi and Elsaadany, 2008 ). Such incentives should suggest limited alterations, otherwise they will signi affect consumers' comfort and may not be accepted.

On the other hand, should one succeed in modeling small-scale consumers in an activity-and a comfort-based context, the gains would be substantial. Small modi fi cations in each individual consumption can have a major impact on the aggregate power demand. For example, a utility may succeed in high acceptance rates via the appropriate Demand Response (DR) programs, where end-use customers deviate from their normal consumption pat-terns, in response to electricity price changes over time or load ( The et al., 2006 ). Thus, by modeling the interaction between the small-scale consumers and the energy suppliers/aggregators (Fig. 1 ) one could predict the resulting impact or savings, make decisions to stabilize energy supply or provide incentives for installation retro fi tting and electrical appliance upgrade.
Current work introduces a modeling approach for small-scale consumers based on electrical consumption measurements that can aggregate their appliance and/or activity end-use. An event detection algorithm has been developed to analyze installation consumption data and train appliance consumption and consumer activity models. These models can then be used to simulate small-scale consumption at different aggregation levels, starting from a single appliance up to an entire installation. Furthermore, a consumer response model has been designed comprising a set of load shifting operations that are speci fi c to pricing incentives.
An Autonomous Household Agent (AHA) architecture, that integrates the proposed consumption and activity models, is also presented. Fig. 2 illustrates how the proposed agent implements the interaction with the environment in the context of the power system. Each AHA interacts only with the household appliances and the aggregator (or energy supplier). Note that, since electricity consumers act independently in real-life, no communication between individual AHAs is performed. The proposed agent architecture and associated models allow not only the estimation and simulation of aggregated expected power consumption, but also the evaluation of the impact of appliance usage habits changes on the aggregated load curve. In the context of this paper, experiments were carried out using real electrical measurements collected from the EU-funded DEHEMS project. 1 Results indicate that (i) the proposed modeling approach leads to accurate load prediction, and (ii) small changes in appliance usage patterns are suf fi cient to signi fi cantly increase demand side control and, thus, increase the power network stability.

The rest of the paper is organized as follows. Section 2 provides a focused overview of the state-of-the-art on small-scale consumer modeling, including agent-based approaches. Section 3 discusses the agent architecture and the embodied modules and de fi nes the consumer modeling elements (consumption models, activity models etc.). Section 4 presents the experimental evaluation of the proposed approach while Section 5 summarizes work performed, probes on directions for further research, and concludes the paper. 2. State of the art
In order to evaluate Demand Response potential, as well as the impact of new technologies in individual installations (such as smart appliances and renewable production capabilities), small-scale consumers must be modeled with respect to their end-use behavior and the appliances within the installations. This grained and tuning-enabling modeling methodology used for (mostly) residential sector energy consumption is Bottom-up (as opposed to the Top-down approaches that treat the residential sector as an energy sink and regress or apply factors that affect consumption to determine trends, relying on statistical data and economic theory, Swan and Ugursal, 2009 ). In principle, bottom-up modeling approaches use individual household models and aggregate the results. Aggregation is achieved by extrapolating models to group households, neighborhoods, cities and so on, by combining measurements with demographic data. Bottom-up modeling methods can be classi fi ed into two main categories: Statistical and Engineering ( Swan and Ugursal, 2009 ).
Statistical methods model the aggregated household consump-tion without mapping the load curve to consumer end-uses. Thus, they cannot be used for modeling consumer behavior and design-ing effective DR programs. On the other hand, Engineering methods (EM) rely on more detailed information, but the models are built on assumptions made by human experts and demographic data and do not rely on historical values, although historical data can be used for calibration.

White-box Power Models : An interesting subset of EM that allows for some parametrization is denoted in the bibliography as White-box Power Models (WBM) ( Paatero and Lund, 2006 ). They are able to calculate use over time for each appliance and aggregate to determine total demand. These models enable consumption micro-management and retro fi t (e.g. smart appliance purchases and micro-generation), since changes in household demand can be attributed to individual loads, as well as impact assessment of various pricing policies ( Gottwalt et al., 2011 ).

The fi rst work in this direction was made by Walker and Pokoski (1985) . They de fi ne models based on an  X  availability  X  statistically estimates the number of residents of an installation that can use an available appliance, and on a  X  proclivity  X  function, which de fi nes the probability that an individual will use a speci fi appliance at any given time of day. The most well known WBM approach, though, is presented in the work of Capasso et al. (1994) , who employed distributions based on demographic surveys over appliance ownership, family types and lifestyle to create appliance use pro fi les of the Italian residential sector and compare them against existing load recordings.

On the other hand, Paatero and Lund (2006) presented a residential electricity consumption data on an hourly basis from a few up to thousands of households. The model exploits input data available in public reports and statistics. The conducted analysis indicates that the generated load pro fi les correlate well with real data. Firth et al. (2008) conducted a study on the electricity consumption of UK residential buildings, in order to investigate the ongoing patterns of different energy user groups (low, medium and high level consumers) and their contribution to the overall consumption. Interesting results were drawn, illustrating the poten-tial for applying various incentive schemes. Armstrong et al. (2009) generated detailed Canadian household electrical demand pro using a bottom-up approach from available inputs, including a detailed appliance set, annual consumption targets and occupancy generation devices to examine issues related to system perfor-mance, ef fi ciency and emission reduction potential.
Lately, Gottwalt et al. (2011) presented a simulation model that generates household load pro fi les under fl at tariffs. The impact of smart appliances and variable prices on electricity bills and household consumption was investigated and the results show that the savings from installing smart appliances are moderate compared to the required investment. Molitor et al. (2012) presented an approach for generating realistic load models of individual homes with a high resolution, while reducing the required input information. The households can be parameterized by their annual electricity consumption and their electrical appli-ances equipment, allowing generation of realistic time series of electrical energy demand.

Bajada et al. (2013) propose another bottom-up approach that uses non-homogeneous Markov chains to model each appliance within each household. Their model is time-aware and captures the variability of the transition probabilities as they change throughout the day. A simulator was developed based on this model, where hypothetical scenarios could be realized. Finally, in the work of Holub and Sikora (2013) a platform for automated demand response (ADR) services in residential neighborhoods was introduced, with the main focus on user behavior. They developed an algorithm which can be used to generate time series of electrical loads representing individual households. Each produced scenario has a realistic consumption pro fi le with optional house-hold equipment setups, while assuring that the average of a large amount of such scenarios follows typical load pro fi le statistics.
Activity-oriented models : Recently there is an increased interest in activity-oriented consumption modeling. In these approaches, the goal is the prediction of activity sequences in the daily routine and activity consumption based on the appliances participating, in order to estimate the overall load curve of an installation. In the work of Jardine (2008) , a method of synthesizing high-resolution domestic electricity loads has been developed in order to provide the necessary accuracy to a forthcoming network model. It is based on measured 30-min resolution data of household loads and average appliance usage. The model utilizes an occupancy model, which can serve as a proxy for both non-base load electricity demand and heat demand. Synthesized  X  activity  X  pro fi les are then generated for a sample of 1000 homes. On the other hand, Gil-Quijano and Sabouret (2010) propose a mechanism for predicting domestic human activity in a smart home context. These predic-tions are used to adapt the behavior of home appliances. The appliance behavior is built by employing a reinforcement learning mechanism and a set of experiments was run to compare the extracted behaviors with both a merely reactive behavior and a state-permanent behavior.

Subbiah et al. (2013) proposed a modeling framework aimed at generating household energy demand pro fi les based on individual-level energy consuming activities. The model associates appliance usage for each household activity and calculates energy consumption based on the appliance energy rating and duration of activity. This work also proposes a novel approach to resolve correlation and consistency problems in the generation of individual-level and household-level  X  shared  X  activities, which occur due to household members interactions. In another context, Ford et al. (2013) introduce Suricatta , a platform to model the power demand of a network of dwellings, allowing demand from one dwelling to in fl uence in real time demand from others. The demand of each dwelling is determined by aggregating the demand of individual appliances, enabling the potential impact of demand side management (DSM) to be investigated at both grid and household levels.

Special mention should also be made to several recently published approaches, based on high-resolution domestic building occupancy models, attempting to predict the overall energy consumption and any inter-relations between household members that may exist (e.g. Tanimoto et al., 2008; Robinson et al., 2011; Wid X n et al., 2012 ). The major drawback of most of these approaches is that they are based on consumer data collected from diaries, meaning that the experiment participants had to their daily activities in 10 or 15 min intervals for the duration of the tests.

Agent-based approaches : In an effort to increase the scale of experiments and to simulate real-life scenarios, agent technology (AT) and especially multi-agent systems have been considered. And though they have been successfully applied to model power markets (see the survey by Zhou et al., 2007 ), there is not much work on modeling small-scale power consumers as individual and autonomous entities.

Sonnenschein et al. (2006) described an agent-based simula-tion tool for examining the impact of real-time pricing methods on the power consumption of domestic users (households). The main entities within the model are electricity suppliers and electricity consumers, scheduling their demand according to real-time prices for electricity. In Xu et al. (2008) , a hybrid econometric and social in fl uence model was implemented for evaluating the in fl uence of pricing and public education policies on residential habits of electricity use in power resources management. Abras et al. (2008) implemented a multi-agent Home Automation System (MAHAS), dedicated to power management, that adapts power consumption to available power resources according to inhabitant comfort and cost criteria.

Karnouskos and De Holanda (2009) , on the other hand, presented the emergent concept of a future smart city grid. They designed and built a simulator, based on software agents, that attempts to capture the behavior of a smart city, by simulating discrete heterogeneous devices that consume and/or produce energy, able to act autonomously and collaborate. Similarly, in
Vytelingum et al. (2010) and Ramchurn et al. (2011) , residential consumers are modeled as autonomous agents (SmartHome), responsible for shifting their consumption in order to maximize the residential revenue in addition to several social welfare factors.
Finally, Truong et al. (2013) propose an agent based prediction algorithm that captures the everyday consumption habits of residents by exploiting their periodic features. In addition, their algorithm employs an episode generation hidden Markov model (EGH) to model the interdependency between appliances, demon-strating better results than any other existing method on activity prediction.

Comparison with the state of the art : Our paper extends the work on White Box (Power) Modeling, Activity-oriented and
Agent-based approaches by using appliance-level household con-sumption measurements to build detailed stochastic activity and appliance models that aggregate to a small-scale consumer model without any other input requirement.

Most WBM are based on statistic reports and demographics about appliance ownership, average use, occupancy etc., that are used to generate time dependent probabilities of appliance pro-fi les, on/off times of use, and the resulting energy consumption.
This is in fact the most apparent drawback of WBMs: occupant behavior models are static and in most cases do not originate from real measurement data.

On the other hand, Activity-based approaches, even though well fi tted for modeling small-scale consumers at a fi ne-grained level, are in need of a training set of predetermined activities and the appliances participating in each activity, in order to perform well and reach an acceptable level of prediction. As far as the approaches based on detailed diaries are concerned, they are usually small in scale (meaning small number of participants), since they can be highly intrusive, and thus they are error-prone.
In the approach presented in this work, the created models allow for estimating the changes in households' daily power curves as a result of changes in appliances' end-use behavior.
Coupled with a set of response models (i.e. how consumers react to pricing variations by altering their activities), the proposed approach enables the design and simulation of effective DR programs, targeting changes in appliance end-use that can lead to signi fi cant peak reduction. The main contributions of the presented work therefore are 1. The use of dynamic, data-driven small scale consumer models that extend the WBM of the bibliography. Our approach tackles their inbound problems by building custom models for each simulated small-scale consumer, based on consumption mea-surement data originating from the actual installation's smart meters; not on demographics and survey reports. Thus, more analytic, specialized and precise models are created. 2. The automatic generation of small-scale consumer pro fi based solely on electricity measurements. This comes in con-trast with most activity-based approaches which are in need of further input. The activity consumption and the end-use behavior are extracted automatically from the raw measure-ments data by the modeling procedure. 3. The introduction of a set of response models that can be used to evaluate the reaction of consumers to pricing signals. In our approach, three different types of responses are modeled, based on real pilot cases from several demand response European projects ( Stromback et al., 2011 ), to evaluate how the consump-tion may vary in different pricing policies and incentives.
Finally, it should be noted that although interesting, none of the aforementioned Agent-based approaches attempts to model con-sumption habits or response; their main goal is the decentralized control of shiftable loads and the optimal utilization of renewable energy sources, thus leaving out all issues related to everyday activity and convenience planning. 3. Household agent architecture and consumer modeling elements
In our work, an Autonomous Household Agent (AHA) archi-tecture is introduced. AHA agents are capable of (i) building consumer activity models from electrical consumption measure-ments, (ii) simulating consumption based on the implemented models and (iii) responding to incentives/messages by adapting its activity models and altering consumption patterns accordingly. A formal description of the AHA architecture is provided in Z Notation (for more details see d'Inverno and Luck, 2004 )in Appendix A .

The proposed agent architecture is modular, as shown in Fig. 3 , and comprises four modules organized in two subsystems.
Furthermore, the fl owchart of the agent operation, indicating which processes are executed in each module, is illustrated in
Fig. 4 . 1. Event detection module ( EDM ): EDM processes available data-sets, prepares training sets and applies the Event Detection algorithm discussed in Section 3.1 . The input needed for the aforementioned analysis, i.e. measurements from appliances, is collected either from fi les provided by the user, or directly from device interfaces (smart devices). In case smart meters are installed, measuring the overall household consumption, dis-aggregation methods can also be utilized to identify the consumption of individual appliances ( Marceau and
Zmeureanu, 2000 ). 2. Event analysis and modeling module ( EAMM ): It analyzes the event dataset extracted from EDM and derives consumer activity models that can simulate the appliances' consumption patterns. These models are passed on to the next module to be tested and applied. 3. Simulation and aggregation module ( SAM ): The SAM module is used for simulating the appliance and activity models extracted from EAMM and aggregating them to the overall consumption of the household. 4. Shaping module ( SM ): It allows the agent to respond to pricing incentives by altering the EAMM models, leading to change in the appliance end-use and, ultimately, to the power load curve. 3.1. Event detection module
A consumption event (or simply event )isde fi ned as a pair  X 
T ; d  X  of the start time and the duration of appliance operation by the end consumer, where d  X  T off T on . Given a stream of power consumption measurements, one from each appliance, the goal of the EDM is to automatically identify the parameters  X  T on events that can be detected from the data. To this end, we employ a two-step heuristic algorithm: 1. The initiation of an appliance's operation T on is marked when the appliance consumption exceeds a pre-speci fi ed threshold.
Obviously, this threshold differs for each appliance. In order to achieve high noise tolerance, the threshold is usually set as a fraction (1/3 or 1/5) of the nominal operating power of the appliance. 2. The end of the operation T off is marked differently for each appliance type. In most appliances, zero or near zero consump-tion means the end of the use. Nevertheless, there are several appliance types whose operation cycle demands pausing for certain time intervals, meaning (almost) zero consumption during that time. Based on the appliance consumption model c a , a cycle counter or a time duration threshold is used to identify the end of operation.

An outlier(s) detection and removal step follows, where erro-neous values are identi fi ed and removed. These can be identi as events with power consumption excessively greater than the nominal value of the appliance, or as events lasting signi longer than they normally do. 3.1.1. Appliance consumption models
Electrical appliances are categorized by type (e.g. cooking oven, washing machine), following the approach de fi ned in Analytics (2005) . The appliance type does not only characterize its usage, but also its consumption, since appliances of the same type may have similar power consumption patterns.

In this work, each appliance is fully de fi ned by a consumption model , c a . There are two main categories of consumption models: 1. Single operation cycle consumption model ( SOC ). The consump-tion of the appliance remains the same during appliance operation. There may be several operating scales, depending on the appliance type or the manufacturer. Examples of such appliances include boilers, TVs, light bulbs and toasters. In SOC models, c a is de fi ned as c a  X  t  X  X  where P nom is the nominal operating power consumption of a certain appliance a , T on and T off are the switching on and switching off operation points respectively and l is the level of operation of the appliance. A model with constant consump-tion is a special case of the presented model with l  X  1. 2. Multiple operation cycles consumption model ( MOC ): More com-plex appliances (washing machines, ovens, dishwashers etc.) have more than one operation cycles. Since the number of operation cycles may differ for each appliance type and each cycle may have its own electrical consumption pattern, the resulting model in these cases is more intricate. In MOC models, c a is de fi ned as c a  X  t  X  X 
Even more intricate consumption models can also be con-structed by combining these categories, or by using variable instead of constant nominal power values. It should be noted that in the experiments presented in this work these models are suf fi cient for data processing and consumption modeling purposes. 3.2. Event analysis and modeling module (EAMM)
Consumer activity models encapsulate habits concerning the end-use of appliances. These activity models need to be expressive enough to capture different usage patterns of occupants for each appliance, while at the same time simple enough to be constructed with a relatively small amount of electrical measurement data.
Formally, the consumer activity model B a of appliance a is de fi ned as the set of three random variables: B  X f n a ; s a ; d a g X  3  X  where n a is the number of times appliance a is operated during a day, s a is the time index the appliance is switched on (in minute intervals during a day, i.e. up to minute 1440) and d a is the duration of the appliance operation. These random variables are described by their corresponding probability density functions (PDFs): n : N a  X  n  X  ; n  X  0 ; 1 ; ...  X  4  X  s : S a  X  s  X  ; s  X  0 ; ... ; 1440  X  5  X  d : D a  X  d  X  ; d  X  0 ; 1 ; ...  X  6  X 
The exact types of PDFs employed in our analysis are discussed in the following section. The set B a and the associated random variables fully describe consumer's end-use of the appliance a .
Load shaping, in the presented context, is achieved by slight modi fi cation of the PDFs of B a in response to pricing variations, as described in Section 3.4 . 3.2.1. Selection of probability density functions
The consumption events from the appliances are used to build consumer activity models. We employ two types of probability density function estimation approaches: Frequency Histograms ( FH ) and Gaussian Mixture Models ( GMM ).

While the FH approach is straightforward, histograms are less accurate when a limited number of samples are available for estimation ( Sircombe, 2004 ). In our approach, histograms are used for the estimation of the PDFs N a ( n ) and D a ( d ) (the number of events per day and duration for appliance a , respectively).
For S a ( s ), parametric estimation approaches are more appro-priate, especially in cases of limited data availability. These PDFs are estimated using GMMs de fi ned as a weighted sum of M
Gaussian component densities ( McLachlan and Basford, 1988 ): f  X  x  X  X   X  M where x are the values of a random variable x ( s or sometimes d in our case), w i ; i  X  1 ; ... ; M are the mixture weights, and
N  X  x j
GMM parameters are estimated from the event time indices (for T on ) and durations (for d ) detected by EDM (Section 3.1 ). Estimation is carried out using the iterative Expectation-Maximization ( EM ) algorithm with Maximum Likelihood
Parameter Estimation ( Dempster et al., 1977 ) for selecting the optimal GMM parameters ( w i ,  X  i and  X  i ) and KL-divergence distribution distance for selecting the optimal number of mixtures M .
 Based on all the above, EAMM produces the activity models for each appliance a . These models, together with the appliance consumption models, are then encapsulated in the small-scale consumer model R k , which can be directly used by SAM to derive the installation agent's power consumption. 3.3. Simulation and aggregation module
This module simulates small-scale consumption based on the estimated appliance and activity models. Different simulation results can be visualized and compared in order to assess various energy ef fi ciency scenarios. Simulation can be run for speci days, using randomly generated events that are created according to the distributions described in Section 3.2.1 . Alternatively, if the average power consumption is required at each time of day, it can be computed ef fi ciently via the expected power , with the method described in the following section. 3.3.1. Small-scale consumer models
A small-scale consumer R k is de fi ned as the following set of tuples for each appliance a :
R  X f X  c a ;  X  ; B a ;  X   X  : a  X  1 ; ... ; L g X  8  X  where c a ;  X  is the consumption model (i.e., how appliance a consumes power when it is switched on) and B a ;  X  is the activity model (i.e., how appliance a is operated by the residents of the household or the workers in a commercial installation). Appliance consumption and end-use behavior may depend on a set of parameters  X  , such as external temperature, time of year, and working/non-working day. In the following sections, we consider a simpli fi ed version of the models that is independent of the limited amount of available training data. One can directly extend the proposed approach by producing a set of models, one for each value of  X  . 3.3.2. Expected power
Having generated and applied the small-scale consumer mod-els, the next step is to estimate the aggregate consumption of the household for the average day. Appliance a may be triggered at time t of a day  X  t A f 1 ; ... ; 1440 g X  by an event  X  T  X  T on  X  t  X  3  X  X  T on  X  t 1  X  4  X  d Z 1  X  X  3  X  X  T on  X  t 2  X  We can therefore compute the expected power P i ( t )as
P  X  t  X  X   X  where  X  max is an upper bound to the event duration created by appliance a , and S a and D a are described in Eqs. (5) and (6) , respectively.

Thus, the expected energy consumption E i for a day is computed as
E 3.4. Shaping module (SM)
Peak reduction applications and incentives (rewards and/or penalties) may be provided to small-scale consumers to modify their end-use behavior. In Autonomous Household Agents, these incentives are modeled as price variations (rises or drops) within a time window W , while the agent responds by altering its con-sumption patterns according to a set of shifting operations. Shifting mainly implies changes to the start time distribution
S ( s ) of the behavior model equation (3) . In the proposed work, changes in S a ( s ) are inversely proportional to the price change in W and are based on the residual probability:
P  X   X 
The residual probability P r that is  X  subtracted  X  from the PDF around the peak price time index is distributed to the rest of the time points of the new distribution S 0 a  X  s  X  according to three different types of the response model, based on the results presented by real pilot cases from several European projects ( Stromback et al., 2011 ):
Response 1( best case scenario ): The residual probability is distributed evenly throughout the day. Such a scenario is possible given the increased penetration of smart appliances in modern households. Price aware electrical appliances are able to shift their operation (automatically or by manual programming) to alternative time zones according to the pricing policy. This type of shifting can result in valley case of monetary rewards, or peak reduction, in case of penalties, without changing their operation drastically during the rest of the day. This shifting behavior is represented as follows: P r is distributed or withdrawn proportionally to the values of S a ( s ) outside of W (i.e. S 0 a  X  s  X  X  X  1  X  P outside W ).

Response 2( comfort-based scenario ): Minimum shifting of the appliance operation time is accomplished, to minimize impact on consumer comfort. As an example, consider that most consumers can stall their activities for 10  X  15 min, whereas the suggestion of a 2 h delay for some kind of activities would probably not be acceptable. In case of a penalty incentive, a percentage of the expected power consumption near the peak index, proportional to the price variation, is shifted right before and after the peak window W , with a declining effect over distance. In case there are additional reward incentives for valley fi lling, the expected power is transferred to the closest (in terms of time) valley.

Response 3( worst case scenario ): In the worst case scenario, consumers respond to penalty incentives by shifting their activities to the next preferred daytime intervals for this activity. For a consumer that is usually carrying out an activity twice a day (once at noon and once in the evening), penalizing excessive power consumption at noon would often move the activity during the evening. This shifting behavior is over-charging the smaller peaks of the expected power consump-tion. To simulate this behavior, the agent distributes the residual P r proportionally to the next largest peaks. 3.4.1. Peak/valley detection and analysis
To support the aforementioned response types, a Peak Detection (PD) algorithm has been implemented (Algorithm 1 ) to identify the global maximum (or several local maxima) in the time series of the daily expected power of the overall installation or the individual appliance end-use.
 Algorithm 1. Peak Detection algorithm. 1 Collect Expected Power Time Series 2 for i  X  1 to minutes per day do 3 4 5 6 7 8 9 end 10 Remove peaks covered by larger  X  neighbors  X  11 Sort peaks in descending order by Expected Power
In the PD algorithm, K is a arbitrarily small value used as a threshold. In the step for peak removal from the list at line 10, we try to keep the list short by retaining the highest of the local maxima that are close in time.

The percentage of participation of each installation appliance in each peak is the next task for SM. It is estimated from the following formula: Perc a i  X  t p  X  X  P a i  X  t p  X   X  where Perc a i is the percentage of participation of the i -th appli-ance, t p is the peak time index, and P a i is the expected power as de fi ned above.

In a similar manner, the algorithm for Valley Detection (VD) in the expected power daily time series returns a list of valleys (Algorithm 2 ). Valleys are identi fi ed as time intervals where the power load can be increased. Given the list of valleys, the analysis can focus on the useful valleys of the list, as these are determined by three criteria: (i) mean value of expected power, (ii) duration and (iii) distance from a (set of) selected peak(s).

Algorithm 2. Valley Detection algorithm. 1 Collect Expected Power Time Series 2 startFlag  X  false 3 for i  X  1 to minutes per day do 4 5 6 7 8 9 10 11 12 13 14 15 16 17 end 18 Remove valleys that are short in duration 4. Experimental results
This section discusses the experiments performed using real consumption measurements from various installations and appli-ances. Results illustrate the effectiveness of the proposed small-scale consumer modeling approach and indicate how agent response to incentives can lead to peak power reduction.
Raw measurement data were obtained from the Digital Envir-onment Home Energy Management System (DEHEMS) project.
Data from installations across 5 different European cities were collected from May 2010 up to August 2011. Following the appropriate preprocessing, we were able to extract a useful measurements dataset containing device-level consumption for 63 households at minute intervals.
 Two groups of experiments were performed:
Activity model experiments : The fi rst set of experiments employed single appliance measurements from several house-holds in order to (a) assess the effectiveness of the proposed event detection and simulation approach (without taking into consideration the consumption models), (b) directly compare real and predicted power and energy consumption and, fi nally, (c) evaluate the accuracy of the activity models in fi ne temporal granularity.

Response model simulations : The second set of experiments assessed the peak reduction and the valley fi lling capabilities of the proposed agents, based on the shifting operations outlined above. Two aspects were assessed: (a) the end-use change with respect to a single appliance given the response model and the monetary incentives (rewards and penalties), and (b) the impact of a pricing policy centered around the daily peak on the overall expected power of an installation.

Multiple small-scale consumers : The fi nal set of experiments assessed the value of the proposed approach when dealing with a large number of small-scale consumers. The impact of different pricing policies centered around the peak from the aggregated consumption from a set of consumers is estimated and evaluated. The consumers can autonomously decide whether and how much to shift their load, given the incentives provided. 4.1. Activity model experiments
The fi rst stage of model evaluation is the comparison between the simulated and the actual appliance power consumption. A set of consumption models c a was constructed based on the nominal load consumption of the appliances under examination (as esti-mated by the available measurements).

In order to evaluate the precision of our end-use models for each appliance, the mean percentage error (MPE) was used:
MPE  X  1 n  X  n where n is the number of time series samples,  X  i is the observed value for each time step i and p i is the respective predicted value.
This error was estimated for three different time intervals: Daily (DMPE), Weekly (WMPE) and Monthly (MMPE). The percentage deviation was used as a standard deviation metric for the above mean error:
PD  X  1 n where  X  i is the standard deviation for each time step i .
Finally, in order to measure the accuracy of the proposed models for fi ner temporal granularity, we compared the simulated expected power with the actual average power extracted from the available data measurements. The metric used to evaluate the results is the symmetric mean absolute percentage error (SMAPE) ( Flores, 1986 ), which is an accuracy measure based on relative percentage errors. The formula for the estimation of SMAPE is
SMAPE  X  1 n  X  n where A t is the expected power extracted from the real measurements for 10 minutes interval t of the day and F t is the simulated expected power. Both errors can be easily calculated from the time series provided for analysis.

Table 1 presents the results for the fi rst set of experiments, where only the event detection is considered, using a generic consumption model for both the real events and the simulated ones. The errors were measured for different household appliance types over 100 runs, where for each run 75% of days were used for training the models and the rest 25% were used for evaluation and a different training set is selected at each run. Given the complex-ity of each model, one may easily notice that simple appliances (boiler, toaster, microwave oven) have small percentage errors ( 5 : 98 7 4 : 29 % , 8 : 16 7 7 : 31 % and 8 : 74 7 6 : 44 % in this exam-ple respectively), while prediction errors of the more complex appliances (e.g. oven and washing m achine) are larger, nevertheless within acceptable error range for the proposed consumer modeling context ( 14 : 24 7 7 : 78 % and 11 : 08 7 9 : 66 % respectively). The average SMAPE value for all appliances in our experiments was 10.51%, while the respective standard deviation was 1.28%.
Given the tolerance levels of transmission and distribution seg-ments of the power system, a 10% SMAPE is considered to be acceptable. Furthermore, the goal of the proposed framework is not focused on consumption or activity forecasting but on consumer activity modeling (e.g., appliance operation statistics) for demand response or consumption analysis a pplications. This error level is, therefore, more than adequate to characterize and/or group consu-mers and support the design of effective DR programs. It should be noted that for some appliance types the achieved SMAPE values are even satisfactory for consumption prediction problems. Fig. 5 com-pares the actual and estimated power consumption for a representa-tive appliance example, where the proposed models provide very accurate peak time index forecasting and closely follow the trends of the real average power.

Another useful metric that proves the accuracy of our models is the proportion of events triggered during certain time intervals of the daytime. Each day was separated into 4 different 6-hour time zones (night, morning, noon, evening). Fig. 6 shows a typical example of event proportion comparison between real and simu-lated operations of an appliance.

On the second set of experiments, the real consumption measured from each appliance for the sample time period is compared against the simulated use of the appliance for the same period, from an agent with encapsulated consumption model. The consumption model used for all the appliances is a Single
Operation Cycle Consumption Model (Section 3.1.1 ) with a power consumption P , that was estimated based on the average con-sumption observed in the measurements. Table 2 shows that the error increase is very small (2  X  4%), even with the use of the simpli fi ed consumption model. It is, therefore, safe to deduce that the approach selected is robust and accurate even in cases where the precise consumption model of the appliance is not known.
It is important to note that for some appliance types (e.g. washing machine) very few events were detected in the data. By increasing the duration of sampling, the constructed models have greater prediction capacity. Fig. 7 illustrates how error is reduced as the number of samples increases for two example appliances.
Similar results were obtained for other appliances also. As power utilities have access to an abundance of measurement data from the smart grid, they improve their ability to build highly accurate and more granular end-use models that can describe consumer activities over different seasons of the year or different day types (e.g., weekend/weekday). 4.2. Response model simulations
Apart from end-use analysis, agents may be used for small-scale consumer load shaping (as mentioned in Section 3.4 ). Having processed the DEHEMS dataset with EDM and EAMM, each agent computes the expected power consumption for each appliance using Eq. (10) . In addition, the overall power household consump-tion is estimated as the sum of the expected power consumptions of the installed appliances.

The fi rst series of experiments implemented penalty incentives for a single appliance around the time interval where its load demand was peaked. A 20% price increase in a time window W around the appliance peak power was applied. In the best case scenario (Fig. 8 (a)), the average observed reduction over all the appliances was 42 7 8%, while the level of the expected power for the rest of the day remained the approximately the same, since only a small portion of residual expected power had transferred to each minute. In the second case (Fig. 8 (b)), the average reduction was 29 7 12% and the residual power was naturally shifted to the time intervals near the penalized timezone, increasing the sur-rounding region's power up to 15 7 4%. In the third (worst) case scenario (Fig. 8 (c)), the mean reduction was equally signi with the previous case (29 7 12%), but there was an average increase of 25% in other peaks of the daily expected power (although in absolute values, the peaks remained lower).
The results of all the scenarios examined indicate that a signi fi cant decompression in the peak area is feasible without having to increase the prices too much, heavily penalizing the customers who choose not to accept the end-use change.
In the second set of experiments, a combination of rewards and penalties was used to fi ll the valleys in the expected power consumption for a single appliance. As in the previous case, pricing in the time interval where the main peak appears was increased by 20%, whereas in the valleys it was decreased by the same percentage. In the best case scenario (Fig. 9 (a)), the largest valley observed in the expected daily power consumption was fi lled (increasing by 400 7 80%), while the level of the expected power for the rest of the day remained approximately the same, since again only small portion of residual power had to be transferred from each minute. In the second case (Fig. 9 (b)), the average reduction was 31 7 8% and the residual power was naturally shifted to the valley closer to the penalized timezone, increasing its region's power up to 100% (since the expected power of the valley is signi fi cantly lower than the one in the peak).

The second series of results show, again, that the curves can become smoother without excessive price variations from the base pricing policy. In addition, the reduction levels are as signi before, strongly supporting the case in point.

In the fi nal set of experiments, the effect of a penalty policy centered around the aggregate expected power of a household is assessed (i.e. using all household appliances). The highest daily peak in consumption is found and a penalty policy in that time interval is applied. Results show (Fig. 10 ) that there was a signi fi cant reduction in every case (best case 40 7 5%, second case 38 7 12% and worst case 30 7 7% on average), though in the worst case the smaller peaks may again increase in size, as it is expected through shifting.

This approach also reveals a signi fi cant bene fi t of the presented bottom-up modeling: having detailed small-scale models may allow for sending different incentive schemes to each consumer agent (or groups of them), thus leading to fi ne control of the power curve. This intuition is not followed in this work, but the agent architecture implemented allows for further research in the future work. 4.3. Extension to multiple consumers experiments
This fi nal set of experiment shows how the proposed approach scales up to an overall segment of the Power Grid. To this end, a simulation of the interaction between a set of AHAs and an aggregator is presented, using real electricity measurements. The aggregator (energy supplier) is able to send a message containing a new pricing scheme for the next day. The individual AHAs choose whether they will shift their electricity load, based on their consumption patterns and how much they may be affected by the new pricing scheme. It should be noted that there is no commu-nication/interaction between Household Agents, since the real life scenarios we are simulating do not consider any kind of interac-tion between household tenants, but only their interaction with the utilities/aggregators/energy suppliers.
 For the realization of these experiments, three different Time-
Of-Use pricing schemes are de fi ned (Fig. 11 ): 1. A baseline pricing scheme, with fi xed price/kWh all day long . 2. A TOU pricing scheme, with fi xed price/kWh all day long, except for the time of the aggregated peak consumption, where the price is increased . 3. A TOU pricing scheme, with fi xed price/kWh all day long, except for the time of the aggregated peak consumption, where the price is increased, and a period of time right after the peak where the price is slightly reduced . Thus, the AHAs receive incentives to shift their consumption at night time, where the demand is lower.

In the fi rst set of experiments, a set of 10 households are chosen, all located in the same geographical area (London). The corresponding AHAs are trained using the raw electricity mea-surement data and then are provided with the aforementioned incentives in order to reform/shift their consumption, thus remov-ing the peaks there may be created by their aggregated consump-tion ( Fig. 12 ).

When presented with the fi rst demand response scheme, approximately half of the AHAs respond and shift their consump-tion in the time periods before and after the peak pricing, in order to minimize their inconvenience caused by shifting. The reduction in the peak time period was 6.38% and part of it moved to the rest of the day (increase by 0.63%). In the case of the second demand response scheme, most of the AHAs preferred to move their exceeding consumption to the night hours after the peak, where the price is reduced. This behavior resulted an reduction in the peak period up to 11.7%, while the night-time consumption was increased by up to 15% in some households. Even though this percentage is high, the consumption at that time period was too low to great a rebound effect (a new peak appearing).
In the second set of experiments, measurements from 30 different households from both England and Bulgaria are used, and each AHA is introduced with the same incentives as before. In the fi rst case (Pricing Scheme 1), the reduction was 8.5%, while in the second case (Pricing Scheme 2) it was 12.33%. It should be noted that a further increase in the peak time price or further reduction in the price at night time would lead to more AHAs shifting their load away from the peak period.

These simulations illustrate how the proposed AHA architec-ture, along with the proposed model training mechanism, can be used to simulate and evaluate a range of Demand Response scenarios involving a variety of incentives/pricing schemes and consumer responses, providing effective decision support, both from the supplier and the demand side. Examples of such decision support applications of the proposed AHA include (i) aggregators, wishing to optimize their portfolio management, (ii) DSOs, wishing to eliminate high peaks in demand, (iii) municipalities, companies, or organizations aiming at lowering the environmental impact and cost of electrical energy consump-tion, and (iv) individual consumers, wishing to select their energy provider or optimally adapt their consumption to reduce house-hold electricity costs. In addition, these experiments indicate that even though the demand of each individual small-scale consumer is very small in the context of the distribution system, the aggregate impact of their change in consumption behavior can be signi fi cant. 5. Conclusion and future work
Current work presents detailed bottom-up small-scale consu-mer models embedded into Autonomous Household Agents. By providing appliance-level power consumption data, agents build detailed models and can simulate the observed appliance end-use.
Furthermore, agents encapsulate a demand shaping mechanism, responding to incentives provided by altering their consumption patterns. Using the proposed approach, an Energy Provider or DSO can map the observed power consumption to consumer activities and can therefore model and simulate a wide range of Demand Response scenarios for load shaping.

A number of experiments were carried out based on measure-ments that were collected from different households in fi European cities as part of the DEHEMS research project. These experiments illustrated the accuracy and the applicability of our implemented agents and also outlined the proposed load shaping process. An interesting observation is that the presented models have high convergence rates, i.e., the model accuracy improves important, since the emergence of smart grids allows energy providers to collect large amounts of detailed measurement data from their consumers.

Results presented in this paper are promising, however there is room for future improvement. It is possible to examine the use of detailed appliance models that will be sensitive to external parameters (weather, location, etc.) or consider more complex parametric models (models that can generate probability func-tions based on the value of  X  in Eq. (8) ). Activity models can also become context-dependent, e.g. different models for working/ non-working days and different seasons of the year. Another aspect worth exploring is the possibility of having dynamic pricing schemes that may change over time, which would require an automated procedure encapsulated in the AHAs. Finally, as more smart grid measurement data become available, multi-agent systems with several household agents can be developed in order to experiment with different Demand Response incentives applied at varying community sizes (such as neighborhoods or cities). Acknowledgments
This work was supported in part by the EU funded research project CASSANDRA (FP7-ICT-288429).
 Appendix A. Z-notation high level entities de fi nition For readability reasons, some of the high level entities in the Z Notation schemas were not de fi ned in Section 3 . In this appendix, these entities are presented and fully de fi ned, for reasons of completion. Some of the entities (Object, Autonomous Agent) are properly de fi ned in d'Inverno et al. (2004) , so the reference and page is given. Some other entities are considered as primitives (e.g. Time and ActivePower), so their de fi nition is omitted. The symbolizes tuples of the objects contained within.
 Z-Notation high level entity De fi nition AutonomousAgent d'Inverno et al. (2004, p. 30)
ConsumerActivityModels  X  Distribution ; Distribution ; Distribution Distribution  X  Value ; Probability  X  , Section 3.2.1 Event  X  T on ; d  X  , Section 3.1 ExpectedPowerMeasurement  X  Time ; ActivePower  X  ; Section 3.3.2
MOCApplianceConsumptionModel  X  X  X  l 1 ; P 1 ; nom ; T 1 ; on Module Object as de fi ned in d'Inverno et al. (2004, p. 21) Peak  X  Time ; ActivePower  X  , Section 3.4.1 PowerMeasurement  X  Time ; ActivePower ; ReactivePower  X  PricingScheme  X  Time ; PricePerkWh  X 
SmallScaleConsumerModel  X  P 1 ApplianceConsumptionModel ; P 1 ConsumerActivityModel  X 
SOCApplianceConsumptionModel  X  l ; P nom ; T on ; T off  X  Valley  X  Time ; ActivePower  X  , Section 3.4.1 References
