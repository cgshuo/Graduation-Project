 Mohammad Gheshlaghi Azar m.azar@science.ru.nl R  X emi Munos remi.munos@inria.fr Hilbert J. Kappen b.kappen@science.ru.nl Model-based value iteration (VI) ( Kearns &amp; Singh , 1999 ; Bu  X s,oniu et al. , 2010 ) is a well-known re-inforcement learning (RL) ( Szepesv  X ari , 2010 ; Sutton &amp; Barto , 1998 ) algorithm which relies on an empirical estimate of the state-transition dis-tributions to estimate the optimal (action-)value function through the Bellman recursion. In the finite state-action problems, it has been shown that an action-value based variant of VI, model-based Q-value iteration (QVI), finds an  X  -optimal estimate of the action-value function with high probability using only T =  X  O ( N/ (1  X   X  ) 4  X  2 ) samples ( Kearns &amp; Singh , 1999 ; Kakade , 2004 , chap. 9.1), where N and  X  denote the size of state-action space and the discount factor, respectively. 1 Although this bound matches the best existing upper bound on the sample complexity of estimating the action-value function ( Azar et al. , 2011a ), it has not been clear, so far, whether this bound is a tight bound on the performance of QVI or it can be improved by a more careful analysis of QVI algorithm. This is mainly due to the fact that there is a gap of order 1 / (1  X   X  ) 2 between the upper bound of QVI and the state-of-the-art result for lower bound, which is of  X  N/ (1  X   X  ) 2  X  2 ( Azar et al. , 2011b ). In this paper, we focus on the problems which are formulated as finite state-action discounted infinite-horizon Markov decision processes (MDPs), and prove a new tight bound of O N log( N/ X  ) / (1  X   X  ) 3  X  2 on the sample complexity of the QVI algorithm. The new upper bound improves on the existing bound of QVI by an order of 1 / (1  X   X  ). 2 We also present a new match-ing lower bound of  X  N log( N/ X  ) / (1  X   X  ) 3  X  2 , which also improves on the best existing lower bound of RL by an order of 1 / (1  X   X  ). The new results, which close the above-mentioned gap between the lower bound and the upper bound of RL, guarantee that no learning method, given a generative model of the MDP, can be significantly more efficient than QVI in terms of the sample complexity of estimating the action-value function.
 The main idea to improve the upper bound of QVI is to express the performance loss of QVI in terms of the variance of the sum of discounted rewards as opposed to the maximum V max = R max / (1  X   X  ) in the previous results. For this we make use of Bernstein X  X  concen-tration inequality ( Cesa-Bianchi &amp; Lugosi , 2006 , ap-pendix, pg. 361), which bounds the estimation error in terms of the variance of the value function. We also rely on the fact that the variance of the sum of dis-counted rewards, like the expected value of the sum (value function), satisfies a Bellman-like equation, in which the variance of the value function plays the role of the instant reward ( Munos &amp; Moore , 1999 ; Sobel , 1982 ), to derive a sharp bound on the variance of the value function. In the case of lower bound, we im-prove on the result of Azar et al. ( 2011b ) by adding some structure to the class of MDPs for which we prove the lower bound: In the new model, there is a high probability for transition from every intermediate state to itself. This adds to the difficulty of estimating the value function, since even a small estimation error may propagate throughout the recursive structure of the MDP and inflict a big performance loss especially for  X   X  X  close to 1.
 The rest of the paper is organized as follows. After in-troducing the notation used in the paper in Section 2 , we describe the model-based Q-value iteration (QVI) algorithm in Subsection 2.1 . We then state our main theoretical results, which are in the form of PAC sam-ple complexity bounds in Section 3 . Section 4 con-tains the detailed proofs of the results of Sections 3 , i.e., sample complexity bound of QVI and a general new lower bound for RL. Finally, we conclude the pa-per and propose some directions for the future work in Section 5 . In this section, we review some standard concepts and definitions from the theory of Markov decision processes (MDPs). We then present the model-based Q-value iteration algorithm of Kearns &amp; Singh ( 1999 ). We consider the standard reinforcement learn-ing (RL) framework ( Bertsekas &amp; Tsitsiklis , 1996 ; Sutton &amp; Barto , 1998 ) in which a learning agent inter-acts with a stochastic environment and this interaction is modeled as a discrete-time discounted MDP. A dis-counted MDP is a quintuple ( X , A , P, R ,  X  ), where X and A are the set of states and actions, P is the state transition distribution, R is the reward function, and  X   X  (0 , 1) is a discount factor. We denote by P ( | x, a ) and r ( x, a ) the probability distribution over the next state and the immediate reward of taking action a at state x , respectively.
 Remark 1. To keep the representation succinct, in the sequel, we use the notation Z for the joint state-action space X  X  A . We also make use of the shorthand notations z and  X  for the state-action pair ( x, a ) and 1 / (1  X   X  ) , respectively.
 Assumption 1 (MDP Regularity) . We assume Z and, subsequently, X and A are finite sets with car-dinalities N , | X | and | A | , respectively. We also as-sume that the immediate reward r ( x, a ) is taken from the interval [0 , 1] .
 A mapping  X  : X  X  A is called a stationary and deterministic Markovian policy, or just a policy in short. Following a policy  X  in an MDP means that at each time step t the control action A t  X  A is given by A t =  X  ( X t ), where X t  X  X . The value and the action-value functions of a policy  X  , denoted respec-tively by V  X  : X  X  R and Q  X  : Z  X  R , are defined as the expected sum of discounted rewards that are encountered when the policy  X  is executed. Given an MDP, the goal is to find a policy that attains the best possible values, V  X  ( x ) , sup  X  V  X  ( x ) ,  X  x  X  X . Function V  X  is called the optimal value func-tion . Similarly the optimal action-value function is defined as Q  X  ( x, a ) = sup  X  Q  X  ( x, a ). We say that a policy  X   X  is optimal if it attains the optimal V  X  ( x ) for all x  X  X . The policy  X  defines the state tran-x  X  X . The right-linear operators P  X  , P and P  X  are then defined as ( P  X  Q )( z ) , ( P V )( z ) , ( P  X  V )( x ) , tively. Finally, k k shall denote the supremum (  X   X  ) norm which is defined as k g k , max y  X  Y | g ( y ) | , where Y is a finite set and g : Y  X  R is a real-valued function. 3 2.1. Model-based Q-value Iteration (QVI)
The algorithm makes n transition samples from each state-action pair z  X  Z for which it makes n calls to the generative model. 4 It then builds an empirical model where m ( y, z ) denotes the number of times that the state y  X  X has been reached from z  X  Z . The al-gorithm then makes an empirical estimate of the opti-mal action-value function Q  X  by iterating some action-value function Q k , with the initial value of Q 0 , through the empirical Bellman optimality operator b T . 5
Our main results are in the form of PAC (probably approximately correct) bounds on the  X   X  -norm of the difference of the optimal action-value function Q  X  and its sample estimate: Theorem 1 (PAC-bound for model-based Q-value it-eration) . Let Assumption 1 hold and T be a positive integer. Then, there exist some constants c and c 0 such that for all  X   X  (0 , 1) and  X   X  (0 , 1) a total sampling budget of suffices for the uniform approximation error k Q  X   X  Q k k  X   X  , w.p. (with the probability) at least 1  X   X  , after only k =  X  log(6  X / X  ) / log(1 / X  )  X  iteration of QVI algorithm. 6 In particular, one may choose c = 68 and c = 12 .
 The following general result provides a tight lower bound on the number of transitions T for every RL al-gorithm to achieve an  X  -optimal estimate of the action-value function w.p. 1  X   X  , under the assumption that the algorithm is (  X ,  X , T )-correct: Definition 1 ((  X ,  X , T ) -correct algorithm ) . Let Q A T be the estimate of Q  X  by an RL algorithm A af-ter observing T  X  0 transition samples. We say that A is (  X ,  X , T ) -correct on the class of MDPs M if Q  X   X  Q A T  X   X  with probability at least 1  X   X  for all M  X  M . 7 Theorem 2 (Lower bound on the sample complex-ity of estimating the optimal action-value function) . There exists some constants  X  0 ,  X  0 , c 1 , c 2 , and a class of MDPs M , such that for all  X   X  (0 ,  X  0 ) ,  X   X  (0 ,  X  and every (  X ,  X , T ) -correct RL algorithm A on the class of MDPs M the number of transitions needs to be at least
In this section, we first provide the full proof of the finite-time PAC bound of QVI, reported in Theorem 1 , in Subsection 4.1 . We then prove Theorem 2 , the RL lower bound, in Subsection 4.2 . Also, we need to em-phasize that we discard some of the proofs of the tech-nical lemmas due to the lack of space. We provide those results in a long version of this paper. 4.1. Poof of Theorem 1 We begin by introducing some new notation. Con-sider the stationary policy  X  . We define V  X  ( z ) , E [ | sum of discounted rewards starting from z  X  Z under the policy  X  . Also, define  X   X  ( z ) ,  X 
P we shall denote v  X  and v  X  as the immediate variance of the value function V  X  and V  X  defined as v  X  ( z ) ,  X  for all z  X  Z , respectively. Further, we denote the im-mediate variance of the action-value function b Q  X  , b V and b V  X  by b  X   X  , b v  X  and b v  X  , respectively. We now state our first result which indicates that Q k is very close to b Q  X  up to an order of O (  X  k ). Therefore, to prove bound on k Q  X   X  Q k k , one only needs to bound k Q  X   X  b Q  X  k in high probability.
 Lemma 1. Let Assumption 1 hold and Q 0 ( z ) be in the interval [0 ,  X  ] for all z  X  Z . Then we have In the rest of this subsection, we focus on prov-ing a high probability bound on k Q  X   X  b Q  X  k . One can prove a crude bound of  X  O (  X  2 / b Q  X  k by first proving that k Q  X   X  b Q  X  k  X   X  k ( P  X  b P ) V  X  k and then using the Hoeffding X  X  tail inequal-ity ( Cesa-Bianchi &amp; Lugosi , 2006 , appendix, pg. 359) to bound the random variable k ( P  X  b P ) V  X  k in high probability. Here, we follow a different and more subtle approach to bound k Q  X   X  b Q  X  k , which leads to a tight bound of  X  O (  X  1 . 5 / Lemma 2 component-wise upper and lower bounds on the error Q  X   X  b Q  X  which are expressed in terms of ( I  X   X  b P  X   X  )  X  1 P  X  b P V  X  and ( I  X   X  b P b  X   X  ) respectively. (ii) We make use of the sharp result of Bernstein X  X  inequality to bound P  X  b P V  X  in terms of the squared root of the variance of V  X  in high proba-bility. (iii) We prove the key result of this subsection (Lemma 5 ) which shows that the variance of the sum of discounted rewards satisfies a Bellman-like recur-sion, in which the instant reward r ( z ) is replaced by  X  ( z ). Based on this result we prove an upper-bound of order O (  X  1 . 5 ) on ( I  X   X P  X  )  X  1 icy  X  , which combined with the previous steps leads to the sharp upper bound of  X  O (  X  1 . 5 / We proceed by the following lemma which bounds Q  X   X  b Q  X  from above and below: Lemma 2 (Component-wise bounds on Q  X   X  b Q  X  ) . We now concentrate on bounding the RHS (right hand sides) of ( 1 ) and ( 2 ). We first state the following tech-nical result which relates v  X  to b  X   X   X  and b  X   X  . Lemma 3. Let Assumption 1 hold and 0 &lt;  X  &lt; 1 . Then, w.p. at least 1  X   X  : where b v is defined as and 1 is a function which assigns 1 to all z  X  Z . Based on Lemma 3 we prove the following sharp bound on  X  ( P  X  b P ) V  X  , for which we also rely on Bern-stein X  X  inequality ( Cesa-Bianchi &amp; Lugosi , 2006 , ap-pendix, pg. 361).
 Lemma 4. Let Assumption 1 hold and 0 &lt;  X  &lt; 1 . Define c pv , 2 log(2 N/ X  ) and b pv as: Then w.p. 1  X   X  we have Proof. For all z  X  Z and all 0 &lt;  X  &lt; 1, Bernstein X  X  inequality implies that w.p. at least 1  X   X  : We deduce (using a union bound): where c  X  pv , 2 log( N/ X  ) and b  X  pv , 2  X  X  log( N/ X  ) / 3 n . The result then follows by plugging ( 3 ) and ( 4 ) into ( 7 ) and ( 8 ), respectively, and then taking a union bound. We now state the key lemma of this section which shows that for any policy  X  the variance V  X  satisfies the following Bellman-like recursion. Later, we use this result, in Lemma 6 , to bound ( I  X   X P  X  )  X  1  X   X  . Lemma 5. V  X  satisfies the Bellman equation Proof. For all z  X  Z we have
V  X  ( z ) = E in which we rely on E ( 0.
 Based on Lemma 5 , one can prove the following result on the immediate variance.
 Lemma 6. Proof. The first inequality follows from Lemma 5 by solving ( 5 ) in terms of V  X  and taking the sup-norm over both sides of the resulted equation. In the case of Eq.( 10 ) we have 8 k ( I  X   X P  X  )  X  1 in which we write k = tl + j with t is a positive inte-ger. We now prove a bound on by making use of Jensen X  X  inequality as well as Cauchy-Schwarz inequality: where in the last step we rely on ( 9 ). The result then follows by plugging ( 12 ) into ( 11 ) and optimizing the bound in terms of t to achieve the best dependency on  X  .
 Now we make use of Lemma 6 and Lemma 4 to bound k Q  X   X  b Q  X  k in high probability.
 Lemma 7. Let Assumption 1 hold. Then, for any 0 &lt;  X  &lt; 1 : w.p. 1  X   X  , where  X   X  is defined as: Proof. By incorporating the result of Lemma 4 and Lemma 6 into Lemma 2 , we deduce that: w.p. 1  X   X  . The scalar b is given by: The result then follows by combining these two bounds and taking the  X   X  norm.
 Proof of Theorem 1 . We combine the proof of Lemma 7 and Lemma 1 in order to bound Q  X   X  Q k in high probability. We then solve the resulted bound w.r.t. n and k . 9 4.2. Proof of the Lower-bound In this section, we provide the proof of Theorem 2 . In our analysis, we rely on the likelihood-ratio method, which has been previously used to prove a lower bound for multi-armed bandits ( Mannor &amp; Tsitsiklis , 2004 ), and extend this approach to RL and MDPs. We begin by defining a class of MDPs for which the proposed lower bound will be obtained (see Figure 1 ). We de-fine the class of MDPs M as the set of all MDPs with the state-action space of cardinality N = 3 KL , where K and L are positive integers. Also, we assume that for all M  X  M , the state space X consists of three smaller sets S , Y 1 and Y 2 . The set S includes K states, each of those states corresponds with the set of actions A = { a 1 , a 2 , . . . , a L } , whereas the states in Y are single-action states. By taking the action a  X  A from every state x  X  S , we move to the next state y ( z )  X  Y 1 with the probability 1, where z = ( x, a ). The transition probability from Y 1 is characterized by the transition probability p M from every y ( z )  X  Y 1 to itself and with the probability 1  X  p M to the corre-sponding y ( z )  X  Y 2 . 10 Further, for all M  X  M , Y 2 consists of only absorbing states, i.e., for all y  X  Y 2 , P ( x | x ) = 1. The instant reward r is set to 1 for every state in Y 1 and 0 elsewhere. For this class of MDPs, the optimal action-value function Q  X  can be solved in close form from the Bellman equation:
Q  X  ( z ) =  X V  X  ( y ( z )) = In the rest of the proof, we concentrate on proving the lower bound for k Q  X   X  Q A T k for all z  X  S  X  A . Now, let us consider a set of two MDPs M  X  = { M 0 , M 1 } in M with the transition probabilities where  X  and p are some positive numbers such that 0 &lt; p &lt; p +  X   X  1, which will be quantified later in this section. We assume that the discount factor  X  is bounded from below by some positive constant  X  0 for the class of MDP M  X  . We denote by E m ad P m the expectation and the probability under the model M m in the rest of this section.
 We follow the following steps in the proof: (i) we prove a lower bound on the sample-complexity of learning the value function for every state y  X  Y on the class of MDP M  X  (ii) we then make use of the fact that the estimates of Q  X  ( z ) for different z  X  S  X  A are inde-pendent of each others to combine these bounds and prove the tight result of Theorem 2 .
 be an empirical estimate of the action-value function Q  X  ( z ) by the RL algorithm A using t &gt; 0 transition samples from the state y ( z )  X  Y 1 for z  X  X  X  A . We all z  X  S  X  A , where Q  X  0 ,  X / (1  X   X p ) is the optimal action-value function for all z  X  S  X  A under the MDP M 0 . We then define k , r 1 + r 2 + + r t as the sum of rewards of making t transitions from y ( z )  X  Y 1 . We also introduce the event E 2 ( z ), for all z  X  S  X  A as: the following lemmas required for our analysis. We begin our analysis of the lower bound by the fol-lowing lemma: Lemma 8. Define  X  , exp  X  c  X  1  X  2 t/ ( p (1  X  p )) . Then, for every RL algorithm A , there exists an MDP M m  X  M  X  and constants c  X  by the choice of  X  = 2(1  X   X p ) 2  X / (  X  2 ) . Proof. To prove this result we make use of a contra-diction argument, i.e., we assume that there exists an algorithm A for which: for all M m  X  M  X  and show that this assumption leads to a contradiction. We now state the following techni-cal lemmas required for the proof: Lemma 9. For all p &gt; 1 2 :  X  )  X   X /c  X  2 for all M m  X  M  X  , we have P 0 ( E 1 ( z ))  X  1  X   X /c  X  2  X  1  X  1 /c  X  2 . This combined with Lemma 9 and for all z  X  S  X  A .
 S  X  A : P 1 ( E 1 ( z )) &gt;  X /c  X  2 .
 Now by the choice of  X  = 2(1  X   X p ) 2  X / (  X  2 ), we have Q 0 ( z ) +  X  &lt; Q {| Q  X  1 ( z )  X  Q A t ( z ) |  X   X  } .
 Now let us return to the assumption of Eq. ( 15 ), which states that for all M m  X  M  X  , P m ( | Q  X  ( z )  X  t ( z ) | )  X   X  )  X  1  X   X /c This combined with the fact that {| Q  X  0 ( y )  X  Q A t ( z ) |} and {| Q  X  1 ( z )  X  Q A t ( z ) |} do not overlap implies that P assumption of Eq. ( 15 ). The contradiction between the result of Lemma 10 and the assumption which leads to this result proves the lower bound of Eq. ( 14 ). Now by the choice of p = 4  X   X  1 3  X  and c 1 = 8100, we have that for every  X   X  (0 , 3] and for all 0 . 4 =  X  0  X   X  &lt; 1 there exists an MDP M m  X  M  X  such that This result implies that for any state-action z  X  S  X  A , the probability of making an estimation error of  X  is at least  X  on M 0 or M 1 whenever the number of transition samples T z from z  X  Z is less that  X  (  X ,  X  ) , 6  X  3 c We now extend this result to the whole state-action space S  X  A .
 Lemma 11. Assume that for every algorithm A , for every state-action z  X  S  X  A we have 11 Then for any  X   X   X  (0 , 1 / 2) , for any algorithm A using a total number of transition samples less than T =  X   X , 12  X   X  N , there exists an MDP M m  X  M  X  such that where Q A T denotes the empirical estimate of the opti-mal action-value function Q  X  by A using T transition samples.
 Proof. First note that if the total number of observed transitions is less than KL/ 2  X  (  X ,  X  ) = ( N/ 6)  X  (  X ,  X  ), then there exists at least KL/ 2 = N/ 6 state-action pairs that are sampled at most  X  (  X ,  X  ) times. Indeed, if this was not the case, then the total number of tran-sitions would be strictly larger than N/ 6  X  (  X ,  X  ), which implies a contradiction). Now let us denote those states as z (1) , . . . , z ( N/ 6) .
 We consider the specific class of MDPs described in Figure 1 . In order to prove that ( 17 ) holds for any al-gorithm, it is sufficient to prove it for the class of algo-action z based on the transition samples observed from z only (indeed, since the samples from z and z  X  are in-dependent, the samples collected from z  X  do not bring more information about Q  X  ( z ) than the information brought by the samples collected from z ). Thus, by defining Q ( z ) , {| Q  X  ( z )  X  Q A T for such algorithms, the events Q ( z ) and Q ( z  X  ) are con-ditionally independent given T z and T z  X  . Thus, there exists an MDP M m  X  M  X  such that: = =  X  from Eq. ( 16 ), thus  X  (1  X   X  ) N/ 6 .
 We finally deduce that if the total number of transition samples is less than N 6  X  (  X ,  X  ), then  X  1  X  (1  X   X  ) N 6  X  whenever  X N 6  X  1. Setting  X   X  =  X N 12 , we obtain the desired result.
 Lemma 11 implies that if the total number of sam-choice of c 1 = 8100 and c 2 = 72, then the probability of k Q  X   X  Q A T k  X   X  is at maximum 1  X   X  on either M 0 or M 1 . This is equivalent to the statement that for every RL algorithm A to be (  X ,  X , T )-correct on the set M  X  , and subsequently on the class of MDPs M , the total number of transitions T needs to satisfy the inequal-proof of Theorem 2 .

In this paper, we have presented the first minimax bound on the sample complexity of estimating the optimal action-value function in discounted reward MDPs. We have proven that the model-based Q-value iteration algorithm (QVI) is an optimal learning algo-rithm since it minimizes the dependencies on 1 / X  , N ,  X  and  X  . Also, our results have significantly improved on the state-of-the-art in terms of dependency on  X  . Overall, we conclude that QVI is an efficient RL al-gorithm which completely closes the gap between the lower and upper bound of the sample complexity of RL in the presence of a generative model of the MDP. In this work, we are only interested in the es-timation of the optimal action-value function and not the problem of exploration. Therefore, we did not compare our results with the-state-of-the-art of PAC-MDP ( Strehl et al. , 2009 ; Szita &amp; Szepesv  X ari , 2010 ) and upper-confidence bound based algo-rithms ( Bartlett &amp; Tewari , 2009 ; Jaksch et al. , 2010 ), in which the choice of the exploration policy has an influence on the behavior of the learning algorithm. However, we believe that it would be possible to im-prove on the state-of-the-art in PAC-MDP, based on the results of this paper. This is mainly due to the fact that most PAC-MDP algorithms rely on an extended variant of model-based Q-value iteration to estimate the action-value function, but they use the naive result of Hoeffding X  X  inequality for concentration of measure which leads to non-tight sample complexity results. One can improve on those results, in terms of depen-dency on  X  , using the improved analysis of this paper which makes use of the sharp result of Bernstein X  X  in-equality as opposed to the Hoeffding X  X  inequality in the previous works. Also, we believe that the existing lower bound on the sample complexity of exploration of any reinforcement learning algorithm ( Strehl et al. , 2009 ) can be significantly improved in terms of de-pendency on  X  using the new  X  X ard X  class of MDPs presented in this paper.
 Acknowledgments The authors appreciate supports from the Euro-pean Community X  X  Seventh Framework Programme (FP7/2007-2013) under grant agreement n o 231495. We also thank Bruno Scherrer for useful discussion and the anonymous reviewers for their valuable comments.
