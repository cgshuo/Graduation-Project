 Image capture devices, including cell phone cameras, handheld digital cameras and video cameras, are prone to lens smudges and blemishes due to industrial design and the production environment of the devices [1]. It is an important task that controlling quality in the camera manufacturing and one of the pivotal issues is blemish detec-tion. Inspection by human operator is depended on their physical and psychological state [2] and thus is inconsistent. Human visual inspection is time-consuming, tedious and highly dependent on inspector experience, conditions or mood [3]. Compared with human inspection, the automated blemish detection system is more accurate and cuts down the costs. Currently, the use of various filtering techniques is common in automated visual inspection tasks, for example, by using various texture filters [4]. One growing area of the blemish detection is the manufacturing process of flat liquid-crystal device displays [5] and light-emitting device chips [6]. 
The appearance of blemish will affect the quality of the camera in camera manu-facturing. Blemish is a darker area than the surrounding pixels. Most blemishes are caused by dust on sensor, blemishes can be caused also by water spot or fingerprint on lens as shown in Fig.1. The majority of blemishes are not only very small but also they are extremely diverse and can assume various forms [7]. Blemishes appear as low contrast, non-uniform brightness regions, typically larger than single pixels [8]. A blemish defect in a camera may be manifested by one or more blurred spots as seen when a resulting digital image produced by the camera is displayed. 
Blemishes may be contrasted with other defects such as vignettes. A photograph or drawing whose edges gradually fade into the surrounding paper is called a vignette. The vignetting means a phenomenon of radial falloff of the image intensity from the image center [9]. Vignettes are usually minor defects that are present in almost every manufactured specimen, and may be alleviated by post-capture image processing that can correct for vignetting and less shading defects. But the blemishes are difficult to number of pixels in high resolution complementary metal oxide semiconductor cam-era sensors has increased rapidly in recent years. Hence, a physically small dust can cause a large amount of blemish pixels. Blemishes may be severe enough so as to result in a particular specimen being flagged as a failed unit. 
In this paper, we propose an efficient filtering method for blemish detection. The method is based on image scaling, filtering, difference calculation and thresholding. The novel method performs well on testing 600 production samples. The rest of or-ganization of this paper is as follows. Section 2 describes the related works, and sec-tion 3 gives the details of the proposed method. Section 4 shows the experimental results and section 5 conclude the paper. 2.1 Traditional Methods based on Image Filtering There are several methods to detect blemishes [10-11] by using various filtering tech-niques to detect blemish. These traditional methods are based on an image taken on a bright flat surface by the camera being tested. The raw image may contain certain artifacts such as noise and vignetting. Specifically, the traditional method [11] uses age subtraction, and ( iv ) thresholding. Let us describe the details of the traditional method as follows. 2.2 Image Size Reduction by Scaling First, the raw image is scaled down to a smaller size scaled image. Scaling the raw image speeds up the processing and reduces the noise. Image size reduction can speed up the processing and reduce the influence by noise to some extent. 2.3 Median Filtering Next, a median filtering operation is performed on the scaled image. Since blemish is a darker area than the surrounding pixels, the intensity profile of the scaled image will drop when there is a blemish as shown in Fig.2. Hence, we can calculate the differ-ence image between the median filtered image and original image, where the positive values of the difference image are considered as blemishes. 
After scaling down the raw image, a traditional approach for this would be to use a filter, presented in Fig.3, to reduce the effect of blemish and then calculate a differ-ence image between the filtered image and original image. The filter is applied on the rows x of the scaled image, where the width d is experimentally tuned, as follows, 
However, shape of blemishes is so diversified and irregular that it is difficult to de-tect all kinds of blemishes in only one direction. 2.4 Image Subtraction Then we calculate the difference between the scaled image and the filtered image, 
Blemish is a region darker than the surrounding pixels. So, the positive values in the difference image between the filtered image and the scaled image will be consid-ered as blemishes. 2.5 Thresholding Once the difference is calculated, a thresholding operation will be applied to the dif-ference image to retain the blemish pixels from background noises. Pixels which are greater than the threshold will be considered as blemishes. The traditional threshold value can be written as where the parameter M can be founded according to experiments, and the variable s stands for standard deviation of the difference image. Traditional threshold formula (3) can hardly deal with both low and high noisy images with one parameter M . 
Due to the single direction filter and the traditional threshold formula with one pa-rameter, the detection result is not promising by using traditional method which can-not alleviate the interference by noise but considers noise as blemishes. In order to overcome this difficulty, a new type of filter which can detect blemishes accurately in both high and low noisy images with a new threshold formula is needed. 3.1 Influences of image noises Image noise is random variation of brightness or color information in images, and is usually an aspect of electronic noise. It can be produced by the sensor and circuitry of a scanner or digital camera. Image noise can also originate in the unavoidable shot noise of an ideal photon detector. Image noise is an undesirable by-product of image capture that adds spurious and extraneous information [12]. Intensity profile will drop when image is noisy as shown in Fig.4. Blemish is a region darker than the surround-ing pixels. Traditional approach aims at detecting the drops of intensity profile and considers any drops as blemishes. This is the major cause of the unsatisfactory detec-tion results by using traditional method. In order to better separate noises from blem-ish, the filter needs to take into account more spatial information. 
Drops caused by image noise are random and it is uncertain that drops appear in which directions. Detection results in different directions can be seen in Fig.5. In the test image, pixels located within the red rectangle are in a noise region, pixels located within red circle are in a blemish region. It is obvious that the drops caused by noise region can only be detected in vertical direction and is almost non-existent in horizon-tal direction, but the drops caused by blemish can be detected in both horizontal and vertical directions. This implies detecting blemishes in multiple directions and averag-ing all filtering results in different directions can alleviate the influence caused by noise. Besides, the shapes of blemishes are irregular, the proposed multidirectional filter can detect blemishes with various shapes more accurately. 3.2 Proposed multi-directional median filter 
In order to improve the detection results of the blemishes in noisy images, we pro-posed a novel filtering method. The filter we used contains four filters in different directions, respectively, in the horizontal direction, clockwise rotation of 45 degrees from the horizontal direction, clockwise rotation of 90 degrees from the horizontal direction, clockwise rotation of 135 degrees from the horizontal direction as shown in Fig.6. The parameters d and f are experimentally tuned. 
The Filter1 detects blemish in horizontal direction, 
The Filter2 detects blemish in the direction that clockwise rotation of 45 degrees from the horizontal direction, 
The Filter3 detects blemish in the direction that clockwise rotation of 90 degrees from the horizontal direction, 
The Filter4 detects blemish in the direction that clockwise rotation of 135 degrees from the horizontal direction, ent directions, 
Then we calculate the difference between the scaled image and the filtered image, 3.3 Adaptive threshold with bias 
After that, a thresholding operation will be applied to the difference image. Com-pared to the traditional thresholding method, we proposed a novel thresholding meth-od, and the thresholding value can be written as standard deviation of the difference image. Because of blemish effects, the standard deviation is not sufficient to describe the image noise in all scenarios, the bias N is added to make the threshold formula more robust to image noise and more accurate than traditional threshold formula. The adaptive threshold formula can get more ap-propriate threshold according to the noise level of difference image.

Compared with the traditional method, the multidirectional filter with new thresh-old can reduce the interference caused by noise effectively as shown in Fig.7. Experiments were conducted on images taken by two batches of camera samples at different production periods to evaluate the performance of proposed approach and traditional approach. Due to different production environments, 300 low noise raw images and 300 noisy raw images were captured for experiment. We have evaluated the detection results on low noise images and noisy images by using traditional meth-od [11] and the method proposed in this paper. For traditional method, we adopted throughout the experiments. The experimental results are as follows. 4.1 Low noise samples The filter we proposed takes into more spatial information and can detect the blemish with various shapes. By using the novel method, blemishes in low noise image can be detected accurately. The low noise image detection result can be seen in Fig.8 and Fig.9. 4.2 High noise samples In addition, by using the blemish detection method proposed in this paper, the blem-ishes in noisy images can be detected accurately and alleviate the interference caused by noise. The detection results in noisy images can be seen in Fig.10 and Fig.11. 
Experimental results show that the proposed novel method can detect blemishes in low noise images more accurately than traditional method. Besides, the novel method also can detect blemishes in noisy images and alleviate the influence caused by noise. In this paper, we proposed a novel method for blemish detection. The method goes blemish. Compared to the traditional filter presented in Fig.3, the proposed multidi-rectional filter considers more spatial information to detect the blemish in four direc-tions. Besides, we proposed a novel threshold formula which makes the thresholding value to be more flexible and accurate to accommodate various noise levels. The nov-el detection method proposed in this paper can detect blemishes with various shapes and reduce the influence caused by noise, as verified by extensive experiments. 
This work was supported in part by the Shenzhen Emerging Industries of the Stra-tegic Basic Research Project (No. JCYJ20160226191842793), and the National Natu-ral Science Foundation of China (No. 61602312, 61620106008). 
