 In this paper, we propose a set-oriented personalized rank-ing model for diversified top-N recommendation. Users may have various individual ranges of interests. For personalized top-N recommendation task, the combination of relevance and diversity in recommendation results would be desirable. For this purpose, we integrate the concept of diversity into traditional matrix factorization model to construct a set-oriented collaborative filtering model. By optimizing this model with a set-oriented pairwise ranking method, we di-rectly achieve personalized top-N recommendation results which are both relevant and diversified. We also utilize category information explicitly for learning personalized di-versity. Experimental results show that our model outper-forms traditional models in terms of personalized diversity and maintains good performance on relevance prediction. H.3.3 [ Information Systems ]: Information Search and Re-trieval X  Information Filtering Collaborative Filtering, Recommender Systems, Set-oriented Pairwise Ranking, Personalized Diversity
Collaborative Filtering (CF) [2] is one of most popular techniques in providing users with personalized suggestions of items or other information. The basic intuition behind CF is that users who had similar ranges of interests in the past are likely to have similar preferences in the future, and the more similar they were in the past, the more likely they will make similar choices in the future.

Top-N recommendation results are often presented to a target user in the form of a rank list according to their pre-dicted relevance scores. In recent years, diversity of the results list has been regarded as another important factor that influences the satisfaction of users to a recommender system significantly. A recommendation list which contains different types of relevant items would be more desirable. In order to achieve this goal, most traditional methods re-rank the relevance prediction results to balance relevance and diversity [8, 9]. We believe that relevance and diversity should be considered together. As personalized relevance can be predicted through learning, personalized diversity can be also predicted directly. Unlike relevance, diversity is a set-oriented concept. To quantify this concept, we con-struct a set-oriented CF model. We optimize this model for ranking by using a set-oriented pairwise ranking method and directly achieve personalized top-N recommendation results which are both relevant and diversified.

The paper is organized as follows: In Section 2, we review some related work briefly. Then in Section 3, we present the details of our set-oriented personalized ranking model. Our experimental results and analysis are reported in Section 4. Finally, Section 5 concludes the paper.
During the past years, collaborative filtering has been used as an effective technique for recommender systems [2]. In collaborative filtering, latent factor models usually have promising performance on predictive accuracy and scalabil-ity. Most latent factor models are based on factorizing the user-itemratingmatrix,whichareknownasSingularValue Decomposition (SVD) models [4].

Ranking-oriented models have been proposed recently in order to tackle the task of top-N recommendation more prac-tically. A generic optimization criterion BPR was proposed in [5]. The experiments empirically showed that for the task of personalized ranking, learning a CF model with BPR out-performs other learning methods.

Diversity is regarded as another important aspect for the recommendation quality besides relevance. Previous studies showed that diversity of a recommendation list may ham-per relevance to some degree, but will improve user satis-faction as a whole [3]. For traditional work about diver-sity, the concept of user is usually a generic average user, thus the diversified top-N recommendation results are non-personalized. In recent years, many diversification methods have been proposed [8, 9], including some adaptive diversifi-cation methods [6]. But most of these methods are two-step methods that consider relevance and diversity separately. In contrast with this, we combine relevance and diversity in a unified model which adaptively balances them for users with different interests in one step.
In this section, we present our set-oriented personalized ranking model. The objective of this model is to directly recommend personalized item sets of size N which are both relevant and diversified to users with different ranges of in-terests. Key notations are shown in Table 1.
Let U be the set of users and I be the set of items. Ratings of U on I arescoredinamatrix R ( m  X  n ). Entry r ui in R denotes the rating that user u gives to item i and reflects the preference of user u for item i .Let I u be the set of items whose ratings are observed in matrix R for user u . We define asubset I + u  X  I u containing items that user u likes. Where r + represents a rating threshold. We assume that a user prefers all items in I + u over all items in I  X  u I . Previous pairwise ranking approaches use item pairs as training data. In order to quantify the recommendation diversity, in our work we use item set pairs as training data. We define T + u as a candidate positive item set of size N . We denote the set of T + u as T + u . Similarly, we define a common item set of size N as: We also denote the set of T u as T u . A training pair ( u, S for user u is constructed by selecting two item sets S i and S from T + u and T u respectively, accordingly the set-oriented training collection is formalized as follows:
D S := { ( u, S i ,S j ) | S i  X  X  + u  X  S j  X  X  u  X  ( Con 1 In which, Where r s denotes the relevance score of a given item set S and d s denotes the diversity score of this set. The set S is preferred to S j by considering the two conditions above: 1) the relevance score r s i of S i is higher than r s j of S the diversity score d s i of S i is higher than d s j of S relevance scores of S i and S j are equal. We will discuss how to calculate the r s and d s later.
As a famous class of latent factor models, SVD models factorize the user-item rating to the inner product of user latent factor p u and item latent factor q i ,wherebothof p and q i are f -dimension. In the basic SVD model, the rating that user u gives to item i is predicted as follows:
In order to learn the diversity together with relevance, we introduce a new concept named  X  X et Diversity Bias X  (SDB) representing the diversification degree of an item set. By combining SDB and the basic SVD model, we propose a set-oriented CF model to directly predict the score of user
Representations Descriptions u on a given item set S k . The score is decided by both relevance and diversity of S k .Itisformulatedasthis: where b d ( S k ) denotes the diversity bias of S k and  X  is a constant to control the weight of diversity in the model.
Many traditional personalized ranking methods maximize the metric of area under the ROC curve (AUC) [1]. In order to learn the set-oriented CF model (2), we maximize a set-oriented AUC. With the notation of D S , it can be formalized as: Where  X  r u,S i is the predicted preference score of user u on item set S i .Avalueof( X  r u,S i  X   X  r u,S j ) &gt; 0 means the model predicts that user u prefers item set S i to item set S j use logistic loss function as  X  ( x ): Which is a surrogate loss function and corresponds to Bayesian Personalized Ranking (BPR) [5]. Now we can derive our loss function for set-oriented AUC optimization as follows: l (  X  )= Where  X  represents the unknown parameters in (2) and  X  r is a constant for regularization. We solve this loss function with a stochastic gradient descent algorithm. In every single training step, we use the bootstrap sampling to randomly select a triple ( u, S i ,S j ) from D S for updating our model.
For the effective learning of diversity, set diversity bias should be able to reflect the diversity of an item set reason-ably and easy to learn. A well-known approach proposed is to model diversity as the average dissimilarity of all pairs of items in the set [7]. Recently, a new idea has been proposed that the diversity of an item set is associated with the latent factors of items in it [6]. Inspired by this idea, we define v as the latent factors of item i for item-item similarity. For anypairofitem i and item j , the more similar v i and v j the greater the inner product of v i and v j is. Besides, the categories of items are one kind of important and explicit in-formation related to the diversity of an item set. Let | C thenumberofcategoriesitem i contains. We also integrate it into SDB to normalize the latent factors, since an item often contains more than one category. With the notations above, our b d ( S k )isformalizedas:
We also define p c as the latent factors of category c and w i as the latent factors of item i for category-item relation, which are estimated by the logistic regression model below. The result of this model is that items with common cate-gories have similar w i , thus we introduce a L2-norm regu-larizing term || v i  X  w i || 2 to help learn SDB.
In this section, we present a series of experiments to eval-uate our proposed set-oriented personalized ranking model.
We use the publicly available dataset MovieLen-1M in our experimental evaluation. In our work, we regard items with ratings larger than or equal to 4 as relevant. We randomly split relevant/irrelevant items of each user into the train-ing set and the test set with the ratio of 4:1. Then D S is constructed on the training set as described in section 3.1. During the training, we define the relevance score r s of a given item set S as the number of relevant items in it, while the diversity score d s of set S is measured by  X NDCG h @N in (9).
In our experiments, we adopt the precision @N to evaluate the relevance of recommendation sets. The common metric precision @N is defined as: Where H u is the number of relevant items in a recommen-dation set for user u . The diversity of recommendation sets can be evaluated by the metric  X NDCG @N [6]. We use the highest  X NDCG @N (  X NDCG h @N) and the average  X NDCG @N (  X NDCG a @N) instead, since the items in the set have many potential rankings. Let L u := { l 1 ,l 2 ,...,l be the set of all potential inner rankings in a given item set of size N for user u ,weformulate  X NDCG h @N and  X NDCG a @N as:
During training, we utilize  X NDCG h to measure the di-versity of item sets. We obtain an approximate value of it with greedy algorithm in O( N 2 ), since the time complexity of calculating exact  X NDCG h @N is O( N | L u | ). While in the test, we utilize  X NDCG a @N to evaluate the statistical Figure 1:  X NDCG @N of SPR, STD and BPR-MF on MovieLen-1M performance of the recommendation sets of size N .Foreach user u , the recommendation set is approximate optimal rec-ommendation set constructed by greedy selection strategy in O( a u N 2 ), where a u is the amount of items in the test set for user u .
In this paper, we compare our model with several oth-ers [5, 9], which are called BPR-MF (Bayesian Personalized Ranking based on Matrix Factorization) and STD (Sequen-tial Topic Diversification) separately in this paper. We refer to the parameters recommended for BPR-MF in [5] and STD in [9].
Figure 1 compares the performance of our model with baselines in terms of diversity on MovieLen-1M. BPR-MF gives the worst performance on diversity, since it only fo-cuses on providing the most relevant results for users without taking the diversity into account. STD gives higher perfor-mance than BPR-MF through re-ranking the prediction re-sults based on topic(category) diversification. Our proposed SPR consistently outperforms BPR-MF and STD regarding  X NDCG @N at any value of N  X  [3 , 10]. Note that for our model, we use  X NDCG a @N to evaluate the statistical per-formance of the recommendation sets. Another observation is that our model achieves significant improvement when the size N of recommendation set is small. This result empiri-cally shows that our proposed model is suitable to diversify the top-N recommendation results for a small value of N .
In this section, we conduct experiments in the scenario of top-3 recommendation to explore the relation between rele-vance and diversity under various settings of  X  in (2). Ex-perimental results are shown in Figure 2. In our set-oriented CF model,  X  is a constant to balance relevance and diversity for recommendation. We can observe that as the value of  X  grows,  X NDCG a @3 gradually increases while precision @3 decreases. This is consistent to the common intuition that the improvement of diversity weakens the relevance of re-sults. By adjusting  X  carefully, a reasonable balance of rec-ommendation relevance and diversity can be achieved. Table 2: Example top-4 recommendation results for users with Focused interests
In this section, we demonstrate that recommendation re-sults given by our model achieves good personalized diver-sity. In Movielen-1M, we regard users who are related to 15 or more categories as  X  X road X  users and users who are related to 10 or less categories as  X  X ocused X  users. We also use numerical id (1-18) to represent different categories in Movielen-1M, such as 1 presents  X  X ction X , 7 presents  X  X oc-umentary X  and 17 presents  X  X ar X .

We conduct experiments for top-4 recommendation. The results are shown in Table 2 and Table 3. In the two tables, movie ratings given by a user are presented in the brackets after movie names. Our model recommends movie sets with category ranges corresponding to different tastes of users. Table 2 shows a  X  X ocused X  user(id: 4651) case. This user prefers documentary movies suggested by his rating history. Our recommendation set for this user focuses on the same movie type. The relevance of this set is very high with all the movie ratings above 4. Table 3 illustrates a case of the user(id: 406) who has broad interests. The recommendation set for this user covers broad types to meet his taste and also has good performance on relevance. Note that though  X  X lien X  got a rating score 3, it is regarded as a diverse one containing 4 categories related to this user.

We also explore novelty of the recommendation sets for  X  X road X  users in top-3 recommendation. For this purpose, we consider the number of unique categories that each movie contains in a recommendation set. According to our statis-tical results, the expectation and variance of this value is 2.3 and 1.3 respectively. This observation means that each movie contains at least one different category from all the Table 3: Example top-4 recommendation results for users with Broad interests others in a recommendation set. This result further supports that our model has good performance in terms of personal-ized diversity.
In this paper, we propose a set-oriented personalized rank-ing model for diversified top-N recommendation. Our exper-imental results show that our model outperforms traditional models in terms of personalized diversity and maintains good performance on relevance prediction. In future work, we plan to provide a more thoughtful analysis for the potential relation between relevance and diversity in personalized top-N recommendation according to our experimental results.
