 Humans demonstrate a variety and versatility of movements f ar beyond the reach of current anthro-pomorphic robots. It is widely believed that human motor con trol largely relies on a set of  X  X ental templates X  [1] better known as motor primitives or motion templates . This concept has gained in-creasing attention both in the human motor control literatu re [1, 2] as well as in robot imitation learning [3, 4]. The recent suggestion of Ijspeert et al. [3] to use dynamical systems as motor primitives has allowed this approach to scale in the domain o f humanoid robot imitation learning and has yielded a variety of interesting applications as wel l as follow-up publications. However, up to now, the focus of motion template learning has largely bee n on single template acquisition and self-improvement. Future motor skill learning systems on t he other hand need to be able to observe several different behaviors from human presenters and comp ile libraries of motion templates directly from these examples with as little predetermined structure s as possible.
 An important part of such a motor skill learning system is the clustering of many presented move-ments into different motion templates. Human trajectories are recorded as multi-dimensional time-series of joint angles as well as joint velocities using eith er a marker-based tracking setup (e.g., a VICON T M setup), a sensing suit (e.g., a SARCOS SenSuit) or a haptic in terface (e.g., an an-thropomorphic master arm). Inspired by Ijspeert et al. [3], we intend to use dynamical systems as generative models of the presented trajectories, i.e., a s motion templates. Our goal is to cluster these multi-dimensional time-series automatically into a small number of motion templates without pre-labeling of the trajectories or assuming an a priori num ber of templates. Thus, the system has to discover the underlying motion templates, determine the number of templates as well as learn the underlying skill sufficiently well for robot application.
 In principle, one could use a non-generative clustering app roach (e.g., a type of K-means) with a method for selecting an appropriate number of clusters and, subsequently, fit a generative model to each cluster. Here we prefer to take a different approach in w hich the clustering and learning of the underlying time-series dynamics are performed at the same t ime. This way we aim at ensuring that each obtained cluster can be modeled well by its representat ive generative model.
 To date the majority of the work on time-series clustering us ing generative models has focused on static mixture models. Clustering long or high-dimensiona l time-series is hard when approached with static models, such that collapsing the trajectories t o a few relevant features is often required. This problem would be severe for a high-dimensional motor le arning system where the data needs to be represented at high sampling rates in order to ensure th e capturing of all relevant details for motor skill learning. In addition, it is difficult to ensure s moothness when the time-series display high variability and, therefore, to obtain accurate genera tive models with static approaches. A natural alternative is to use mixtures of temporal models w hich explicitly model the dynamics of the time-series. In this paper, we use Mixtures of Linear Gau ssian State-Space Models (LGSSMs). LGSSMs are probabilistic temporal models which, despite th eir computational simplicity, can repre-sent many natural dynamical processes [5]. As we will see lat er in this paper, LGSSMs are powerful enough to model our time-series sufficiently accurately.
 For determining the number of clusters, most probabilistic approaches in the past used to train a sep-arate model for each possible cluster configuration, and the n select the one which would optimize the trade-off between accuracy and complexity, as measured for example by the Bayesian Informa-tion Criterion [6, 7]. The drawback of these approaches is th at training many separate models can lead to a large computational overhead, such that heuristic s are often needed to restrict the number of possible cluster configurations [7].
 A less computationally expensive alternative is offered by recent Bayesian approaches where the model parameters are treated as random variables and integr ated out yielding the marginal likelihood of the data. An appropriate prior distribution can be used to enforce a sparse representation, i.e., to select the smallest set of parameters that explains the data well by making the remaining parameters inactive. As a result, the structure selection can be achiev ed within the model, without the need to train and compare several separate models.
 As a Bayesian treatment of the Mixtures of Linear Gaussian St ate-Space Models is intractable, we introduce a deterministic approximation based on variatio nal Bayes. Importantly, our approximation is especially designed to enable the use of standard LGSSM in ference methods for the hidden state variables, which has the advantage of minimizing numerical ly instabilities.
 As a realistically difficult scenario in this first step towar ds large motor skill libraries, we have selected the game of dexterity Balero (also known as Ball-In -A-Cup or Kendama, see [8]) as an evaluation platform. Several substantially different typ es of movements exist for performing this task and humans tend to have a large variability in movement e xecution [9]. From a robotics point of view, Balero can be considered sufficiently complex as it i nvolves movements in all major seven degrees of freedom of a human arm as well as an anthropomorphi c robot arm. We are able to show that the presented method gives rise to a reasonable number o f clusters representing quite distinct movements and that the resulting generative models can be us ed successfully as motion templates in physically realistic simulations.
 In the remainder of the paper, we will proceed as follows. We w ill first introduce a generative approach for clustering and modeling multi-dimensional ti me-series with Bayesian Mixtures of LGSSMs and describe how this approach can be made tractable u sing a variational approximation. We will then show that the resulting model can be used to infer the motion templates underlying a set of human demonstrations, and give evidence that the gene rative model representing each motion template is sufficiently accurate for control in a mechanica lly plausible simulation of the SARCOS Master Arm. Our goal is to model both human and robot movements in order to build motion template libraries. In this section, we describe our Bayesian modeling approach an d discuss both the underlying assump-tions as well as how the structure of the model is selected. As the resulting model is not tractable for analytical solution, we introduce an approximation method based on variational Bayes. 2.1 Modeling Approach In our Bayesian approach to Mixtures of Linear Gaussian Stat e-Space Models (LGSSMs), we are given a set of N time-series 1 v 1: N 1: T of length T for which we define with the following marginal likelihood where z n  X  { 1 , . . . , K } indicates which of a set of K LGSSMs generated the sequence v n 1: T . The parameters of LGSSM k are denoted by  X  k and have a prior distribution depending on hyperparam-eters  X   X  k . The K -dimensional vector  X  includes the prior probabilities of the time-series genera tion for each LGSSM and has prior distribution hyperparameter  X  .
 The optimal hyperparameters are estimated by type-II maxim um likelihood [10], i.e., by maximizing the marginal likelihood over  X   X  1: K and  X  . Clustering can be performed by inferring the LGSSM that ploy a Linear Gaussian State-Space Model [5] that assumes th at the observations v 1: T , with v t  X   X  V , are generated from a latent Markovian linear dynamical syst em with hidden states h 1: T , with h Standard LGSSMs assume a zero-mean hidden-state noise (  X  t  X  0 H ). In our application the use of a time-dependent mean  X  t 6 = 0 H leads to a superior modeling accuracy. A probabilistic form ulation of the LGSSM is given by and  X  = { A, B,  X  H ,  X  V ,  X  1: T ,  X  } . Due to the simple structure of the model, performing infere nce, In the presented Bayesian approach, we define a prior distrib ution p ( X  |  X   X ) over the parameters  X  where  X   X  are the associated hyperparameters. More specifically, we d efine zero-mean Gaussians on the elements of A and on the columns of B by 3 p A |  X ,  X   X  1 H = where  X  and  X  are a set of hyperparameters which need to be optimized. We ma ke the assumption that  X   X  1 H ,  X   X  1 V and  X   X  1 are diagonal and define Gamma distributions on them. For  X  1 we define a zero-mean Gaussian prior, while we formally treat  X  2: T as hyperparameters and determine their optimal values. These choices are made in order to render our Bayesian treatment feasible and to obtain a sparse parametrization, as discussed in more detai ls below.
 In the resulting mixture model, we consider a set of K such Bayesian LGSSMs. The joint distribu-tion over all sequences given the indicator variables and hy perparameters is defined as parameters  X  k have been employed to generate it.
 Modeling p z 1: N |  X  . As prior for  X  , we define a symmetric Dirichlet distribution where  X ( ) is the Gamma function and  X  denotes a hyperparameter that needs to be optimized. This distribution is conjugate to the multinomial, which greatl y simplifies our Bayesian treatment. To model the joint indicator variables, we define Such Bayesian approach favors simple model structures. In p articular, the priors on A k and B k en-force a sparse parametrization since, during learning, man y  X  k ij and  X  k j get close to infinity whereby fect). This enables us to achieve structure selection withi n the model. Specifically, this approach en-sures that the unnecessary LGSSMs are pruned out from the mod el during training (for certain k , all for all n )). 2.2 Model Intractability and Approximate Solution The Bayesian treatment of the model is non-trivial as the int egration over the parameters  X  1: K and  X  renders the computation of the required posterior distribu tions intractable. This problem results from  X  1: K as well as between the indicators z 1: N and  X ,  X  1: K . To deal with this intractability, we use a deterministic approximation method based on variational B ayes.
 Variational Approximation. In our variational approach we introduce a new distribution q and make the following approximation 4 That is, we approximate the posterior distribution of the hi dden variables of the model by one in which the hidden states are decoupled from the parameters gi ven the indicator variables and in which the indicators are decoupled from the parameters.
 The approximation is achieved with a variational expectati on-maximization algorithm which min-imizes the KL divergence between the right and left hand side s of Equation (2), or, equivalently, respect to q for fixed  X   X  1: K and  X  and vice-versa. Observation v n t is then placed in the most likely LGSSM by computing arg max k q ( z n = k ) . Figure 1: This figure shows one of the Balero motion templates found by our clustering method, i.e., the cluster C2 in Figure 2. Here, a sideways movement wi th a subsequent catch is performed and the uppermost row illustrates this movement with a symbo lic sketch. The middle row shows an execution of the movement generated with the LGSSM represen ting the cluster C2. The lowest row shows a recorded human movement which was attributed to clus ter C2 by our method. Note that movements generated from LGSSMs representing other cluste rs differ significantly.
 Resulting Updates. While the space does not suffice for complete derivation, we w ill briefly sketch the updates for q . Additional details and the updates for the hyperparameter s can be found in [12]. The updates consist of a parameter update, an indica tor variable update and a latent state update. First, the approximate parameter posterior is give n by where hi q denotes expectation with respect to q . The specific choice for p ( X  k |  X   X  k ) makes the computation of this posterior relatively straightforward , since q ( X  k ) is a distribution of the same type. Second, the approximate posterior over the indicator variables is given by where H q ( x ) denotes the entropy of the distribution q ( x ) and z  X  n includes all indicator variables except for z n . Due to the choice of a Dirichlet prior, the term p ( z n = k | z  X  n ,  X  ) = R  X  p ( z n = k | z  X  n ,  X  ) p (  X ,  X  ) can be determined analytically. However, the required aver age over this term is computationally expensive, and, thus, we approximate it us ing a second order expansion [13]. The third and most challenging update is the one of the hidden sta tes Whilst computing this joint density is relatively straight forward, the parameter and indicator variable to this distribution. Following a similar approach to the on e proposed in [14] for the Bayesian LGSSM, we reformulate the rhs of Equation (3) as proportiona l to the distribution of an augmented LGSSM such that standard inference routines for the LGSSM ca n be used. In this section we show that the model presented in Section 2 c an be used effectively both for inferring the motion templates underlying a set of human tra jectories and for approximating motion templates with dynamical systems. For doing so, we take the d ifficult task of Balero, also known as Ball-In-A-Cup or Kendama, and collect human executions o f this task using a motion capture Figure 2: In this figure, we show nine plots where each plot rep resents one cluster found by our method. Each of the five shown trajectories in the respective clusters represents a different recorded Balero movement. For better visualization, we do not show jo int trajectories here but rather the trajectories of the cup which have an easier physical interp retation and, additionally, reveal the differences between the isolated clusters. All axes show un its in meters. setup. We show that the presented model successfully extrac ts meaningful human motion templates underlying Balero, and that the movements generated by the m odel are successful in simulation of the Balero task on an anthropomorphic SARCOS arm. 3.1 Data Generation of Balero Motions In the Balero game of dexterity, a human is given a toy consist ing of a cup with a ball attached by a string. The goal of the human is to toss the ball into the cup. Humans perform a wide variety of different movements in order to achieve this task [9]. For ex ample, three very distinct movements are: (i) swing the hand slightly upwards to the side and then g o back to catch the ball, (ii) hold the cup high and then move very fast to catch the ball, and (iii) je rk the cup upwards and catch the ball in a fast downwards movement. Whilst the difference in these three movements is significant and can be easily detected visually, there exist many other move ments for which this is not the case. We collected 124 different Balero trajectories where the su bject was free to select the employed movement. For doing so, we used a VICON T M data collection system which samples the trajecto-ries at 200Hz to track both the cup as well as all seven major de grees of freedom of the human arm. For the evaluation of our method, we considered the seven joi nt angles of the human presenter as well as the corresponding seven estimated joint velocities .
 In the lowest row of Figure 1, we show how the human motion is co llected with a VICON T M motion tracking setup. As we will see later, this specific movement i s assigned by our method to cluster C2 whose representative generative LGSSM can be used successf ully for imitating this motion (middle row). A sketch of the represented movement is shown in the top row of Figure 1. 3.2 Clustering and Imitation of Motion Templates We trained the variational method with different initial co nditions, hidden dimension H = 35 and a number of clusters K which varied from 20 to 50 in order to avoid suboptimal result s due to local maxima.
 The resulting clustering contains nine active motion templ ates. These are plotted in Figure 2, where, instead of the 14-dimensional joint angles and velocities, we show the three-dimensional cup tra-jectories resulting from these joint movements, as it is eas ier for humans to make sense of cartesian trajectories. Clusters C1, C2 and C3 are movements to the sid e which subsequently catch the ball. Here, C1 is a short jerk, C3 appears to have a circular movemen t similar to a jerky movement, while C2 uses a longer but smoother movement to induce kinetic ener gy in the ball. Motion templates C4 and C5 are dropping movements where the cup moves down fast for more than 1.2m and then Figure 3: (a) Time-series recorded from two executions of th e Balero movement assigned by our model to cluster C1. In the first and second rows are plotted th e positions and velocities respectively (for better visualization each time-series component is pl otted with its mean removed). (b) Two executions of the Balero movement generated by our trained m odel using probability distributions of cluster C1. catches the ball. The template C5 is a smoother movement than C4 with a wider catching movement. For C6 and C7, we observe a significantly different movement w here the cup is jerked upwards drag-ging the ball in this direction and then catches the ball on th e way down. Clusters C8 and C9 exhibit the most interesting movement where the main motion is forwa rd-backwards and the ball swings into the cup. In C8 this task is achieved by moving upwards at t he same time while in C9 there is little loss of height.
 To generate Balero movements with our trained model, we can u se the recursive formulation of the LGSSM given by Equation 1 where, for each cluster k , A k , B k and  X  k 1 are replaced by the mean values of their inferred Gaussian q distributions, while the noise covariances are replaced by the modes of their Gamma q distributions. The initial hidden state h 1 and the noise elements  X  h t and  X  t are sampled from their respective q distributions, whist the inferred optimal values are used f or  X  In Figure 3 (a) we plotted two recorded executions of the Bale ro task assigned by our model to cluster C1. As we can see, the two executions have similar dynamics bu t also display some differences due to human variability in performing the same type of movement . In Figure 3 (b) we plotted two executions generated by our model using the learned distrib utions representing cluster C1. Our model can generate time-series with very similar dynamics t o the ones of the recorded time-series. To investigate the accuracy of the obtained motion template s, we used them for executing Balero movements on a simulated anthropomorphic SARCOS arm. Inspi red by Miyamoto et al. [15], a small visual feedback term based on a Jacobian transpose met hod was activated when the ball was within 3cm in order to ensure task-fulfillment. We found that our motion templates are accurate enough to generate successful task executions. This can be s een in Figure 1 for cluster C2 (middle row) and in the video on the author X  X  website. In this paper, we addressed the problem of automatic generat ion of skill libraries for both robot learning and human motion analysis as a unsupervised time-s eries clustering and learning problem based on human trajectories. We have introduced a novel Baye sian temporal mixture model based on a variational approximation method which is especially d esigned to enable the use of efficient inference algorithms. We demonstrated that our model gives rise to a meaningful clustering of human executions of the difficult game of dexterity Balero an d is able to generate time-series which are very close to the recorded ones. Finally, we have shown th at the model can be used to obtain successful executions of the Balero movements on a physical ly realistic simulation of the SARCOS Master Arm. The authors would like to thank David Barber for useful discu ssions and Betty Mohler for help with data collection.
 [1] T. Flash and B. Hochner. Motor primitives in vertebrates and invertebrates. Current Opinion in [2] B. Williams, M. Toussaint, and A. Storkey. Modelling mot ion primitives and their timing in [3] A. Ijspeert, J. Nakanishi, and S. Schaal. Learning attra ctor landscapes for learning motor prim-[4] S. Calinon, F. Guenter, and A. Billard. On learning, repr esenting and generalizing a task in a [5] J. Durbin and S. J. Koopman. Time Series Analysis by State Space Methods . Oxford Univ. Press, [6] Y. Xiong and D-Y. Yeung. Mixtures of ARMA models for model -based time series clustering. [7] C. Li and G. Biswas. A Bayesian approach to temporal data c lustering using hidden Markov [8] J. Kober, B. Mohler and J. Peters. Learning perceptual co upling for motor primitives. Interna-[9] S. Fogel, J. Jacob, and C. Smith. Increased sleep spindle activity following simple motor proce-[10] D. J. C. MacKay. Information Theory, Inference and Learning Algorithms . Cambridge Univ. [11] D. Wipf and J. Palmer and B. Rao. Perspectives on Sparse B ayesian Learning. In Advances in [12] S. Chiappa and D. Barber. Dirichlet Mixtures of Bayesia n Linear Gaussian State-Space Mod-[13] K. Kurihara, M. Welling, and Y. W. Teh. Collapsed variat ional Dirichlet process mixture [14] D. Barber and S. Chiappa. Unified inference for variatio nal Bayesian linear Gaussian state-[15] H. Miyamoto and S. Schaal and F. Gandolfo and Y. Koike and R. Osu and E. Nakano and
