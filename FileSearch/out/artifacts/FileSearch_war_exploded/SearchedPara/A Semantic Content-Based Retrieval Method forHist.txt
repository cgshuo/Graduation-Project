 Medical images have been supporting clin ical decisions in health care centres during the last decades, for instance the Geneve University Hospital reported a production rate of 12.000 daily images during 2.002 [10]. Traditional medical image database systems store images as a complementary data of textual infor-mation, providing the most basic and common operations on images: transfer and visualization. Usually, these systems are restricted to query a database only through keywords, but this kind of queries limits information access, since it does not exploit the intrinsic nature of medical images.

A recent approach to medical image databa se management is the retrieval of information by content, named Content-Based Image Retrieval (CBIR)[10] and several systems such as ASSERT [12], IRMA [8] or FIRE [4] work following this approach. These systems allow evaluation of new clinical cases so that when sim-ilar cases are required, the system is able to retrieve comparable information for supporting diagnoses in the decision making process. One drawback of current CBIR systems is that they are based on basic image features that capture low-level characteristics such as color, textures or shape. This approach fails to capture the high-level patterns corresponding to the semantic content of the image, this may produce poor results depending on the type of images the system deals with.
On the other hand, it is well known that the diagnosis process in medicine is mainly based on semantic or semiotic knowledge, difficult issues to deal with when image knowledge contents has to be organized for retrieval tasks. To extract image semantics is a great challenge because of the semantic gap [9], that is to say, the existing distance between concep tual interpretation at a high level and the low-level feature extraction. One strategy to bridge the semantic gap in image retrieval is the automatic image annotation, investing efforts to assign labels to images as accurately as possible to support keyword-based image search.
The problem of extracting semantic features from images may be approached from two different perspectives: an analytic approach and an inductive approach. The analytic approach requires to understand, with the help of an expert, what a given pattern is; then a model to decide whether the pattern is present or not is built, based on this knowledge. On the other hand, the inductive approach, or machine-learning approach, requires to collect enough image samples where the pattern is present or absent, and to train a model able to discriminate both situations. The inductive approach has many advantages: it just relays on the expert for labeling the samples; the model may be easily retrained when new data is available; and there is not need for dealing directly with the complexity of the patterns. In this work, the inductive approach is followed.

This paper presents the design, implementation and evaluation of a new method for the semantic analysis of a basal-cell-carcinoma database. The whole system is modeled as to map a set of low-level features into high-level semantic properties for a collection o f basal-cell-carcinoma images, which were previously annotated by an expert pathologist. The semantic mapper is able to recognize which concepts are present in an image, quantifying a degree of certainty about those decisions using a binary SVM per concept. Although classifiction methods have been previously used for automatic annotation of image concepts [5], our approach builds a new semantic feature space instead of assigning keywords to the image. An image similarity measure is calculated in the semantic feature space. This similarity measure provides a finer mechanism for ranking similar images than keyword-matching-based retrieval.

The reminder of this paper is organized as follows. In Section 2, the problem of content-based retrieval in histopathology is introduced. In Section 3, the model for feature extraction is presented. Me thods for compare images are in Section 4, Section 5 presents results of the experimental evaluation and some concluding remarks are presented in Section 6. Medical practice constantly requires acces s to reference information for the deci-sion making process in diagnostics, teaching and research. Previous works have designed CBIR systems for medical image databases providing services such as query-by-example, query-by-regions or automatic image annotations among others [14,11]. This kind of tools helps physicians to take informed decisions and to make case-based reasoning.

The aim of this work is to include domain-specific knowledge to improve the performance of a medical CBIR system. Specifically, the proposed system deals with histopathology images, so some details of this kind of images need to be studied and understood. A basic concept in histology is that there exist four basic types of tissue: epithelial, connect ive, muscle, and nerve[7]. With very few exceptions, all organs contain a different p roportion of these four basic tissues. In general, histological techniques highlight these tissues with few colours since dyes are designed to specifically arise a particular tissue feature. In terms of image processing, histological images are distinguished by having more or less homogeneous textures or repeated patterns, which may be used to characterise the image. Main information in histological images lyes on repeated patterns of textures, with particular edg es and slight color differences.

Histopathology images used in this work were acquired to diagnose a special skin cancer called basal-cel l carcinoma. Slides were obtained from biopsy samples whichwerefixedinparaphin,cuttoa5mmthickness,depositedontotheglass slides and finally colored with Hematoxilin-Eosin. The whole collection is close to 6.000 images associated with clinical cases. A subset of the collection consisting of 1.502 images were annotated and organized in semantic groups by a pathologist. The groups are representative of the semantic categories that are relevant in the scenario of a content-based image retrieval system, according to the expert. Each group is composed of a number of image samples of a histopathology concept. A particular image may belong to many groups simultaneously, because each image may contain more than one concept. This section is devoted to describe how l ow-level features are transformed into semantic characteristics. The whole process starts by a conventional low-level feature extraction phase that reduces image dimensionality: histograms of pre-defined edge, texture and color characteristics. Dimensionality is further reduced using statistical descriptors of the histogram up to a fourth order along with its entropy. The resulting feature vector , herein called meta-features, grossly describes the underlying probability distribution associated with each differ-ent histogram. Once images are expressed as meta-features, a semantic mapper transforms them into semantic features. This mapper is devised for capturing the pathologist knowledge and is composed of 19 SVM classifiers, each special-ized upon different concepts previously defined by an expert pathologist. Figure 1 illustrates the feature extraction process. 3.1 Low-Level Feature Extraction A very convenient approach to face feature extraction consists in using a statisti-cal frame: images are modeled as random variables so that histograms stand for the probability distribution of any of the selected features i.e. edges, textures and colors. Histogram features have been traditionally used in content-based image retrieval to calculate similarity measures and to rank images [3]. The following histogram features were used:  X  Gray histogram : Luminance intensities in a 256 scale.  X  Color histogram : In the RGB color model with a partition space of 8  X  8  X  8  X  Local binary partition : A local texture analysis to determine neighbor dom- X  Tamura texture histogram : Composed of contrast, directionality and coarse- X  Sobel histogram : Edge detection  X  Invariant feature histograms : Local invariant transformations such as rota-A set of meta-features are calculated from the information of each histogram h as follows ( k is a index for histogram bins):  X  Mean :  X  Deviation :  X  Skewness : the third central moment.  X  Kurtosis : the fourth central moment.  X  Entropy : All meta-features are calculated on each of the six histogram features, which amounts to a total of 30 meta-features per image. 3.2 Semantic Mapper Overall, every pathologist follows a standard training addressed to strength out both diagnosis precision and velocity. An efficient management of these two com-plementary issues is based on four classic steps: look, see, recognize and under-stand [2]. A pathologist that evaluates an image is basically looking for patterns and his/her decisions are usually based on the presence or absence of a specific pattern. These patterns are associated with concepts, that is, pathologists give meaning to the image or in other words, they  X  X nderstand X  the image contents. Patterns may correspond to simple low-level features, but in most cases they are a complex combination of them. Features are usually made up of many of this kind of patterns and are called high-level or semantic features. The main goal of this work is to design a model to capture the semantic interpretation of histopathology images, in order to achive a better CBIR effectivity.
The core of the proposed semantic model is the semantic mapper. Since groups are non disjoint, the semantic mapper is not a single classifier but a model of many learning algorithms identifying the different concepts present in an image. This mapper is composed of 18 Support Vector Machine (SVM) classifiers [13], each specialized on deciding whether or not one image contains one of the eighteen possible concepts, and a e xtra classifier to detect noise 1 . When the image representation is processed through th is semantic mapper, m eta-features are individually processed by each of the 19 classifiers. In this model, each classifier outputs a score value indicating whether the image contains the concept or not. With the output of each classifier, the semantic model builds a semantic feature vector containing the membership deg ree of one image to every semantic group. 3.3 Semantic Mapper Training The dataset used to train each classifier is composed of 1.502 images, organized in 19 different groups (corresponding to the 19 different categories defined by the pathologist). The training dataset is composed of meta-features with their cor-responding labels and each group has a specific dataset. Each dataset is entailed with exactly the same attr ibutes except for the class label which can only have two possible values: positive if the example belongs to this group and negative otherwise. In most of the groups there is a considerable amount of imbalance between negative and positive classes, this is solved by resampling the class with less elements. Each dataset is split, using a stratified sampling approach, into two subsets: 20% is used for testing and 80% for training and validation. A 10-fold cross validation scheme on the training set is used to evaluate the classification rate. The test dataset is set aside and used at the end for calculating the final error rate of the classifier.

A SVM classifier is provided with differ ent parameters (herein called hyper-parameters), such as the regularization parameter  X  along with the kernel and its particular parameterization. In order to select the best configuration for each SVM classifier, generalizing the nature of the associated concept, the following domains for the hyperparameters were studied:  X  Polynomial Kernel . (inhomogeneous) with exponent d setto5and20  X  Radial Basis Function Kernel . with four different values for  X  :0 . 001, 0 . 1, 0 . 5  X  Lambda . The regularization parameter was evaluated in the interval [1 , 50] The purpose of the training evaluation is to identify the best model for each histopathology concept. In total, there were 5 different models to evaluate per concept: one with a polynomial kernel and four with a RBF kernel for each of the parameters shown above. Each model h as a different complexity value which is found as the minimum value drawn from the error-complexity plot. When an optimal model value is obtained, the minimum error rate between models allows to select the best model among the 5 possible ones. Similarity evaluation of image contents is achieved using metrics. For image re-trieval, metrics are designed to detect di fferences between the available features. This work uses metrics for two type of contents: low-level features and semantic features as follows. 4.1 Low-Level Feature Metrics Since low-level features are histograms, they require metrics evaluating differ-ences between probability distributions. Evaluated metrics were Relative Bin Deviation D rbd , Jensen-Shannon Divergence D JSD and Euclidean Distance L 2 . For each feature, we experimentally found the most appropriate metric capturing the feature topology in the image collection, obtaining a set of feature-metric pairs able to rank histopathology images. Many features can be evaluated in an individual metric using a linear combination approach of the feature-metric pairs. If x and y are images; F k is a function to extract a low-level feature k ;and M k is a metric able to compare the feature low level features is: where w k is a factor that controls the relative importance of each feature-metric pair. The best values for all w k were found by exhaustive search. 4.2 Semantic Metric Semantic features are codified in a vector per image, in which each position rep-resents a value of membership degree to the corresponding group. These values are produced by each component of the semantic mapper and are scaled to fit the [0 , 1] range. Each image may belong to many groups at the same time, pro-viding information about the content an d interpretation of the overall scene. To compare images in a semantic way, the Tanimoto coefficient was selected, which is a generalization of the Jaccard coefficient [1]. In t his problem, Tanimoto co-efficient can interpret, how many positio ns in the semantic vectors are showing coincidences, emphasizing the similari ty between concepts shared by both im-ages. Given two semantic vectors A and B , each with 19 positions, the Tanimoto coefficient assigns a simila rity score to the associated images as follows: MEler et al [6] presents a framework to evaluate CBIR systems in order to re-port comparable results from different r esearch centers in a standardized way. The most representatives of those performance measures are precision and re-call. Since precision can be measured for different values of recall, the average precision of the n -th result is reported to compare experiments, named P ( n ). Also a precision vs recall graph may be drawn, which provides information about the behavior of the system in many points. Also, the rank of relevant results is used for measuring performance; in this wo rk, the rank of the first relevant result (Rank1) and the average, normalized rank (NormRank) were used.

Each experiment was configured to sel ect 30 random queries in the collection, through a query-by-example approach. Results associated to each query were evaluated as relevant or irrelevant against the ground truth, and performance measures were averaged to obtain the final result of the experimentation.
Table 1 shows the performance of the CBIR system. In one case, only low-level features were used. In the other ca se, semantic features were used. For all the measures, the semantic features outperform the low-level features. This is corroborated by the precision vs. recall graph (Fig. 2).

The low-level-feature system perfor mance serves a bottom line to assess the real contribution of incorporating domain knowledge to the system. The results Precision -Recall Graph show that the proposed model to represen t this domain knowledge in a semantic feature space, greatly improve the performance of the system. The paper presented a novel approach to represent histopathology knowledge, which is naturally included into a CBIR system. The approach allows to bridge the semantic gap preserving in the same context both, the low-level features and the semantic features. This was accomp lished by a semantic mapper based on SVM classifiers. This mapper allows the building of a new semantic feature space in which a metric is used to calculate the similarity between images.
The experimental results show that th is approach can effectively model the histopathology knowledge, that is to say, images are automatically interpreted and compared as pathologists does. This strategy provides a semantic analysis of image contents, allowing a highly improved operation of the CBIR system, in terms of precision.

The future work includes exploring richer semantic representations, using other low-level features, performing a more extensive evaluation with a larger bank of images and additional pathologists to test the system.

