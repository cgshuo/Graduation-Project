 To combat the ease of online shopping in pajamas, offline mall owners focus increasingly on driving satisfaction and improving retention by identifying customers X  preferences. However, most of these studies are based on customers X  of-fline consuming history only. Benefiting from the internet, we can also get customers X  online behaviors, such as the search logs, web browsing logs, online shopping logs, and so on. Might these seemingly irrelevant information from two different modalities (i.e. online and offline) be somehow in-terrelated? How can we make use of the online behaviors and offline actions jointly to promote recommendation for offline retailing?
In this study, we formulate this task as a cross-modality recommendation problem, and present its solution via a pro-posed probabilistic graphical model, called Online-to-Offline Topic Modeling (O2OTM). Specifically, this method explic-itly models the relationships between online and offline top-ics so that the likelihood of both online and offline behav-iors is maximized. Then, the recommendation is made only based on the pairs of online and offline topics, denoted by ( t, l ), with high values of lift , such that the existence of the online topic t greatly increases the response on the corre-sponding offline topic l compared with the average response for the population without the online topic t . Furthermore, we evaluate this solution in both live and retrospect exper-iments. The real-world deployment of this model for the anniversary promotion campaign of a famous shopping mall in Beijing shows that our approach increases the occurred customer purchases per promotion message by 29.75% com-pared with the baseline. Also, our model finds some inter-esting interpretable relationships between the online search topics and offline brand topics.
 Brands recommendation, Topic modeling, Recommendation explanation
Recommendation systems (RS) [ 16] have been popular for decades, improving the quality of our daily lives by facilitat-ing the item selections from a large set of candidates. Here, we focus on the recommendation systems for offline retail-ing . Although online shopping has the tendency of booming development, offline retailing still covers 92% and 90% of the US and China retailing market in 2014 [ 1, 2], respec-tively. Thus, small improvements on offline retailing might draw great benefits. Meanwhile, with the penetration of IT systems into this traditional sector, the customers X  of-fline consumption logs can be recorded to better undersatnd customers X  interests for driving satisfaction and improving retention. However, previous studies mostly consider the behaviors from offline and online separately [ 8, 12].
In this paper, we study the online and offline activities from a joint perspective. Here, online behaviors consist of all the activities on Internet, such as web browsing, web searching, online video watching, online music listening, and online shopping etc, while offline behaviors include all the activities in real lives, such as shopping in a mall, traveling, dinning out, watching films etc. Figure 1 shows an example of the data we have from these two modalities. For a smal-l fraction of users, we might know their activities on both online and offline sides. On the online side, we know what they searched in a search engine, what videos they watched, and what items they bought online. On the offline side, we know what brands they consumed in an offline shopping mall. With these data, we might ask could the videos user-s watch on Youtube interpret the tour sites they select for travelling? Could the news users read on internet be related with the books they borrow in a library? If we connect the online and offline behaviors together, could these two modal-ities of data fire the chemical reactions for more meaningful recommendation?
This study pioneers towards this direction. As a case s-tudy, here we consider the online search logs as the online behaviors, and the offline shopping history as the offline be-haviors (note that the proposed model can be applied to any type of online and offline activities). Originally, these two sets of data are owned by Internet companies and local malls, separately. We will show how profitable if Internet companies with online data and local retailers with offline data cooperate for a win-win situation (with the consent from users).

Our basic assumption in this study is that customers X  on-line behaviors could reflect their interests, which in turn in-fluence their offline behaviors. From the real-world data, we F igure 1: Offline behaviors and online behaviors. do find some interesting examples which demonstrate that users X  search logs are associated with their offline shopping activities (even although people might not search on Inter-net the exact items they buy offline). Take a clothing brand EVISU as an example. Readers can perceive the style of this clothing brand by its in-store advertisement poster, shown in Figure 2. Also, Table 1 shows some key query words is-sued by the customers of this brand. It clearly demonstrates that people who buy EVISU are interested in Japanese ani-mations, computer games, indicating that they are the fash-ionable new generation. This is consistent with the brand spirit of EVISU .

With this assumption, if the relationship between online and offline behaviors can be automatically discovered, it will greatly benefit the mall owners in both offline and online sce-narios. A typical offline application is for the sales campaign of a shopping mall. To increase sales revenue, once or twice a year the mall carries out the promotion events by send-ing coupons to the targeted customers. So, which coupon should be sent to a given user? Setting aside the scale of the discount, it is reasonable to assume that the more a user like a brand the more likely she will use its coupons. Previ-ously, this recommendation for offline coupons is based on users X  offline shopping history only. With the support of on-line behaviors, more accurate recommendation is expected to increase the revenue significantly. This is also validat-ed by the live experiment conducted in a famous shopping center in Beijing (detailed in Section 5).

For the online apllication, with the connection between online and offline behaviors, the local retailers might conduct more effective online advertising to the target customers for a brand. For example, if we know that people who buy EVISU often watch Japanese animations, we can directly put the coupons of EVISU just before they watch the videos. Also, the representative words of the related topics are the important key words the brand manager should bid for the paid ads shown in the search results.

Motivated by these applications, here we propose the prob-abilistic graphic model to depict the online and offline be-haviors jointly with the goal for offline retailing recommen-dation. Compared with the previous studies on RS, this task imposes us some new challenges.  X 
Multiple modalities and modality missing. The online and offline activities actually form the two modalities of user behaviors. Previous studies take use of only one modality (online or offline) for recommendation, but neglect the oth-er part. Additionally, as shown in Figure 1, only a small
Fi gure 2: An in-store poster for EVISU fraction of users have both the online and offline activi-ties. For the left large amount of users who are potential customers of a mall (living around the mall), they might only leave some online tracks, however, might not consume in the mall before. It means that their offline modality is missing. Thus, we need to transform these online tracks into the intentions and preferences for offline consumption.  X 
Interpretability. Previous recommendation methods, like matrix factorization [ 27 ], are usually less interpretable. In their methods, since users and items are mapped to the latent vectors, it is hard to explain what each dimension represents. However, for mall owners it will be much more acceptable if the reasons of retail recommendations are pro-vided. Additionally, for the applications of online advertis-ing we need to know the exact key words which are predic-tive to the consumption of a certain brand. In this study, the online tracks, especially the queries users search, pro-vide us the unique opportunity for the explanation of rec-ommendation. Thus, we need to not only make the recom-mendations, but also explicitly model the relationships be-tween the online and offline behaviors such that the offline recommendations can be explained by the online search words. Later, we will give more meaningful examples to show the interpretability of our model.  X 
Predictive vs. unpredictive features. It is also worth em-phasizing that not all the online behaviors are predictive to offline activities. For example, most people search the lat-est news from the search engine. Intuitively, the key words about the news, e.g., the local place names and the people names in breaking news, might not be predictive or causal-ly related to any offline consumptions. Thus, the proposed model needs to automatically distinguish predictive online features from the unpredictive ones so that the recommen-dation is made only based on the predictive online features.
For past decades, many researches have been conducted for recommendation. The detailed discussion on these relat-ed works on recommendation techniques will be presented in Section 7. Here, we argue that although previous studies might address some of the challenges separately there still do not exist a model to tackle them all, especially for the issues of interpretability and predictive features. In this pa-per, we assume that both online and offline behaviors can be grouped into some semantically related topics. Then, we d evelop the lift -based recommendation method, where the recommendation is made only based on the pairs of online and offline topics, denoted by ( t, l ), with high values of lift , such that the existence of the online topic t greatly increases the response on the corresponding offline topic l compared with the average response of the population without the on-line topic t . To estimate these lift values, we propose a prob-abilistic graphic model, called Online to Offline Topic Model (O2OTM), to explicitly build the relationships between on-line and offline topics so that the likelihood to generate all the online and offline behaviors is maximized. We argue that this lift-based recommendation method will be more practically useful for the live recommendation scenarios.
Finally, we evaluate our model by both retrospect and live experiments to show its superiority over several baselines, and also give more examples to show its interpretability. For the live evaluation, we deployed our method into a sales campaign in a famous shopping center in Beijing. We find that for each promotion message our model brings 29.75% more purchases than the random method, and 12.5% rev-enue more than the method with the offline behaviors only. Therefore, we argue that by combining online and offline be-haviors our solution has great potential of business impact for offline retailing.
Here, we recommend brands of offline retailing to cus-tomers with the support of their online and offline behav-iors. In this section, we describe the data we have and then formulate the problem. All the mathematical symbols are described in Table 2.

In each recommending task, users and items are two in-dispensable elements. For our problem, users are all the potential customers of a shopping mall while items are the product brands sold in the mall. B is the set of all the brands, and U is the set of all the customers. Meanwhile, we might know the search queries issued by these customers in a popular search engine. V is the vocabulary set of all the search words.

For each customer u  X  U , its offline behaviors are repre-sented by B u =  X  b u,i | b u,i  X  B X  , where b u,i is the i -th brand token bought by user u . Meanwhile, the customer X  X  online behaviors are represented by W u =  X  w u,j | w u,j  X  V X  where w u,j is the j -th word token searched by user u . In other words, both the online and offline behaviors are represented in the bag-of-words manner in this study. Note also that B u or W u can be an empty set. Based on all these data, we focus on the recommendation of brands. Specifically, we give a ranking of the brands in B for each user u .
Before we detail the lift-based recommendation method, we propose the Online to Offline Topic Model (O2OTM), which models the relationships between online and offline topics explicitly based on the data corpus {W u , B u } U both online and offline sides.
First, the basic topic modeling method, LDA [ 5], can be applied to model the online and offline behaviors separately. LDA is developed to modeling document content based upon T able 2: The symbols. the idea that the probability distribution over words in a document can be expressed as a mixture of topics, where each topic is a probability distribution over words.
In this study, since both online and offline behaviors are represented in a bag-of-words model, we can consider each W u or B u as a document to form the online corpus {W u } U and offline corpus {B u } U 1 . Then, LDA can be applied to these two corpora to generate online topics (denoted by x ) and offline topics (denoted by z ), separately. Here, an online topic p ( w | x ) is a probability distribution over search words w while an offline topic p ( b | z ) is a probabilistic distribution over brands b . This method helps to group search words and product brands into semantic topics, and can be used to an-swer queries about similar online users in terms of search words and similar customers in terms of consumed brand-s. However, this method does not provide any information about the dependent relationships between the online and offline topics, thus cannot perform modality transformation from online behaviors to offline activities.
The proposed O2OTM model draws upon the strength-s of probabilistic graphic methods to model the online and offline behaviors jointly by explicitly considering the proba-bilistic dependency between online and offline topics. As in the O2OTM model, each user u adopts the following prob-abilistic process to generate its online and offline behaviors, denoted by ( W u , B u ). This process can be divided into two parts. First, for each search word w  X  W u , an online topic x is chosen from a distribution over online topics specific to u (denoted by  X  u ), and the word is generated from the chose online topic. Second, for each brand b  X  B u , again an on-line topic y is chose from  X  u . Based on y , an offline topic z is chosen from  X  y , which is a distribution over offline topics specific to y ; and then the brand is generated from the chose offline topic.

The graphical model corresponding to this process in Fig-ure 3. In this figure, the left part generates the online be-F igure 3: The graphical model of O2OTM haviors while the right part generates the offline behaviors. In this model, each user u is associated with a distribution over online topics,  X  u (chosen from a symmetric Dirichlet (  X  ) prior). The mixture weights corresponding to u are used to select an online topic x (or y ). Then, based on x a search word is generated according to the distribution  X  x (drawn from a symmetric Dirichlet (  X  ) prior). Meanwhile, based on y an offline topic z is generated according to the distribu-tion  X  y (drawn from a symmetric Dirichlet (  X  ) prior), and a brand is generated according to the distribution  X  z (drawn from a symmetric Dirichlet (  X  ) prior).

Here, both x and y represent online topics. We use these two different symbols to distinguish the online topics which generates the search words from the ones which generates the offline brands. Additionally, both x and y are generated from the same distribution  X  u . Thus,  X  u is dependent on both online and offline behaviors. It is also worth mentioning that the dependent relationship between online and offline topics is modeled in  X  . It can be used for online-to-offline modality transformation.
In this study we use Gibbs sampling [ 9] to estimate the parameters of O2OTM. By applying Gibbs sampling, we construct a Markov chain that converges to the posterior distribution on the latent variables. The transition between successive states of the Markov chain results from repeat-edly drawing x, y, z from its distribution conditioned on all other variables, summing out the parameters using standard Dirichlet integrals. Specifically, we have the following three equations to update x, y, z .

First, we have where x i = t represents the assignment of the i -th word to-ken in the corpus to the t -th online topic, w i = v represents the observation that the i -th word token is the v -th one in the word lexicon,  X  X  : i represents all assignments of online topics to the words, not including the i -th one. Addition-ally, O v t, : i denotes the number of times that the v -th word being observed with the t -th online topic, not including the current instance. O t u, : i denotes the number of times that the t -th online topic being observed in user u (who own-s the search word w i ), not including the current instance. Here, the online topic x is assigned to each word token in the corpus.

Next, we have where y j = t represents the assignment of the j -th brand to-ken in the corpus to the t -th online topic, z j = l represents the observation that the l -th offline topic is assigned to the j -th brand token,  X  X  : j represents all assignments of online topics to the brand tokens, not including the j -th one. Ad-ditionally, O l t, : j denotes the number of times that the l -th offline topic being observed with the t -th online topic, not including the current instance. O t u, : j denotes the number of times that the t -th online topic being observed in user u (who buys the brand b j ), not including the current instance. Here, the online topic y is assigned to each brand tokens in the corpus.

Finally, we have p ( z j = l |  X  X  : j ,  X  X ,  X  X ,  X  X ,  X  b ) = p ( z j = l |  X  X  where z j = l represents the assignment of the j -th brand to-ken to the l -th offline topic, b j = k represents the observation that the j -th brand token is the k -th brand in the brand lex-icon, y j = t represents the observation that the j -th brand token is assigned to the t -th online topic,  X  X  : j represents all assignments of offline topics to the brand tokens, not includ-ing the j -th one. Additionally, O k l, : j denotes the number of times that the l -th offline topic being observed with the k -th brand, not including the current instance. O l t, : j denotes the number of times that the t -th online topic being observed with the l -th offline topic. Here, the offline topic z is assigned to each brand token in the corpus.

After the Markov chain converges, the model parameters can be estimated via Here, T, L are the numbers of online and offline topics, re-spectively. V, B are the sizes of the word vocabulary and brand lexicon.

In this study, we do not estimate the hyperparameters  X ,  X ,  X ,  X  . Instead, these smoothing parameters are fixed at 0.05, 0.01, 0.01, 0.01, respectively. The algorithm begins by assigning search words to random online topics, and assign-ing offline brands to random online and offline topics. Each iteration of the algorithm involves applying Equ. ( 1),(2),(3), to every word token and brand token in the corpus. This sampling process performs at least 2000 rounds until con-vergence.
After we learn all the parameters  X ,  X ,  X  , we can infer the relationship between a brand and an online topic. Specifi-cally, for an online topic y = t and an offline brand b = k , we have Figure 4: The brand Teenie Weenie and its related search words. The description of words is listed in Table 3. T able 3: English translation of words in Figure 4
With this derivation, here we show you an example of the relationship between a brand and online topics. TEENIE WEENIE is a Korean brand designed for young girls from 15 to 25 year-old. It is famous for its school-style dress like the poster in Figure 4(a) . Figure 4(b) shows the distribu-tion over online topics for this brand, and the representa-tive words for the top 3 topics are also shown with English translation in Table 3. The first topic is mainly about cam-pus life, which indicates that the brand is somehow related to college students. The second topic is about horoscope. Many people especially young women are interested in their horoscopes, which could forecast the love, fortune and career etc. The third topic is about hair style and cosmetics, which shows the brand is related to a group of female people who cares about their appearance. These three topics clearly show that the customers of TEENIE WEENIE are a group of young girls, especially college girls, who care about their appearance and long for love and good future. We argue that this kind of relationship could show the characteristics of the consumers of the brand, and help designers to adjust products according to their customers X  interests and tastes.
In this section, we present the methods for cross-modality recommendation.
With all the parameters  X ,  X ,  X  , we could make recom-mendation for customers. The probability of the i -th user buying the k -th brand is calculated as follows: p ( b = k | u = i,  X ,  X ,  X  ) = = With the estimation of  X  i , this recommendation is made based on both its online and offline behaviors. Since this method can easily generate the ranking of brands for a us-er, we will evaluate it in the retrospect experiments. This method is deliberately developed only to show the online be-haviors might provide extra value for this recommendation task, compared with the method using the offline behaviors only.
The recommendation method in Equ. ( 9) has the follow-ing drawbacks. First, this method uses all the online top-ics for the offline recommendation although we believe that some online topics are not predictive or causally related to the offline consumption, as mentioned earlier. Additionally, these unpredictive online topics might occupy a large por-tion of the search content of a user while the topics with the consumption intentions are drowned out. For example, the search content from a primigravid woman might contain little about pregnancy care compared with the large portion about her work and everyday life. Thus, the online topic distribution for this user will have a low value for the topic a bout pregnancy care, and the brands for babies and preg-nant women might not be ranked high based on Equ. ( 9).
Therefore, we need a measure to automatically identify the pairs of predictive online topic and its corresponding offline one so that the recommendation is made only based on these pairs.

Specifically, we define the following lift measure between an online topic t and an offline topic l . Remind that the proposed O2OTM model outputs the relationship between online and offline topics. Namely, the probability of offline topic l given online topic t , denoted by  X  tl = p ( z = l is assigned so that the likelihood of all the data is maximized. Then, based on  X  we can also calculate  X  : tl = p ( z = l  X  t ), measuring the probability of offline topic l given all the other online topics t , excluding t . Then, the lift is defined as follows Th is lift value is simply the ratio of two values: the target response l with the existence of t divided by the response without t . It actually measures how much enhancement we can get in predicting l conditioned on t compared to the condition without t . The bigger this lift value, the more association between online topic t and offline topic l .
Table 4 shows some examples of high-lift pairs of online and offline topics discovered from our data. These exam-ples are selected so that they can cover different groups of consumers.  X  For Group I, the search words are about pet care, and this online topic corresponds with the lift value of 11.5 to the fashioned brands for young girls. Since most of these brands are imported from Japan and Korea, they are more expensive than the regular ones, indicating that these girls are affordable to raise pets.  X  For Group II, it is matched to the group of young people (mostly boys) who love Japanese anime series and computer games. What they wear is mostly from some casual brands, such as VANS, ADIDAS ORIGINAL and so on.  X  For Group III, it corresponds to the group of pregnant women and young mummies. They search for the knowledge about pregnancy care, newborn baby care and postpartum recovery. Also, they corresponds to two offline topics with high lift values. The first brand group refers to the ones for newborn children, while the second group refers to some brands for young girls, indicating that these new mummies still cannot stop buying something for themselves.  X  For Group IV, it refers to the group of housewives with happy lives. On the online side, they search for the materials for keeping fit, popular TV series, netnovels and so on. On the offline side, they buy two groups of brands. One is for their children, and the other is for their husbands with the brands for outdoor sportswear.  X  For Group V, we consider the customers of the high-end cosmetic and jewellery brands. We are surprising to find that the lift value reaches 19 when they search for the online materials for gongfu stories, love and urban novels, and literature. Also, the people, who search for the materials about plastic surgery and phone games, like to buy these expensive brands.  X  For Group VI, we consider the people who search for stocks, funds, securities, and investment. These are rich people who own some extra money for asset management. The offline topic with the highest lift value to this online topic is about some fancy restaurants in China with different types of cuisines. It indicates that good food is the first priority of these people.

It is worth mentioning that all these pairs of online and offline topics with high values of lift are automatically dis-covered by the proposed O2OTM model. They are con-sistent with our basic understandings on online and offline behaviors.
Then, with a user-specified threshold  X  &gt; 0 on lift, we can identify the pairs of online and offline topics whose lift values are not smaller than  X  . Namely, we have
Then, with these high-lift pairs R we develop the follow-ing recommendation method. Consider the scenario of the recommendation for weekend shopping. The search words in the recent weekdays are collected for inferring their online topics. Once an online topic t appears at least for q times, it is considered to match with R to check whether t appears in T = { t | ( t, l )  X  R} . If yes, the top brands in the correspond-ing offline topics are identified for recommendation. Some postprocessing steps are needed to consider the user X  X  recent shopping history and recommendation logs to avoid repeti-tive recommendation. In this study, the two thresholds are set as  X  = 4 . 5 and q = 10.

In this method, the recommendations are made in a trig-gering manner. It means that recommendations only hap-pen when the online topics with high lift values appear for enough times and the corresponding recommendations are considered to be reliable enough. It can automatically judge when to recommend, and when not even if many unpredic-tive search words appear. Since the pairs reflect clear in-tentions for offline consumption as shown in the examples in Table 4, we believe that the recommendations from this lift-based method will be more attractive to potential cus-tomers, while avoiding unnecessary disturbance to users.
We deployed the proposed lift-based model to a real-world sales campaign in a famous shopping mall in Beijing. In or-der to celebrate its anniversary, the mall planed to send out lots of coupons from different brands to attract customers. These coupons were sent via short messages 3 days before the anniversary day, and each short message contained 3 coupons of different brands. For the VIP users of this mal-l, we knew both their offline consumption history and on-line search queries with their consent. We randomly divided these users into 3 groups, each of which contains around 10,000 users. With this big number of users in each group we assume that the demographic information (e.g. gender, education, spending power, etc.) are the same for these three groups of users.

Then, we evaluated the recommendation performances of three methods, which are responsible for the coupon rec-ommendation for these 3 user groups respectively. These 3 methods include: 1) RAN, representing the random rec-ommendation; 2) LDA, representing the method based on th e offline consumption history only. Specifically, the LDA method is applied on {B u } U u =1 , and the recommendation for offline retailing can be made by p ( b | u ) = 3) LIFT, representing the lift-based method based on both online and offline data. The 3 methods are deliberately de-signed to answer the questions on whether the recommen-dation based on history data is effective compared with the random method, and whether the online behaviors can pro-vide extra value for this recommendation compared with the offline data only.
 T able 5: The live evaluation results
In this live evaluation, we recorded the following three 3 measures on the mall consumption for these 3 user groups on the anniversary day: The results are shown in Table 5. Clearly, the consump-tions from the LIFT group are better than the other two groups in terms of all these three measures. Although the increase on IPR is small, the measure of APPC increases greatly. It results in the OCPPUP value of 50.3, meaning that each short message with the coupons recommended by the LIFT method brings 50.3 RMB revenue to the mall in average. For the other two groups of users, the OCPPUP values are 44.7 and 38.76, respectively. Thus, the LIFT group achieves 29.75% increase on OCPPUP compared with the RAN group, and 12.5% increase compared with the LDA group.

Since the demographic statistics are the same for these 3 groups of users, we attribute this purchase increase to bet-ter coupon recommendation by LIFT. It indicates that with both the online and offline behaviors O2OTM models the users X  preferences more accurately to achieve more attrac-tive recommendations. It clearly shows the great potential business impact if the recommendations based on both on-line and offline behaviors are introduced to offline retailing.
Furthermore, we check what kind of users the consump-tion increase comes from. Specifically, for each group of users, we rank them in terms of their purchases. Then, we divide the users, who purchased in this sales campaign, into 10 subgroups by their rankings. Namely, the top 10% user-s go to the 1st subgroup, the top 10%-20% users go to the 2nd one, and so on. Then, for each subgroup we calculate its APPC value. The results are shown in Figure 5, where the number on each bar represents the purchase percentage of the users in this subgroup compared to the total purchases of all the users.

We have the following observation. First, the users whose spending ranks in the top 10% contribute more that 54.6% of Fi gure 5: The APPC comparison in the ranking. the total revenue for the LIFT user group. Second, the AP-PC increase from LIFT mainly comes from these top ranked high-valued customers. It indicates that these high-valued customers are more sensitive to the performance of coupon recommendation. The better the recommendation serves for high-valued customers, the more purchases it will bring.
In this section, we compare the performances of the rec-ommendation methods in retrospect evaluation.

Each data set we use consists of online part and offline part. The online part contains users X  search queries from a widely used online search engine in China. Each search log has three attributes, namely user id, query and date. Note that a query is parsed into a set of words. The offline part contains consumers X  shopping history in a local shopping mall. Each shopping transection consists of consumer id, brand she buys and date.

In this retrospect evaluation, we use two data sets from two different malls in China, denoted by Mall A and Mall B. In total, we get 6539 users from Mall A, with 732 of-fline brands and 30097 search words. For Mall B, there are 6961 users with 789 offline brands and 103597 search word-s. For each data set, we use the data from 2013/01/01 to 2014/12/31 for training, and the data from 2015/01/01 to 2015/06/01 for testing.

Many measures [ 21] can be used to evaluate the perfor-mance of recommendation systems, like mean absolute error (MAE), root mean squared error (RMSE), precision, recall. Since this problem is not for rating prediction, it is not suit-able to adopt MAE and RMSE for evaluation. Neither, we cannot use recall since the ground truth for all the brands a user will buy is unknown. We can only calculate the percent of the recommended brands that a user really bought in the testing data. After getting the precision for each customer, we average them and derive the precision @ K measure for the whole customers.

In this evaluation we focus on recommendation for the products which are not consumed by a user before, since these un-consumed products might reflect users X  preferences more precisely. We know that there are some previous stud-ies focusing on repetitive consumption of products [ 3], which is mostly decided by the use experiences of the products, the product attributes (e.g. continuous or one-shot usage), and some user psychological issues (e.g. boredom) [ 19]. However, the recommendation for repetitive consumptions is beyond the range of this study.

Here, we have the two baseline methods, RAN and LDA, which are the same in the live evaluation. The method of RA N refers to the random recommendation method, while LDA refers to the one using the offline behaviors only. For the method of RAN, its precision @ K measure can be ana-lytically estimated as follows, where ( B  X  B u ) is the set of all the un-consumed brand-s customer u and ( T u  X  B u ) includes all the un-consumed brands that customer u buys in the testing set. Note that this measure for RAN is independent of K .

In this retrospect evaluation, we compare these two base-line methods with the recommendation method via Equ. (9 ), denoted as O2OTM. This method can generate the full rank-ing of all the un-consumed brands. However, the lift-based method might recommend nothing when its online topics do not hit the ones with high lift values. Thus, we do not include it for this retrospect evaluation.

Note also that there exists some strong baseline methods, such as factorization machine [15 ], which can embed the features of users and items (e.g. all the search words) for recommendation. However, these methods cannot provide any interpretability for recommendation. Additionally, the goal of this retrospect evaluation is only to show that the online activities can provide extra value for offline retailing. Thus, we do not include these methods for evaluation. Figure 6: precision@K measures for the three methods on two malls
After some initial experiments, we set the number of on-line topics as T = 50, and the number of offline topics as L = 30 for this retrospect evaluation. The results of the precision @ K measure on the two malls are shown in Fig-ure 6. It clearly shows that O2OTM is significantly better than LDA. At Mall A, the improvement from O2OTM is more clear when K is small, while this improvement becomes small after K reaches 15. At Mall B, the performances of O2OTM and LDA are similar when K = 1, however, when K &gt; 1 the improvement from O2OTM becomes large. Also, the line for the method of RAN is flat, which is consistent with our analytical analysis.
Our work is related to three areas, i) recommendation ii) topic modeling methods and iii) multi-modality learning.
Recommendation. Recommendation services have been deployed for many types of items such as books [ 14 ], mu-sic [7 ], mobile apps [26 ] and even point-of-interests [ 25]. Col-laborative filtering (CF) is the well known recommendation approach with the core idea that users of similar interests may display similar ratings on similar items. Specifically, if a recommendation is made based on similar users (those who have the similar ratings on the same items as the tar-get user has), it is referred to as user-based CF [10 ]. On the other hand, if a recommendation is made based on similar items (those that have been rated similarly by the same set of people), it is referred to as item-based CF [ 20]. Besides these nearest-neighbor techniques, matrix factorization was developed with the assumption that users and items are as-sociated with latent factors and the observed user-item rat-ing matrix is the multiplication of the two. These latent factors are learned by minimizing a loss function, which is defined as the sum-squared distance between observed and predicted ratings [ 22], or by maximizing the likelihood of the regression residual which is assumed to obey the standard Gaussian distribution [ 18].

To address the issue of data sparsity, different approach-es have been developed to incorporate various features on users and items into recommendation. For example, social network was introduce to constrain the factorization process in such a way that socially connected people tend to have similar user feature vectors [13 ]. For the items with rich tex-tual information, the fLDA model was proposed to combine matrix factorization with LDA [ 4]. To recommend scientific articles the CTR model was developed with the assumption that the latent factor of items is the sum of its documen-t topic distribution and the latent offset vector [ 23]. Yin et al. [ 27] developed a model interpreting the silent viewing behaviors to  X  X seudo vote X  to help recommending articles. Also, the general model of factorization machine [ 15 ] was proposed to introduce all kinds of features on both items and users for recommendation with promising performance.
However, all these related works seldom consider the rec-ommendation from the multi-modality perspective, even when the two modalities are only weakly associated. For this cross-modality recommendation task, we explicitly consider the relationships between the two modalities and simultane-ously perform topic modeling over the two modalities. The relationships help to not only make cross-modality trans-formation with clear interpretability, but also identify the associations with high lift values.

Topic modeling. PLSA [ 11 ] and LDA [ 5] are popular to find the topics over the co-occurrence matrix. Differen-t variants of topic modeling were proposed to describe the extra features with the data. For example, the author topic model [17 ] was developed to consider the author informa-tion on the articles. The TOT model [ 24 ] was proposed to describe the topics with its booming time. These previous w orks provide the basic idea of probabilistic generative pro-cess to describe the data we have, but none of them apply it for the cross-modality data.

Multi-modality learning. Multi-modality learning has attracted many attentions recently with the fast accumu-lation of the data with multiple modalities. Most of these previous works focus on the supervised or semi-supervised learning problems with the features from multiple modali-ties. Co-training [ 6] is the most famous method for this task. Recently, the importance of different modalities was also considered to extract the discriminative features for weak modality with the supervision from strong modality. Note that all these modalities are in the feature space. As to the cross-modality recommendation task in this study, the online modality is used as feature space while the offline modality is considered as labels for prediction.
In this paper, we study the problem of offline retailing recommendation based users X  online behaviors. We propose the probabilistic model O2OTM, which performs the topic modeling for both the online and offline activities, and also build the relationships between the online and offline topic-s. These resultant relationships can directly support cross-modality recommendation, and also provide recommenda-tion explanation. Additionally, the lift measure is develope-d to identify the pairs of online and offline topics, which have strong or even causally-related associations. The live experiments show that this cross-modality recommendation contains huge business impact. We emphasize that this mod-el for cross-modality recommendation has wide application scenarios. For example, based on the search logs we can perform the recommendations for restaurants, mobile apps, tour sites for traveling, and so on. Also, we will make the proposed model scalable for large-scale data and build the general system for cross-modality recommendation. This work was supported by the National Natural Science Foundation of China (No. 61473274, 91546122, 61573335), National High-tech R&amp;D Program of China (863 Program) (No.2014AA015105), Guangdong provincial science and tech-nology plan projects (No. 2015 B010109005). [1] http://www.ripenecommerce.com/blog/ecommerce [2] http://www.pwccn.com/webmedia/doc/ [3] http://ijcai-15.org/index.php/ [4] D. Agarwal and B.-C. Chen. flda: matrix factorization [5] D. M. Blei, A. Y. Ng, and M. I. Jordan. Latent [6] A. Blum and T. Mitchell. Combining labeled and [7] H.-C. Chen and A. L. Chen. A music recommendation [8] Y. H. Cho and J. K. Kim. Application of web usage [9] G. Heinrich. Parameter estimation for text analysis. [10] J. L. Herlocker, J. A. Konstan, A. Borchers, and [11] T. Hofmann. Probabilistic latent semantic analysis. In [12] Y. Li, J. Hu, C. Zhai, and Y. Chen. Improving [13] H. Ma, H. Yang, M. R. Lyu, and I. King. Sorec: social [14] R. J. Mooney and L. Roy. Content-based book [15] S. Rendle. Factorization machines with libFM. ACM [16] P. Resnick, N. Iacovou, M. Suchak, P. Bergstrom, and [17] M. Rosen-Zvi, T. Griffiths, M. Steyvers, and [18] R. Salakhutdinov and A. Mnih. Probabilistic matrix [19] A. D. Sarma, S. Gollapudi, R. Panigrahy, and [20] B. Sarwar, G. Karypis, J. Konstan, and J. Riedl. [21] G. Shani and A. Gunawardana. Evaluating [22] N. Srebro and T. Jaakkola. Weighted low-rank [23] C. Wang and D. Bleig. Collaborative topic modeling [24] X. Wang and A. McCallum. Topics over time: A [25] M. Ye, P. Yin, W.-C. Lee, and D. L. Lee. Exploiting [26] P. Yin, P. Luo, W.-C. Lee, and M. Wang. App [27] P. Yin, P. Luo, W.-C. Lee, and M. Wang. Silence is
