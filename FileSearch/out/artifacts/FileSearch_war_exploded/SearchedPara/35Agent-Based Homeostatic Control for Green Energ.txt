 SARVAPALI D. RAMCHURN, PERUKRISHNEN VYTELINGUM, ALEX ROGERS, Achieving energy security and reducing carbon emissions have been recognized as two of the most important challenges of this century given the rapid depletion of worldwide oil and gas reserves and the potentially devastating effects of climate change [DECC 2009a; US Department Of Energy 2003]. To this end, the creation of a smart electricity grid has been advocated as a key component in delivering efficient low-carbon energy. In particular, the vision of a smart grid includes technologies that reduce losses in the transmission of electricity, that integrate intermittent renewable energy generators (such as wind turbines and solar panels), and that attempt to reduce or shift demand by providing real-time information about consumption and prices using smart meters in homes.

In this article we focus in particular on the pressing problem of integrating renew-able energy generation into the smart grid. This is an important challenge because the integration of renewable energy generators requires a significant shift from the traditional principle of  X  X upply follows demand X  whereby generators always have to keep up with demand in the grid. To date, this has been acceptable only because the output from nonrenewable energy sources (such as coal or gas fired power stations) can be turned up or down at will. In contrast, renewable energy generators (i.e., green suppliers) are sensitive to seasons and weather conditions and are therefore variable and intermittent in their output. This means that they cannot be powered up at will to meet the demand, nor is it possible to accurately predict exactly how much energy they will generate. While, from a technical point of view, integrating renewable energy requires the development of technologies to ensure power flows in a controlled manner from renewable energy generators to the grid, from an economic point of view, renew-able energy suppliers need to devise new strategies to trade effectively in the electricity markets in which they operate in order to ensure that they can make a profit while still satisfying the demand from their consumers given the intermittency in their supply.
When the supplier is not able to satisfy the demand of its customers from its own re-newable generation capacity, it must typically buy additional electricity at short notice (usually incurring a high cost which reduces its potential profits) from the wholesale electricity market within which it operates [Kirschen and Strbac 2004]. Conversely, when the supplier produces more than its customers demand, it must sell this extra electricity at a lower price than what it would typically obtain from its customers. 1 It is therefore crucial for the supplier to predict its production accurately in order to bid effectively in markets, but more importantly, the supplier should be able to influence the demand from its customers to mitigate the impact of low production.

Now, while the issue of predicting renewable energy production and bidding in elec-tricity markets has been actively researched in the power systems domain [Kirschen and Strbac 2004; Milligan et al. 2009; Morales et al. 2010], there is relatively little work studying how to influence the demand of residential consumers (see Section 2 for more details). Typical approaches to demand management involve the supplier sending a predicted real-time price, via the consumers X  smart meter, to incentivize them to increase or decrease demand [Faruqui and George 2005]. These mechanisms assume that by feeding more information to consumers, the latter will be able to understand the conditions on the grid (e.g., generator outages or a high price for electricity at peak time) and react to such conditions by switching devices on or off, or changing their thermostat settings on their heaters (or air conditioners), and in future, use electricity stored in their home or electric car battery. However, such an assumption is challenged by the fact that the signals from the grid, aside from being rather complex for the average user [Schweppe et al. 1989], require the user to perform complex calculations in order to optimize her consumption and storage of electricity (i.e., to know what is the best time to store or use electricity). Given this, in this article, we advocate the use of autonomous software agents as a decentralized control paradigm whereby each owner would have her own agent, running on her smart meter, advising on the best consumption pattern she could adopt to achieve her goals (e.g., minimizing carbon emissions and/or costs). A key advantage of this approach is that consumers do not need to be experts at energy trading or scheduling in order to maximize their benefits, therefore their adoption allows for a larger impact in implementing demand management strategies based on complex signals from the grid.
In more detail, agents can be endowed with the ability to learn their owner X  X  prefer-ences from their consumption history and can run optimization algorithms that solve complex scheduling tasks (e.g., heating cycles of boilers or charging profiles of their electric car battery) with very little direct input, if at all, from their owner. In so doing, these agents can minimize their owner X  X  cost, given price signals from the grid, by effi-ciently scheduling the on/off cycles of deferrable devices (such as washing machines or boilers) or the storage profiles of batteries (i.e., storing when prices are low and using the stored electricity when prices are high). However, even if a real-time price signal is provided by the grid or supplier, agents have no indication as to how much they should change their usage (by deferring loads) or store electricity in order to meet the capacity of the renewable energy supplier. This is important because, if, for example, the agents are incentivized to consume more, based on a low predicted price, the aggregate might end up consuming much more than can be provided by the supplier. Conversely, given a high price, the collection of agents might consume much less than what the supplier produces leaving the supplier with unused green energy. Hence, in general, relying solely on the price signal may result in a mismatch between the production capacity of the supplier and the demand from the consumers that might require the supplier to buy extra capacity at a high price or sell its extra production at a loss on the wholesale electricity market. The supplier may, in turn, pass on such costs to its customers and also increase the consumers X  carbon emissions as it uses carbon-emitting generators (from which it buys on the wholesale market) to supply their extra demands. Moreover, providing only a price signal ignores the fact that some agents may also be aiming to reduce their owner X  X  carbon emissions (as there is a growing population of such green users [Kockar et al. 2009]) since such a signal ignores the carbon intensity (i.e., the car-bon emissions per unit of energy) of the energy being supplied. Given these issues with real-time pricing in this domain, it is crucial that better control mechanisms are devel-oped to mitigate the occurrence of such mismatches in order to make the integration of renewable energy into the smart grid more profitable and more reliable. In particular, given the reaction of the agents to such signals, the controller (i.e., supplier) should be able to provide feedback to the agents in order for them to adjust their consumption profile while still allowing them to minimize their costs and their carbon emissions. The challenge here is to generate such signals and stabilize the system without the supplier being able to fully observe the state of the individual agents in terms of their profile of electricity usage. This challenge is further exacerbated by the fact that the agents may not wish to reveal their battery storage capacity (which determines by how much they can defer demand to follow supply) as they may not trust the provider to use this information to their benefit.

To meet this challenge, in this article, we introduce the concept of agent-based home-ostatic control to coordinate a green supplier and its consumers, who may own storage capability, within the smart grid. 2 In particular, we model a system composed of a green energy supplier (e.g., a wind and/or solar powered generator) providing electricity to a large number of consumers whose aims are to reduce their individual costs and carbon emissions. To capture the consumers X  preferences and goals, we develop agents that can optimize their owner X  X  battery storage profile according to signals from the grid. Our model aims to capture real-life settings where, for example, a third-party wind turbine/photovoltaic array provides energy to a small number of houses or buildings, or where a regional/national supplier serves customers across a wide area. We then provide a novel control mechanism to ensure that demand from the agents follows the production from the green supplier. Our approach is inspired from the principle of homeostasis [Marieb and Hoehn 2007]. The latter describes a living organism X  X  adjust-ment of its internal interdependent components to maintain a stable constant condition and was first used in the context of the electricity grid by Schweppe et al. [1980]. The analogy between our system and a living organism is appropriate given that our sys-tem is based on the three underpinning concepts of homeostasis: sensing, sending a control signal, and feedback. First, our system is able to sense and predict 3 the effect of external conditions (i.e., weather in our case) using widely available weather sensors and satellite imagery. Second, the supplier can compute a control signal to be sent to the agents based on the impact of weather conditions on its production of electricity. Third, through the resulting response of the agents in the system (i.e., the combined effect of its load and storage profiles), feedback is provided to the supplier which de-cides how to adapt its control signal to ensure the system reaches the state it desires. Through several iterations of the preceding process, the system aims to converge to a more efficient solution (see Section 6). While the idea of homeostatic control in this domain was pioneered more than 30 years ago, it was not deemed practical at the time due to the lack of communication and distributed computing technologies that would allow large populations of consumers of different types (of different income and usage levels) to participate in such mechanisms. However, with the prevalence of broadband communications 4 and the development of agent-based technologies for a wide variety of applications including the energy domain [Jennings et al. 1996; Bussmann et al. 2004], it is now possible to revisit this proposition and instantiate homeostatic control mechanisms within the smart grid.

In more detail, this article advances the state-of-the-art in the following ways: (1) We implement a novel real-time carbon-based pricing mechanism that builds on the (2) We develop a novel control signal which ensures that agents are incentivized to (3) We develop algorithms, based on mathematical programming, for agents to optimize (4) We provide a novel adaptive mechanism for the green supplier to learn the best (5) We empirically evaluate our approach and show that our agent-based homeostatic
The rest of this article is structured as follows. Section 2 presents the general back-ground of our work and outlines the rationale behind our design choices. Section 3 describes the model of the green supplier and the agents, each endowed with their own preferences and their battery storage capabilities. Given this, in Section 4, we present our novel carbon-based pricing mechanism. Then, Section 5 details our homeostatic control mechanism. Section 6 evaluates our mechanism and Section 7 concludes. The issue of integrating renewable energy supplies into the grid to reduce carbon emissions while ensuring their intermittency does not have an adverse impact (e.g., by requiring more spinning reserves or causing brownouts) has been actively researched for a number of years. The seminal idea of using homeostatic control to account for intermittency (for any energy source type) was initially suggested by Schweppe et al. [1980], who foresaw that improvements in communication technologies would pave the way for new control mechanisms to coordinate energy suppliers with users in order to account for shortfalls (e.g., by asking them to reduce consumption) or excesses (e.g., by letting them consume more) in energy supplies in real time [Schweppe et al. 1980]. Such mechanisms would then allow demand to follow supply. Their work, however, remained preliminary and, as such, untested under simulated settings. In particular, they did not model the individual behavior of agents (in terms of their basic preferences and how they optimized their consumption) and did not consider the issue of carbon emissions to be important at the time. Moreover, they used the frequency of Alternating Current (AC) as a vehicle for real-time pricing. In the absence of other communication mechanisms, this choice was probably the only viable one. However, while frequency is a good indicator of generation failing to meet demand, it does not correspond to the cost of electricity in real-time electricity markets [Schweppe et al. 1989]. In contrast, our more up-to-date approach is able to exploit recent communication and computational advances in order to model individual agent behaviors and develop pricing mechanisms and control signals that can be communicated in real time while still matching the current market conditions.

Since Schweppe X  X  work, most research in the power systems community has focused on facilitating the integration of intermittent sources of energy by providing more re-liable predictions and control of energy generation from such sources [Milligan et al. 2009; Morales et al. 2010] or by matching renewable energy generators with high-capacity electricity storage providers (either attached to wind turbines or performing arbitrage in an electricity market) [Burgio et al. 2009; Lubosny and Bialek 2007; Bathurst and Strbac 2003; Makarov et al. 2010; Korpaas et al. 2003]. Hence, most of this work has focused on the use of large  X  X tility-scale X  batteries controlled by one user as opposed to small domestic batteries (e.g., electric cars or water heaters 6 ) where each battery is individually owned and where the owner is only intent on maximizing her own preferences. This is mainly due to the fact that coordinating a large number of individual users (owning batteries) with suppliers relies on robust communications that were previously considered too expensive [Kirschen and Strbac 2004] and that such storage facilities may be too expensive to implement on a large scale (i.e., across 26M households in the U.K.). However, with the advent of high-speed (mobile) broad-band and less expensive battery storage technology (e.g., with electric cars such as the Mini E and the Nissan Leaf, and deep-cycle battery technologies from Ceramatec, for example), this argument is no longer valid. Hence, several approaches and field trials (e.g., the GridWise Project, the Energy Demand Research Project [Smith 2010] or PowerMatcher 7 ) have emerged which consider the use of demand-side management techniques (DSM) (based on real-time pricing using AC frequency or time of use pric-ing) to control demand [Infield et al. 2007; Hammerstrom et al. 2008]. However, such approaches do not address the use of storage devices to defer the consumption of elec-tricity and again ignore the individual preferences of the users. 8
A number of agent-based approaches that do consider the incentives of individual actors on the grid have been developed over the last decade. For example, Ygge initi-ated work on abstracting electricity markets as multicommodity markets and showed how agents trading energy for different times of the day could generate efficient al-locations [Ygge et al. 1999]. Moreover, Jennings et al. [1996] developed coordination mechanisms for different actors on the grid to manage the allocation of transmission ca-pacity [Jennings et al. 1996] and, more recently, Sun and Testfatsion [2007] and Li and Testfatsion [2009] have developed agent-based electricity market simulations which factored in transmission constraints and different types of buyers and sellers in the grid. Kok and Venekamp [2010] take a similar approach and implement an agent-based architecture to run the electricity market where the individual actors represent either generators or devices in the home whereas Gerding et al. [2011] and Chalkiadakis et al. [2010] adopt a game-theoretic approach to managing electric vehicle charging and organizing collectives of wind energy generators respectively. Moreover, Li et al. [2010] recently proposed a mechanism that coordinates a population of agents in op-timizing their loads to avoid going over a given limit on demand. Their agents are designed to satisfy both the individual X  X  and the system X  X  goals (in capping demand). However, their approach requires agents to communicate their individual plans (to optimize their resources) to the system, leading it to be scalable to no more than ten thousand agents. In general, none of these works deals specifically with the variability of supply when renewable energy sources are involved. Moreover, these approaches do not consider the daily consumption profile of consumers and how an agent might optimize its consumption to solely maximize its owner X  X  benefit (in cost savings). We believe this is crucial because agents have to be profitable to their users, each with her own specific needs and lifestyle, in order to be commercially viable. Moreover, in our recent work, we showed how such agents can be modelled to individually optimize the storage of electricity given a real-time price and how this led to demand on the grid being flattened (without explicitly exchanging plans among agents) [Vytelingum et al. 2010; Ramchurn et al. 2011]. While we did consider the preferences of the agents, we did not address the issue of external influences (i.e., weather conditions in our case) on the supply of electricity. Hence, this article bridges a major gap in this area by modeling the agents in the system, each with its own preferences, and by providing the control mechanism to ensure demand follows supply.

Our work is also inspired from the recent upsurge in eco-friendly energy providers such as Ecotricity, 9 Green Mountain Energy, 10 or New England GreenStart 11 that supply their consumers from their own green energy sources. Their success stems from the fact that there is a large portion of consumers intent on minimizing their individual carbon emissions. However, such companies cannot satisfy all their demand from their own renewable generators (e.g., Ecotricity only generated around 41% of the energy they sold in 2009 X 2010) and they have to buy the rest from other conventional sources. Given this, the carbon-based pricing scheme we propose in this article departs from the fixed pricing scheme provided by these companies, to incentivize users to minimize their carbon emissions in real time while also minimizing their costs. Thus, our work sets the stage for new tariffs that can readily be applied once smart meters are rolled out. 12
Furthermore, in future energy markets where carbon emissions may be taxed [Kockar et al. 2009; Gajbhiye and Soman 2010], our work on the carbon-based pricing scheme also reduces the suppliers X  operational risks. The intuition is that if suppliers can pass on some of their costs, due to carbon taxes, to their consumers, the latter will be incentivized to align their behavior to the needs of the supplier. Thus, if consumers are charged for their carbon emissions, they will optimize their behavior to reduce their emissions, and hence reduce the tax paid. Proposed approaches to mitigating suppliers X  carbon costs have focused on balancing the objective of minimizing costs and minimizing carbon emissions as a complex optimization problem [Hobbs et al. 2010; Wong et al. 2010; Kockar et al. 2009; Mazer 2007; Harris 2005]. Alternative approaches considering the use of carbon intensity signals, as we do here, are practically nonexis-tent since, we believe, such technological solutions involving the use of information and communication technologies, rather than metering devices on the grid, are less pop-ular among power systems engineers. Hence, this article embodies the fundamentals of computational sustainability [Gomes 2009] by providing computational solutions to real-time electricity pricing that can be rapidly and reliably deployed in the smart grid to generate greater efficiencies. In this work, we assume that it will not be possible, at least in the near future, to be fully reliant on green energy sources [DECC 2009b]. Rather, we focus on a more realistic scenario which is more representative of the case today where a green supplier is operating in a market where there are mostly brown (i.e., carbon emitting) sources of electricity (e.g., in markets run by National Grid 13 or PJM 14 on the U.S. east coast). Specifically, Figure 1 depicts the main elements of the system involving the supplier and the consumers. Thus, the grid (consisting of electricity markets and physical networks) and weather (e.g., wind speed or sunshine) act as external influences on them. Hence, in the following sections, we detail each element of our system and the information flows between them by providing a generic model of a green energy supplier (typically with wind or solar power generation capability) and consumers (represented each by its agent) which may possess electricity storage capacity (e.g., either batteries or electric vehicles) and which are keen to minimize their carbon emissions (hence their contract with the green supplier). In our models, we assume that a day is divided into a set of half-hourly slots T ={ 1 , 2 ,..., 48 } such that each actor needs to decide its behavior (typically four hours before or a day ahead) for each slot. Smaller slots (e.g., 5 or 15 minutes) could be considered but half-hour slots are used here as this is a common interval used within electricity meters and electricity markets. We model the green supplier (e.g., with wind turbines and/or solar power generators) as having a pool of consumers that subscribe to it for electricity. 15 The supplier can predict, with a reasonable level of accuracy (usually four hours ahead using sensors and historical data [Milligan et al. 2009]), that it will generate a given amount of electricity q i  X  R + ,  X  i  X  T . Now, in line with today X  X  reality we model our supplier as being able to satisfy only part of its consumers X  demand, acquiring the remainder from the wholesale electricity market. While the availability of supply from the grid is guaranteed, its price is generally driven by the market demand and supply (see the relationship between price and demand in Figure 2(a)). In particular, depending on its energy production pattern, the supplier has a number of potential ways of pricing its electricity in real time based on what it expects the wholesale spot market prices to be and any existing future and forward contracts that it holds. Thus, while spot prices determine the supplier X  X  real-time trading strategy, forward and futures contracts aim to hedge the risk of very high peak prices in the spot market. Typically, buying extra capacity on the spot market is more costly than in a forward contract and selling extra capacity is usually done with a very low or possibly negative profit [Harris 2005]. Hence, the green supplier needs to ensure that it minimizes the amount of extra capacity it needs to buy in spot markets by getting its consumers to follow its production pattern. Moreover, a key challenge here is to align the goals of maximizing profit while meeting the goals of its customers to minimize their carbon emissions. Hence, we address these issues through a combination of pricing and control as we show in Sections 4 and 5. Here, we describe our model of the consumer agent, which builds upon and extends a recent model for homes equipped with smart meters [Vytelingum et al. 2010]. Thus, we consider a set of consumers individually represented by their agent, where the set of agents is A and where each agent a  X  A has a load profile a i  X  i  X  T , (i.e., its owner X  X  predicted consumption of electricity) such that a i is the amount of electricity required by agent a for time interval i during each day. This electricity can either be bought from the supplier or retrieved from a storage device. Thus, each agent a  X  A may possess an electricity storage device with capacity e a  X  R + , efficiency  X  a  X  [0 , 1], and running costs c a  X  R + . Here, the cost c a represents maintenance costs or the loss in value of the device through use over time. We assume this cost is directly proportional to the size of the device, such that if the size of the battery is e a then the storage cost is c a e a . The storage efficiency  X  a models the fact that if q i kWh amount of energy is stored, then only  X  a q i kWh may be subsequently used.

The objective of each agent a is to minimize its owner X  X  cost and hence, it will optimize of the storage (as limited by the efficiency and capacity of the battery), and b a + ,the charging capacity. Since the discharging efficiency of the storage is regimented by  X  a , we separate out the charging and discharging profile such that for all i  X  T we have b we denote as l a i = a i + b a i the total consumption of an agent at time i and the aggregate consumption of all agents as l A i = a  X  A l a i .

In the next section we describe how consumers are charged in real time for their electricity and elaborate on the technology to achieve this. To communicate electricity prices, we develop a novel carbon-based pricing scheme that the supplier sends to its customers. The scheme relies on the availability of a real-time carbon intensity signal (measured in gCO 2 /kWh and representing the amount of CO 2 emitted for every unit of energy consumed) that is broadcast on the Internet 16 by national grid operators (as in the U.K. and Ireland). 17 The key feature of our pricing scheme is that the users are guaranteed to pay for the greenest form of energy at all times if they optimize their consumption pattern (to minimize either costs or carbon emissions). While such a scheme allows the supplier to pass on some of the costs for operating in carbon-taxed electricity markets [Hobbs et al. 2010; Kockar et al. 2009], it also follows from the simple fact that consumers usually subscribe to green suppliers in order to reduce their carbon emissions and it would be simply inconsistent if any extra energy that the supplier cannot provide would be supplied by the worst carbon emitters for the same price. The pricing scheme we develop exploits the correlation between price and grid demand (shown in Figure 2(a)) and between carbon intensity and grid demand (shown in Figure 2(b)) (based on real U.K. data). Using this data, we can infer the correlation between price and carbon intensity as shown in Figure 2(c). Now, as with other examples of pricing mechanisms (e.g., fixed pricing, time-of-use, or real-time pricing), the retail prices must be calculated to reflect the supplier X  X  retail margin profit and its exposure to the risk of peak prices in the wholesale market. 18 However, their complexity must be balanced against the need to provide a simple pric-ing scheme that would appeal to, and be understood by, the average consumer. Thus, we provide retail rates for different bands of carbon emission (in our case, Band 1 to Band 5) 19 rather than providing the consumer with a complex equation-mapping be-tween carbon and price. More formally, these bands are computed as follows. (1) We split the users X  aggregate consumption in terms of the amount satisfied by (2) l A , grid i is priced by our carbon-based pricing scheme (based on five different bands) (3) l A , green i (as a Band 0 ), that is, the amount consumed that is completely satisfied by
Through the preceding pricing scheme the supplier incentivizes consumers to use the green energy (since it always less expensive) it produces rather than grid energy. It is important to note that our carbon based pricing scheme is not specific to a green supplier and could be used by all suppliers in general as the signals we used apply to the whole grid. Also, note that our approach is different from typical sliding scale or band pricing (where consumers simply pay different rates for different amounts consumed) in that, in our model, the band price (p/kWh) applied to a consumer X  X  usage is independent of the energy consumed by the consumer and, instead, dependent on the real-time carbon intensity of the grid (incentivizing consumers to consume less when the grid has a high carbon intensity).

Building upon our pricing mechanism, we next develop an agent-based homeostatic control mechanism that provides additional signals to the agents to ensure demand follows supply. Given the variability in weather conditions affecting the generation capacity, the sys-tem, comprising of the agents and the supplier, needs to continuously adjust to these conditions to maximize its efficiency. This needs to happen given that both the supplier and the consumers aim to maximize their individual profits. More importantly, they can only do so if they communicate to ensure that the aggregate demand from all the consumers is as close as possible to the real-time supply from the producer, while en-suring that any extra energy needed is bought at times when the carbon intensity of the grid is the lowest. Only by doing so can all of the energy the supplier produces be used (which ensures that both the supplier makes a profit and the users get inexpensive and greener electricity) and that any extra energy needed is bought at the least expensive price from the grid.
While the sensing and prediction of short-term weather conditions can be easily implemented using existing machine learning techniques [Alpaydin 2004], significant challenges lie in determining the appropriate control signal to be sent to the agents to ensure that their behavior in reaction to such a signal meets the aforesaid require-ments. Moreover, the supplier may have to adapt the signals it sends based on the feedback (i.e., consumption levels at different times of the day) it receives. In this article, we address these challenges and detail the different elements of our solution (graphically represented in Figure 3) in the following subsections. The information that is typically provided by the supplier to an agent is the price of electricity whether it is a fixed, real-time, or of our carbon-based type. Using this information, an agent can then manage its demand in order to both minimize its costs and also its carbon emissions. While this approach is suitable for most suppliers, it is inefficient for the green supplier with its own renewable energy generation capacity. Specifically, due to the intermittent nature of this generation capacity, the supplier needs to signal to its pool of consumers about its generation pattern so as to maximize the use of its green energy, thereby minimizing the carbon emissions of its consumers.
Now, a price signal would be an ineffective stimulus as it would provide no informa-tion about how much the agents need to increase their demand during any particular 30-minute period to maximize the use of green energy (as discussed in Section 1). Thus, we propose two new signals (see Figure 3) that address this shortcoming. First, con-sumers are given a grid carbon intensity signal. This signal may be provided either by the grid operators (over the Internet) or by the supplier (collecting the data from grid operators) through the meter (the band prices are agreed with the supplier well before). The signal allows the consumer to compute its cost of electricity based on our pricing mechanism outlined earlier on. Second, the supplier provides the consumer with a tar-to the previous day X  X  consumption at time i such that demand follows supply in the day ahead. This target  X  i is based on the aggregate consumption at time interval i given by l A i and the production from the supplier q i , and is given as  X  i = q i will show how to adapt this signal to consider the feedback that the supplier gets from the population of agents. For now, however, assuming that all consumers in the system react to this signal (by storing electricity when most incentivized to do so), we expect the aggregate demand to approach this target, thus maximizing green energy usage and minimizing the carbon emissions of the consumers. Thus, if agents meet this target exactly, they are expected to pay only p green for every unit of electricity used. However, if an agent overuses (above the target), it increases the expected cost of electricity as the supplier would need to acquire the additional demand at p grid i prices. On the other hand, if it underuses (below the target), the agent misses out on less expensive and greener electricity.

Next, we present an optimization model for an agent that aims to minimize its costs given its load and storage availability (see Figure 3). In particular, we consider that the agent obtains part of its energy demand from the green supplier described in Section 3.1 and is already contracted to pay p green i for every kWh provided by its supplier from its own sources (wind or sun). Then, the agent receives two signals from the supplier, that is p grid i , computed based on the carbon-pricing scheme agreed beforehand and the real-time carbon intensity of the grid, and  X  t + 1 i  X  [0 , 1]. We assume that the agent obtains these signals a day ahead (but this could equally also be a few hours ahead as is commonly the case for wind generators which can predict reasonably accurately how much they are going to be able to provide in such time frames [Milligan et al. 2009]). Thus, the agent would need to reoptimize its behavior whenever it receives updates of  X  i . Since we assume that an agent X  X  daily consumption (load) profile is fixed (i.e., price does not affect the loads in a single time slot but can affect stored or discharged energy), an agent a can only try to minimize its costs by storing energy when prices are low and using as much of that energy as possible when prices are high. Thus, we consider agent a having to plan its storage for the day ahead, that is t + 1, if t is the current day. As opposed our previous model [Vytelingum et al. 2010], 20 the agent does not need to predict the next day X  X  price for each time slot. Rather, we assume the agent predicts the next day X  X  carbon intensity  X  i for each half-hourly interval of the day and using the price plan proposed in Section 3.1, computes a price p grid i (since p green i is known to all agents a priori). Given the uncertainty in its own consumption for the next day, the agent also needs to predict a , t + 1 i which is its own expected total load at time i for the previous (similar) days X  consumption (we choose k = 3). 21
Now, the agent also has to decide how to adjust its consumption for individual time slots based on the signal  X  i sent by the supplier. Since  X  t + 1 i implies a factor change in the current day X  X  overall consumption l a , t i , the best an agent can do is to try and bound the total amount of energy it consumes at i by  X  t + 1 i l a , t i . By so doing, the agent can maximize the probability that it will pay the best price p green , as offered by the supplier (as explained in Section 3.1).

Our solution to this optimization problem is formulated as a mathematical program as given in Figure 4. The output is the storage profile, b a = b a +  X  b a  X  at every time slot during the day.
 The objective of the agent is captured by the minimization function in Eq. (1). 22 Then Constraint 1 expresses the fact that the total load of the agent at any point in time is the sum of the amount it stores and the amount it consumes. Constraints 2 and 3 decouple the amount consumed by the agent in terms of the green and nongreen components since the green component (i.e., l a , green i ) is limited by the supplier according in the battery to ensure it respects the battery X  X  efficiency limitations (as limited by  X  a ), that the amount (dis)charged in any time slot respects the limits b a  X  i and b a + i ,andthat the energy that can be stored or used at any point during the day respects the state of the battery at that point in the day. Finally, Constraint 7 prevents the agent from simply storing electricity to sell back to the grid. As can be seen, the mathematical program only has linear constraints and a linear objective function. Hence, linear programming solvers (e.g., CPLEX or glpk) can be directly applied to find the solution. In our implementation, we found that the optimal solution is obtained within a few milliseconds. 23
Note that the last constraint can be removed in a system where consumers are allowed to sell power back to the grid and that e a can be fixed or unconstrained . In line with our model (see Section 3), c a is the relatively small discounted running cost of using storage, e a is the storage capacity,  X  a is the efficiency of the agent X  X  storage, b a + is its maximum charging and b a  X  its maximum discharging rates, and e a 0 is the storage at the beginning of the day which equals the storage at the end of the day (i.e., charging at the end of a day for the next day).

Now, not all agents may possess storage capacity (or some may not have enough storage to cover their whole consumption) and this is not known to the supplier a priori. The effect of this can be quite dramatic (as we shall show in Section 6). In particular, with limited storage, agents are less able to react to the variability in supply (communicated through the  X  signals). This, in turn, can result in the supplier incorrectly estimating the outcome of aggregate consumers X  response to its signals, leading to greater demand from the grid at peak times and hence higher prices. In the next subsection, we present a novel adaptive mechanism that allows a supplier to determine the appropriate  X  i to be sent to a population of agents that may have limited storage. The aim of the adaptive mechanism is to learn the optimal signal to send to the agents (see Figure 3) (given their response to a previously sent signal). Now, if the supplier were to have complete and perfect information about the system (i.e., the proportion of consumers with demand-side management capabilities that can use or store energy in reaction to a supplier X  X  signal) and complete control of the system (i.e., control the capabilities owned by its consumers), it would be able to define (and com-municate) exactly the storage profile of each consumer to minimize its total cost. The same optimization model defined in Eq. (1) could be used by aggregating the charging and discharging capabilities of all consumers and their loads as subject to Constraints 1 to 7 as in Figure 4. In so doing, we can find an optimal solution to the behaviors of consumers that will result in the most efficient use of green energy.
Now, in a more realistic setting, the only feedback that the supplier obtains from its consumers is their total load on the grid, that is i + b i (as shown in Figure 3). Assuming that the supplier can accurately estimate the average load of each consumer , a simplistic approach to set the control signal  X  t + 1 i would be This is simply the ratio between the total green energy from the supplier q t i and the total load from the agents at time slot i . The aim here would be to tell the agents to adjust their loads (using the battery b a i )sothat  X  i ideally converges to 1 (i.e., demand following supply). However, this approach assumes that all consumers have storage capability, as the supplier is signaling to each one of its consumers to increase its demand by a portion of the green energy produced. Ideally, the supplier should do so only for those consumers that are able to react to such a signal (i.e., those with storage capability). However, such information is not readily available to the supplier as consumers do not have to and may not want to reveal such information to their supplier (because they may not trust it to use this information to their benefit). Hence, the challenge is to adapt  X  i using only the feedback from the agents. We present our solution to this problem in Figure 5.

In more detail, we propose a novel adaptive version of  X  i based on current aggregate demand and the supplier X  X  green energy production. As can be seen, using the adaptive signal, the homeostatic control mechanism tries to minimize the difference between green energy produced and current total demand based on a learning rate  X  S which determines the rate at which it will change  X  i to reflect the feedback it receives. This rate is critical in determining whether the mechanism converges to the optimal solution (as we will see in Section 6). Thus, when the green energy produced is higher than the total demand, it implies an opportunity to maximize the use of green energy and reduce the carbon emissions of the consumers is lost and therefore  X  i is compensated positively (i.e., top condition in Figure 5) to increase the total demand of all the consumers. However when the total demand is too high, the supplier signals its consumers to reduce their use of green energy (i.e., bottom condition in Figure 5) at time i (and ensuring that  X  i is never negative). As we empirically demonstrate in Section 6, the daily total demand gradually changes such that the efficiency of green energy usage converges to the optimal (defined by the optimal solution of Eq. (2)).

In the next section, we evaluate our homeostatic control mechanism for different proportions of the population with storage capability and demonstrate how our adaptive system remains robust (i.e., keeps costs low and efficiency of green energy usage high) even when the error with which the supplier predicts his own supply of green energy (i.e., q i ) increases. The aim of this evaluation is to empirically demonstrate the effectiveness of the homeostatic control mechanism presented in the previous section in inducing demand to follow supply such that the carbon emissions of the system are reduced. We adopt an empirical approach here, as opposed to an analytical approach seeking equilibrium characterisations, in order to evaluate the system under a wider variety of settings than would be feasible within a theoretical framework, 24 and predict equilibrium outcomes (for differently parameterized versions of our mechanism) without overly restrictive assumptions. As we will see, despite the utility-maximizing behavior of consumers with storage capability, the system quickly converges to the optimal behavior. In this context, we define optimal behavior as the solution to Eq. (2) as discussed in Section 5.3.
In what follows, we first detail our experimental setup and then go on to evaluate the efficiency of our homeostatic control mechanism (against the optimal behavior) in terms of green energy use and costs of electricity, in particular for different proportions of the population with storage capability. We focus on the proportions with storage capacity to identify the critical amount of storage needed in the population to achieve the maximum returns on investment in batteries for individual users and for the population as a whole. We also demonstrate how the supplier X  X  adaptive behavior significantly improves the system. Finally, we analyse the sensitivity of our mechanism against prediction (of green energy production) errors. 25 We simulate a pool of 5000 consumers 26 subscribed to a green supplier that is able to supply 50% of its demand from its own renewable sources and the remainder bought from the grid. Our choice of the proportion of green energy was designed to model one of the most popular green suppliers in UK, namely Ecotricity which produced 41% of the electricity it supplies to its consumers from its own renewable sources in 2009 X 2010 and expects to reach 50% within the year.
 Electricity is priced using the carbon-based pricing scheme detailed in Section 4. Furthermore, we model the generation capacity as values drawn from a uniform dis-tribution (between 0 and 1) for each of the 30-min time slots. Each value is averaged using a discrete Gaussian filter (i.e., using normally distributed weights with mean 0 and standard deviation of 1 to model the effect of gradually changing wind patterns by removing any high-frequency changes) over the vector of 48 time slots across the day. The values of the time slots are then linearly scaled such that the sum total of these values equals 50% of the daily demand of the consumers. Furthermore, we set the limit for the prices bands at  X  min = 0 , 275 , 325 , 375 , 425 ,  X  max = 275 , 325 , 375 , 425 ,  X  and p grid = 29 , 41 , 51 , 59 , 71 assuming a 10% profit margin for the supplier. Finally, the de-mand of each consumer is modeled on the real UK data profile of the average user on the Domestic Unconstrained Tariff (i.e., the typical UK average profile before any demand-side management technologies, such as storage, are used [Vytelingum et al. 2010]) and the simulation is run 500 times, each run lasting 100 days. These values were chosen to ensure the statistical significance of our analysis. 27
Next, we assume that only a proportion of the population has storage capability (i.e., they own storage devices capable of storing 4kWh with charging and discharging efficiency uniformly distributed between 0.3kW and 0.5kW to model current storage devices [Vytelingum et al. 2010]). The consumers with storage capabilities are thus able to optimize their storage profile to reduce their costs (and implicitly reduce their carbon emissions as a result of our carbon-based pricing scheme). Given a control signal from the supplier, we empirically demonstrate in this section how the system efficiency improves in terms of carbon emissions (i.e., by minimizing energy used from the grid and maximizing green energy use). First, we analyse the daily effect of homeostatic control on the system.We do so by comparing the green energy usage efficiency (i.e., the percentage of green energy that is directly used by the consumers contracted to the supplier) and the cost of electricity used (based on the carbon-based pricing scheme and the Band 0 pricing of the supplier) in a system with and without homeostatic control. Furthermore, we also demonstrate the effectiveness of our adaptive mechanism and how it allows the system to converge to an optimal solution (given in Section 5.3).

From Figure 6, given a population with 50% having storage capability, we can see a daily convergence of our homeostatic control system with an adaptive mechanism, for different learning rates  X  S , to the optimal solution at 91.8%. As can be seen, the nonadaptive version is not very efficient (i.e., only 88.3%) as it overestimates the proportion of the population with storage and understates  X  that represents the amount of green energy available to consumers with storage. When the supplier adopts the adaptive mechanism using a higher learning rate (i.e.,  X  S = 0 . 05), this leads to a faster, though less smooth, convergence as opposed to a slower, but smoother convergence to the lower learning rate (i.e.,  X  S = 0 . 005). In general, this demonstrates that the emergent behavior of individually utility-maximizing agents is indeed efficient such that the system maximizes its use of green energy, avoiding having to acquire electricity from the grid as the consumers change their demand profiles to follow green supply. Also, an efficient outcome means that the consumers have lower carbon emissions overall since they maximize their use of renewable energy (and thus, minimize their use of grid energy). Because the objectives of reducing carbon emissions and minimizing costs are aligned through the carbon-based pricing scheme, the selfish utility-maximizing behavior of a consumer allows it to be as green as it could be. Next, we analyse the system at an equilibrium state (i.e., once the system has converged after a number of days), for different proportions of the population that have storage capability. Based on the previous experiment, here we set the learning rate at  X  S = 0 . 005 (to ensure convergence) for our homeostatic control mechanism and vary the proportion of the population with storage capability from 0 to 1. Figure 7(a) shows the green energy usage efficiency (as a percentage of the generation capacity) for different storage penetration in the population (at the end of 100 simulation days). First, we observe that when too many consumers adopt storage, the system with no homeostatic control wastes more green energy (when the proportion is greater than 0.6 in particular). This is because too many consumers are blindly optimizing their demands based only on market prices, unaware of the green production, with efficiency decreasing to 72%.

Now, when given a signal about green production (as in the homeostatic control mechanisms), the consumers are significantly greener as they are optimizing their demand based on how much and when green energy is available to them. With no storage in the system (i.e., no storage capability), green energy usage efficiency is the same with and without homeostatic control as a signal is then redundant. As storage penetration increases, the homeostatic control system becomes greener (having to use less electricity from the grid and more of the supplier X  X  green energy). When storage penetration is at its highest, we can see how the effect of homeostatic control peaks with up to a 25% increase in green energy usage efficiency (i.e., a 25% decrease in carbon emissions) compared to without homeostatic control. In addition, Figure 7(b) (log-scale) also compares the system, at equilibrium, with and without homeostatic control against the optimal solution (i.e., we are comparing the relative error between the optimal solution and where the system converges to). We can see that our adaptive mechanism allows the system to converge to within 0.5% of the optimal solution as opposed to up to 4.4% without an adaptive mechanism and up to 25% without homeostatic control. Next, we investigate the effect of different penetrations of storage in the population on the cost of electricity. Here we use our carbon-based pricing scheme to evaluate the cost of electricity given that different proportions of the population are able to utilize the full capacity of the green supplier. We consider cases where the cost of storage is added to the overall costs of the consumer or not. Thus, if cost of storage is fully subsidized, we observe from Figure 8 the decreasing trend which results from more consumers being able to change their demand to use green and less expensive energy. Furthermore, the cost without homeostatic control is marginally higher than with homeostatic control. The individual savings of a consumer with storage are maximized when the demand response of the population is maximized. At this point, it results in up to 14.5% lower costs because it can optimize its demand for greener and less expensively priced electricity. Conversely, when there is no storage in the system, a single consumer deciding whether to adopt storage would be able to make 7.5% savings even if she were the only one to have storage in the system. Indeed, this points to a significant incentive for consumers to adopt storage. Moreover, because the payoff of owning storage (rather than not) is always higher, it is likely that all consumers will eventually acquire storage devices and capitalize on the supplier X  X  control signal of green energy. 28
Next, we assume that there is a cost to storage. Specifically, we assume a storage device typically costing  X  200 per kWh and a startup cost of  X  200 (i.e., installation cost, wiring, and voltage inverter), with a lifetime of 10 years. When the costs are spread over the lifetime and with a capacity of 4kWh, this equals to a cost of 6p/kWh per day. From Figure 8, we can observe an increase in the cost of storage with homeostatic control (as we now factor in the cost of storage). However, a system with homeostatic control still remains less costly than without, changing from 3.1% less expensive (when the proportion of the population with storage is low) to 9.8% (when the whole population has storage). Given that the supplier X  X  generation capacity is dependent on weather conditions and hence uncertain, we investigate the sensitivity of our system with respect to prediction errors in green energy production (since the signal is a prediction of green energy to be produced in a near future, typically 3 X 4 hours). We do so to evaluate the sensitivity of our homeostatic control mechanism to prediction errors and do so by analysing the efficiency of our system in the presence of prediction errors.

From Figures 9(a) and 9(b), we can see how the system performs if the supplier overstates or understates its green production. In particular, we can observe that efficiency increases slightly (by up to 0.5%) when the supplier overstates  X  . This is because storage-capable consumers are recommended to use more green energy than available ensuring that all the green energy will be used. Thus the green energy-focused supplier (i.e., motivated to use all the green energy it produces to supply its consumers) is more inclined to slightly overstate  X  . However, in so doing, the total demand will be higher than the green energy available at peak times (when consumers are most incentivized to use green energy because of the greater cost of grid electricity) such that the supplier will need to buy from the grid to cover the difference, leading to higher costs. When the supplier slightly overstates  X  , we can clearly see that cost increases exponentially (see Figure 9(b)) while efficiency only increases by up to a negligible 0.5% (see Figure 9(a)).

On the other hand, when the supplier understates  X  , the cost increases while effi-ciency decreases, such that the system is worse off both in terms of cost and efficiency. Thus, crucially to minimize cost (and trade off only up to 0.5%), the supplier is incen-tivized to predict accurately since poor prediction (whether understating or overstating) invariably results in rapidly increasing costs for its consumers. However, when the ab-solute prediction error is small, the increase in costs is also small such that the system is relatively nonsensitive to small prediction errors. Specifically, when the supplier understates  X  by up to 10%, the cost only increases by up to 0.5% and, by up to 0.08% when it overstates  X  by up to 10%. This suggests that our system is relatively robust against small errors in prediction. In this article we have presented a novel decentralized homeostatic control mecha-nism for a green supplier and its consumers connected through the grid. Our approach is underpinned by the use of autonomous software agents endowed with algorithms to optimize their owners X  energy consumption. We fully utilize the real-time carbon intensity signal provided by existing information and communication technologies cou-pled with a flexible carbon-based pricing in order to implement real-time pricing in the smart grid for any type of supplier (green or brown). Given this, we have shown how agents can optimize their consumption of energy by storing electricity at times when it is inexpensive, thereby maximizing their individual utility and minimizing their carbon footprint. Building upon the feedback from the population of agents, the homeostatic control mechanism implements a control signal that the supplier learns to adapt to maximize its green energy usage by incentivizing the portion of the pop-ulation with storage capability to optimize their storage of electricity in such a way that their individual selfish behavior is aligned with the greater good of the system. We demonstrate that such an adaptive mechanism is essential for an efficient system, and indeed, we empirically demonstrate that it allows the system to converge to an optimal solution. Thus, we are able to show that our mechanism can achieve up to 25% greater efficiency for the supplier and up to 14.5% savings for the consumer over other single-signal-based mechanisms. We also demonstrate that the system is not sensitive to small prediction errors and that a supplier is incentivized to predict accurately its green production to minimize costs.

In general, our work demonstrates the strengths of closer synergies between power systems and information and communication technologies by showing how real-time consumption and carbon emissions data can be used to make electricity distribution more efficient. Moreover, our approach departs from the traditional approaches that did not consider the self-interested behaviors of consumers with different preferences, constraints (on storage capacity), and consumption profiles. Hence, we believe this is the first realistic step in building deployable multiagent systems in the grid. However, this article also highlights the challenges that lie in building robust communication technologies and autonomous agents for home energy management. In particular, while robust communications are needed to guarantee that signals are provided in a timely fashion to all actors in the system (i.e.,  X  for the agents and real-time consumption data for the supplier), intelligent agents need to be designed to learn the patterns of behavior of their owners either by analysing their usage profile or interacting with them through new user interfaces such as those of AlertMe or Google PowerMeter.

In future we aim to investigate the properties of our control mechanism within a more theoretical framework in order to prove its convergence properties (under specific settings) and expand our optimization model to consider other types of constraints (e.g., bounds on energy storage to extend battery life or decay in battery storage capacity). Moreover, to improve the practical performance of our mechanism we aim develop better prediction algorithms. While in our simulations we assumed that the renewable power generation does not vary significantly across days, this may not always be the case. Hence, we will investigate the robustness of our system given different volatilities for renewable power generation. Indeed, it is important to note that our approach is highly dependent on the predictions that both suppliers and consumers can make about the generation and consumption of energy, respectively. While we have studied how prediction errors on the supplier side affect the system, we have simplified the model of the consumers to avoid significant prediction errors. The main challenge here is that consumer behavior tends to vary significantly between days, across seasons, and on specific days (e.g., sporting events or holidays) and predicting the daily consumption is a challenging task that is likely to require advanced machine learning solutions and human-agent interaction mechanisms that will allow agents to understand the users X  future consumption intentions. Indeed, a major assumption of our approach is that users will be happy to delegate the task of shifting energy to their agents in the hope to get the best deal. While this may be fine for some people, others may not trust their agents to act on their behalf in such a sensitive domain. Given this, work is needed to develop good feedback interfaces and interaction mechanisms for humans to trust their agents.

Another important future direction involves extending the model to consider mul-tiple green suppliers operating in the grid such that they constitute the majority of the energy producers. This, we believe, will require more advanced control tech-niques given that carbon intensity signals may disappear altogether and a key ob-jective of suppliers will change from maximizing green energy usage to ensuring that demand always follows supply throughout the grid in order to avoid brownouts and blackouts.
 Half-hourly time-slots T ={ 1 , 2 ,..., 48 } Agent a  X  A Agent X  X  load profile a i  X  i  X  T Agent X  X  storage profile b a i  X  i  X  T Agent X  X  demand profile l a i  X  i  X  T Agent X  X  demand profile priced as green energy l a , green i  X  i  X  T Agent X  X  demand profile priced as grid l a , green i  X  i  X  T Agent X  X  storage charging profile b a + i  X  i  X  T Agent X  X  storage discharging profile b a  X  i  X  i  X  T Agent X  X  storage charging capacity b a + Agent X  X  storage discharging capacity b a  X  Agent X  X  storage efficiency e a Agent X  X  storage capacity c a Aggregate demand profile l A i  X  i  X  T Aggregate demand profile from green production l A , green i  X  i  X  T Aggregate demand profile from grid l A , grid i  X  i  X  T Grid price bands p grid n  X  R + where n  X  X  1 , 2 , 3 , 4 , 5 } Carbon intensity  X  i  X  R +  X  i  X  T Green production price p green  X  R + Grid price p grid i  X  R +  X  i  X  T Green supplier production q i  X  R +  X  i  X  T Supplier X  X  control signal  X  i  X  R +  X  i  X  T Learning rate of supplier X  X  adaptive mechanism  X  S  X  [0 , 1]
