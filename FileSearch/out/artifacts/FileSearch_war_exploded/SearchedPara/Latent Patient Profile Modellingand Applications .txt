 Chronic diseases are rampant. Health care costs are increasingly related to such diseases. Diabetes mellitus is one such chronic disease from which 346 million people worldwide suffer, as estimated by The World Health Organization (WHO) [1]. Only about 5  X  10% of them have Type I diabetes mellitus, whilst Type II comprises the rest. The people who suffer Type I are not able to produce insulin. In contrast, Type II diabetes means that there is an inability to absorb insulin. In 2004, 3 . 4 million people died from complications of high blood sugar. The incidence of diabetes mellitus is increasing, and being diagnosed in younger people. This leads to serious complications -deterioration in blood vessels, eyes, kidneys and nerves. It is a chronic, lifelong disease.

Escalating health costs are associated with such chronic diseases. To provide high quality healthcare, care plans are issued to patients to manage them within the community, taking steps in advance so that these people are not hospitalised. Thus, it is imperative to identify groups of patients with similar characteristics so that they can be covered by a coherent c are plan. Additionally, if the hospital can predict the disease codes arising fr om escalating complication of chronic disease, it can adjust financial and manpower resources. Thus useful prediction of codes for chronic disease can lead to service efficiency.

Clustering is a natural selection for this task. However, medical data is com-plex  X  it is mixed-type containing Boolean data (e.g., male/female), continuous quantities (e.g., age), single categories (e.g., regions), and repeated categories (e.g., disease codes). Traditional clustering methods cannot naturally integrate such data and we choose to extend the our recent model, the mixed-variate re-stricted Boltzmann machine (MV.RBM) [2]. The mixed-variate RBM uncovers latent profile factors, enabling subsequent clustering. Using a cohort of 6 , 931 chronic diabetes patients with data from 2007 to 2011, we collect 3 , 178 diagno-sis codes (treated as repeated categories) and combine it with region-of-birth (as categories) and age (as Gaussian variables) to form our dataset. We show clus-tering results obtained from running affini ty propagation (AP) [3], containing 10 clusters and qualitatively evaluate the disease codes of groups. We demonstrate that the mixed-variate RBM followed by AP outperforms all baseline methods  X  Bayesian mixture model and affinity propagation on the original diagnosis codes, and k -means and AP on latent profiles, discovered by just the plain RBM [4].
Predicting disease codes for future years enables hospitals to prepare finance, equipment and logistics for individual requirements of patients. Thus prediction of disease codes forms the next part of our study. Using the mixed-variate RBM and the dataset described above, we demonstrate that our method outperforms other methods, establishing the versatility of the latent profile discovery with mixed-variate RBM.

In short, our main contributions are: (i) Novel extension and application of a powerful data mining tool, mixed-variate RBM, to a complex hospital chronic disease dataset, for clustering and understanding of disease codes within sub-groups; (ii) Disease code prediction, using the model; and (iii) Demonstration of the method and showing that it outperforms baseline models, in both clustering and prediction on this complex data.

The significance of our work is to build a framework that is able to support healthcare centres and clinicians delivering outcomes that can integrate with their operations to enhance clinical effici encies. Using such systems, the man-agement and supervision on diabetes patients in particular as well as other kinds of diseases patients in general would have the potential to improve.

The rest of paper is organized as follows. The next section presents our pa-tient profile modelling framework. Next, we describe our implementation on the diabetes cohort and demonst rate efficiencies of our met hods. Section 4 discusses related work and modelling choices as well as the other potentials of the proposed framework, followed by conclusions in Section 5. A patient profile in modern hospitals typically consists of multiple records includ-ing demographics, admissions, diagnoses, surgeries, pathologies and medication. Each record contains several fields, eac h of which is type-specific. For example, age can be considered as a continuous quantity but a diagnosis code is a dis-crete element. At the first approximation, each patient can be represented by using a long vector of mixed types 1 . However, joint modelling of mixed types is known to be highly challenging even for a small set of variables [5,6]. Complete patient profiling, on the other hand, requires handling of thousands of variables. Of equal importance is that the profiling should readily support a variety of clinical analysis tasks such as patient cl ustering, visualisation and disease pre-diction. In what follows, we develop a representational and computational scheme to capture such heterogeneity in an efficient way. In particular, we extend the our recently introduced machinery known as mixed-variate restricted Boltzmann machine (MV.RBM) [2] for the task. 2.1 Mixed-Variate Restricted Boltzmann Machines A restricted Boltzmann machine (RBM) is a bipartite undirected graphical model with two layers, where the input layer consists of visible units and the other layer the binary hidden units [7]. See, for example, Fig. 1 for an illustration. A mixed-variate RBM is a RBM with inhomogeneous input units, each of which has the own type. More formally, let v denote the joint set of visible variables: v =( v 1 ,v 2 ,...,v N ), h the joint set of binary hidden units: h =( h 1 ,h 2 ,...,h K ), where h k  X  X  0 , 1 } for all k . Each visible unit encodes type-specific information, and the hidden units capture the latent factors not presented in the observations. Thus the MV.RBM can be seen as a way to transform inhomogeneous observa-tional record into a homogeneous representation of the patient profile. Another way to view this as a mixture model where there are 2 K mixture components. This capacity is arguably important to capture all factors of variation in the patient cohort.

The MV.RBM defines a Boltzmann distribution over all variables: P ( v , h ;  X  )= e and  X  is model parameter. In particu lar, the energy is defined as where a =( a 1 ,a 2 ,..,a N ) , b =( b 1 ,b 2 ,...,b K ) are biases of visible and hidden units, and W =[ W ik ] represents the weights connecting hidden and visible units, and F i ( v i ) are type-specific function. The bipartite structure allows con-ditional independence among intra-layer variables which lead to the following factorisations: The conditional separation of types in Eq. (2) is critical: This allows inde-pendent specification of type-specific data generative models and at the same time achieves higher-order dependencies through the  X  X ooling X  layer h .For example, let f i ( h )= a i + k W ik h k ,the binary units would be specified as: P ( v i | h )=1 / 1+ e  X  f i ( h ) (i.e., F i ( v i )=0);the Gaussian units: P ( v i | h )= N  X  2 e
The model is typically estimated by maximising the data log-likelihood L = log P ( v ;  X  ) = log h P ( v , h ;  X  ). The parameters are updated in a gradient ascent fashion as follows: for some learning rate  X &gt; 0. Here E v , h denotes the expectation with respect to the full model distribution P ( v , h ;  X  ), E h | v the conditional distribution given the known v . Whilst the conditional expectation can be compute efficiently, the full expectation is generally intractable. Thus we must resort to approximate methods, and in this paper, we choose a truncated MCMC-based method known as contrastive divergence (CD) [8] as it proves to be fast and accurate. A MCMC chain is obtained by alternating between  X  v  X  P v |  X  h and  X  h  X  P ( h |  X  v ). 2.2 MV.RBM for Patient Profiling The goal of patient profiling is to construct an effective personal representation from multiple hospital records. Here we focus mainly on patient demographics (e.g., age , gender and region-of-birth ) and their existing health conditions (e.g., existing diagnoses ). For simplicity, we consider a binary gender (male/female). Further, age can be considered as a continuous quantity and thus a Gaussian unit can be used 2 ; and region-of-birth and diagnosis as categorical variables. However, since the same diagnosis can be repeated during the course of readmissions, it is better to include them all. In particular, we adopt the idea from the  X  X eplicated softmax X  [4] where repeated diagnoses share the same parameters. In the end, we build one MV.RBM per patient due to the difference in the diagnosis sets. Further, to balance the contribution of the hidden units against the variation in input length, it is important to make a change to the energy model in Eq. (1) as follows: D b  X  b where D is the total number of input variables for each patient. We note that these parameter sharing and balancing are not readily present in the current MV.RBM of Truyen et al [2].

Once the model has been estimated, the latent profiles are generated by com-puting the posterior vector  X  h = P h 1 1 | v ,P h 1 2 | v ,...,P h 1 K | v ,where P h 1 k | v is a shorthand for P ( h k =1 | v )  X  the probability that the k -th latent factor is activated given the demographic and clinical input v : As we will then demonstrate in Section 3, the latent profile can be used as input for a variety of analysis tasks such as patient clustering and visualisation.
Interestingly, the model also enables a certain degree of disease prediction , i.e., we want to guess which diagnoses will be positive for the patient in the future 3 . Although this may appear to be an impossible task, it is plausible statistically because some diseases are highly corre lated or even causative, and there are certain pathways that a disease may pr ogress. More specifically, subset of diag-noses at time t + 1 can be predicted by searching for the mode of the following conditional distribution: Unfortunately the search is intractable as we need to traverse through the space of all possible disease combinations, which has the size of 2 M where M is the set of diagnosis codes. To simplify the task and to reuse of the readily discovered latent profile  X  h (1: t ) , we assume that (i) the model distribution is not changed due to the  X  X nseen X  future, (ii) the latent profile at this point captures everything we can say about the state of the patient, and (iii) future diseases are conditionally independent given the current latent profile. This leads to the following mean-field approximation 4 : In this section we present the analysis of patient profiles using the data obtained from Barwon Health, Victoria, Australia 5 , during the period of 2007  X  2011 using the extended MV.RBM described in Section 2. In particular, we evaluate the capacity of the MV.RBM for patient clustering and for predicting future diseases. For the former task, the MV.RBM is can be seen as a way to transform complex input data into a homogeneous vector from which post-processing steps (e.g., clustering and visualisation) can take place. For the prediction task, the MV.RBM acts as a classifier that map inputs into outputs.

Our main interest is in the diabetes cohort of 7 , 746 patients. There are two types of diabetes: Type I is typically present in younger patients who are not able to produce insulin; and Type II is more popular in the older group who, on the other hand, cannot adsorb insulin. One of the most important indicators of diabetes is the high blood sugar level compared to the general population. Diabetes are typ-ically associated with multiple diseases and complications: The cohort contains 5 , 083 distinct diagnosis codes, many of which are related to other conditions and diseases such as obesity, tobacco use and heart problems. For robustness, we re-move those rare diagnosis codes with less than 4 occurrences in the data. This results in a dataset of 6 , 931 patients who originally came from 102 regions and were diagnosed with totally 3 , 178 unique codes. The inclusion of age and gender into the model is obvious: they are not only related to and contributing to the dia-betes types, they are also largely associated with other complications. Information about the regions-of-origin is also important for diabetes because it is strongly re-lated to the social conditions and lifestyles, which are of critical importance to the proactive control of the blood sugar level, which is by far the most cost-effective method to mitigate diabetes-related consequences. 3.1 Implementation Continuous variables are first normalised across the cohort so that the Gaussian inputs have zero-means and unit variances. We employ 1-step contrastive diver-gence (CD) [8] for learning. Learning rates vary from type to type and they are chosen so that reconstruction errors at each data sweep are gradually reduced. Parameters are updated after each mini-batch of 100 patients, and learning is terminated after 100 data sweeps. The number of hidden units is determined empirically to be 200 since large size does not necessarily improve the cluster-ing/predictio n performance.

For patient clustering , once the model has been learned, the hidden posteriors that are computed using Eq. (3) can be used as the new representation of the data. To enable fast bitwise implementation (e.g., see [9]), we then convert the continuous posteriors into binary activation as follows:  X  h k =1if P ( h 1 k | v )  X   X  1 and  X  P k = 0 otherwise for all k =1 , 2 ..,K and some threshold  X  1  X  (0 , 1). We then apply well-known clustering methods including affinity propagation (AP) [3], k -means and Bayesian mixture models (BMM). The AP is of particular interest for our exploratory analysis because it is capable of automatically determining the number of clusters. It requires the similarity measure between two patients, and in our binary profiles, a natural measure is the Jaccard coefficient: where S { p } is the set of activated hidden units for patient p .Anotherhyper-parameter is the so-called  X  X reference X  which we empirically set to the average of all pairwise similarities multiplied by  X  20. This setting gives a reasonable clustering.

The other two clustering methods require a prior number of clusters, and here we use the output from the AP. For the k -means, we use the the Hamming distance between activation vectors of the two patients 6 . The BMM is a Bayesian model with multinomial emission probability.

The task of disease prediction is translated into predicting diagnoses in the future for each patient. We split data into 2 subsets: The earlier subset, which contains those diagnoses in the period of 2007  X  2010, is used to train the MV.RBM; and the later subset is used to evaluate the prediction performance. In the MV.RBM, we order the future diseases according to the probability that the disease occurs as in Eq. (5). 3.2 Patient Clustering First we wish to validate that the latent profiles discovered by the MV.RBM are informative enough so that clinically meaningful clusters can be formed. Fig. 2 shows the 10 clusters returned by the AP and the similarity between every pa-tient pair (depicted in colour, where the similarity increases with from blue to red). It is interesting that, out of 10 groups, we are able to discover a group whose conditions are mostly related to Type I diabetes (Figs. 3a and 3b), and another group associated with Type II diabetes (Figs. 4a and 4b). The grouping properties can be examined visually using a visualisation tool known as t-SNE [10] to project the latent profiles onto 2D. Fig. 5a depicts the distribution of patients, where the colours are based on the group indices assigned earlier by the AP.
For quantitative evaluation, we calculate the Rand-index [11] to assess the quality of resulting clusters, given that we do not have cluster labels. The Rand-index is the pairwise accuracy between any two patients. To judge whether two patients share the same cluster, we consult the diagnosis code hierarchy of the ICD-10 [12]. We use hierarchical assessment since a diagnosis code may have multiple levels. E11.12, for example, has two levels: E11 and E11.12. The lower level code specifies disease more clearly w hilst the higher is more abstract. There-fore we have two ways for pairwise judgem ent: the Jaccard coefficient (Section 3.1) and code  X  X luster X  which is the grouping of codes that belong to the same disease class, as specified by the latest WHO standard ICD-10. At the lowest level, two patients are considered similar if the two corresponding code sets are sufficiently overlapping, i.e., their Ja ccard coefficient is greater than a thresh-old  X  2  X  (0 , 1). At higher level, on the other hand, we consider two patients to be clinically similar if they share higher level diabetes code of the same code  X  X luster X . For instance, two patients with two codes E11.12 and E11.20 are sim-ilar at the level E11 7 , but they are dissimilar at the lower level. Note that this hierarchical division is for evaluation only. We use codes at the lowest level as replicated softmax units in our model (Section 2.2).
Fig. 5b reports the Rank-indices with respect to the assessment at the lowest level in the ICD-10 hierarchy for clustering methods with and without MV.RBM pre-processing. At the next ICD-10 level, the MV.RBM/AP achieves a Rand-index of 0.6040, which is, again, the highest among all methods, e.g., using the RBM/AP yields the score of 0.5870, and using AP on diagnosis codes yields 0.5529. This clearly demonstrates that (i) MV.RBM latent profiles would lead to better clustering that those using diagnosis codes directly, and (ii) modelling mixed-types would be better than using just one input type (e.g., the diagnosis codes). 3.3 Disease Prediction The prediction results are summarised in Fig. 6, where the ROC curve of the MV.RBM is compared against that of the baseline using k -nearest neighbours ( k -NN). The k -NN approach to disease ranking is as follows: For each patient, a neighbourhood of the 50 most similar patients is collected based on the Jaccard coefficient over sets of unique diagnoses. The diagnoses are then ranked accord-ing to their occurrence frequency within the neighbourhood. As can be seen from the figure, the latent profile approaches outperform the k -NN method. The MV.RBM with contextual information such as age, gender and region-of-birth proves to be useful. In particular the the areas under the ROC curve (AUC) of the MV.RBMs are 0 . 84 (with contextual information) and 0 . 82 (without con-textual information). These are clearly better than the score obtained by k -NN, which is 0 . 77. This work is part of our ongoing effort to apply data mining and statistical techniques to understand the complex health databases in order to improve the services efficiency within health organisations and across coordinated networks. This line of research has recently attrac ted considerable interest in the data mining community (e.g., see [13,14]). Our focus on diabetes is motivated by the pressing demands to deliver personalised cares for the large population on an ongoing basis [15,16]. However, we wish to emphasize that the approach is quite general and could be applicable to other cohorts.

In terms of modelling, our work adds a few more flavours to the current mixed-variate analysis in biomedical domains [5,6,17]. The existing literature of-fers three approaches: The first is to speci fy the direct type-specific conditional relationship between two variables (e.g., see [5]), the second is to assume that each observable is generated from a latent variable (latent variables then encode the dependencies) (e.g., see [6]), and the third is to construct joint cumulative distributions using copula [18,17]. The drawback of the first approach is that it requires far more domain knowledge and statistical expertise to design a cor-rect model even for a small number of variables. The second approach lifts the direct dependencies to the latent variables level. All approaches are, however, not very scalable to r ealistic setting of the hospital records. Our treatment using MV.RBM [2], along with the line of work using RBMs for representing com-plex data [19,20,21], offers the fourth alternative : Direct pairwise dependencies are substituted by indirect long-range dependencies. Not only this simplifies the model design, the inference is much mo re scalable: each MCMC sweep through all variables takes only linear time. Our most recent work in [21], while enjoying the similar computational efficiency, offers a better interpretation through the use of latent variables to capture the generative mechanism of data types.
Latent profiling could be important for other applications such as patient retrieval, i.e., we want to retrieve patients with clinically similar conditions to the patient under study. In this setting, using raw diagnosis codes may miss those whose codes are different from the present patient even if they share the same clinical conditions. The use of MV.RBM, on the other hand, would project these patients onto similar latent profiles . It is also of interest to ask whether it is justifiable for the choice of parameter sharing for repeated diagnoses. To get answer, we experimented with the  X  X ounting X  treatments in which each code is considered as a Poisson variable, and our clustering/prediction results indicate that it is much better to employ the parameter sharing trick. This may due to the fact that under the Poisson treatment, diagnoses are assumed to  X  X rrive X  independently, while in reality diagnoses are generally correlated. We have presented a latent profiling framework using our recently introduced ar-chitecture known as mixed-variate restricted Boltzmann machines (MV.RBM). The goal was to develop a representational and computational scheme that can handle complex, inhomogeneous data from real hospital settings. The MV.RBM was adapted to handle recurrent diagnoses by parameter sharing and variable balancing. We evaluated this scheme on a cohort of complex diseases such as diabetes, where there are many influential factors, and diagnoses are often re-peated, correlated and causative. It is demonstrated that the chosen scheme is highly effective for exploratory tasks such as patient clustering and visualisation and predictive tasks such as 1-year diagnosis prognosis.
