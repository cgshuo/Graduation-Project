 1. Introduction
In recent decades, the application of FC in vehicles has been the focus of increased attention. In contrast to a chemical battery, the FC generates electric energy rather than storing it and continues to do so as long as a fuel supply is maintained. Compared with the battery-powered electric vehicles (EVs), the
FC-powered vehicle has the advantages of a longer driving range without a long battery charging time. Compared with internal combustion engine (ICE) vehicles, FC vehicles are more efficient since the energy conversion is direct (i.e. without combustion), and there is no Carnot limitation. FC vehicles using hydrogen are about twice as efficient as ICEs ( Larminie and Dicks, 2003 ).
Moreover, unlike the ICE, FC efficiency is also high at partial loads ( Yang, 2008 ). This is particularly advantageous in transportation because the vehicles are mostly operated at part load conditions ( Sandy, 2009 ). Thus, FC vehicles have long-term potential as the mainstream vehicle in the future because they have almost zero emissions and a driving range similar to that of ICE vehicles ( Granovskii et al., 2006 ).

Hydrogen is a clean energy vector in the same way electricity is, but it has to be produced, as well as electricity has to be produced, out of different primary energy sources. And this is the real challenge. To produce hydrogen many pathways are being considered ( Bogart, 2002; Holladay et al., 2009 ). Most pathways are based on electrolysis of water by using electricity produced by renewable sources (hydraulic, solar, or wind energy), by nuclear power plants (and in the future fusion power plants). Hydrogen can also be produced from natural gas or by reforming methanol. It is clear that the global energy efficiency as well as the associated CO 2 emissions depend strongly on the chosen pathway ( Van Mierlo et al., 2006 ).

Tramways for city and regional transport are considered to be the most likely types of vehicles for an early market introduction of FC technology. Tramways require more power than passenger automobiles, typically about 250 kW or more. They operate in a more demanding operating regime with frequent starts and stops ( Sammes, 2006 ). Nevertheless, the average fuel economy of a tramway FC system is roughly 15% better than that of a diesel engine ( Hoogers, 2003 ).

Apart of the production of hydrogen, there are some difficulties that must be solved to insert the FC technology in trains or tramways. Although the FC hybrid locomotives cannot fully reach their potential for enhanced performance, the most likely applications to benefit from enhanced tractive effort and regeneration are commuter rail and long-distance intercity passenger trains. Packaging of the bulky hybrid power plant is relatively easy because it is in a separate locomotive. For light rail and mass-transit, however, packaging is difficult as the power equipment is distributed over a multiple-unit vehicle and must be mounted under the floor ( Miller et al., 2006 ).
 This paper focuses on describing two control strategies for a
FC X  X attery powered hybrid system for a real surface tramway and also briefly describes the configuration and modeling of all principal components. This tramway, called Metro Centro , serves the centre of Seville, a city in Spain. Currently, it operates as catenary-powered tramway. One of the objectives of the Ecotrans research project, leaded by a Spanish consortium and supported by the Spanish Ministry of Science and Technology, is to retrofit it to FC X  X attery hybrid tramway. This paper presents the advances made in control for the energy management of the hybrid system.
Both control strategies (cascade and fuzzy logic based) are assessed by simulations for the real driving cycle of this tramway.
This paper is organized as follows. After introduction, a brief description of the tramway is presented in Section 2. In Section 3, a summary of the degree of hybridization of the tramway and the description of each component model are presented. Section 4 presents the two control strategies for the energy management of the hybrid tramway. Experimental results are shown in Section 5.
Finally, conclusions are presented in Section 6. 2. Tramway description Metro Centro is a surface tramway serving the centre of the city
Seville, in Andalusia, Spain. At present, the service consists of just four stops, but it is expected to be extended to high speed train station and including five new stops. The project works began in 2005 and its first phase was completed in autumn of 2007. The tramway system covers 1.4 km and has 7 trains, all of them were manufactured by the Spanish rail equipment manufacturer Construcciones y Auxiliar de Ferrocarriles (CAF).

The tramway is composed of bidirectional units with five articulated bodies resting on three bogies. Two of these units are motor bogies and the other is a trailer bogie. It develops 70 km/h with a maximum capacity of 275 places.

The two motor bogies are supplied by the tramway traction system via an inverter box, which consists of two independent inverters that supply the traction motors (one per wheel). Each bogie has four traction motors.

Each traction converter box has a rated power of 300 kW with supply voltage of 750 V dc. It consists of two completely independent inverters, each one supplying two 60 kW squirrel cage traction motors.

The traction box includes two crowbar circuits, one per inverter. Each crowbar circuit consists of an IGBT, a diode and an external dissipation resistor. Each braking chopper branch connects to a braking resistor where the kinetic power of the tramway and the over-voltages generated are absorbed.

The route of the first phase of Metro Centro takes approxi-mately 6 min. This route has four stops, two of which are intermediate, along a linear path that crosses two major urban areas. The first of these areas is located in the old town of the city, whereas the other area is more modern with wide streets and avenues.

The typical power-speed curve, recorded on the bidirectional tramway route, is shown in Fig. 1 . This curve was the starting point for the design of a tramway hybrid system.

The driving cycle of the tramway is the function P ( t ), where P is the tramway traction power and t is the time.

As shown, power requirements for acceleration are very different from the rest, with a maximum power reaching over 400 kW for durations of less than a minute when the tramway starts up or begins to move uphill. For the rest of the 660 s cycle, the power requirements are low or zero in stopping or braking events. Such braking events show the regeneration capability of the system.

Apart from the traction power, it is important to consider the electrical auxiliary services that include fans, steering, air conditioning systems, etc. Although these loads vary throughout the cycle, the net effect can be accounted as a constant average load ( Markel, 2003 ), in this case, of over 61 kW. 3. Fuel cell X  X attery hybrid system
Fig. 2 shows the proposed configuration of FC X  X attery powered hybrid system for the tramway. The hybrid system is composed of (1) FC, (2) battery, (3) dc/dc boost converter, (4) auxiliary services module, (5) four traction motor drives, (6) braking chopper, and (7) Energy Management System (EMS).
Two energy management strategies were used to control the power distribution among the power sources of hybrid tramway.
One of them uses a cascade controller to decide the power that the FC must generate at every moment and the other uses a fuzzy controller for the same objective. 3.1. Degree of hybridization FC X  X attery
For hybrid electric locomotives, the degree of hybridization (DOH) is the ratio of FC power to the total power requirements. The
DOH depends on the role of the energy secondary storage (ESS), covering peak transient demands, gradeability or acceleration performance, power assist during th ecyclesorregenerativebraking energy recapture ( Markel, 2003 ). Table 1 summarizes the tramway driving cycle characteristics that can be considered for the DOH.
An easy way to obtain the minimum FC power requirements is to balance the energy consumed from the ESS during the driving cycle (including auxiliary services) to that returned to the battery by the FC ( Garc X   X  a et al., in press ).

The FC size must be up the average power requirements and avoid increased energy requirements for the battery. On the other hand, these requirements depend on the specific roles that would be expected to fill in the control system strategy. According with this two premises and after considering simulated scenarios and commercially available components, it has been considered a rated power of 200 kW to be generated by the FCs and 58 34 Ah Ni-MH batteries connected in series as ESS with a rated power of 450 kW. 3.2. Fuel cell
The PEM FC is the best option for public transport due to their high power density, specific power, low operating temperature, longevity, efficiency, good dynamic behavior, and the relativity ability to rapidly adjust to changes in power demand ( Hoogers, 2003; Emadi et al., 2009 ). Thus, a commercial FC from Nuvera was considered in this work ( Nuvera, 2006 ). Since this type of FC generates a nominal power of 127 kW to 235 V, two of these FCs are generally connected in parallel in order to achieve a total net power of around 200 kW.

A reduced model of a PEM FC was used in this study, which was a simplification of the complete model described in Pukrushpan et al. (2002 ). The capability of this reduced model to represent the FC response is demonstrated in Garcia et al. (in press ). Fig. 3 shows the configuration of the PEM FC model. Next, this reduced model is explained briefly.
 The voltage generated by a FC is obtained from the sum of Nernst X  X  voltage, the activation over voltage, concentration over voltage and the ohmic over voltage ( Uzunoglu and Alam, 2006 ). The PEM FC output voltage can be expressed by Nernst X  X  instantaneous voltage E cell and the irreversible voltage or the loss voltage V irrev : V E V where E 0 is the standard-state reversible voltage, k e is a function of the entropy change and Faraday X  X  constant, T is the FC temperature, R is the ideal gas constant, F is Faraday X  X  constant, P
O is the water partial pressure, P O 2 is the oxygen partial pressure, P H 2 is the hydrogen partial pressure, V act and V the activation and concentration voltage drop, which are function of the current density (relation between the actual current fuel cell and the effective area of it), and V ohm is the ohmic voltage drop, which depends on the FC internal resistance.

The hydrogen partial pressure can be calculated as dp dt  X  where R H 2 is the hydrogen gas constant, T is the temperature at that reacts in the anode, which is obtained with Faraday X  X  law: q where N is the number of series cells necessary to get the FC output voltage and I FC is the actual current generated by the FC.
The hydrogen input flow q H 2 _ i n has been obtained through the model of a valve in order to maintain a similar pressure between the anode and the cathode.

The hydrogen output flow q H 2 _ ou t can be calculated by using the relation between the molar flow of hydrogen and its partial pressure inside the channel. This relation can be expressed as ( Uzunoglu and Alam, 2006 ) k ffiffiffiffiffiffiffiffiffiffiffiffiffiffi
M p q
Similarly, the oxygen partial pressure can be obtained as dp dt  X  q q
Other FC components are the compressor, humidifier and air cooler. The compressor is the responsible for the control of the incoming oxygen in the cathode. In this case, the compressor has been modeled by a first order system in order to approximate its dynamic response. Furthermore, the humidifier and air cooler are regarded as ideal so that the FC operates at an optimum temperature (80 1 C) and a constant relative humidity. 3.3. Battery
Many battery systems have been tested in hybrid vehicles (transit buses, light trucks, and tramways). Such systems use
Pb-acid, Ni X  X d, Ni-MH, or Li-ion batteries. A Pb-Acid battery is inexpensive, but has a poor charge/discharge capacity. A Li-ion battery performs better than a Pb-acid battery, Ni X  X d battery or
Ni-MH battery, but it is much more expensive than the other three ( Xu et al., 2009 ). When it comes to choosing one of these battery types, practical experience has shown that despite its higher cost, the Ni-MH battery is the best system because of its endurance and reliability ( Broussely, 2007 ). In addition, these batteries can be charged very rapidly which makes them ideal for use in hybrid cars with range extenders, or in a vehicle, such as a bus or tram, which can be recharged during frequent stops ( Larminie and Dicks, 2003 ). In fact, most of the battery-powered and hybrid vehicles tested and marketed to date have Ni-MH batteries ( Burke, 2007 ).

For this reason, the tramway hybrid system described in this paper includes a Ni-MH battery, whose characteristic parameters were selected from a commercial battery module ( Saft Industrial
Battery Group, 2005 ), Saft X  X  NHP 10-3412 V, 34 Ah. This battery is specifically designed for high-power applications, such as hybrid tramways. It was modeled by the Ni-MH battery model included in SimPowerSystems ( MathWorks, 2009 ). The battery voltage can be expressed as
U where U bat is the battery voltage, E bat is the no load voltage, I the battery current, and R i is the internal resistance, which is assumed to be constant during the charge and the discharge cycles, and which does not vary with the amplitude of the current.
The no load voltage during the charging or discharging of the battery depends on the battery current, extracted capacity, and hysteresis phenomenon of the battery during the charge and discharge cycles. It can be calculated as follows:
E
E where E o is the constant voltage, K is the polarization constant or polarization resistance, i * is the low-frequency current dynamics, i is the battery current, it is the extracted capacity; Q is the functions of the battery current, which represent the hysteresis phenomenon of the battery during the charge and discharge cycles.

When Ni-MH batteries are used for public transport applica-tions, it is best to keep the stage-of-charge (SOC) as close to 50% as possible or within 30 X 70%, because the coulombic charge efficiency is very high at such SOCs ( Linden and Reddy, 2002 ).
The implemented model calculated the battery SOC as ( MathWorks, 2009 ) SOC  X  %  X  X  100 1 3.4. Boost converter A classical dc/dc boost converter ( Skvarenina, 2002;
Thounthong et al., 2006 ) is selected as FC power converter, which adapts the dc voltage supplied by the FC (235 V) at its rated power to the 750 V traction standard dc bus. It is composed of a high frequency inductor L 1 , an output filtering capacitor C 1 and a main switch S 1 . Switch S 2 is a shutdown device for test security to prevent the FC stack from short circuits in case of accidental destruction of S 1 , or faulty operation of the regulator.
This converter is controlled by a current control loop. Effective control of the fraction of time that the converter is operating (duty cycle) permits the FC current control. By acting on the switch S gate signal, it is therefore possible to determine the load power distribution between the two energy sources, FC and battery. 3.5. Braking chopper
In regenerative braking, some of the kinetic energy is converted into electrical energy and stored in the battery, in order to be used during the next acceleration, or whenever else needed. However, part of the regenerative braking energy must be dissipated in the braking resistor when it cannot be absorbed by the battery because of its limitations. Moreover, it avoids the voltage rise over the desired level.

The braking chopper absorbs the energy produced by the motors deceleration when required. It has been modeled by a current source parallel with the dc bus. As explained further on, the controls systems determine the effective resistance to be required to dissipate the power, and thus the current is calculated from the dc bus voltage and the effective resistance. 3.6. Tramway loads
As previously mentioned, the tramway loads are the auxiliary services and the traction system. Because the objective of our research was to compare the two control strategies, both loads were modeled as a controlled dc current source connected to the dc bus, whose current was a function of the power consumption and the dc bus voltage. 4. Control strategies for the EMS of tramway
The tramway EMS should pro vide the power needed by optimizing the energy generated by the system, maintaining the SOC at a desired level (60%), and ordering the operation of the braking resistor, when necessary, during regenerative braking. Accordingly, two types of control strategies for the EMS are described and compared in this work: cascade control and fuzzy logic based control. 4.1. Cascade control
This control is based on that proposed in Thounthong et al. (2008 ). According to this, the cascade control is composed of three control loops. Fig. 4 shows the control structure implemented to generate the duty cycle of the boost converter.

First, a reference SOC value is considered and the difference between this and the actual SOC is used in a PI controller to generate the ideal reference battery current, ( I bat _ ref has two limitations; two limitations are applied: the first one is a limitation in level, and the second one limits the rising/falling rate of the reference current, both of them depending on the physical limitations of the battery.

Secondly, the error between the battery reference power and actual power is used in other PI controller to generate the FC reference power. The FC reference current is obtained using the FC voltage. This current is limited in slope and level, depending on the physical limitations of the FC.

Finally, the error between the FC reference and actual current is used in the last PI controller to define the duty cycle of the boost converter.

In this control, the braking resistor will work if the braking power is higher than the maximum battery charge power. Then, the braking resistor absorbs the difference between them. 4.2. Fuzzy logic based control
The other control used for the EMS of tramway is based on fuzzy logic controller, which is quite suitable for the control of hybrid energy systems. Fuzzy logic facilitates the representation in digital computers of this kind of knowledge through the use of fuzzy sets. From this basis, fuzzy logic uses logical operators to collate and integrate this knowledge in order to approximate the kind of reasoning common in natural intelligence ( Abonyi, 2003 ).
The knowledge of an experienced human operator may be used as an alternative to a precise model of the controller process.
While this knowledge is also difficult to express in precise terms, an imprecise linguistic description of the manner of control can usually be articulated by the operator with relative ease. This linguistic description consists of a set of control rules that make use of fuzzy propositions ( Lee, 1990; Jurado, 2005 ).
Fuzzy systems have been applied to a variety of fields ranging from control, signal processing, c ommunications, integrated circuit manufacturing, and expert systems to business, medicine, psychol-ogy, etc. ( Erdinc et al., 2008 ). However, the most significant applications have concentrated on control problems, such as the energy management of renewable energy (solar or wind energy) or hybrid energy systems (hybrid ve hicle). An example of this use is presented in Altas and Sharaf (2008 ), where a fuzzy logic controller is developed to ensure the operation at the maximum power point of a stand-alone photovoltaic arra y. Other example is explained in
Kamel et al. (2010 ), where a fuzzy logic pitch controller and an energy storage ultracapacitor are proposed and developed to smooth the output power of a wind turbine. Furthermore, the fuzzy logic is also used in the energy management of hybrid vehicles. In based on FC. In this paper, the fuzzy logic directly provides the FC reference current and changes the battery reference current. Other examples of applications of fuzzy logic in hybrid vehicles are the FC hybrid vehicle presents two ESS (battery and ultracapacitor) and the EMS uses similar input and output variables to those used in the present work. In both cases, t he input variables are the power demanded by the hybrid vehicle, the battery SOC and the ultracapacitor SOC. The output variables are the power required from the FC system and the power required from the ultracapacitor.
The fuzzy logic controller presented in this paper has two input variables and one output variable. The input variables are the load power demanded by the tramway ( P load ) and the battery SOC. The output variable is the reference power from the FC ( P fc _ ref
The power required from the battery is calculated as difference between the total power demanded by the tramway and the power required from the FC system. The difference between FC reference and actual power is used in a PI contr oller to generate the duty cycle of the boost converter. This control scheme is depicted in Fig. 5 .
The performance of an energy management strategy based on fuzzy logic is determined by the number and shape of the membership functions of each fuzzy variable, and by the selection of rules, which are essential for increasing the vehicle efficiency and maintaining the battery SOC. The membership functions of the input and output variables are shown in Fig. 6 . The specification of the rules of the fuzzy logic controller depends on the designer knowledge about the supplies and traction device constraints; intuitive and practical aspects regarding the propul-sion mechanism dynamic behavior; and successive experiments to assure the process X  X  robustness and reliability ( Ferreira et al., 2008 ). The rule base is shown in Table 2 . For example, if the load power demanded by the tramway is  X  X  X B X  X  (positive big) and the 0 20 40 60 80 100 120 140 160 180 200 220 1 0.5 0 1 0.5 0 1 0.5 0 battery SOC is  X  X  X  X  X  (medium), then the power required from the
FC system is  X  X  X B X  X  (very big). 5. Simulation results and discussion 5.1. Simulation results
The proposed hybrid system and two control strategies (cascade and fuzzy logic) have been tested for the real drive cycle of the Metro Centro tramway. It has been simulated the outward route. Simulation results are shown next.

Firstly, the tramway speed and the mechanical power required by the tramway during this route are depicted in Fig. 7 . The complete cycle followed by the tramway is basically composed of four trips and four stops. The first one lasts about 60 s. It consists of accelerations and decelerations, during which the tramway reaches a maximum speed of 50 km/h. The following two trips are very similar, during which the tramway maintains a constant speed of 15 km/h throughout the whole trip. The first one lasts 80 and 110 s the second one. The three stops last approximately 20 s.
The fourth trip, which lasts 65 s, is similar to the first trip, with accelerations and decelerations, during which the tramway reaches a maximum speed of 50 km/h.

Fig. 8 shows the voltages at the FC and dc bus for each control strategy and, moreover, the duty cycle evolution. Significant differences can be observed between the two control strategies at 10 s, between 40 and 75 s and also at 330 s. As shown in Fig. 10 , where the FC and battery powers are represented, these voltage differences occur when the FC power differences are significant between both control strategies.

Moreover, the highest dc bus voltage drop occurs at 40 s. In this moment, the tramway demands high power (near to 500 kW), and the battery has to provide its maximum power, decreasing abruptly its SOC.

Fig. 9 shows the load power and the power dissipated in the braking resistor. In particular, it can be observed that the tramway controlled by the cascade control present higher power dissipated in the braking resistor. It is due to that the fuzzy controller decreases the FC power when the battery SOC achieves the desired value (60%) or a higher value and, moreover, the tramway generates a high regenerative power as observed in Fig. 9 . For this reason, the battery does not reach its charge limit and the braking resistor does not need to dissipate energy. It happens approxi-mately at 6 and 319 s. Between 40 and 48 s, the braking resistor works for both strategies, as can be observed in Fig. 9 c. In this case, the fuzzy controller cannot avoid that the battery reaches its charge limit and therefore, the braking resistor operation.
Fig. 10 shows the FC and battery powers. Although they present certain differences it can be observed that they are very similar.
Fig. 11 shows the battery SOC. As observed for both controls, the SOC evolution is similar and the battery SOC is maintained near the desired value (60%). However, the cascade control reaches a SOC closer to the desired value, as demonstrated by its lower mean square error (MSE).
 Fig. 12 represents the total hydrogen mass consumption of the FC system, the hybrid vehicle (HV) efficiency ( Z HV ) and the FC efficiency ( Z FC ). The two last parameters have been calculated with next expressions ( Chun-Yan and Guo-Ping, 2009 ) Time (s) Time (s) where M H 2 is the total hydrogen mass consumption of FC system, E low , H 2 is the lower heating value of hydrogen ( E 120 MJ/kg), P hv is the traction power of the hybrid vehicle, P FC power, N is the number of FC, and P battery is the battery power.
As observed in Fig. 12 , the hydrogen mass consumption is very similar in both strategies, but with a little higher consumption in case of the cascade control. As regards the HV efficiency, the fuzzy control gets better efficiency (about 46%) than the cascade control (43%). In the case of FC efficiency, it is also higher for fuzzy control (approximately 47%) than cascade control (about 45%).
Furthermore, both efficiencies are better for fuzzy control along the drive cycle.

Finally, Fig. 13 shows the degree of discharge (DOD) which represents the variation of the actual voltage relative to the average voltage in the battery. Maximum and minimum values of DOD occur for the cascade control.

Regarding the simulation time, the cascade control is about 8 times faster than fuzzy control (cascade control takes 10 s to finish the simulation and 82 s for the fuzzy control, both of them using the same CPU). Fuzzy control Cascade control Fuzzy control
Cascade control 5.2. Discussion
Finally, the proposed control strategies and the results of this work are compared with those of other investigations in order to place this work in perspective with other works in the field of energy management of hybrid system.

References ( Li et al., 2009; Li and Liu, 2009; Xu et al., 2009 ) present a similar configuration to that used in our work: control strategies for hybrid vehicles powered by FC and battery, in which the battery is directly connected to the dc bus. The hybrid system proposed in each case is the following one: a 40-kW PEM FC and a Ni-MH battery in ( Li et al., 2009 ), a 30-kW PEM FC and a lead acid battery in Li and Liu (2009 ), and two PEM FC stacks with a rated power of 40 kW and a Ni-MH battery in Xu et al., (2009) ). based on fuzzy logic control, which determine the operating point of FC converter, according to the load power and the battery SOC. Xu et al. (2009) propose an adaptive supervisory control Time (s) Time (s) Fuzzy control Cascade control Time (s) Time (s) strategy for a hybrid city bus, which takes into account the vehicle accessorial power, the charge-sustaining battery, and the FC durability. The results of these works demonstrate the capability of the proposed hybrid system to provide the power demanded by the load during the driving cycle. However, the use of a battery directly connected to the dc bus leads to that too many battery cells that must be connected in series to achieve the high voltage required by the high-power traction motors (for higher effi-ciency), and then, the volumetric efficiency of the battery comes down. However, this configuration only allows the direct control of FC power flow via the FC converter, so that only the FC acts as an active-control power source so the control strategy is simplified and adding another converter for the battery is avoided. The battery acts as a passive-control power source, since its power flow is controlled indirectly.

Furthermore, the fuzzy logic is also used in the energy management of hybrid vehicles. In Ferreira et al. (2008 ), the fuzzy fuzzy logic directly provides the FC reference current and changes the battery reference current. Other examples of applications of fuzzy logic in hybrid vehicles are presented in Erdinc et al. (2009) and Gao et al. (2008 ). In both works, the FC hybrid vehicle presents two ESS (battery and ultracapacitor) and the EMS uses similar input and output variables to those used in the present work. In both cases, the input variables are the power demanded by the hybrid vehicle, the battery SOC and the ultracapacitor SOC. The output variables are the power required from the FC system and the power required from the ultracapacitor.

Reference ( Bauman and Kazerani, 2008 ) compares three config-urations for a hybrid vehicle: FC X  X attery, FC X  X C, and FC X  X attery X 
UC. The hybrid systems based on FC  X  X attery and FC X  X C present the battery or UC directly connected to the dc bus, whereas in case of
FC X  X attery X  X C, the battery is connected to the dc bus through a bidirectional converter and the UC directly connected to the dc bus.
Results show that the FC X  X attery configuration is the best option to optimize the powertrain cost and the total mass of the vehicle, whereas the FC X  X attery X  X C configuration can extend the battery lifetime due to less battery stress. 6. Conclusions
Until relatively recently, the hybrid systems powered by FC and batteries have not been considered interesting for application to locomotives, railcar o tramways. This paper presents a configuration for a fuel cell (FC) X  X attery powered hybrid system for the Metro Centro tramway (400 kW) from Seville, Spain. This new hybrid system is based on two PEM FC of 127 kW connected in parallel as primary energy source and a Ni-MH battery as secondary energy source. The aim of this paper is to perform a comparison study of two different control strategies for the energy management during the real driving cycle of the actual tramway. One of the controls is based on a fuzzy logic control -50 -40 -30 -20 -10 10 20 30 40 50 Degree of Discharge DOD (%) which has been designed specifically for this tramway and developed by several tests. The other control presents a cascade control structure with three control loops.

Simulations were performed that showed the validity of both control strategies for the energy management of the Metro Centro tramway. When both controls were compared, it was observed that the fuzzy control had the following advantages with respect to the cascade control:
Maximum and minimum voltages achieved at the dc bus are lower, which is better to supply the inverters of the electrical motors.

The battery charge and discharge levels are lower (lower maximum and minimum values of battery DOD), so that the battery life increases.

The braking resistor dissipate less power because of the FC power is better adapted to the power required by the vehicle and the battery SOC.

The consumptions and efficiencies obtained are slightly better: The hydrogen mass consumption and the energy dissipated in the braking resistor are slightly lower, and the HV and FC efficiencies are slightly higher.

On the other hand, the advantages of the cascade control are as follows:
Computation time is significantly reduced: the cascade strategy is about 8 times faster than fuzzy.

The implementation of the cascade control is simpler than fuzzy control. The fuzzy control needs more experience and knowledge about the system, whereas the cascade control only needs a correct adjust of the controller parameters.
 Acknowledgements
This work was supported in part by Hynergreen Technologies S.A. and by the Cenit Program from the Centre for the Development of
Industrial Technology, Spanish Mi nistry of Science and Technology, under the Ecotrans research project. A National Industries Con-to which belongs Hynergreen Technologies, is working in this project for the development of ecological technologies for urban transport. References
