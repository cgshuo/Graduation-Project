 1. Introduction
Hybrid systems contain continuous and discrete dynamic parts. As a consequence, models of hybrid systems should be enough illustrative to describe both continuous and discrete variables and interactions between them. Several approaches have been proposed in the literature to address the modeling problem of hybrid systems. These approaches range from generic formulation to tailor-made methods for certain sub-classes of hybrid systems, predominantly for switched linear, affine, or quadratic dynamics ( Stursberg, 2004a , b ). Model predictive con-trol (MPC) is regarded as the most appealing optimization-based control approach in chemical process industries, enabling the designer to handle the process constraints, time-delay and multi-variable process dynamics. Two popular dynamic model formula-tions for model predictive control (MPC) of hybrid systems are known as mixed logical dynamical (MLD) ( Bemporad and Morari, 1999 ) and piecewise affine (PWA) ( Sontag, 1981 ). Obtaining the MDL models of the hybrid systems can be facilitated with the
HYSDEL Toolbox ( Torrisi and Bemporad, 2004 ). However, effi-ciency of the resulting optimization solution, based on mixed-integer linear or quadratic programming (MILP/MIQP) ( Bemporad and Morari, 2000 ), is derogated and become computationally too demanding with increase in number of discrete states. To search for a reduction in the computational burden, ( Thomas et al., 2004 ) proposed a partitioning scheme in the state-space domain and
Potocnik et al. (2004) introduced a hybrid predictive control algorithm which is characterized by an evolution tree with building and pruning features based on a reachability analysis.
Camacho et al. (2010 ) addressed the general stability and solution issues of the optimization problem, being encountered when MPC is applied to hybrid systems.

Identification of hybrid systems can be categorized into the variants of the mixed-integer programming (MIP) approach ( Roll 2003 ; Tabatabaei-pour et al., 2006 ), the bounded-error approach 2008 ) proposed an offline global model for a class of hybrid systems using a feed-forward neural network (NN). Karer et al. (2007 ) presented the second major contribution in identifying an unknown hybrid system with discrete inputs by a nonlinear
Takagi X  X ugeno (TS) fuzzy model formulation. The developed fuzzy model was then used for model predictive control strategies ( Karer remains in the adaptive nonlinear control of nonlinear hybrid systems with continuous and discrete inputs/outputs.

The first major contributed work in this paper addresses the foregoing modeling challenge by proposing an online model identification approach based on a fuzzy clustering of the con-tinuous inputs/outputs and discrete inputs to ultimately facilitate developing a new demanding model predictive control for nonlinear hybrid systems in an adaptive context. This leads to a self-organizing eTS fuzzy clustering identification method to adaptively generate descriptive eTS fuzzy rules in response to time-varying hybrid system dynamics without requiring a priori knowledge of the system. For this purpose, an evolving Takagi X 
Sugeno (eTS) fuzzy model structure is identified online to capture the system dynamic behavior using a recursive potential cluster-ing scheme, leading to estimation of focal points or antecedent parameters in the generated fuzzy rules ( Angelov and Filev, 2004 ). A new rule-base reduction mechanism has been presented to control number of the generated rules, leading to a more compact and efficient rule base. Firing level of each rule in the set of identified MISO fuzzy models is monitored as an evaluating measure to identify the inactive rules. A rationalized scheme is proposed which incorporates memory to consider each rule activation (RA) record in past with respect to a low threshold value. Finally, a recursive least-squares (RLS) algorithm is utilized to estimate the linear parameters associated with each generated rule consequent. The generated online fuzzy model of the non-linear hybrid system can then be utilized for adaptive control applications.

MPC-based optimization of hybrid systems poses a challenging issue since the discrete dynamics introduces discontinuities with which gradient-based solvers often cannot cope very well ( Tometzki et al., 2006 ). Stursberg and Engell (2002 ) presented an MPC-based scheme using a mixed-integer linear programming (MILP) approach. The solution performance of the resulting optimization problem, however, suffers from large number of auxiliary variables to encode the switching dynamics ( Till et al., 2004 ). Alternatively, a graph search algorithm with embedded nonlinear programming (NLP) was proposed in Stursberg (2004a , b ). But, the non-smoothness arising from the switching can lead to a lack of convergence in the NLP step. Genetic algorithm (GA) provides an efficient alternative means to tackle such optimization problems. The idea of using GA in hybrid systems is not new. Olaru et al. (2004 ) introduced a method that solves the optimization problem by GA within an MPC scheme.
The method is restricted, however, to MLD-systems, i.e. discrete-time piecewise affine systems. Another MPC-based scheme has been described in Tometzki et al. (2006 ). The method utilizes GA for hybrid systems formulated by an automaton model. Nunez et al. (2009 ) introduced a fuzzy model approach, based on combining fuzzy clustering and principle components analysis, to develop a hybrid predictive control scheme. The paper, how-ever, uses the principal eigenvectors of the covariance matrices of the clusters to model the system dynamics in an off-line manner.
All the previous works related to hybrid predictive control are almost based on offline system dynamic models. However, majority of industrial processes are prone to potential time-varying dynamic behavior, necessitating online capability in modeling to be adapted with the occurred dynamic changes. This paper presents a novel receding horizon adaptive MPC methodol-ogy for nonlinear hybrid systems with mixed inputs as the main new contribution. The proposed methodology uses a new online identification algorithm to estimate an eTS fuzzy model with adaptive structure and parameters as new system input X  X utput data become recursively available in real time. A new online approach is incorporated to control number of the generated eTS fuzzy rules. This leads to a set of simpler eTS multi-inputs and single-output (MISO) fuzzy models without sacrificing the aimed accuracy. This maintains rules to be generated faster in the beginning of the identification process due to a priori model uncertainty and dynamic response fluctuations. The identified
MISO fuzzy models are then forced to become more tuned by eliminating some of the preliminary inactive identified rules. A new adaptive NMPC methodology is then developed by combination of the online eTS fuzzy identified model and the NMPC design procedure. In this scheme, there is no more need to have the real model dynamics of the hybrid system to design the NMPC controller and the identified eTS MISO fuzzy models are recursively updated to provide the required dynamic model information. The developed NMPC objective function is then solved using a genetic algorithm (GA) to adaptively generate the necessary optimal control moves. This requires to recursively solve a nonlinear optimization problem in each iteration to determine both the discrete and continuous inputs on the basis of the identified nonlinear fuzzy model.

The paper is organized as follows. In Section 2 , the proposed online model identification is presented using an eTS fuzzy clustering approach. A new adaptive MPC methodology is intro-duced in Section 3 for hybrid systems with mixed inputs. In addition, a GA is presented to solve the online MPC nonlinear optimization problem with mixed controls. The performance of the proposed adaptive MPC methodology is comparatively demon-strated on the start-up procedure of a CSTR benchmark simulation 2. Online fuzzy identification of a class of hybrid systems with mixed inputs 2.1. Identification problem statement
The proposed identification approach addresses a class of nonlinear hybrid systems with mixed inputs which consist of a combined set of binary discrete inputs ( u d A f 0 , 1 g m the number of discrete inputs), continuous inputs ( u c A is the number of continuous inputs) and continuous outputs ( y A R m y ; m y indicates the number of continuous outputs). These systems can be represented by a collection of coupled multi-input, single output (MISO) models in discrete-time for-mulation. The frequently used Nonlinear Auto-Regressive with eXogenous input (NARX) model structure presents a suitable framework to establish a general nonlinear functional relation for each MISO model as follows: y  X  k  X  1  X  X  f i  X  x i  X  k  X  , y i  X  k  X  X  X  E i  X  k  X  , i  X  1 , ... , m where f i  X  U  X  represents an unknown nonlinear function, expressing the dynamic model for the i th output, E i is an additive modeling error to be minimized, x i is the regressor vector, given as follows and y i denotes the vector of free model parameters to be identified: x  X  k  X  D  X  y T  X  k  X  ,  X  y T  X  k 1  X  , ... , y T  X  k n yi  X  , u u  X  k 1  X  , ... , u T d  X  k n di  X  X  2  X  where y , u c and u d show continuous output vector, continuous input vector, and discrete input vector, respectively. n yi indicate the number of assumed delays in the continuous output, the continuous input and the discrete input vectors, respectively. 2.2. Online identification using an adaptive eTS fuzzy model
The nonlinear hybrid system characterized by Eq. (1) can be approximated by an adaptive eTS fuzzy model. For this purpose, each eTS fuzzy rule can be represented by the following generic formula-tion in which the antecedents are organized in the conjunctive form:
R i : if y 1  X  k  X  is A and u c 1  X  k  X  is C  X  i 1 and y and u cmc  X  k  X  is C  X  imc and u d 1  X  k  X  is D  X  i 1 and y and u dmd  X  k  X  is D  X  imd then y  X  k  X  1  X  X  a  X  i y  X  k  X  X  b  X  i u c  X  k  X  X  g  X  i u d  X  k  X  X  B where the antecedents describe hybrid fuzzy regions in the space of input variables of the hybrid eTS fuzzy model. Here,
A  X  j  X  1 , ... m y  X  , C  X  ij  X  j  X  1 , ... , m c  X  and D  X  antecedent fuzzy sets of the  X  th rule in the i th MISO model. a  X  , b i and g  X  i represent vector polynomials in q 1 (i.e., backward shift operator) with dimensions of 1  X  n a m y  X  ,1  X  n b m and 1  X  n g m d  X  , respectively, and B  X  i is the bias term. m indicates the number of rules in the i th MISO model. Thus, the fuzzy identification problem will be concerned with the determi-nation of an appropriate number of relevant rules in the hybrid fuzzy model which naturally depends on number of fuzzy membership functions assumed for each antecedent variable.
The then-parts, i.e., consequences of the eTS rules in Eq. (3) are affine functions of the hybrid fuzzy model inputs which can be shown as follows: y a  X   X  X  b  X   X  X  g  X  therefore, the i th-output of the hybrid fuzzy model in Eq. (4) can be rewritten in the following compact form: y  X  k  X  1  X  X  P  X  i  X  k  X  X  X  k  X  X  5  X  where vector P  X  i contains all the consequent parameters of the hybrid fuzzy model corresponding to the  X  th hybrid rule ( R
While, X  X  k  X  denotes the regressor vector in time-step k , given by
Thus, the resulting eTS fuzzy model for each MISO model formulation can be calculated by the following weighted aver-aging of individual rule contributions: y  X  k  X  1  X  X   X  th rule and t  X   X  P n j  X  1 m  X  j  X  X j  X  ;  X  n  X  my n a denotes the firing level of each rule, defined on the basis of Cartesian product or conjunction of respective fuzzy sets.
Eq. (8) can be rewritten in the following regression form: y  X  k  X  1  X  X  c T  X  k  X  y i  X  k  X  ; i  X  1 , ... , my  X  9  X  where y
Thus, the online identification procedure of the resulting eTS fuzzy model consists of two distinct steps. In the first step, the eTS fuzzy model structure is determined in terms of the required number of fuzzy rules and sets for each output ( m i ) using an online potential clustering approach ( Angelov and Filev, 2004 ). In the second step, the consequent parameters ( y i ) of the generated rules are adaptively tuned by a recursive least-squares (RLS) method. 2.2.1. eTS model structure identification using a potential clustering approach
This paper introduces a self-organizing eTS fuzzy clustering identification method to adaptively generate descriptive eTS fuzzy rules in response to time-varying hybrid system dynamics without requiring a priori knowledge of the system. This model structure identification step includes estimation of the focal points of the rules based on a fuzzy potential clustering approach ( Angelov and Filev, 2004 ). In this methodology, the rule-base is assumed to be gradually evolving. Therefore, the number of rules varies with the most recent information inherent in the regressor variables. The online potential clustering procedure starts with the first input X  X utput data point, leading to establishment of the first cluster and rule using the data coordinates as the focal point of the cluster. Following the procedure from the next data point onwards, the potential of the new data points, X ( k ) is calculated recursively as follows:
P  X  X  X  k  X  X  X  where P i X ( k ) represents the calculated potential of the new data point X ( k ) at time k , corresponding to the i th MISO fuzzy model.
P hi a  X  b g  X  X  X  k  X  X 
 X  ;  X  k n g  X  1 of the distance between two data points at different sample times n and k on the axis of X . This function is monotonic and inversely proportional to the distance and hence enables updating the coordinates of the focal points of the existing clusters by the following recursive equation:
P  X  X n l  X  k  X  X  X   X  k 1  X  P i  X  k 1  X   X  X is updated for each MISO fuzzy model at time k.

The evolution of each fuzzy MISO model structure (i.e., rule base) is then conducted by the following two basic principles, based on the comparison of the new data potential to the updated potential of the existing rule centers. (a) Rule generation criterion
If the potential of the new data point is higher than the potential of the existing cluster centers, i.e.,
P i  X  X  X  k  X  X  4 max ml
Then, the new data point is accepted as a new center and a new rule is added to the rule-base with the following char-acteristics: (b) Rule replacement criterion
If in addition to the condition expressed by Eq. (14) , the new data point is close to an old existing rule center, based on the following measure:
P i  X  X l  X  k  X  X  replaces the closest center using the following substitutions: ln  X  X l , P i  X  X n ln  X  X  P i  X  X l  X  X  17  X  2.2.2. eTS fuzzy consequent parameter identification using a RLS estimation approach The generated fuzzy MISO model structures evolve gradually.
This influences all the existing rule-base structures and hence the straightforward application of the RLS approach is not applicable.
A proper resetting of the covariance matrices  X  C i , i  X  1 , ... , m added to the rule-base. Then, the estimation of consequent parameters is conducted by the RLS algorithm using the following recursive procedure: 1. Initialize the algorithm with y i  X  0  X  X  0 , C i  X  0  X  X  O I where O 2. Form the new regressor vector c T  X  k  X  at each sampling time. 3. Evaluate the Kalman gain vector: 4. Update the consequent parameters 5. Update the covariance matrix
However, when a rule is replaced by another one, which has antecedent parameters close to the rule being replaced, the parameters and covariance matrices are inherited from the previous step. 2.2.3. A new rule reduction approach
A new online approach is incorporated to control the number of generated rules. The main objective is to attain a set of reduced or simpler eTS MISO fuzzy models compared to the original eTS fuzzy identification approach with the same accuracy. This is due to the fact that in the beginning of the identification process, rules are generated faster due to the model uncertainty and dynamic response fluctuations. Therefore, when the identified MISO fuzzy models become more tuned, their rule-bases may be ended up with some inactive identified rules.

In order to identify the inactive rules, firing level  X  l in the set of identified MISO fuzzy models can be monitored as a measure to evaluate its activation. A simple approach is based on the comparison of this measure as the rule activation (RA) with respect to a low threshold value. When its valueislessthanthethreshold value, the corresponding rule can be deleted. But, this method may cause oscillation in rule creation X  X eletion procedure due to its instantaneous nature. A more rationalized scheme is proposed which incorporates memory to consider the rule activation record in past, as well. This scheme can be formulated as follows: RA  X  k  X  X  X  1 g i l  X  RA i l  X  k 1  X  X  g i l l i l , l  X  1 , ... , m in the l th MISO fuzzy model at time k .0 o g i l r 1representsthe assigned forgetting factor, determining the memory time length of proposed rule-reduction criterion can be expressed by the follow-ing logic: if RA i l  X  k  X  o x l , then remove the lth rule , where x l indicates the threshold value corresponding to the l th rule.
 To achieve a smoother rule production-reduction procedure,
RA  X  k  X  is reset to an initial value once a rule is deleted. 3. Adaptive nonlinear model predictive control (NMPC)
The MPC methodology requires a dynamic model of the system to predict its future evolution with reasonable accuracy over a finite prediction horizon. Most of the developed MPC methods for hybrid systems are based on a priori knowledge of the exact system dynamic model. In this work, it is assumed that there is no a priori knowledge of the system model and hence the MPC optimization is developed based on the online identified eTS
MISO fuzzy models. Therefore, the optimization problem is no longer a linear problem. A genetic algorithm (GA) is used to continuously solve this nonlinear optimization problem. In con-trast to the other conventional searching methods that move sequentially from one point to another, genetic algorithms start simultaneously from many points to climb many peaks in parallel. Accordingly, these algorithms are less susceptible to getting stuck at local minima ( Goldberg, 1989 ; Mitchell, 1996 ). 3.1. Development of NMPC optimization control scheme
The NMPC optimal problem can be formulated as follows to within a finite control horizon time (H): min
J  X f u g H 1 0 , ^
X  X  k  X  X  D min where 99 U 99 2 represents the 2-norm, Q 1 and Q 2 are weighting matrices, having the symmetric positive semi-definite and sym-metric positive definite properties, respectively. h  X  0 , ... , H 1 ahead estimated state, which is obtained from the identified eTS fuzzy model. u refers to both continuous and discrete hybrid system inputs. Hence, the optimal control sequence, minimizing the cost function in Eq. (23) , consists of both continuous  X  u discrete  X  u d  X  sequence inputs as f u g 0  X f u  X  0  X  , u  X  1  X  , ... u  X  H 1  X g X 
However, only the first vector of the optimal sequence, i.e. step( k ). In the next time step, a new optimal sequence is determined to realize the receding horizon adaptive MPC approach. Thus, the resulting optimization problem can be expressed in terms of the optimal cost function described in Eq. (23) , subject to the following constraints: ^
X  X  0 9 k  X  X  ^ X  X  k  X  X  f fuz  X  X  X  k  X  , y  X  k  X  X  ^
X  X  h  X  1 9 k  X  X  f fuz  X  X  X  h  X  1 9 k  X  , y  X  k  X  X  u r u  X  k  X  h  X  r u max , h  X  0 , ... , H 1
X r ^ X  X  k  X  h 9 k  X  r X max , h  X  0 , ... , H 1 ^
X  X  k  X  H 9 k  X  X  X f where f fuz  X  U  X  denotes the online identified eTS fuzzy model, f u , u max g and f X min , X max g represent hard bounds on the inputs and states, respectively. 3.2. Adaptive NMPC methodology
The proposed adaptive NMPC methodology involves the com-bination of the online eTS fuzzy identification and the NMPC design procedures, summarized by the general algorithm in Table 1 .

The first part of the algorithm deals with the initialization section which provides initial values for both the identification and NMPC control sections. In this case, there is no more need to have the real model dynamics of the hybrid system to design the NMPC controller and the identified eTS MISO fuzzy models are updated to provide the required information. In the NMPC design section, a genetic algorithm (GA) is employed to generate the optimal control moves f u g H 1 0  X f u  X  0  X  , ... , u  X  H 1  X g . 3.3. NMPC optimization using GA
Genetic algorithm (GA) is an appropriate searching method for solving the constrained optimization problem with highly complex combinatorial features. In this work, a GA is used as a stochastic searching method to solve the constrained NMPC optimization problem formulated by Eqs. (23) and (24) . GA is based on the concepts of natural evolution including reproduction, crossover, mutation, and survival of the fittest ( Goldberg, 1989 ). In formula-tion of GA, a population of Nind individuals with length of Lind is generated. This gives the set of all potential solutions or chromo-somes which can be represented by a chromosome data matrix structure in iteration i ,denotedby Chrom i . The structure of each chromosome in this work looks different due to the hybrid nature of the system inputs. That is, each individual s represents a combination of continuous and discrete input trajectories. Thus, the i th individual can be defined by the following codes: s in which n denotes the iteration number of the GA and the continuous inputs  X  u c  X  are represented by real-valued numbers b discrete values of u d .

The GA is started with an initialization step to set the required free parameters. This step includes the initialization of the current hybrid system state estimate ^ X  X  k  X  provided by the identified eTS fuzzy model, the desired control horizon ( H ), the maximum allowable number of loop iterations ( n max ) to terminate the GA procedure, the size of chromosome data matrix (Nind, Lind) for each generation, the desired system reference trajectory ( r ), and the most recent estimated parameters of the identified eTS fuzzy is generated randomly. At every iteration ( n ) of the GA, the i th control input trajectories, i.e. f u i c g X f u i in the n th chromosome data matrix  X  Chrom n  X  . The fitness of each chromosome in the current population is determined by the following evaluating function:
F  X  ^
X  X  k  X  X  X  aJ  X  ^ X  X  k  X  , f u g H 1 0  X  X  b  X  26  X  in which J is the optimization objective function, a is a positive scaling factor for maximizing optimization problems and negative for minimizing optimization problems. The offset b is also used to ensure that the resulting fitness values are non-negative.
Upon assessing the fitness of the entire chromosomes in the current population  X  Chrom n  X  , the most fitted ones are selected as next generation  X  Chrom n  X  1  X  . In this work, the roulette wheel approach ( Goldberg, 1989 ; Mitchell, 1996 ) is used to select a subset of the solutions. Each chosen chromosome is separated into two sections of rs and bs corresponding to continuous and discrete inputs of the hybrid system, respectively. This is due to the fact that binary and real operators are done differently in the
GA evolution procedure. A multi-point crossover scheme with m  X  5 crossover positions and probability of w c A  X  0 , 1 is utilized for the binary individuals bs 1 and bs 2 . The crossover duals) are chosen at random with no duplicates, sorting into an ascending order. The bits between successive crossover points are then exchanged between the two parents to produce two new offspring. This multi-point crossover scheme allows the most fitted parts of the chromosome representation which are not necessarily contained in the adjacent substrings to be utilized ( Booker, 1987 ). Furthermore, the disruptive nature of the multi-point crossover scheme appears to encourage the exploration of the search space, rather than favoring the convergence to highly fit individuals early in the search, leading to a more robust search ( Spears and De Jong, 1991 ).

Intermediate recombination is a method of producing new individuals rs 1 n and rs 2 n around and between the values of the parent individuals rs 1 and rs 2 ( M  X  uhlenbein and Schlierkamp-
Voosen, 1993 ) for the real-valued encoding parts of the individual structure. Offspring are produced according to the rule of rs 1 n  X  rs 1 a  X  rs 2 rs 1  X  where a is a scaling factor chosen uni-formly at random over some interval, typically [ 0.25, 1.25]. In this way, each variable in the offspring is the result of combining the variables in the parents according to the preceding rule expression with a new a chosen for each pair of parent genes.
The mutation operator is used to randomly change genes of the two children. Each binary and real value of the individual has a separate mutation operator. Each gene of a child bs i is changed with the number 9 bs i 9 of genes of bs i by a probability w
It should be noted that the modified real-valued genes a 0 created from the original gene a j according to a j 0  X  a m n denotes a realization of a normally distributed random variable with the expected value of 0 and decreasing variance over the iteration n . Whereas, the binary-valued genes are over, and mutation is repeated until the number of individuals in two cascaded generations, i.e. Chrom n  X  1 and Chrom n , is equal.
Otherwise, after a predefined number of generations ( n max
GA optimization procedure is terminated and the input trajectories encoded by the individual of Chrom n max with the highest fitness value determine the optimal solution of the NMPC optimization problem at the current time sample.

Rudolph (1994 ) presents theoretical results to clarify the fact that the GAs converge to the global optimum when the best solution is maintained in the population. Obviously, this result cannot be guaranteed for the limited amount of time between two samples in online applications. However, the algorithms can find a solution which is approximately optimal due to their probabilistic nature ( Sarimveis and Bafas, 2003 ). This is in con-trast to traditional optimization techniques which cannot guar-antee even the calculation of a feasible solution due to the complexity of the optimization problem ( Nunez et al., 2009 ). As a result, using the GA optimization approach is justified in this work which involves a complex mixed integer and nonlinear programming (MINLP) problem. 4. Simulation case study
Start-up of continuous reactors is of great interest, since the risk of incidents is higher during start-up than steady-state operation. The performance of the proposed adaptive model predictive control methodology has been demonstrated for such a challenging problem on a CSTR benchmark hybrid system ( Stursberg and Panek, 2002 ). The simulation tests are implemen-ted in a digital computer having a core 2 Duo CPU 2.53 GHz with 3.45 GB of RAM using MATLAB 7.6 software package. For this purpose, the basic time unit is in second (s) and the sampling time is taken to be equal to 100 s. 4.1. CSTR benchmark description
The CSTR system consists of a tank equipped with two inlets, a heating coil, a cooling jacket, a stirrer and one outlet, as depicted in Fig. 1 . The inlets feed the reactor with two dissolved substances
A and B which react exothermically to form a product D. The system has five input variables which can be classified into the following two discrete and continuous inputs:
The discrete input vector u d  X  X  F 1 F 2 S H T in which F represent the two inlet flows and S H denotes the on or off status of the heater. To be physically reasonable, F 1 and F have the same status all the time, indicating that inlet flows of the two substances A and B are simultaneously either on or off.
The continuous input vector u c  X  X  F 3 F c T which comprises the outlet flow  X  F 3  X  and the cooling flow  X  F c  X  .
 The system state vector is defined as x  X  X  V R T R C A C B Where V R represents the volume of the liquid in the tank, T denotes the temperature inside the reactor tank, C A and C indicate the concentrations of the two substances A and B , respectively, in the tank.

Depending on the continuous state, the hybrid system can be generally written as _ x  X  f  X  z , x , u c , u d  X  where z  X f z V R A  X  0 : 1 , 0 : 8 g while z 2 is given by f x 9 x A X : V
For z 1 with V R A  X  0 : 1 , 0 : 8 : f I :  X  f  X  z , x , u c , u d  X  X 
For z 2 with V R A  X  0 : 8 , 2 : 2 : f II :  X  f  X  z , x , u c , u d  X  X  f I 1 , f I 2  X  S H k 6 with q  X  C A C 2 B exp  X  k 5 = T R  X  and appropriate constants of T the model has three forbidden regions given by F 1  X  z , f x 9 x A X : T R Z 360 g X  , F 2  X  X  z 2 , f x 9 x A X : T f x 9 x A X : V R Z 1 : 8 g X  . 4.2. The CSTR start-up optimization objective
The optimization task is to drive the CSTR hybrid system from an initial state represented by  X  z 1 , x 0  X  X  0 : 1 , 300 , 0 , 0  X  corresponds to an initially empty reactor, into a status of desired operating region in which the liquid volume V R , the temperature T , and the production rate in terms of C A and C B have reached the desired nominal values. In other words, the target location is specified by z 2 and a hyper-ball with radius 0.1 around the
X
CSTR should be guided by the optimal input trajectories to drive it from the initial state  X  z 1 , x 0  X  to the target state  X  z violating the forbidden regions expressed by T R Z 360 and V 1 : 8. 4.3. Simulation test study for CSTR time-invariant dynamic model eTS MISO fuzzy models were used to identify the CSTR process dynamics at each sampling period of 100 s. The identification was carried out with the following input regressor vector to each eTS MISO fuzzy model: X  X  k  X  X  X  u T  X  k  X  u T  X  k 1  X  u T  X  k 2  X  u T  X  k 3  X  x where u  X  k  X  X  X  u c  X  k  X  u d  X  k  X  T  X  X  F 3  X  k  X  F c  X  k  X  F 1 and x  X  k  X  X  X  V R  X  k  X  T R  X  k  X  C A  X  k  X  C B  X  k  X  T Figs. 2 X 5 illustrate identification results obtained for four eTS
MISO fuzzy models, considering V R , T R , C A and C B as the model output variables. Observations of Figs. 2 (a), 3 (a), 4 (a) and 5 (a) demonstrate the accuracy of the identified eTS MISO fuzzy models to predict the behaviors of the CSTR outputs in real time.
This conclusion can be confirmed by analysis of the plots of modeling error or residuals or their equivalent distribution plots 4 (d) and 5 (d) illustrate the time evolution of the identified eTS MISO fuzzy model structures in terms of their time X  X istory plots of the generated fuzzy rules during the online identification. As shown, the identification starts with no a priori knowledge of the CSTR dynamics. Thus, the MISO eTS fuzzy models adapt their structural complexities with the real-time CSTR dynamic beha-vior. It is readily observed that the resulting fuzzy models are quite simple and compact for any real-time control applications. The proposed adaptive MPC controller utilizes the combined identified eTS MISO fuzzy models as an aggregate dynamic model of the CSTR to solve the real-time optimization design problem specified in Eqs. (23) and (24) . The desired receding horizon control sequences f u c , u d g H 1 0 are determined over the finite horizon H  X  3 at every sampling instant. The projection of the resulting optimal transition trajectory into the  X  V R , T has been shown in Fig. 6 while the continuous  X  F 3 , F c  X  F , F 2 , S H  X  control moves are illustrated in Fig. 7 .

Computational time needed to per form the proposed optimization procedure has been measured and depicted in Fig. 8 for each sampling time step. The plot clearly illustrates that the average and maximum computational times nee ded to calculate the required adaptive predictive control inc luding the online fuzzy model identification is 3.5 and 6.8 s, respectively, within each sampling time interval. Thus, it is clearly observed that both the average and maximum optimization times are much smaller than the chosen sampling time step (i.e., 100 s). This ensures the GA proper speed or the CSTR system and hence guarant ees its capability of performing to fulfill the optimization task within the process sampling time period.

The simulation results show that the optimal transition time has been obtained within 92.8 s, indicating an improvement compared to the required 125 s to implement the alternative optimization approach proposed in Stursberg (2004a , b ).
The parameters of GA optimization solver were adjusted to a population size of 30 individuals, the crossover probabilities w  X  0 : 6 and w b  X  0 : 083 and an upper limit of n max  X  50 for maximum number of generations. 4.4. Simulation test scenario under CSTR parameter/disturbance perturbations
The dynamic behavior of the CSTR is represented by a set of differential equations formulated in Eq. (27) , translating molar and heat balances in the reactor. The derived model is based on the following hypotheses:
The reactor is perfectly stirred implying that the reaction temperature and concentrations are homogeneous throughout the mass volume.
 The heat losses are negligible.
 No phase change in the reaction mass occurs.

The density, the specific heat of the cooling and the reaction mass heat are independent of the temperature.
 Mixing is perfect in the cooling jacket.

Furthermore, in the works reported in Stursberg and Panek (2002 ) and Stursberg (2004a , b ), the CSTR dynamic model was assumed to be exactly known and none of the process parameters, denoted by k 1 to k 10 in Eq. (27) , was allowed to vary over the operational time evolution. Obviously, this does not represent a realistic situation and such circumstances and hypotheses are not always valid. Hence, control trajectories computed based on the nominal CSTR model is not likely to reproduce the predicted output profiles for all process dynamic evolutions within its uncertainty set. Physical interpretations of k 1 to k 10 as the CSTR process parameters can be explored from the conventional dynamic balances for mass and energy. The energy balance expression for z 1 with V R A  X  0 : 1 , 0 : 8 is given by:  X  Rate of energy flow in  X  rate of energy flow out  X  X  rate at which heat is generated due to reaction  X  X  rate of change of energy within system dT
R = dt  X  X  F 1  X  T 1 T R  X  X  F 2  X  T 2 T R  X  X  = V R  X  F c a  X  F c k 1 k 3  X  T c T R  X  k 4 q  X  28  X  where
U  X  heat-transfer coefficient with the coolant side, a 0  X  heat-transfer area, r  X  density of process mixture, C P  X  heat capacity (process side).

Heat-transfer coefficient is the main process parameter which varies when fouling phenomenon happens due to germ subsi-dence on the reactor surface. Moreover, heat-transfer area is significantly subject to possible changes due to filling of reactor or volume variations. Temperature perturbation is another factor which influences density of the process mixture. Comparing
Eqs. (27) and (28) demonstrates that k 1 and k 2 incorporate all these variable physical phenomena.

Different simulation test runs are carried out in this section to comparatively evaluate the performance of the proposed adaptive
MPC scheme with its non-adaptive alternative version in the presence of probable CSTR parameter/disturbance perturbations from their nominal values. In the non-adaptive version, a fixed and freezing predefined fuzzy model of the CSTR in the offline identification mode is utilized as suggested in [7]. On the other hand, the adaptive MPC strategy which is presented in this paper employs an online eTS fuzzy identification to take into account the probable dynamic changes in long-term operation of CSTR.
Table 2 lists a predefined set of test scenarios. Tests 1 and 2 are devoted to variations in k 1 and k 2 parameters. Test 3 emulates the case in which the process is faced with the catalyst deactivation phenomenon, manifesting as a decrease in rate of reaction ( q ) while Test 4 represents a disturbance in the inlet coolant temperature ( T C ).

Each simulation test run is organized as follows. First, the proposed adaptive MPC methodology is implemented under the pre-programmed test scenario. Then, the performance of its non-adaptive version is evaluated under similar test conditions to facilitate their comparative performances. 4.4.1. Test simulation results and analysis it can be observed in Fig. 9 , the proposed adaptive method is able to successfully accomplish the desir ed state transition with a rather smoother and faster response. Fig. 11 provides a more illustrative representation of the obtained com parative results in terms of the CSTR output time-responses. Fig. 11 (b) clearly demonstrates that temperature oscillations are more, covering a wider range for the non-adaptive control approach. Naturally, this behavior influences Fig. 11 (c) and (d), leading to much sluggish responses.
Table 3 summarizes quantitatively the comparative results in terms of two time-based measures. 4.4.1.2. Test 2. The simulation results have been illustrated in Figs. 12 and 13 for the two alternative adaptive and non-adaptive fuzzy predictive control methods, respectively. As shown, the proposed adaptive approach is able to yield a better state transition performance compared to the non-adaptive alternative approach. The simulation results, illustrated in Fig. 13 ,are unfavorable suffering mainly from two drawbacks: (i). The state transition trajectory shown in Fig. 13 (a) is very (ii). The test induces considerable deviations in continuous and discrete control efforts shown in Fig. 13 (b) and (c), respectively, compared to the alternatives, depicted in Fig. 12 (b) and (c).
These comparative observations have been projected in Fig. 14 in terms of the individual CSTR state trajectories for more clarity and perception.

Table 4 summarizes the results in terms of time-based mea-sures for the state transitions. 4.4.1.3. Test 3. Figs. 15 and 16 illustrate the simulation results for the case when q is decreased by 30%. It can be observed that the proposed adaptive control approach is performed better than the non-adaptive control method in terms of response speed and control efforts. Fig. 17 illustrates the same comparative results for the CSTR state trajectories. The results have been summarized in Table 5 in terms of time-based measures. 4.4.1.4. Test 4. Figs. 18 and 19 visualize the simulation results for the case when T C is increased by 10%. Fig. 19 verifies that non-adaptive predictive control fails to guide the system to the desired target hyperbox, while adaptive predictive control has been able to successfully accomplish the desired target in a few steps ( Fig. 18 and Table 6 ). This illustrative test study highlights the robustness of the proposed adaptive approach to properly handle the induced uncertainty. Fig. 20 clearly demonstrates this practical observation for each individual process state, signifying that concentrations A and B cannot settle down in their desired domains for the non-adaptive predictive control approach ( Fig. 20 (c) and (d)). 5. Conclusions
A new adaptive nonlinear model predictive control (NMPC) methodology has been proposed for a class of hybrid systems with mixed inputs. An online fuzzy identification approach is presented to recursively estimate an evolving Takagi X  X ugeno (eTS) model for the hybrid systems based on a potential clustering scheme without a priori knowledge. A receding horizon adaptive NMPC is then formulated directly from the identified eTS fuzzy model. The nonlinear optimization problem is solved via a genetic algorithm (GA). Performance capabilities of the proposed adaptive NMPC scheme was comparatively explored by automatically computing a set of optimal control sequences to realize a start-up transition procedure for a CSTR benchmark process, having complex, hybrid, and nonlinear stiff dynamics with mixed-inputs. Extensive sets of simulation test studies were carried out to comparatively evaluate performances of the proposed adaptive NMPC scheme with its non-adaptive alternative version in the presence of some probable
CSTR parameter/disturbance perturbations from their nominal values. These illustrative test studies clearly justify the robustness and fast performance of the proposed adaptive approach to properly handle the induced CSTR model uncertainties.
The simulation test scenarios embodied a typical evaluation picture in which the CSTR might be encountered in its long-term operation. The results illustrated the inherent capabilities of the overall proposed methodology to provide an automated control design framework without any prior dynamic model assumption under two possible categories of adaptive and non-adaptive schemes. This is maintained via a self-organizing eTS fuzzy identification method in which both the fuzzy rule base model structure and parameters are automatically adjusted to generate a proper set of descriptive eTS fuzzy rules in response to time-varying hybrid system dynamics without requiring a priori knowledge of the system. However, it was experimentally observed that the proposed adaptive scheme could establish more robustness to adaptively present consistent performances under multiple test scenarios with variable operational circumstances, including induced uncertainties in the CSTR benchmark process. References
