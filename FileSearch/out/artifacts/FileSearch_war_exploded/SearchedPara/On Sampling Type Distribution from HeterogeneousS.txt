 Social network analysis has drawn more and more attention of the data mining com-munity in recent years. By modeling the soci al network as a graph structure, where a node is an individual and an edge represents the relationship between individuals, many studies addressed the graph mining technique s to discover the interesting knowledge on the social networks. As the advance of communication technologies and the explosion of social web applications such as Facebook an d Twitter, the scale of the generated net-work data is usually very large. Apparently, it is less possible to explore and store the entire large network data before extracting t he characteristics of these social networks. Therefore, it is critical to develop an efficien t and systematic approach to gathering data in an appropriate size while keeping the properties of the original network.
To scale down the network data to be processed, there are two possible strategies: graph summarization and graph sampling . Graph summarization [1,2,3,4,5,6] aims to condense the original graph in a more compact form. There are lossless methods, where the original graph can be recovered from the summary graph, and loss-tolerant methods, where some information may be lost during the summarization. To obtain the summary graph, these methods usually need to examine the entire network first. On the other hand, sampling is a way of data collection by selecting a subset of the original data. By following some rules of sampling nodes and edges, a subgraph can be constructed with the characteristics of the original graph preserved. In contrast to graph summarization, a big advantage of sampling is that only a controlled number of nodes, instead of the entire network, are visited. In this work, as a result, we want to focus on sampling from large social networks.

Prior studies on graph sampling [7,8], however, focused only on preserving statis-tics such as degree distribution, hop-plot, and clustering coefficient on homogeneous graphs, where each node and link is treated equally. In reality, the social network is heterogeneous, where each individual has its own attribute indicating a specific group membership or type. For example, people are of different races or nationalities. The link between individuals of the same or different types can thus be classified to intra-connection and inter-connection . The type distribution of nodes and the proportion of intra/inter-connection links is also key information that should be preserved to under-stand the heterogeneous social network, which, to the best of our knowledge, has not yet been addressed in the previous graph sampling works in the data mining community.
To this end, we propose two goals on the heterogeneous social network. First is the type distribution preserving goal . Given a desired number of nodes of the sample size, a subgraph G s is generated by some sampling method. The type distribution of G s , Dist ( G s ) , is expected to be the same as that of the original graph G . The second goal is the intra-relationship preserving goal . We expect that the ratio of the intra-connection numbers to the total edges of G s should be preserved.

In search of a better solution, we adopt five possible methods: Random Node Sam-pling (RNS), Random Edge Sampling (RES), EgoCenteric Exploration Sampling (ECE) [9], Multiple-Ego-Centric Sampling ,(MES)and Respondent-Driven Sampling (RDS) [10], to see their effects on sampling type distribution in the heterogeneous social net-works. RNS and RES are two methods of selecting nodes and edges randomly until some criteria are met. ECE is a chain-referral-based sampling proposed in [9]. Chain-referral sampling usually starts from a node called ego and selects neighbor nodes uniformly at random wave by wave [9]. MES is a variation of ECE we designed that the sampling starts with multiple initial e gos. Finally, we adopt RDS, which is a sampling method used in social science for studying the hidden populations [10]. Many works on the social network analysis focus on the majority, i.e., the greatest or the second greatest connected components, of the network. However, sometimes the small or hidden group of a network hints more interesting messages. For example, the population of drug users or patients with rare diseases is usually hidden and relatively small. Essentially, RDS is a method combining snowball sampling , of which the recruiting of future samples is from acquaintances of the current subject , with a Markov Chain model to generate un-biased samples. In our implementation, we adopt RDS for the simulation of the human recruiting process and indicate how the Markov Chain is computed from the collected samples.

To evaluate the sampling quality of the above five methods, we conduct experi-ments on the Twitter data sets provided in [11]. We measure the difference of the type distribution between the sampling results and the original network by two indexes: error ratio and D-statistic of Kolmogorov-S mirnov Test. In addition, we measure the difference of the intra-connection percenta ge between the samples and the original net-work. The results show that RDS works best in terms of preserving the type distribu-tion and the intra-connection percentage when the sample size is small. MES and ECE perform next best, while MES has small improvement over ECE in the node type distri-bution. Finally, the sampling quality of RNS and RES are less stable. RNS outperforms other methods only when the sample size is large.

The remainder of the paper is organized as follows. The related work is discussed in Section 2. The problem statement is formally defined in Section 3. The detailed implementation of the five sampling algorithms is described in Section 4. In Section 5, we show the experimental results. Finally, the paper is concluded in Section 6. As the scale of social network data is getting very large, graph sampling is a useful technique to collect a smaller subgraph, wit hout visiting the entire original network, but with some properties of the original network preserved. Krishnamurthy et al. [12] found that a simple random node selection to a 30% sampling size is already able to preserve some properties of an undirected graph. Les kovec and Faloutsos [7] provided a survey on three major kinds of sampling methods on graphs: sampling by random node selection, sampling by random edge selection and sampling by exploration. The sampling quality of preserving many graph properties such as degree distribution, hop-plot, and clustering coefficient are examined. Moreover, they proposed a Forest Fire sampling algorithm, which preserves the power law property of a network very well during the sampling process. They concluded that there is no perfect sampling method for preserving every property under any c onditions. The sampling performance depends on different criteria and graph structures. H X bler et al. [8] further proposed Metropolis algorithms to obtain representative subgraphs. However, all these sampling works did not concern the heterogeneous network where each node may have its own attribute indicating a specific group membership or type. The link (edge) may be a connection between two nodes of the same or different types. The type distribution of nodes and the proportion of intra/inter-connection links is also key information to understand the heterogeneous social network, which, to the best of our knowledge, has not yet been addressed in the previous graph sampling works in the data mining community.
To sample the type distribution in a heter ogeneous network, we further introduce the Respondent-Driven Sampling (RDS) proposed by Heckathorn [10]. RDS is a well-known sampling approach for studying the hidden population, which combines snow-ball sampling and the Markov Chain process to produce unbiased sampling results for the hidden population. Furthermore, a newer estimator for the sampling results is de-signed [13] based on the reciprocity model assumption, i.e., the number of edges from group A to group B is equal to that from group B to group A in a directed graph with two groups (an undirected graph naturally complies with this assumption). In the real case of directed heterogeneous network, howe ver, this assumption does not usually hold. For example, the Twitter data sets we use in the experiments do not have the reciprocity property between the tweets among users. In our study, as a result, we apply and sim-ulate the original RDS [10] to sample the type distribution in a large heterogeneous social network. Given a graph G = &lt; V , E &gt; , V denotes a set of n vertexes (nodes, individuals) v i and E is a set of m directed edges (link, relationships) e i . First, we define the heterogeneous graph which models the heterogeneous social network we are interested in.
 Definition 1. A heterogeneous graph G with k types is a graph where each node be-L = { L 1 , ... L k } denoting k types, the type of each node v i is T ( v i )= L i ,whereL i  X  L. Suppose the number of vertex of G is n, and the number of nodes belonging to type L i is N , then the condition  X  k i = 1 N i = n must be true. In other words, (nodes  X  L i )  X  (nodes  X  L j )=0,wherei = j.
 The edges between nodes of different types are defined as follows.
 Definition 2. An edge e i connecting two nodes v i and v j is an intra-connection edge if T ( v i )= T ( v j ) .Otherwise,itisan inter-connection edge.
 With the above two definitions, our problem statements are presented as follows. Problem 1. Type distribution preserving goal Given a desired number of nodes, i.e., the sample size, a subgraph G s is generated by some sampling method. The type distri-bution of G s , Dist ( G s ) , is expected to be the same as that of the original graph G .That is, d ( Dist ( G s ) , Dist ( G )) = 0, where d () denotes the difference between two distribu-tions. In other words, the percentage of each N i in G s is expected to be the same as that of G .
 Problem 2. Intra-relationship preserving goal Given a desired number of nodes, i.e., the sample size, a subgraph G s is generated by some sampling method. The ratio of the intra-connection numbers to the total edges should be preserved. That is, On the other hand, the inter-relationship is equal to 1  X  IR ( G s ) which is also preserved. An example is given to illustrate these two problems. Given a social network which including 180 nodes ( n = 180) and 320 edges ( m = 320). Suppose there are totally 3 groups ( k = 3) containing 20, 100, and 60 people respectively. Thus, the type dis-tribution of the network Dist ( G ) is 0 . 11 , 0 . 56 , 0 . 33. Also suppose there are 200 intra-connection edges, the intra-connection ratio is thus 0 . 625. Our goal is to find out a sampling method that preserves the type distribution and the intra-connection ratio best. Suppose that a subgraph G s is sampled under the given 10% sampling rate, which is 18 nodes. If the number of nodes of group 1, 2, and 3 is 5, 8, and 5, then the type distri-bution is 0.28,0.44,0.28. In addition, suppos e there are 30 intra-connection edges out of 50 sampled edges, then the intra-connection r atio is 0.6. In the experiment section, we will provide several indexes to compute the difference between these distributions and ratios.
 The five algorithms for sampling large heterogeneous networks to be described are di-vided into three categories: random-based sampling, chain-referral sampling and indi-rect inference sampling. For random-based sampling, we conduct Random Node Sampling and Random Edge Sampling. The chain-referral sampling method includes Ego-Centric Exploration Sampling and Multiple Ego-Centric-Exploration Sampling. Finally, we adopt Respondent-Driven Sampling, an indirect sampling method, that orig-inated from the social science. 4.1 Random-Based Sampling Random Node Sampling (RNS) is an intuitive procedure for selecting desired number of nodes uniformly at random from the given graph. First of all, RNS picks up a set of nodes into a list. Then it constructs the vertex-induced subgraph by checking if there are edges between the selected nodes in the original graph.

The logic of Random Edge Sampling (RES) is also intuitive and similar to RNS by selecting edges uniformly at random. Once an edge is selected during the sampling process, the two nodes, head and tail , that it connected are also be included. Note that once the node number exceeds the desired one wh en a latest edge is selected, one of the node, say, the head node, will be excluded. 4.2 Chain-Referral Sampling The chain-referral sampling is also known as exploration-based sampling. First, we il-lustrate the Ego-Centric Exploration Sampling (ECE) method proposed by Ma et al. [9], then we proposed an variation method which improves ECE.

Essentially, ECE is based on the Random Walk (RW) methods [14]. Starting with a random node, RW chooses exactly one neighbor of that start node as the next stop. Following the same step, RW visits as many nodes as the desired sample size. The visited nodes and the edges along the walking path are collected. Similar to RW, ECE first randomly chooses a starting node called ego . Then all of its neighbor nodes, in contrast to RW where only one neighbor is considered, will be examined to be chosen or not by ECE according to a probability p respectively. The number of nodes chosen is expected to be p times the degree of that ego. Next, each new selected node itself is a new ego and the algorithm repeats the same step iteratively until the desired sample size is reached. Whenever the sampling process cannot move to the next wave, we select a new ego and restart this procedure to continue the sampling.

Consider the case that the start ego of ECE falls in a strongly connected component where individuals tend to be connected to those of the same type, e.g., same race or same nationality. This may trap ECE in sampling only the same or very few types of nodes. To deal with this issue, we further propose the Multiple Ego-centric-exploration Sampling (MES) method, which allows multiple egos as the sampling s tarts at initial. In this way, we have more chance to reach nodes of different types and can avoid the bias of over-sampling nodes for a particular type.
Although the chain-referral sampling algorithms can both produce a reasonable con-nected subgraph and preserve community structure, the rich get richer flavor inherently exists in this family of sampling techniques. 4.3 Respondent-Driven Sampling To study the hidden population in social science, Respondent-Driven Sampling (RDS) [10], a non-probab ility method, has been proposed. Generally, RDS contains two phases that including the snowball sampling phase and the Markov Chain process. Snowball sampling works similarly to ECE/MES that the recruiting of future samples is from acquaintances of the current subject. To compensate for collecting the data in a non-random way, the second phase of RDS, the Markov Chain process, helps to generate unbiased samples. As opposed to the conventional sampling methods, the statistics are not obtained directly from the samples, but indirectly inferred from the social network information constructed through them.

We simulate the snowball sampling phase of RDS as follows. First, the initial seeds, or individuals, must be chosen from a limited number of convenience samples. We just randomly select these initia l seeds. Originally in RDS, each chosen seed is rewarded to encourage further recruiting. Here, we simply make all recruited nodes continue to recruit their peers. In addition, we set a coupon limit, which is the number of peers an individual can recruit, to prevent the sampling in favor of individuals who have many acquaintances.

Then, we simulate the Markov Chain process. Suppose there are total k types of people in the network we study. From the collected samples we can organize a k by k recruitment matrix M , where the element S i , j of M represents the percentage of the type j people among those recruited by the people of type i . An example is illustrated in the following sample matrix.
 Suppose that the recruiting should reach to an equilibrium state if more samples are recruited than currently we have. That is, the type distribution will stabilize at E = ( E 1 , ..., E i , ..., E k ) ,where E i is the proportion of the type i at equilibrium. The law of large number of the regular Markov Chain process provides a way of computing that equilibrium state of M . It is computed by solving the following linear equations. For instance, if there are only two groups in a social network, Male ( m )andFemale( f ), the solution is E m = S mf 1  X  Smm + Sfm and E f = 1  X  E m , thus provide the information about type distribution of the social network. According to [15], if M is a regular transition matrix, there is an unique E .Also, M to the the power of N , M N , approaches a proba-bility matrix, where each row is identical and equal to E. Therefore, we can estimate E alternatively by finding a large enough N that makes M N converge and obtaining a row of it. In this section, we introduce the data sets we used and present our experimental results. Then, we show the results of all five sampling methods for both of the type reserv-ing goal and the intra-relationship preserving goal. We also discuss the effects on the statistics with the number of types and the sampling size varied. The sampling proba-bility p was set to 0.8 for ECE and MES based on the suggestion in [12]. The coupon limit for RDS was set to 5. We implemented all algorithms using VC++ and ran on a PC equipped with 2.66GHz dual CPUs and 2G memo ry. Moreover, we ran each experiment 200 times for each setting and computed the average to get a stable and valid result. 5.1 Twitter Data Sets We conducted our experiments on the Twitter d ata sets provided in [11] . This data set contains about 10.5 million tweet s from 200,000 users along with their information such as time zone, location and so on between 2006 and 2009. The total following/follower information constitutes a directed heterogeneous graph we used. However, we pre-served those users with the location label only. Starting from those 200,000 user IDs, we included all their neighbors that had valid location labels on them. Therefore. we constructed a social network that contained more than 200,000 nodes. The resulted so-cial network data consists of n = 403874 accounts and e = 689541 relationships (tweets behavior of followers and followees) among those accounts.

According to the location lab el that records the city/country of each user, we can di-vide them into several types according to the geographical areas. The division included three settings: 3, 5, and 7 types (groups). The group and type are interchangeably in the following content. The characteristics of these settings were listed in Table 1. The 7 groups are: East Asia, West Asia, Europe, North America, South America, Australia and Africa. The overall intra-connection ratio is 0 . 303, which means about 30% users contact with those of the same region types. The second setting, 5 region groups were classified as Asia, Europe, America, Austra lia and Africa. The overall intra-connection ratio is 0.466. In the third setting, 3 region groups are Asia, Europe and America. The overall intra-connection ratio is 0.486 meaning that almost half of the users contact with those in the same area. Detailed information between different groups were presented in Table 1. 5.2 Evaluation Index For the type distribution preserving goal, we used two statistics to measure the type distribution difference between the subgraph G s extracted by the five algorithms and the original graph G . First, the Error Ratio (ER) summed up the proportion difference of all types. It is defined as  X  k i = 1 group on G s , E ( i ) is the theoretical number of nodes it should be in the sampled graph according to the type i  X  X  real proportion in G ,and SN is the sample size. Another evalu-ation statistic is the D -statistic for the Kolmogorov-Smirnov Test. We simply used it as an index rather than conducting a hypothesis test. The D -statistic, which can measure the agreement between two distributions, is defined as D = su p x | F ( x )  X  F ( x ) | ,where F ( x ) is the type distribution of G s and F ( x ) is that of G . ER provided a percentage-like form of the total errors between type distributions of G s and G whereas D -statistic provided the information about the cumulative errors within the structure of G s and G .
For the intra-relationship preserving goal, we used the Intra-Relation Error (IRE) to measure the difference of the intra-relationship ratio among G s and G . It was defined respectively, and m and m were the total number of edges in G s and G respectively. 5.3 Results of the Type Distribution Preserving Goal This goal is to preserve the type distribution of the sampled graph G s as similar as that of the original graph G . The sample size varied from 50 to 200000 nodes, i.e., about 0.1% to 50% sampling rate. The experiment results in Fig. 1(a) and (b) showed the error in the type distribution for the 7-groups Twitter dat a set. In general, the error decreased as the sampling size increased. Fig. 1(a) showed the ER of all the five sampling methods, we found that RDS performed best when the sampling size was very small, but improved slowly in large sample size. Because the fast-converge rate in the Markov transition, RDS can provide more accurate results even when the information from the samples was limited. However, since the Markov process converged very fast, the result was determined until an enough number of nodes w as reached. Thus, the following selected entities failed to improve the accuracy. On the other hand, MES outperformed ECE only at the small sample size. It was because MES could avoid getting stuck in some particular group members and thus provided more accurate results. When the sample size increased, ECE had higher chances to travel from groups to groups thus provided the similar result with MES. Finally, RNS and RES behaved very unstable and sensi-tive to the sample size. When the sample size was very small, both methods produced terrible results. However, they improved significantly and obtained the best sampling results when the sample size was large enough. In Fig. 1(b), we found similar behav-ior patterns for all sampling methods except for RDS at the small sample size. This indicated that RDS heavily relied on the information provided by the recruitment ma-trix. When the sampling size was very small, the recruitment matrix could not provide enough information for the Markov Chain process thus produced a worse result.
For the 5-groups Twitter data set, all pattern s from five methods were similar to those of 7-group Twitter data set as shown in Fig. 1(c) and (d). This is also true for the setting of 3-groups as shown in Fig. 1(e) and (f). Only at small sample sizes, the results showed that the error decreased as the number of gr oups was getting smaller. We will further discuss the results in Section 5.5.

It is noted that, the results were similar for both ER and D-statistic. This was because the property of the Twitter data sets. Since ER is an index to measure the total error, it was sensitive to the performance on the largest or relatively great groups in terms of size. On the other hand, D-statistic measured the cumulative error that encountered on the greater groups as well in most cases. According to those reasons, we observed some similar patters between ER and D-statistic. 5.4 Results of the Intra-Relationship Preserving Goal Our second goal is to preserve the relationship among different groups in a network. Fig. 2 presented experimental results for this goal. We found that RDS produced the best result even at small sample sizes. It i ndicated that the sampling phase of RDS not only provided the network information to the Markov Chain process, but also somewhat preserved the relationship information (different tie types) as well. Still, its improve-ment slowed down when the sample size became very large. On the other hand, MES had a little higher errors compared to that of the ECE at a small sample size. Since the original concept of MES is to avoid samplin g bias from the chain-referral procedure in the type distribution, it did not consider the issues about the relationship among indi-viduals (edges on the graph). However, we can observe the advantage of MES when the sample size increased. RES outperformed RNS since it is an edge-based random selection. Thus it had more advantages than the node-based random selection did. Fi-nally, RNS failed to describe the relationships among individuals with a small sample size since RNS tended to produce a set of nonconnective nodes, which was especially true when the network was sparse, that mislead the intra-connection ratio to 0. How-ever, the situation changed while the sampl e size increased. Because RNS performed a vertex-induced procedure after sampling enough nodes into the sample pool, this pro-cess included both in-edge and out-edges between two nodes. Therefore, more selected edges resulted in the better performance of the intra-relationship preserving goal. We omitted the results of the 5-group data set due to the space limit. Its IRE values were between those of the 7-group and 3-group settings. 5.5 Analysis on the Effects of the Number of Groups and the Sample Size Here we provide some remarks on the performance at different numbers of groups. The sampling size chosen here was 100. We only presented ER in Fig. 3(a) and omitted the results of D-statistic since they had similar patterns. We found that both ER and D-statistic affected by the number of groups ( k ) positively. This is reasonable since the more k existed in a social network the more errors we observed lead to a lower accuracy. On the other hand, in Fig. 3(b), the number of groups k were almost independent of the intra-relationship error. It is noted that since RNS cannot sample any edge in the small sample setting, the IRE equals to the IR of the original graph. As a result, the IRE of RNS in Fig. 3(b) had significant differences of different group settings.

One of the most important issues in the sampling problem is that how big the sample size should be chosen to get good enough results in terms of the sampling accuracy on preserving our two goals. According to all of our experiment results, Fig. 1 and Fig. 2, we concluded that 15% is the best point for this concern. We found that when the sample size grew to more than 15% (around 60000 nodes) of the population, all statistics were below 0.05 no matter which sampling method was used. In other words, the sampling quality improved limitedly when the sample size was even larger (up to 50% in this study). Although the purposes and research target are different, our finding is similar to that in [7], which also concluded with this argument. In this study, we proposed a novel and meaningful sampling problem, the type distri-bution preserving and the intra-relationship preserving problems, on the heterogeneous social network and conducted five algorithms to deal with this issue. In preserving the type distribution, we found that RDS was a good method especially at small sample sizes. MES helped ECE a little at a small samp le size. In addition, the random-based methods were sample size sensitive and failed to provide reasonable results at small sample sizes. In preserving the link relationship goal, we had a similar conclusion while some differences were discussed. Furthermore, we discussed the results under different group sizes. Finally, we provided a rule of thumb that a 15% sample size should be large enough on the type distribution preserving and the intra-relationship preserving sampling problems in our findings.

