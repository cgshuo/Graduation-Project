 Repeat Purchases have become increasingly important in measuring customer X  X  satisfaction and loyalty to e-commerce websites in regard to online shopping. In this paper, we first propose a model for estimating repeat purchase frequency in a given time period from a given product category using Poisson/Gamma model. Second, we estimate the purchase probabilities of different product types in a product category for each customer using Dirichlet model. Experimental re-sults on data collected by a real-world e-commerce website show that it can predict a user X  X  average repeat purchase frequency along with their product types with decent ac-curacy. We also argue that the output of our models can be used as prior information to enhance the performance of time-sensitive recommendation.
 Repeat purchase, Poisson/Gamma model, Dirichlet model
Repeat Purchase is a common phenomenon in online shop-ping which can depict a customer X  X  satisfaction and loyalty to an e-commerce website. In this work we describe a model for predicting the number of repeat purchases along with their product types from a given product category, in a given time period, for a given customer. We also show that these predictions can guide existing systems for better time-sensitive recommendation.

Repeat purchases are generally predicted using time sen-sitive recommender system. Several studies have been done in the field of time-sensitive recommendation. Work in [3] represented the problem of recommending the right prod-uct at right time with the help of Hazards model in survival analysis. Work in [4] clusters user-product into groups hav-ing similar purchase behaviour using topic model and then filters out products from each cluster based on purchase time interval. Work in [1] addresses the problem with the help of self-exciting temporal point process(Hawkes process) where each point represents a purchase event.

There are several challenges in predicting repeat purchase events. The major hindrance is irregular purchases by cus-tomers. Model described in [3] works well when a customer purchases consistently from the e-commerce website. But real life scenarios are different. It has been observed that some customers are active for only a short time period and remains inactive for rest of the year. On the other hand frequency of purchases for majority of the customers are extremely low whereas for some customers it is uncharacter-istically high. Another issue for predicting repeat purchase is data sparsity. In [1], parameters are estimated for each user-product pair. A low rank Hawkes process has been pro-posed as a solution and ample data is required to get a good estimate. Work in [4] tries to compute average purchase in-terval for each pair of products which not only increases the computational cost but also suffers from data sparsity.
One common assumption in all the existing time sensitive recommendation is that the current purchase is dependent on previous purchase/purchases. In context of repeat pur-chase, this assumption must hold true in ideal case. But analysis of real purchase data shows that this dependency assumption holds true for only a few customers. For the rest of the customers, it would be better to assume that pur-chases over a longer time periods(several weeks or months) are independent. These observations and repeat buying the-ory of Ehrenberg [2] serves as the motivation of our work.
For predicting number of repeat purchases along with their product types, we use a two stage top down procedure. The first stage predicts the number of repeat purchases for a given product category and time period. In the second stage, the model matches predicted repeat purchases with possible product types. If shampoo is a product category, then a group of shampoos with similar features form a prod-uct type. The model only provides a broad estimate about repeat purchases over a longer duration of time with de-cent accuracy. Thus it should not be used as a standalone recommendation system for predicting repeat purchase. In-stead it can be used as a supporting system in parallel with existing recommendation system where the predicted infor-mation about repeat purchases and product types can be used as prior knowledge.
We propose a two stage top down method to achieve our goal. The first stage predicts the number of repeat pur-chases from a given product category in a given time period for a given user. The second stage matches the predicted repeat purchases with possible product types. We also show how this model can be used to enhance the performance of existing time-sensitive recommendation system. In this stage we predict the number of repeat purchases. We build a Poisson/Gamma model to estimate the average purchase frequency of each customer for a given time period and product category. Here time period is longer -several weeks or months.

Before further detail, we state three assumptions behind the model. First, repeat purchases in one product category is independent of other product categories. Repeat purchases can be dependent across several product categories but we are restricting our scope to this independent assumption. Second, purchase frequency of each customer is indepen-dent. This assumption is pretty straightforward and can be verified from purchase data. The third and the most important assumption is that the successive purchases of a customer behave as if random over a longer duration of time. A closer observation on the purchase data clearly shows that the purchase frequency of a customer is very irregular over longer time period(several weeks or months). That is why the successive purchases in a single time period tends to be effectively independent and can be regarded as if random. Moreover, we observe a very low correlation between the average purchase frequency of different time periods. So we also assume that the average purchase frequency of different time periods are independent.

Now we describe our model for estimating average pur-chase frequency. The occurrence of a purchase event can be viewed as arrival of a customer to purchase a product. Then our objective can be represented as the prediction of num-ber of times a customer will arrive/purchase in a given time period. As this is a count data problem, we assume that the purchase frequency of each customer follows a Poisson dis-tribution for a given time period. Then according to our as-sumption, purchase instances of all the customers in a given time period are independent and sampled from Poisson dis-tribution. We assume that mean of the Poisson distributions of all the customers in a given time period is sampled from a gamma prior. The basic model has been described in Fig-ure 1. We build a separate version of the same model for different time period and product category.
 Figure 1: Distribution of each customer c in a given time period t and product category m , share information through prior  X  . r c,i is the total number of purchases in the i observation by customer c in time period t from product category m . Average purchase frequency  X  c is the mean of the Poisson distribution for customer c in time period t for product category m .  X  c of all the customers are sampled from prior  X  = Gamma ( k,a ) where k and a are shape and scale parameter respectively.

We use maximum likelihood estimate to infer the model parameters  X  c and  X  or { k,a } for each time period t and product category m .

Let D be the observed purchase frequency of all the cus-tomers for a given time period and product category. From our assumption, r c,i  X  Poisson (  X  c ) and  X  c  X  Gamma ( k,a ). Then we can write the likelihood function as where n c is the number of observations for customer c . The posterior distribution(  X  c ) of  X  c given D follows a Gamma distribution.
Maximizing the likelihood in Equation 1 is equivalent to maximizing the log likelihood L (  X  ).
 L (  X  ) = ln p ( D |  X  ) = X
We use Expectation Maximization algorithm to estimate the parameters. The process to infer parameters using EM algorithm is to iterate between the following E-step and M-step until convergence.

In the E-step, we infer  X  c as the expectation of the pos-terior distribution.
In M-step, we infer  X  or { k,a } that maximizes the log likelihood L (  X  ) in equation 3.
The objective of this stage is to predict the product types given the number of repeat purchases. Ideally the goal was to predict products from a given product category. As the number of products in a product category can be large and dynamic, we only predict product types. Generation of product types within a product category has been discussed later. The assumptions for this stage are -(1) Each cus-tomer X  X  choices among the available product types follow a Multinomial distribution, (2) These choice probabilities fol-low a Dirichlet distribution across different customers.
Let p c,j denote the probability of purchasing product type j by customer c for a given product category. Let x c,j denote the number of purchases from product type j by customer c and P k j =1 x c,j = m c . Then the probability mass function for the Multinomial distribution of customer c can be written as
The probability distribution of the choice probabilities of a customer c given prior  X  = {  X  1 ,..., X  k } can be written as p ( p c, 1 ,...,p c,k |  X  1 , X  1 ,..., X  k ) =  X ( S )
Let D be the observed data of purchased product types by all customers. Then we can write the likelihood function as p ( D |  X  1 , X  2 ,..., X  k ) =
Y
Posterior distribution(  X  c ) of choice probabilities given D follows a Dirichlet distribution. where  X  j 0 =  X  j + P x
Here we have to estimate the choice probabilities p c,j and prior  X  for each product category. Again we use Expectation Maximization algorithm in a similar fashion.

In the E-step we infer the choice probabilities from poste-rior distribution of each customer.
In M-step, we infer  X  that maximizes the log likelihood of equation 7.

A product type is a group of similar products within a sin-gle product category. In this work we used k-means cluster-ing algorithm to generate product types. We used product price and brand equity as clustering features as they held good partitioning attribute for the products of our dataset. Let x be total number of sales in a particular brand b. Let y be the total number of purchases by the users of brand b from the entire product category of b. Then we can de-note brand equity as ( y  X  x ) /x where a lower value indicates higher brand equity and vice versa.
In this section we discuss how our model can be used to enhance the performance of existing time-sensitive recom-mendation system. Predicted product types can help reduc-ing the search space of the recommendation. On the other hand, predicted number of repeat purchases can be used in various ways for guiding the time-sensitive recommendation. Here we discuss one such application in detail.

Let a recommender system is recommending a product at time t for customer c and estimates the probability of pur-chase as q . Let t belongs to time period T . For example, if we assume time period of one month and t is some date of January, then time period T is the entire January month. Let the category of this product be m . Let y c be the num-ber of products already purchased in T by customer c from category m . Let  X  c be the average purchase frequency of this customer in category m and time period T . Then the probability of purchasing ( y c + 1) th product given  X  c written as
We can now use q and p (( y c + 1) |  X  c ) to get the updated purchase probability as
The basic idea is to penalize the probability score when the number of purchase exceeds average purchase frequency. Here we have used an exponential kernel for this task.
Evaluation of this part requires data regarding actual rec-ommendations along with their time. We could not run our evaluation due to lack of this ground data. Instead we give a theoretical justification about the possible impact on time-sensitive recommendation. Let a user has already purchased 3 diapers in a given time period. Let the average purchase frequency for this user in the given time period be 2. Now let a recommender system recommend another diaper to this user in the same time period. Surveys show that this type of scenario is frequent in real-world e-commerce websites which also hurts customer satisfaction with the recommender sys-tem. Thus, prior information regarding average purchase frequency can certainly help to tackle this type of situations. Penalizing the probability score is one such solution to avoid over optimistic recommendation. It can also be used in deal-ing with situations where number of recommendations are lesser than average purchase frequency.
We have used purchase data collected on a real-world e-commerce website as our dataset. Training data contained purchase history from 2014-01-01 to 2014-12-31. Duration of test data was from 2015-01-01 to 2015-12-31. Analysis of the raw data suggested that repeat purchases in FMCG(fast-moving-consumer-goods) products are more frequent than other products. That is why we used sales data and product details of some popular FMCG products(Shampoo,Soap,Diaper and Deodorant) as our data source.
We used two different methods to evaluate our two models as described next.
For evaluating the prediction of repeat purchase, we ana-lyze the standard deviation of test data from the estimated average purchase frequency. Let  X  c and x c be the estimated and actual purchase frequency respectively of a customer c for product category m and time period t . Then we use the following equation to calculate the standard deviation of our model(  X  Model ) for time period t and product category m
Let  X  Mean denotes the standard deviation of test data when average purchase frequency for each customer is esti-mated as the sample mean. We compute  X  Model and  X  Mean for different time period and product category. Results has been shown in Table 1 and 2.
 Table 1: Std Deviation for Time Period of 2 months Table 2: Std Deviation for Time Period of 3 months
Comparison shows that the value of  X  Model is less than  X 
Mean for all the cases. Therefore our model gives better prediction of average purchase frequency in comparison to simply using sample mean for the same task. We performed the evaluation taking different time periods. Results for time period 2 and 3 months has been shown in Table 1 and 2 respectively. We observe same trend in results for different time periods which show that our model works better even if the time period is variable.
For evaluating this section, we compute conversion rate of products using estimated purchase probability of prod-uct types. Here conversion rate is the ratio between number of products correctly recommended and number of products actually purchased. We compare the result with conversion rate using highest selling product types in a product cate-gory.

Let T c be the total number of purchases from product category m by customer c . Let P c be the list of top k product types based on estimated purchase probabilities for a given customer c and product category m . Let S c be the total number of purchases from product types enlisted in P c by customer c . Let f m denote the average conversion rate of product types using P c . Then f m can be written as where N is total number of customers in test data.
Let Q be the list of top k highest selling product types from product category m common to all users. Let S c 0 be the total number of purchases from product types enlisted in Q by customer c . Let g m denote the average conversion rate of product types using Q . Then g m can be written as The results of f m and g m has been compared in Table 3. We performed this evaluation for different values of k where each product category had 20 product types.

Comparison shows that usage of estimated purchase prob-abilities results in better performance than using highest selling product types. Conversion rate of our model is de-pendent on the clustering of products. A more sophisticated clustering algorithm can be used for better accuracy.
In this paper, we developed two models for predicting number of repeat purchases and product types respectively. We used Poisson/Gamma model for estimating average pur-chase frequency whereas Dirichlet model for estimating pur-chase probability of a product type. We also argued that the output of our models can guide existing system for better time-sensitive recommendation. In the future, we want to explore the dependency of repeat purchases across different product categories. [1] N. Du, Y. Wang, N. He, J. Sun, and L. Song.
 [2] A. Ehrenberg. Repeat-buying: Facts, Theory, and [3] J. Wang and Y. Zhang. Opportunity model for [4] G. Zhao, M. L. Lee, and H. Wynne. Utilizing purchase
