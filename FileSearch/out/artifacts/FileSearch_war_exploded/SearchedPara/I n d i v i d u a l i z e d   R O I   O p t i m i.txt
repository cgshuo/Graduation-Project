 1 , 2 * Kaiming Li, 1 Lei Guo, 3 Carlos Faraco, 2 Dajiang Zhu, 2 Fan Deng , 1 Tuo Zhang, 1 Xi The human brain X  X  function is segregated into distinct regions and integrated via axonal fibers [1]. Studying the connectivity among these regions and modeling their dynamics a nd interaction s ha s drawn increasing interest and effort from the brain imaging and neuroscience Functional Connectomes Project [ 8 ] ha ve embarked to elucidate large -scale connectivity patterns in the human brain. For traditional connectivity analysis, a variety of models including DCM (dynamics causal modeling) , GCM (Granger causality modeling) and MVA ROIs. A fundamental issue in these studies is how to accurately identify the ROIs, which are challenging problem in many brain imaging applications . From our perspective, the major challenges come from uncertainties in ROI boundary definition, the tremendous variability across individuals, and high nonlinearities within and around ROIs. Current a pproaches for identifying brain ROIs can be broadly classified into four categories. The first is manual labeling by experts using their domain knowledge. The second is a homogeneity) algorithm [ 11 ] has been used to identify regional homogeneous regions as ROIs. The third is to predefine ROIs in a template brain, and warp them back to the individual space approaches, there are various limitations . For instance, manual labeling is difficult to warping template ROIs back to individual space is subject to the accuracy of warping techniques and the ana tomical variability across subjects.
 volume coil), k -space acquisition trajectory, reconstruction algorithms, susceptibility -induced technique in fMRI analysis to enhance SNR, may introduce artificial localization shift s ( up to 12.1mm for Gaussian kernel volumet r ic smoothing ) [14] or generate overly smoothed act ivation maps that may obscure important details [ 1 5 ] . For example, as shown in Fig.1a, the local maximum of the ROI was shifted by 4mm due to the spatial smoothing process. group -based activation maps may show different patterns from an individual's activation map; memory study, while the bottom panel is the activation map o f one subject in the study . As we analysis result. In conclusion , standard analysis of task -based fMRI paradigm data is inadequate to accurately localize ROIs for eac h i n dividual . Fig.1. (a): Local activation map maxima (marked by the cross) shift of one ROI due to spatial volumetric smoothing. The top one was detected using unsmoothed data while the bottom one used smoothed data ( FWHM : 6.875mm). (b): The corresponding fibers for the ROIs in (a). The ROIs are presented using a sphere (radius: 5mm). (c): Activation map differences between the group (top) and one subject (bottom). The highlighted boxes show two of the missing activated RO Is found from the group analysis. Without accurate and reliable individualized ROIs, the validity of brain connectivity analysis, and computational modeling of dynamics and interactions among brain networks , would be questionable . In response to this fund amental issue, this paper presents a novel computational application to develo p and evaluate our methodology. The optimization of ROI locations was formulated as an energy minimization problem, w ith the goal of jointly maximiz ing the group -wise consistency of functional and structural connectivity patterns and anatomic profiles. The optimization problem is solved via the well -established simulated annealing approach. Our experimental results show that the optimized ROIs achieved our optimization objectives and demonstrated promising results. Twenty -five university students were recruited to participate in this study. Each participant performed an fMRI modified version of the OSPAN task (3 block types: OSPAN, Arithmetic, and Baseline) while fMRI data was acqu ired. DTI scans were also acquired for each participant. FMRI and DTI scans were acquired on a 3T GE Signa scanner. Acquisition parameters were as follows : fMRI: 64x64 matrix, 4mm slice thickness, 220mm FOV, 30 slices, TR=1.5s, TE=25ms, ASSET=2; DTI: 128x128 matrix, 2mm slice thickness, 256mm FOV, 60 slices, TR=15100ms, TE= variable, ASSET=2, 3 B0 images, 30 optimized gradient directions, b -value=1000). Each participant X  X  fMRI data was an alyzed using FSL. Individual activation map reflecting the OSPAN ( OSPAN &gt; Baseline ) contrast was used . In total , we identified the 16 highest activated ROIs , including left and right insula, left and right medial frontal gyrus, left and right precentral gy rus, left and right paracingulate gyrus, left and right frontal pole, right lateral occipital gyrus, and left and right precuneus. Fig.2 shows the 16 ROIs m apped onto a WM(white matter)/GM(gray matter) cortical surface. For some individuals, there may be missing ROIs on their activation maps . Under such condition, we adapted the group activation map as a guide to find these ROIs using linear registration . DTI pre -processing consist ed of skull removal, motion correction, and eddy current correction. After the pre -processing, fiber tracking was performed using MEDINRIA (FA threshold: 0.2; minimum fiber length: 20). Fibers were extended along their tangent direction s to reach into the gray matter when necessary . Brain tissue segmentation was conducted on DTI data by the marching cubes algorithm. The cortical surface was parcellated into anatomical regions using the HAMMER tool [ 1 7 ]. DTI space was used as the standard space from which to generate the surface. Since the fMRI and DTI sequences are both EPI (echo planar imaging) sequences, much less than th at between T1 and fMRI images [ 1 8 ]. Co -registration between DTI and fMRI data was performed using FSL FLIRT [12] . The activated ROIs and tracked fibers were then mapped onto the cortical surface for joint modeling . Despite the high degree of variability across subjects, there are several aspects of regularity on penetrating the same functional ROIs should have at lea st similar target regions across subjects. Last ly, individual network s identified by task -based paradigms , like the working memory axongenesis processes are closely coupled [ 20 ]; Hence, it is reasonable to put these three types of inform ation in a joint modeling framework. 2) Extensive studies have already demonstrated the existence of a common structural and functional architecture of the human brain [2 1 , 2 2 ], and it makes sense to assume that the working memory network has similar struc tural and functional connectivity patterns across individuals. Based on these premises, we propose d to optimize the locations of individual functional ROIs by jointly modeling anatomic profiles, structural connectivity patterns, and functional connectivi ty p atterns, as illustrated in Fig 3 . The jointly modeled profiles. Mathematically, we model ed the group -wise variance as energy E as center vertex and its neighborhood . Suppose  X   X  X  X  is the ROI region j on the cortical surface of subject i identified in Section 2. 1 ; we find a corresponding surface ROI region  X   X  X  X  so that the energy E (contains energy from n subjects, each with m ROIs) is minimized : where  X  are the mean and standard deviation of connectivity constraint, and  X  is a weighting parameter between 0 and 1. If no t specified , n is the number of subjects, and m is the number of ROIs in this paper. The details of these energy terms are provided in the following sections. 2 . 2 . 1 A n a t o m i c a l c o n s t r a i n t e n e r g y Anatomical constraint energy optimized ROIs have similar anatomical locations in the atlas space (Fig . 4 shows an example of ROIs of 15 randomly selected subjects in the atlas space). We model the locations for all ROIs in the atlas space using a Gaussian model (mean:  X   X   X  , and standard deviation : j X  X  for ROI j ). The model parameters were estimated using the initial locations obtained from S ection 2.1. Let in the atlas space, then where Under the above definition, if any center other word s , this energy factor will ensure the optimized ROIs will not significant ly deviate away from the original ROIs. 2 . 2 . 2 S t r u c t u r a l c o n n e c t i v i t y c o n s t r a i n t e n e r g y Structural connectivity constraint energy should have the similar structural connectivity patterns [ 1 9 ] , where ij C is the connectivity pattern vector for ROI j of subject i , for ROI j , and 1 Covc  X  is the inverse of the covariance matrix. The connectivity pattern vector ij C is a fiber target region distribution histogram. To obtain four lobes for each hemisphe re, and the subcortical region) using the HAMMER algorithm accuracy , which might render the histogram too sensitive to the parcellation result . Then, we extract fibers penetrating region regions. Fig. 5 illustrates the ideas . spheres), and fibers penetrating the ROIs (in red and yellow, respectively); (c): Corresponding connected to the corresponding cortical region. Fiber numbers are normalized across subjects. 2 . 2 . 3 F u n c t i o n a l c o n n e c t i v i t y c o n s t r a i n t e n e r g y Functional connectivity constraint energy functional connectivity pattern s for the working memory system, assuming the human brain has similar functional architecture across individuals [2 1 ] . Here , dataset. The connectivity between each pair of ROIs is defined using the Pearson correlation. The matrix distance used here is the Frobenius norm. 2 . 3 E n e r g y m i n i m i z a t i o n s o l u t i o n The minimization of the energy defined in Section 2.2 is known as a combinatorial optimization problem. Traditional optimization methods may not fit this problem, since there changes with the varying locations of ROIs. Therefore, techniques like Newton X  X  method multiple local minima during optimization. To address this p roblem, we adopt the simulated based on random walk through the space for lower energies. In these random walks, the probability of taking a step is determined by the Boltzmann distribution, configuration  X  and  X  + 1 respectively;  X  is the Boltzmann constant; and  X  is the system temperature. In other words, a step will be taken when a lower energy is found. A step will also be taken with probability p if a higher energy is found. This helps avoid the local minima in the search space. Compared to structural and functional connectivity patterns, anatomical profiles are more easily affected by variability across individuals. Therefore, the anatomical constraint energy is designed to provide constraint only to ROIs that are obviously far away from reasonableness . The reasonable range was statistically modeled by the localizations of ROIs warped into the atlas space in Section 2.2.1 . Our focus in this paper is the structural and functional profiles. 
In this section, we use only anatomical and structural connectivity profiles to optimize the locations of ROIs. The goal is to check whether the structural constraint energy expected. Fig. 6 shows the fibers penetrating the right precuneus f or eight subjects before (top panel) and after optimization (bottom panel) . The ROI is highlighted in a red sphere for each subject. As we can see from the figure ( please refer to the highlighted yellow arrows) , after optimization, the third and sixth subjects have significantly improved con sistency with the rest of the group than before optimization, which proves the validity of the energy function Eq.(4). Fig . 6 . Comparison of structural profiles before and after optimization. Each column shows the corresponding before -optimization (top) and after -optimization (bottom) fibers of one subject. The ROI (right precuneus ) is presented by the red sphere. aiming to validate the definition of functional connectivity constraint energy constraint worked well, the functional connectivity variance of the working memory system is significantly reduced after optimization. This demonstrated the effectiveness of the defined functional connectivity constraint energy. Fig. 7 . Comparison of the standard derivation for functional connectivity before and after the optimization. Lower values mean more consistent connectivity pattern cross subjects. s t r u c t u r a l p r o f i l e s profile energy drop along with structural profile optimization; Bottom: Structural profile energy drop along with functional profile optimization. Each experiment was re peated 15 times with random initial ROI locations that met the anatomical constraint. functional profiles and structural profiles by looking at how the energy for one of them changes while the energy of the other decreases . The optimization processes in Section 3.1 and 3.2 were repeated 15 times respectively with random initial ROI locations that met the anatomical constraint. As shown in Fig. 8 , in general , the functional profile energies and structural profile energies are closely related in such a way that the f unctional profile energies tend to decrease along with the structural profile optimization process, while the structural profile energies also tend to decrease as the functional profile is optimized. This positively correlated decrease of functional profil e energy and structural profile energy not only proves the close relationship between functional and structural profiles, but also demonstrates the consistency between functional and structural optimization, laying down the foundation of the joint optimiza tion, whose results are detailed in the following section. c o n n e c t i v i t y p r o f i l e s In this section, we used all the constraints in Eq. (1) to optimize the individual locations of all ROIs in the w orking memory system. Ten runs of the optimization were performed using random initial ROI locations that me t the anatomical constraint. Weighting parameter  X  indicates that the simulated annealing algorithm provides a valid solution to our problem . By visual inspection, m ost of the ROIs move to more reasonable and consistent locations after the joint optimization. As an example, F ig.10 depicts the location movements of the ROI in F ig. 6 for eight subjects. As we can see, the ROIs for these subjects share a similar anatomical landmark, which appears to be the tip of the upper bank of the parieto -occipital sulcus . If the initial ROI was not at this landmark, it moved to the landmark after the optimization, which was the case for subject s 1, 4 and 7. The structural profiles of these ROIs are very similar to F ig.6. The results in Fig. 10 indicate the significant impr ovement of ROI locations achieved by the joint optimization procedure. conditions. visualized the movement direction after optimization. This paper presented a novel computational approach to optimize the locations of ROIs connectivity patterns, and anatomical locations are jointly modeled and formulated in an energy function, which is minimized by the simulated a nnealing optimization algorithm . Experimental results demonstrate the op timized ROIs have more reasonable localizations , and have significantly improved the consistency of structural and functional connectivity profiles and morphological and anatomic profiles across subjects . Our future work includes extending this framework t o optimize other parameters of ROIs such as size and shape, and applying and evaluating this methodology to the optimization of ROIs identified in other brain systems such as the vis ual , auditory, language, attention, and emotion networks. 
