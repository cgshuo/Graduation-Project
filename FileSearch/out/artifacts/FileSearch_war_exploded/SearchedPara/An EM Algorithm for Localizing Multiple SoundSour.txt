 Determining the direction from which a sound originated using only two microphones is a difficult problem. It is exacerbated by the presence of sounds from other sources and by realistic reverbera-tions, as would be found in a classroom. A related and equally difficult problem is determining in which regions of a spectrogram a sound is observable, the so-called time-frequency mask, useful for source separation [1]. While humans can solve these problems well enough to carry on conversa-tions in the canonical  X  X ocktail party X , current computational solutions are less robust. Either they assume sound sources are statistically stationary, they assume anechoic conditions, or they require an array with at least as many microphones as there are sources to be localized.
 The method proposed in this paper takes a probabilistic approach to localization, using the psychoa-coustic cue of interaural phase difference (IPD). Unlike previous approaches, this EM algorithm estimates true probability distributions over both the direction from which sounds originate and the regions of the time-frequency plane associated with each sound source. The basic assumptions that make this possible are that a single source dominates each time-frequency point and that a single delay and amplification cause the difference in the ears X  signals at a particular point. By modelling the observed IPD in this way, this method overcomes many of the limitations of other systems. It is able to localize more sources than it has observations, even in reverberant environments. It makes no assumptions about the statistics of the source signal, making it well suited to localizing speech, a highly non-Gaussian and non-stationary signal. Its probabilistic nature also facilitates the incorporation of other probabilistic cues for source separation such as those obtained from single-microphone computational auditory scene analysis.
 Many comparable methods are also based on IPD, but they first convert it into interaural time differ-ence. Because of the inherent 2  X  ambiguity in phase differences, this mapping is one-to-one only up to a certain frequency. Our system, however, is able to use observations across the entire frequency range, because even though the same phase difference can correspond to multiple delays, a particular delay corresponds unambiguously to a specific phase difference at every frequency.
 We evaluate our system on the localization and separation of two and three simultaneous speakers in simulated anechoic and reverberant environments. The speech comes from the TIMIT acoustic-phonetic continuous speech corpus [2], the anechoic simulations use the head related transfer func-tions described in [3], and the reverberant simulations use the binaural classroom impulse responses described in [4]. We use four metrics to evaluate our system, the root mean square localization error, the mutual information between the estimated mask and a ground truth mask, the signal to noise ratio of separated speech from [5], and the W-disjoint orthogonality metric of [1]. Our EM approach outperformed Yilmaz and Rickard X  X  DUET algorithm [1] and Aarabi X  X  PHAT-histogram [6] in anechoic situations, and performed comparably to PHAT-histogram in reverberation. 1.1 Previous work Many systems exist for localizing sounds using a microphone array, e.g. [7]. These systems can be quite accurate, but this accuracy requires physical bulk, special hardware to synchronize many recordings, and tedious calibration procedures. They isolate signals in reverberation using direc-tional filtering, which becomes more selective only through the addition of further microphones. Because of the structure and abilities of the human auditory system, researchers have paid partic-ular attention to the two-microphone case. Roman et al. [5] make empirical models of the timing and level differences for combinations of two sources in known positions synthesized with ane-choic head-related transfer functions (HRTFs). They then classify each time-frequency cell in their auditory-based representation, creating a binary time-frequency mask which contains the cells that appear to be dominated by the target source.
 Yilmaz and Rickard [1] studied the interaction of speech signals in the time-frequency plane, con-cluding that multiple speech signals generally do not overlap much in both time and frequency. They also conclude, as in [5], that the best ground truth mask includes only points in which the signal to noise ratio is 0dB or greater. They propose a method for localization that maps IPD to delay before aggregating information and thus cannot use information at higher frequencies. It is designed for anechoic and noise-free situations and subsequently its accuracy suffers in more realistic settings. Aarabi [6] and Rennie [8] focus on localizing sounds. Aarabi X  X  method, while quite simple, is still one of the most accurate methods for localizing many simultaneous sound sources, even in reverberation. Rennie refined this approach with an EM algorithm for performing the same process probabilistically. A limitation of both algorithms, however, is the assumption that a single source dominates each analysis window, as compared to time-frequency masking algorithms which allow different sources to dominate different frequencies in the same analysis window. For the purposes of deriving this model we will examine the situation where one sound source arrives at two spatially distinct microphones or ears. This will generalize to the assumption that only a single source arrives at each time-frequency point in a spectrogram, but that different points can contain different sources.
 respectively. The two received signals will have some delay and some gain relative to the source, in addition to a disruption due to noise. For this model, we assume a convolutive noise process, because it fits our empirical observations, it is easy to analyze, and in general is it is very similar to the additive noise processes that other authors assume. The various signals are then related by, The ratio of the short-time Fourier transforms, F{ X } , of both equations is the interaural spectrogram, where  X  =  X  `  X   X  r , N (  X ,t ) = N ` (  X ,t ) N that  X  is much smaller than the length of the window over which the Fourier transform is taken, a condition easily met for dummy head recordings with moderately sized Fourier transform windows. For example, in our experiments the maximum delay was 0.75ms, and the window length was 64ms. As observed in [9], N (  X ,t ) , the noise in the interaural spectrogram of a single source, is uni-modal and approximately identically distributed for all frequencies and times. Using the standard rectangular-to-polar change of coordinates, the noise can be separated into independent magnitude and phase components. The magnitude noise is approximately log-normal, while the phase noise has a circular distribution with tails heavier than the von Mises distribution. In this work, we ig-nore the magnitude noise and approximate the phase noise with a mixture of Gaussians, all with the same mean. This approximation includes the distribution X  X  heavy tailed characteristic, but ignores the circularity, meaning that the variance of the noise is generally underestimated. A true circular distribution is avoided because its maximum likelihood parameters cannot be found in closed form. The only observed variable in our model is  X  (  X ,t ) , the phase difference between the left and right channels at frequency  X  and time t . While 2  X  ambiguities complicate the calculation of this quantity,  X   X  (  X ,t ;  X  ) = arg L (  X ,t ) R (  X ,t ) e j X  X  as a function of the observation.
 Our model of the interaural phase difference is a mixture over sources, delays, and Gaussians. In particular, we have I sources, indexed by i , each of which has a distribution over delays,  X  . For this model, the delays are discretized to a grid and probabilities over them are computed as a multinomial. This discretization gives the most flexible possible distribution over  X  for each source, but since we expect sources to be compact in  X  , a unimodal parametric distribution could work. Experiments approximating Laplacian and Gaussian distributions over  X  , however, did not perform as well at localizing sources or creating masks as the more flexible multinomial.
 For a particular source, then, the probability of an observed delay is where p 6 N (  X  ) is the probability density function of the phase noise, N (  X ,t ) , described above. We approximate this distribution as a mixture of J Gaussians, indexed by j and centered at 0 , In order to allow parameter estimation, we define hidden indicator variables z  X t ij X  such that z  X t ij X  = 1 if  X  (  X ,t ) comes from Gaussian j in source i at delay  X  , and 0 otherwise. There is one indicator for each observation, so P ij X  z  X t ij X  = 1 and z  X t ij X   X  0 .
 The estimated parameters of our model are thus  X  ij X   X  p ( i,j, X  ) , a third order tensor of discrete probabilities, and  X  ij , the variances of the various Gaussians. For convenience, we define  X   X  {  X  Thus, the total log-likelihood of our data, including marginalization over the hidden variables, is: This log likelihood allows us to derive the E and M steps of our algorithm. For the E step, we compute the expected value of z  X t ij X  given the data and our current parameter estimates, Figure 1: Example parameters estimated for two speakers located at 0  X  and 45  X  in a reverberant classroom. (a) Ground truth mask for speaker 1, (b) mask estimated by Yilmaz X  X  algorithm, (c) mask estimated by Aarabi X  X  algorithm, (d) mask estimated by EM algorithm, (e) probability distribution over  X  for each speaker p (  X  | i ) estimated by EM algorithm, (f) probability distribution over phase error for each speaker, p (  X  (  X ,t ) | i, X  ) estimated by EM algorithm.
 For the M step, we first compute the auxiliary function Q (  X  |  X  s ) , where  X  is the set of parameters over which we wish to maximize the likelihood, and  X  s is the estimate of the parameters after s iterations of the algorithm.
 where c does not depend on  X  . Since Q is concave in  X  , we can maximize it by taking derivatives with respect to  X  and setting them equal to zero while also including a Lagrange multiplier to enforce the constraint that P ij X   X  ij X  = 1 . This results in the update rules Note that we are less interested in the joint distribution  X  ij X  = p ( i,j, X  ) than other distributions derived from it. Specifically, we are interested in the marginal probability of a point X  X  coming from source i , p ( i ) , the distributions over delays and Gaussians conditioned on the source, p (  X  | i ) and p ( j | i ) , and the probability of each time-frequency point X  X  coming from each source, M i (  X ,t ) . To calculate these masks, we marginalize p ( z  X t ij X  |  X  (  X ,t ) , X  ) over  X  and j to get See Figure 1(d)-(f) for an example of the parameters estimated for two speakers located at 0  X  and 45  X  in a reverberant classroom. In order to evaluate our system, we simulated speech in anechoic and reverberant noise situations by convolving anechoic speech samples with binaural impulse responses. We used speech from the TIMIT acoustic-phonetic continuous speech corpus [2], a dataset of utterances spoken by 630 native American English speakers. Of the 6300 utterances in the database, we chose 15 at random to use in our evaluation. To allow the speakers to be equally represented in each mixture, we normalized all of the signals by their average energies before convolving them with the binaural impulse responses. The anechoic binaural impulse responses came from Algazi et al. [3], a large effort to record head-related transfer functions for many different individuals. Impulse response measurements were taken over the sphere surrounding subjects X  heads at 25 different azimuths and 50 different elevations. The measurements we used were for the KEMAR dummy head with small ears, although the dataset contains impulse responses for around 50 individuals.
 The reverberant binaural impulse responses we used were recorded by Shinn-Cunningham et al. in a real classroom [4]. These measurements were also made with a KEMAR dummy head, although a different actual unit was used. Measurements were taken at four different positions in the classroom, three distances from the subject, seven directions, and three repetitions of each measurement. We used the measurements taken in the middle of the classroom with the sources at a distance of 1 m from the subject.
 Our method has a number of parameters that need to be set. Perhaps the most important part of running the algorithm is the initialization. We initialized it by setting p (  X  | i ) to discrete approx-imations to Gaussians centered at the I largest peaks in the average cross-correlation. The other parameters are numerical. Following [1], we use a 1024 point window, which corresponds to 64 ms at 16 kHz. We chose J , the number of Gaussians in the noise GMM, to be 2, striking a balance between model flexibility and computational cost. Since the log likelihood increases monotonically with each EM iteration, we chose to stop after 10, when improvements in log likelihood generally became insignificant. Finally, we discretized  X  to 31 values linearly spaced between -0.9375 ms and 0.9375 ms. 4.1 Comparison algorithms We compare the performance of the time-frequency masks and the localization accuracy of our algorithm with those of two other algorithms. The first is Yilmaz and Rickard X  X  DUET algorithm from [1], although it had to be modified slightly to accommodate our recordings. In order to estimate the interaural time and level differences of the signals in a mixture, DUET creates a two-dimensional histogram of them at every point in the interaural spectrogram. It then smooths the histogram and finds the I largest peaks, which should correspond to the I sources.
 The interaural parameter calculation of DUET requires that the interaural phase of a measurement unambiguously translates to a delay. The maximum frequency at which this is possible is c 2 d where c is the speed of sound and d is the distance between the two microphones. The authors in [1] choose a fixed sampling rate and adjust the distance between their free-standing microphones to prevent ambiguity. In the case of our KEMAR recordings, however, the distance between the two ears is fixed at approximately 0.15 m and since the speed of sound is approximately 340 m/s, we must lower the maximum frequency from 8000 to 1150 Hz. Even though the frequencies used to estimate the interaural parameters are limited, a time-frequency mask can still be computed for all frequencies. See Figure 1(b) for an example of such a mask estimated by DUET.
 We also implemented Aarabi X  X  PHAT-histogram technique from [6], augmented to create time-frequency masks. The algorithm localizes multiple simultaneous sources by cross-correlating the left and right channels using the Phase Transform (PHAT) for each frame of the interaural spectro-gram. This gives point estimates of the delay at each frame, which are pooled over all of the frames of the signal into a histogram. The I largest peaks in this histogram are assumed to be the interaural delays of the I sources. While not designed to create time-frequency masks, one can be constructed that simply assigns an entire frame to the source from which its delay originates. See Figure 1(c) for an example mask estimated by PHAT-histogram.
 As discussed in the next section, we compare these algorithms using a number of metrics, some of which admit baseline masks. For power-based metrics, we include ground truth and random masks in the comparison as baselines. The ground truth, or 0 dB, mask is the collection of all time-frequency points in which a particular source is louder than the mixture of all other sources, it is included to measure the maximum improvement achievable by an algorithmically created mask. The random mask is created by assigning each time-frequency point to one of the I sources at random, it is included to measure the performance of the simplest possible masking algorithm. 4.2 Performance measurement Measuring performance of localization results is straightforward, we use the root-mean-square error. Measuring the performance of time-frequency masks is more complicated, but the problem has been well studied in other papers [5, 1, 10]. There are two extremes possible in these evaluations. The first of which is to place equal value on every time-frequency point, regardless of the power it contains, e.g. the mutual information metric. The second is to measure the performance in terms of the amount of energy allowed through the mask or blocked by it, e.g. the SNR and WDO metrics. To measure performance valuing all points equally, we compute the mutual information between the ground truth mask and the predicted mask. Each mask point is treated as a binary random variable, so the mutual information can easily be calculated from their individual and joint entropies. In order to avoid including results with very little energy, the points in the lowest energy decile in each band are thrown out before calculating the mutual information. One potential drawback to using the mutual information as a performance metric is that it has no fixed maximum, it is bounded below by 0, but above by the entropy of the ground truth mask, which varies with each particular mixture. Fortunately, the entropy of the ground truth mask was close to 1 for almost all of the mixtures in this evaluation.
 To measure the signal to noise ratio (SNR), we follow [5] and take the ratio of the amount of energy in the original signal that is passed through the mask to the amount of energy in the mixed signal minus the original signal that is passed through the mask. Since the experimental mixtures are simulated, we have access to the original signal. This metric penalizes masks that eliminate signal as well as masks that pass noise. A similar metric is described in [1], the W-disjoint orthogonality (WDO). This is the signal to noise ratio in the mixture the mask passes through, multiplied by a (possibly negative) penalty term for eliminating signal energy.
 When evaluated on speech, energy based metrics tend to favor systems with better performance at frequencies below 500 Hz, where the energy is concentrated. Frequencies up to 3000 Hz, however, are still important for the intelligibility of speech. In order to more evenly distribute the energy across frequencies and thus include the higher frequencies more equally in the energy-based metrics, we apply a mild high pass pre-emphasis filter to all of the speech segments. The experimental results were quite similar without this filtering, but the pre-emphasis provides more informative scoring. 4.3 Results We evaluated the performance of these algorithms in four different conditions, using two and three simultaneous speakers in reverberant and anechoic conditions. In the two source experiments, the target source was held at 0  X  , while the distracter was moved from 5  X  to 90  X  . In the three source experiments, the target source was held at 0  X  and distracters were located symmetrically on either side of the target from 5  X  to 90  X  . The experiment was repeated five times for each separation, using different utterances each time to average over any interaction peculiarities. See Figure 2 for plots of the results of all of the experiments.
 Our EM algorithm performs quite well at localization. Its root mean square error is particularly low for two-speaker and anechoic tests, and only slightly higher for three speakers in reverberation. It does not localize well when the sources are very close together, i.e. within 5  X  , most likely because of problems with its automatic initialization. At such a separation, two cross-correlation peaks are difficult to discern. Performance also suffers slightly for larger separations, most likely a result of greater head shadowing. Head shadowing causes interaural intensity differences at high frequen-cies which change the distribution of IPDs, and violate our model X  X  assumption that phase noise is identically distributed across frequencies.
 It also performs well at time-frequency masking, more so for anechoic simulations than reverberant. See Figure 1(d) for an example time-frequency mask in reverberation. Notice that the major features follow the ground truth, but much detail is lost. Notice also the lower contrast bands in this figure at 0, 2.7, and 5.4 kHz corresponding to the frequencies at which the sources have the same IPD, modulo 2  X  . For any particular relative delay between sources, there are frequencies which provide no information to distinguish one from the other. Our EM algorithm, however, can distinguish between the two because the soft assignment in  X  uses information from many relative delays. Figure 2: Experimental results for four conditions (rows) compared using four metrics (columns). First row: two sources, anechoic; second row: three sources, anechoic; third row: two sources, reverberant; fourth row: three sources, reverberant.
 The EM approach always performs as well as the better of the other two algorithms and outperforms them both in many situations. Its localization performance is comparable to PHAT-histogram in two-speaker conditions and slightly worse in three-speaker conditions. DUET suffers even in anechoic, two-source situations, possibly because it was designed for free-standing microphones as opposed to dummy head recordings. Its performance decreases further as the tasks become more difficult. The advantage of our method for masking, however, is particularly clear in anechoic conditions, where it has the highest mutual information at all angles and the highest SNR and WDO at lower angles. In reverberant conditions, the mutual information between estimated masks and ground truth masks becomes quite low, but PHAT-histogram comes out slightly ahead. Comparing SNR measure-ments in reverberation, PHAT-histogram and the EM approach perform similarly, with DUET trail-ing. In WDO, however, PHAT-histogram performs best, with EM and DUET performing similarly to the random mask. We have derived and demonstrated an expectation-maximization algorithm for probabilistic source separation and time-frequency masking. Using the interaural phase delay, it is able to localize more sources than microphones, even in the reverberation found in a typical classroom. It does not depend on any assumptions about sound source statistics, making it well suited for such non-stationary signals as speech and music. Because it is probabilistic, it is straightforward to augment the feature representation with other monaural or binaural cues.
 There are many directions to take this project in the future. Perhaps the largest gain in signal sepa-ration accuracy could come from the combination of this method with other computational auditory scene analysis techniques [11, 12]. A system using both monaural and binaural cues should surpass the performance of either approach alone. Another binaural cue that would be easy to add is IID caused by head shadowing and pinna filtering, allowing localization in both azimuth and elevation. This EM algorithm could also be expanded in a number of ways by itself. A minimum entropy prior [13] could be included to keep the distributions of the various sources separate from one another. In addition, a parametric, heavy tailed model could be used instead of the current discrete model to ensure unimodality of the distributions and enforce the separation of different sources. Along the same lines, a variational Bayes model could be used with a slightly different parameterization to treat all of the parameters probabilistically, as in [14]. Finally, we could relax the independence con-straints between adjacent time-frequency points, making a Markov random field. Since sources tend to dominate regions of adjacent points in both time and frequency, the information at its neighbors could help a particular point localize itself.
 Acknowledgments The authors would like to thank Barbara Shinn-Cunningham for sharing her lab X  X  binaural room impulse response data with us and Richard Duda for making his lab X  X  head-related transfer functions available on the web. This work is supported in part by the National Science Foundation (NSF) under Grants No. IIS-0238301, IIS-05-35168, CCR-0312690, and IIS-0347499. Any opinions, findings and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the NSF.

