 Advances in real-time location system (RTLS) solutions have enabled us to collect massive amounts of fine-grained se-mantically rich location traces, which provide unparalleled opportunities for understanding human activities and dis-covering useful knowledge. This, in turn, delivers intelli-gence for real-time decision making in various fields, such as workflow management. Indeed, it is a new paradigm for workflow modeling by the knowledge discovery in location traces. To that end, in this paper, we provide a focused study of workflow modeling by the integrated analysis of indoor location traces in the hospital environment. In com-parison with conventional workflow modeling based on pas-sive workflow logs, one salient feature of our approach is that it can proactively unravel the workflow patterns hid-den in the location traces, by automatically constructing the workflow states and estimating parameters describing the transition patterns of moving objects. Specifically, to deter-mine a meaningful granularity for the model, the workflow states are first constructed as regions associated with spe-cific healthcare activities. Then, we transform the original indoor location traces to the sequences of workflow states and model the workflow transition patterns by finite state machines. Furthermore, we leverage the correlations in the location traces between related types of medical devices to reinforce the modeling performance and enable more appli-cations. The results show that the proposed framework can not only model the workflow patterns effectively, but also have managerial applications in workflow monitoring, au-diting, and inspection of workflow compliance, which are critical in the healthcare industry.
Contact Author. H.4 [ Information Systems Applications ]: Miscellaneous; H.2.8 [ Database Management ]: Database Applications X  Data Mining Algorithms, Application Indoor Location Traces, Workflow Modeling, Healthcare Op-eration and Management
Recent years have witnessed the increasing deployment of real-time location systems (RTLS) in hospitals. These RTLS solutions, as shown in Figure 1, allow people to track and monitor the movement of moving objects (e.g., medical devices, doctors and patients), and the interactions between people and medical devices. However, currently such sys-tems are only used for basic tasks, such as simply locating a wheel chair and checking the availability of an inpatient bed. Meanwhile, hospital managers are still facing many manage-rial challenges. Particularly, there are three important tasks of operation and management in hospital: workflow moni-toring , workflow auditing , and inspection of workflow com-pliance . For example, many healthcare providers have their own work protocols to ensure that the healthcare practices are executed in a controlled manner. Non-compliance prac-tices may be costly and expose the healthcare providers to severe risks, such as litigation, prosecution and damage to brand reputation. However, it is not an easy task to system-atically evaluate the degree to which the ongoing healthcare processes are compliant with the predefined protocols. Thus, effective inspection of workflow compliance is very needed by healthcare providers to maintain the performance and rep-utation of their services.

Conventionally, to accomplish these tasks, hospital man-agers mainly rely on inspecting detailed workflow logs, which are managerially daunting. In particular, the logs can be heterogeneous in format and stored in different media. For example, many medical records are still documented in pa-pers, which are not easy to be systematically processed and analyzed in real time. More importantly, these workflow logs are provided passively by the personnel, which might be bi-ased. In contrast, a proactive approach requiring minimum human intervention would be a promising complement for the workflow management tasks. Indeed, the existing RTLS and collected location traces provide unparalleled opportu-nities for us to develop new ways to help with the workflow management tasks. To this end, this paper provides a fo-cused study of workflow modeling by the integrated analysis of indoor location traces in the hospital environments. One major goal is to proactively unravel the workflow patterns hidden in the location traces, by automatically constructing the workflow states and estimating parameters describing the transition patterns of medical devices. The discovered knowledge from the indoor location traces are then trans-formed to actionable intelligence for healthcare operation and management. Indeed, the learned workflow model is valuable in that a wide range of practical problems in hospi-tal environments can be relieved with the modeling results.
Although modeling the workflow patterns in the hospi-tal environments is of significant managerial value, it is a non-trivial task to systematically construct and estimate the models with the massive indoor location traces. First, there are some inherent characteristics in the indoor sce-nario, which pose new challenges to the workflow analysis.  X  The granularity and quality of indoor location traces cap-tured by wireless location systems might vary a lot from place to place due to several factors: the density of sensor receivers, the underlying localization techniques, and the sensor device itself (e.g., the battery power percentage).  X  The topologies of indoor space are often much more com-plex than outdoor space. Therefore, some fundamental assumptions of outdoor scenarios may not hold for indoor scenarios. For example, the widely-used similarity mea-surements for outdoor trajectories based on geometry dis-tance [4] or overlapping degree [6] are not much meaningful for indoor location traces.  X  The structure of indoor space is very dynamic and the modeling framework should be automatic and adaptive ac-cordingly. For instance, the structure and utility of many modern buildings may be frequently changed per the on-going needs. Such dynamic changes will alter the semantic of indoor location traces.

As a result, even there are intensive works on the analysis of outdoor location traces [6, 12, 5], most of them are not suitable or practical for modeling the indoor location traces of medical devices. Moreover, the results of those methods are not very helpful towards the workflow analysis in hos-pital environments. For example, the method developed by Giannotti et al. [6] aims for the discovery of frequent tra-jectory patterns based on given thresholds, i.e., minimum support and time tolerance, from outdoor location traces. However, such frequent patterns cannot provide a parsimo-nious description for healthcare activities in hospitals. For example, to help with workflow compliance inspection, we need to consider all activities rather than only a subset of moving patterns, i.e., frequent patterns. Similarly, the peri-odic patterns mined from outdoor spatio-temporal data by Mamoulis et al. [12] are also a subset of moving activities and cannot fully meet the needs of workflow monitoring, auditing, or compliance inspection in a hospital. While Yin Figure 1: A demonstration of the real-time location system in hospitals. At the bottom layer, the moving objects (medi-cal devices, patients, doctors, etc.) are attached with sensor tags, which send signals to the sensor receivers. The sen-sor receivers at the middle layer transmit the signal data to the network bridges. At the top layer, network bridges con-nected with data/application servers will collect the signal data and the data/application servers will calculate loca-tions of the tracked objects. et al. [17] proposed stochastic models for indoor activities, the purpose of these models is to predict the goals of ac-tivities, rather than summarize overall activity patterns in descriptive ways. Besides, their methods are mostly super-vised and need sufficient training data.

To accommodate the unique characteristics of indoor loca-tion traces of medical devices in a hospital, in this paper, we propose a stochastic process-based framework to model the healthcare workflow. First, to extract each workflow state which is related to a particular type of healthcare activity, we develop a density-based clustering algorithm to partition the indoor space. Particularly, to incorporate the complex indoor topologies, we compute the neighborhood of a loca-tion record and its density in the indoor space based on the transition history rather than the geometry distance. With the clustering results, we further transform the original lo-cation traces into the sequences of workflow states. Then we analyze the workflow sequences by modeling the transitions among states with finite state machines.

Second, due to the dynamic indoor structure, we need an automatic and adaptive modeling framework to support the critical applications in real time. However, during some spe-cific periods of observation, the estimation of parameters in the finite state machines may be unstable due to the data scarcity issue of the location traces. Meanwhile, there is some natural correlation in the location traces of a group of medical devices, which are often used together for a partic-ular task. By leveraging such correlation, we may overcome the data scarcity issue and improve the robustness of the pa-rameter estimation for the finite state machines. Therefore, we explore MAP (Maximum A Posteriori) estimation in the Hidden Markov Random Fields (HMRFs) to estimate the transition probabilities, which can effectively leverage the correlation in the location traces of related medical devices. Moreover, in addition to the correlation relationship, we will be able to integrate more prior or domain information about the workflow of medical devices with the HMRFs, which will further improve the effectiveness of our workflow modeling.
Finally, we demonstrate the effectiveness of our models with the real-world data collected from multiple hospitals in US. We have also implemented and deployed a management information system, HISflow , based on our methods to show how the discovered knowledge can help with the three im-portant managerial tasks in hospitals: workflow monitoring, auditing, and inspection of workflow compliance.
In this section, we first introduce the data format of the in-door location traces. Then, we formally formulate the prob-lem of workflow modeling for medical devices.
Our location traces (trajectories) of medical devices are collected from indoor environments of several US hospitals. The location trace of an object O is represented as a se-quence: O t = ( L 1 ,L 2 ,... ) , where L i represents the i th record in the sequence. L i = ( start i ,end i ; x i ,y i ,z i specific coordinate and the corresponding timestamp when that record is recorded, where start i and end i are the start time and the end time of L i . In other words, during the time frame from start i to end i , the object O stays at the coordinate ( x i ,y i ,z i ) in a three-dimensional indoor space.
However, the indoor wireless communication may be in-terrupted by environmental factors and lead to some errors or noises for the localization of moving objects. Therefore, a coordinate localized by the RTLS might not indicate the exact position, but a small area surrounding the coordinate. In addition, it may not be meaningful to directly use these coordinates for workflow modeling in the indoor space. For example, for two recorded coordinates which are close to each other on the same floor, although the geometry dis-tance of them is very small, the actual moving distance from one coordinate to another one may be very long when there is a wall between these two coordinates.

To cope with these challenges, we normalize the origi-nal location traces for workflow modeling. Specifically, we project each raw coordinate to a semantic location of the building, such as a room in the hospital, based on the floor maps of the building. For the data and maps in this study, each hallway is also treated as a room and some long hall-ways have been segmented into several small rooms. Then, we map L i = ( start i ,end i ; x i ,y i ,z i ) to L  X  i = ( start where r i is the room containing the coordinate ( x i ,y i After this projection, two neighboring coordinates of the raw location traces may be mapped into the same room. In prac-tice, we merge these consecutive records within the same room to one union record. Specifically, if i &lt; j and r r i +1 =  X  X  X  = r j , we replace the subsequence ( L i ,L i +1 with only one record L  X  i = ( start i ,end j ,r i ).
Now, each raw location record L i is mapped to a sym-bolic room (graph node), and each location trace Tr = ( L 1 ,L  X  2 ,  X  X  X  ) is transformed to a symbolic sequence (trav-eling path). This data preprocessing drastically reduces the computational cost, since we significantly reduce the number of records in the data after the projection. Also, this pre-processing step greatly smooths out the noise and alleviates the impact of errors on the workflow modeling tasks.
The ultimate goal of our workflow pattern modeling is to automatically summarize the healthcare activities in a sys-tematic manner. To this end, the concept of workflow pat-terns is actually a hierarchy with several levels. At the low-est level, the location trace itself can be seen as an instance of workflow patterns. For example, in Figure 2, we show location traces of an infusion pump with red line segments. However, it is difficult to comprehensively understand the pattern hidden in the raw location traces.

On the other hand, three workflow stages at the highest level are widely used in the healthcare industry to describe the workflow logistics: preprocessing maintenance stage , in-use stage , postprocessing maintenance stage . The in-use stage of a medical device corresponds to the period when it is used for any healthcare purpose. Before the in-use stage , a device is in the preprocessing maintenance stage , e.g., held in the storage room. After the in-use stage , the de-vice must go through the postprocessing maintenance stage before the next circle of use. These maintenance processes include cleaning up, sterilization, disinfection, etc. However, modeling the workflow patterns based on these three stages is too coarse to get useful results to help with tasks of op-eration and management in a hospital. In particular, one important factor missed by the workflow stages is the spa-tial information, and the modeling results based on these high level stages cannot facilitate the workflow evaluation from the spatial perspectives, such as the evaluation for the utilization efficiency of the indoor space. Therefore, we need to model the workflow patterns using a middle-level repre-sentation of location traces of medical devices.
To that end, we introduce an important concept, workflow state , which will serve as a basis for our workflow modeling at the proper level of granularity. Indeed, to better understand the location traces, we need to annotate a few key locations in these trajectories. For example, as shown in Figure 2, we annotate location traces with important location spots: C i ( i = 1 ,  X  X  X  , 5). The medical functions of these spots are summarized in Table 1. With these annotations, the location trace in red in Figure 2 can be represented as C 1 7 X  C 2 C 3 7 X  C 4 . Such representation with annotated spots makes it easy to understand the workflow behind the location trace.
In fact, Figure 2 is the map of the second floor of a hos-pital building, which is centered around E 1 , the elevator connected to the basement. The red location trace of one infusion pump starts from the storage room in the base-ment to the elevator E 1 . After E 1 , the first spot C 1 Anesthesia Care Unit (PACU) where the patient is ready for medical procedures such as surgery and the medical de-vices are attached with the patients. Spot C 2 is the area of operating rooms (OR) where medical procedures happen. After the medical procedure, the patients and the medical devices are moved to C 3 , Intensive Care Unit (ICU), based on the medical needs. When the situation of the patient becomes stable, the patient and the medical devices being used will be further moved to C 4 , Patient Care Unit (PCU), before the patient is discharged. After the patient is dis-charged, the medical devices will be moved through elevator E 2 to the basement for cleaning up in a disinfection room and depositing into the storage rooms.

From the above example, we know that each spot with a particular healthcare purpose corresponds to a workflow state, and the location traces represented with such workflow states are very meaningful for understanding and modeling the workflow patterns. Therefore, we formally define the workflow states in the context of hospitals as follows:
Definition 1 (Workflow state). A workflow state is a location spot in the indoor space where specific healthcare activities frequently happen.

According to this definition, a workflow state might be a cluster of location records with specific activities. In the above example, we have workflow states C 1 ,C 2 ,C 3 ,C 4 representing the location traces with workflow states, the workflow patterns are more clear to be understood and in-ferred than that with symbolic rooms or high level stages.
With workflow states, a further task is to describe the transition patterns of the moving objects among the work-flow states. As shown in Figure 2, the transition from one state may go to several different states. For example, when the situation of a patient is stable after the medical oper-ation at C 2 , the medical devices and the patient might be moved directly to PCU without passing through ICU ( C 3 ). Also, there are more than one PCU spots in the hospital. For example, in addition to C 4 , we have C 5 as another PCU spot in Figure 2. Note that, Figure 2 is only one floor in one building. In fact, we may have many workflow states since there might be several buildings and many floors in one hos-pital. Thus, the overall workflow patterns are indeed much more complex than the examples discussed above.

Furthermore, we have multiple types of medical devices moving around in the indoor space. In hospitals, many dif-ferent medical devices are often used together for a partic-ular task. Therefore, although different types of medical devices have different workflow patterns, there is some nat-ural correlation among their location traces. Modeling such correlation not only helps reinforce the robustness of the workflow modeling, but also provides better understanding of the overall workflow patterns.

Now, we can formally state the problem of workflow pat-tern modeling in the indoor healthcare environments.
Problem 1 (Workflow pattern modeling). Given the collected location traces ( { Tr } ) of moving objects, such as medical devices, workflow pattern modeling is to discover the workflow knowledge including workflow states ( C ), and parameters (  X  ) describing the transition patterns of the mov-ing objects among the workflow states. In addition, we would also like to learn the correlation measurement ( s ) among the transition patterns for different types of moving objects. To accomplish these tasks, in Section 3, we first propose a clustering algorithm to construct the workflow states. Next, in Section 4, we model the transition patterns among the workflow states with finite state machines. In Section 5, we further show how to learn the correlation measurement and build the transition models in a reinforcement way.
Inspired by Liu et al. [10], we develop a DBSCAN-style clustering algorithm to construct the workflow states from the location traces. This density-based method is adopted to meet the requirements for the workflow analysis. Particu-larly, the clustering method should be able to automatically determine the number of clusters, and detect clusters of dif-ferent densities and arbitrary shapes. The detected clusters should also be spatially contiguous, since we want to iden-tify areas of semantically meaningful locations, such as  X 2nd floor northeast patient rooms X  and  X  X asement central storage rooms X . However, even if we adopt the framework in [10], we have to develop some new methods to address the challenges caused by the unique characteristics of the workflow traces. First, we need a meaningful neighborhood definition for the location records in the indoor space. Second, to cope with the definition of workflow states, we need a density defini-tion associated with workflow activities to detect clusters of different densities.

To address these challenges, let us first introduce how to define the neighborhood of a location record by exploiting the topologies of the indoor space. Since the location traces are represented symbolically, the indoor space map can be modeled with a corresponding symbolic graph. With all the symbolic nodes V as vertices of the graph G = ( V,E ), we can use edge E to represent neighboring relationship among the nodes. An edge is added between two vertices if a direct transition path between the corresponding pair of symbolic location nodes exists. Formally, we define the neighboring relationship based on the transition connectivity:
Definition 2 (Transition neighborhood). For room r , we denote as the transition neighboring rooms of r 0 . One room r is said to be transition neighbor of another room r 0 if one can transit from r to r 0 without passing through other rooms.
With Definition 2, we define the neighborhood of a loca-tion record in the symbolic space:
Definition 3. The neighborhood of a location record L 0 = ( start 0 ,end 0 ,r 0 ) is a set of location records observed in the rooms that are involved in transitions to r 0 , denoted by Thus, instead of identifying the neighborhood of a location record based on a distance threshold as used in DBSCAN, we define the neighborhood of a location record by directly querying the transition history from the data. In this way, we avoid the use of parameters, such as the distance thresh-old, which DBSCAN is very sensitive to.

To detect the clusters of different densities, we propose a weighted density definition to measure the density of in-dividual neighborhood and identify core location records. If we know the distribution of waiting time T in room r 0 then a natural choice to weight the location record L = ( start,end,r 0 ) is the p -value w ( L ) = Pr( T  X  d ) , where d = end  X  start is the waiting time of L . Intuitively, a longer waiting time d will lead to a bigger weight, as it takes time to carry out medical procedures and we are identifying the spot where specific medical activities frequently happen. If we do not know the distribution of T , which often happens in reality, we propose to estimate the weight as With this formulation, we have the following definition of the weighted density for a neighborhood: Definition 4. The weighted density of a neighborhood N ( L 0 ) is defined as: w ( N ( L 0 )) =
Example. By the definition above, suppose N ( L 0 ) = { L = ( start,end,r 0 ) } , let us calculate the weighted density for the following distributions of waiting times:  X  D 1 = { 1 , 2 ,  X  X  X  , 10 } , 10 observations.  X  D 2 = { 5 . 5 , 5 . 5 ,  X  X  X  , 5 . 5 } , 10 observations.  X  D 3 = { 1 , 1 ,  X  X  X  , 1 } , 55 observations.
 Although the total waiting time of D 1 , D 2 and D 3 same as 55, our weighted densities are 3 . 85, 5 . 5, 1 respec-tively. For D 3 , the neighborhood N ( L 0 ) is more likely in hallway or in front of elevator. Although the total waiting time in these places is long due to a lot of trajectories pass-ing around, there is no long period of waiting time for carry-ing out medical procedures. Our weighted density definition can underrate this kind of situations. Similarly, observations with shorter waiting time in D 1 are also weighted lower.
Finally, we compare this estimated weighted density with a user-specified threshold  X  to decide if a location record is a core point or not. Although there is similar parameter in DBSCAN, i.e., minimum number of points required to form a cluster, the parameter  X  is not the count of points but a weight measurement based on historical statistics. Due to the space limit, readers are referred to Liu et al. [10] for details of the algorithm, except that the neighborhood and density definitions should be replaced by Definition 3 and 4.
With the constructed workflow states C , we can trans-form the original location trace into a workflow sequence Tr = ( s 1 ,s 2 ,  X  X  X  ,s l ) , where s i = ( c i ,d i ), c workflow state and d i is the waiting duration in c transformation makes it feasible to model the workflow se-quences of the objects moving among the indoor states with a continuous time Markov chain (CTMC). Specifically, with the constructed workflow states C as stochastic states in the workflow processes, a CTMC(  X  ) is defined with two sets of parameters  X  = ( P,q ): waiting time parameters q c for each state c  X  C , and state transition probabilities P cc 0 from state c to c 0 . Let S ( t )  X  C denote the state of the process at time t  X  [0 ,  X  ). CTMC stays in S ( t ) = c at time instant t for a random amount of duration D c  X  Exp( q c ). When CTMC finally leaves c , the next state of the system is c 0 with prob-ability P cc 0 where c 0 6 = c . For c = c 0 , we let P cc these parameters, for the process Tr starting from s 1 and ending at time d = P l i =1 d i , the probability of Tr is
Pr( Tr | P,q ) = exp(  X  q c l d l )
Without causing confusion, in the following, we denote states in C by integers 1 , 2 ,  X  X  X  , | C | for simplicity. For a set of processes { Tr } , the probability calculated above can also be expressed in terms of N and D , where N ij is the transition count from state i to state j , and D i = R [ S ( t ) = i ] dt is the total waiting time in state i . Specifically, Here, N i = P j N ij is the transition counts from state i . Note that by definition we have N ii = 0 and we compute P
One important fact in the likelihood of parameters P,q is that, we can estimate P ij and q i separately. That is, Pr( N,D | P,q ) = Pr( N | P ) Pr( N,D | q ), where: The solution to maximize Pr( N,D | q ) is q i = N i D words, q i is estimated by the reciprocal of the mean waiting time at state i . In the following, we will focus on optimizing Pr( N | P ) to estimate the transition probability matrix P .
Under the normalization constraints P j P ij = 1 and P ij 0, it is straightforward to estimate the parameters P using a maximum likelihood estimation approach. However, the result estimated in this way will be unstable if the train-ing data is not sufficient (e.g., when analyzing the daily data instead of monthly or yearly data). Fortunately, the data collected from different types of moving objects may help mutually reinforce each other to estimate the moving patterns in a robust way. To leverage this potential, we introduce the Maximum A Posteriori (MAP) estimation ap-proach which simultaneously estimates transition models for multiple types of moving objects. More importantly, with this approach, we will also be able to understand the collabo-rating relationship among different types of medical devices.
For the healthcare procedures of one patient, multiple types of medical devices are often needed. Thus, these dif-ferent types of moving objects transit together and produce the correlated location traces. Therefore, although differ-ent medical devices follow different patterns, their workflow models can be built jointly with the consideration of these correlations. To this end, we first piece together the work-flow states for all the K types of moving objects: where C ( k ) is the workflow states of the k th type of moving objects. Note that, when C 1  X  C (1) and C 2  X  C (2) overlap, i.e., C 1  X  C 2 6 =  X  , we merge them together as C 1  X  C Now, all the K types of transition sequences can be ex-pressed with the common transition states C , while each type has one transition count matrix N ( k ) and one transi-tion probability matrix P ( k ) . To estimate the K transition probability matrices { P ( k ) | 1  X  k  X  K } together based on { N ( k ) | 1  X  k  X  K } , we use Hidden Markov Random Fields (HMRFs) to leverage the correlation among all types of ob-jects. Specifically, an HMRF has the following components: Hidden field: In our model, the hidden field includes the transition matrices P ( k ) for 1  X  k  X  K for all types of objects, whose values are hidden or unobservable.
 Observations: The observed data includes the transition counts N ( k ) for 1  X  k  X  K .

As shown in Figure 3, there is also a connecting structure in the hidden field. We would like to reinforce the estimation of the connected parameters by leveraging the prior distri-bution of the random field. For our problem, we consider pairwise correlation among different types of objects, so the prior depends on P k the potential of the link between P ( k 1 ) and P ( k 2 ) cally, we have Pr( P )  X  exp(  X  P k ing this prior, the objective function to be maximized is: or equivalently log Pr( P | N ) =  X  X Note that a normalization constant is omitted in the log-likelihood equation.
HMRFs can integrate the knowledge about the neighbor-hood structure by formulating the potential V ( k 1 ,k the following, we demonstrate this framework by an unsu-pervised approach, where the neighborhood structure itself is also learned from the data. Specifically, we define the potential between them as where w  X  0 is a scaling constant. Here, the correlation s ( k 1 ,k 2 ) measures the similarity between the transition pat-terns of types k 1 and k 2 . The matrix trace Tr( P ( k 1 P serve about the contradicting moves. For example, in the ex-treme case when Tr( P ( k 1 ) P ( k 2 ) ) = 0, we have P ( k 0 for any given states i,j . In this case, we have P ( k jects that have no contradicting workflows, the probability of transition from state j to i is 0 for the second type of ob-jects, only if we have a positive transition probability from state i to j for the first type of objects.

To measure the correlation adaptively with respect to the observed data, we propose to parameterize the Frobenius inner product using a non-negative matrix M , which leads to the following formula: where the weighted Frobenius inner product is &lt; X,Y &gt; P ij X ij M ij Y ij and weighted Frobenius matrix norm is k X k  X  &lt; X,X &gt; M . Indeed, N is directional observation and s ( k 1 ,k 2 ) corresponds to a von-Mises Fisher (vMF) distri-bution [2] as the underlying generative model.
We need an iterative updating algorithm to learn the cor-relation from the data and optimize the objective function in Equation 4 simultaneously. Specifically, there are two sets of parameters: Frobenius weights M and transition proba-bilities P . To update the Frobenius weights by increasing Equation 4, a closed-form solution is unattainable. In this case, gradient ascent update can be used alternatively. Par-ticularly, the gradients are  X  log Pr( P | N ) and  X  X  ( k 1 ,k 2 )  X  1 With the given M , the optimal P can be obtained by solving the following KKT system: for 1  X  k  X  K and 1  X  i,j  X  | C | . Here  X  ki is a KKT multiplier. With the normalization constraints P j P ( k ) this quadratic system can be numerically solved. Note that, by iteratively conducting above updates, Equation 4 will be monotonically increased and we can stop the process when a sufficiently accurate solution is reached.
Here, we evaluate the performances of our workflow mod-els in indoor healthcare environments. First, we show the identified workflow states and analyze the goodness-of-fit of our transition models with respect to important statistics. Then, we show that the learned correlation can reinforce the modeling performance, especially for real-time applica-tions. The proposed models will also be compared with some baseline models. Finally, we showcase a few intelligent ap-plications in healthcare operation and management that can benefit from the learned knowledge.
We use real-world data sets for validation. These data sets are collected from several hospitals in US. Medical devices operated in these hospitals have been attached with sensor tags and tracked by RTLS developed by Awarepoint Cor-poration. In Table 2, we show basic statistics of the data collected for various types of medical devices in Hospital 1. Specifically, we will build workflow models for 7 types of medical devices. The 2nd and 3rd columns show the number of medical devices of each type operated in this hospital, and the number of location records collected during the period from January 2011 to August 2011.

In Hospital 1, there are totally 123 different workflow states identified. The last two columns in Table 2 give the number of workflow states identified for each device type and the corresponding threshold for density-based cluster-ing. We can see that different types of medical devices are used in different ranges of region. For instance, wheelchairs move among 121 workflow states, while feeding pumps tran-sit only in 58 workflow states. We also automatically iden-tified that PCA II Pump and Heating Pad only move in a small range, which means the workflows of these two types of devices are quite simple. Thus, in the following we focus on analyzing the remaining 5 types of devices which have more complex workflow patterns. For the threshold of clustering, we empirically specify the parameter based on the mobility of medical devices and the classical work time for treatment in order to achieve well-separated workflow states.
The identified workflow states are verified to be seman-tically meaningful by the domain experts. For example, in Figure 4, we show the constructed workflow states for Ven-odyne, which moves most frequently, on 4 building floors. A summary of these workflow states is reported in Table 3. Particularly, with the developed clustering algorithm based on the the weighted density (demonstrated as transparency), we can effectively focus on the most important location spots. For example, as shown in Figure 4a, although most of the right part on this floor is planned to be PCU (Patient Care Unit), we find that only a small subset of rooms were fre-quently used. This is especially surprising in the top right corner, where only one room was used efficiently. These observations lead to an important application, workflow au-diting, which we will further discuss in Section 6.5.2. Table 3: Semantic summary of workflow states in Figure 4.
We experimented with different values of the scaling con-stant w in Equation 5 to build the transition models. If w = 0, our framework gives the maximum likelihood es-timation. When w &gt; 0, the scaling constant controls the tradeoff between maximizing Pr( N | P ) and deconstructing the potentials in the hidden field. Users can chose a value according to the correlation degree of the workflow patterns. In this paper, we perform an exhaustive search in [ r 2 , with step size 0 . 1 where r is the average non-weighted Frobe-nius inner products of the transition matrices.

To measure the goodness-of-fit of the learned transition models, we compute the average log -loss with test location traces. For a test location trace Tr = ( L 1 ,L 2 ,  X  X  X  ,L its corresponding workflow sequence Tr = ( s 1 ,s 2 ,  X  X  X  ,s transformed with workflow states C , where s i = ( c i ,d average log-loss is calculated as where Pr( Tr | P,q ) is defined in Equation 1 and  X  = ( P,q ) is learned from training data. According to Rissanen and Langdon [14], smaller average log-loss implies better com-pression of the data when using the estimated parameters.
In the following, after constructing the workflow states C , we randomly partition the data into 10 subsets and compute the average log-loss in 10 rounds. In each round, we use 9 of these subsets as training data to estimate the transition parameters  X  = ( P,q ) and compute L ( Tr ) for each Tr in the remaining test data. The solid green lines in Figure 5 show the average log-loss along the sequence length ` for different types of medical devices. We also show the per-formances with dashed green lines for the baseline models. The baseline model of each type straightforwardly estimates the transition parameters without considering the correla-tion among different types of moving objects. In the figure, we can see that our models based on HMRFs achieve lower information loss consistently for all types of moving objects.
In practice, as we will discuss in Section 6.5, sufficient observations might not be available to monitor the ongo-ing workflow patterns. In this case, our models can per-form much better than baselines by holistic estimation. To demonstrate this, we repeat the above comparison by using only 1 subset as the training data. In Figure 5, as shown by the red lines, our models achieve much better performance. Our models not only achieve lower information losses, but also produce robust results without rigid jumps.
In addition to the goodness-of-fit in terms of information loss, a realistic model should also be able to simulate the modeled process without breaking important characteristics. In the research of time series data, one important character-istic is the autocorrelation function, ACF , which describes the serial dependence structure in the sequence models. In our workflow models, the state space C is categorical, thus we propose to investigate the  X  2 statistic to test the ho-mogeneity. Specifically, for a set of categorical sequences { Tr = ( c 1 ,  X  X  X  ,c l ) } where c i  X  C and C = { 1 , 2 ,  X  X  X  , | C |} , the auto  X  2 function , AXF, is calculated as M The degree of freedom of the corresponding  X  2 distribution for AXF( h ) is ( | C |  X  1) 2 . We can then calculate the p -value of the test of homogeneity with a null hypothesis that ( c ,  X  X  X  ,c l  X  h ) and ( c h ,  X  X  X  ,c l ) are independent. In Figure 6, we show the p -values of AXF( h ) for the raw observations in solid lines. As can be seen, the serial dependence structures of the simulated processes shown in dashed lines are quite close to that of raw observations. Furthermore, we prefer the p -values that increase rapidly along h . This means the long-term dependence is little in the sequences and thus CTMC is a feasible model.
The learned workflow model is valuable in that a range of practical problems can benefit from the results of modeling. In this paper, we have implemented a management informa-tion system, HISflow, to exploit the discovered knowledge for healthcare operation and management. In the following we elaborate on the techniques used in our implementation.
When the mined workflow patterns are legislated as pro-cedure codes, we can identify abnormal behavior from daily healthcare activities in a real-time manner. When such anomaly occurs, warnings and alerts can be activated by the management system. Such a system helps reduce the risks of faults or accidents of healthcare services. To develop this system, a simple approach is to rank the ongoing trajectories of all monitored medical devices based on average log-loss in Equation 8. In this way, the devices ranked in the top are worth more scrutiny. However, this ranking results might not be intuitive from the management perspective. In fact, it is vital to provide more insights into the cause for the higher log-loss trajectories. To this end, we further identify the recent transition s i = ( c i ,d i ) in Tr = ( s which causes L ( Tr ) to increase. With the identified s can then clarify whether the increase is caused by c i or d is larger, the increase is caused by c i because the transition coming from c i  X  1 is unlikely to end at c i . Otherwise, it indicates that the device stays at c i too long.

A screenshot of the real-time monitoring is shown in Fig-ure 7.As can be seen, the average log-loss of the selected device ( Id = 49202) increases linearly at the beginning, which means the device stayed at a workflow state c and  X  log q c + q c d increases linearly with waiting time d . As shown in red, when this device is moved from Storage Room (left middle spot in Figure 4b) to 526 Soiled Utility Room (blue spot in the floor map in Figure 7), it is ranked into the top due to the unlikely transition. We also show the related information in the grid and the location status on the floor map. Such an intuitive and interpretable real-time monitor system is valuable for the hospital managers to improve the quality of healthcare services.
Our workflow models can also provide insights into au-diting the efficiency of the healthcare services. Particularly, hospital managers would like to know how and how much the indoor spaces and the medical devices are being used. With our models, the utilization efficiency of medical devices and indoor space can be measured with sound statistics.
First, we can use waiting time parameter q in each state c to measure the utilization efficiency of the medical de-vices. Specifically, a small q indicates that the healthcare procedures taken in these states need a lot of time. For the workflow states corresponding to preprocessing maintenance stage (e.g., Storage rooms) and postprocessing stage (e.g., Soiled Utility Rooms, Decontamination Service Rooms), this small q means the processing procedures are not efficient. Second, to investigate the utilization efficiency of the indoor space, we would like to know the proportion of time the stochastic process spend at each state. In our CTMC model, this proportion at the i th state can be estimated by the sta-tionary probability r i = lim t  X  X  X  Pr ( S ( t ) = i ) = where  X  j = P i  X  i P ij and P j  X  j = 1.

Our system periodically calculates these statistics which allow hospital managers to audit the utilization efficiency of the medical devices and indoor space. By showing the trends over time and comparisons between different hospitals, one can get both intuitive understanding and quantitative mea-surement of the ongoing operation performance.
The procedure of healthcare services is an operation pro-cess controlled by the science of medical treatment as well as industry legislation. Non-compliance practices lead to ad-verse affects such as litigation, prosecution and damage to brand reputation. To inspect the workflow compliance, we can calibrate the classical workflow sequences with respect to given workflow policies. In our stochastic model, the clas-sical workflow sequences can be constructed by finding the most likely trajectories. Note that, in addition to providing statistic evidence on workflow compliance, the constructed classic workflow sequences are also helpful for understand-ing the ongoing workflow practices. Technically, given the initial state c , the final state c 0 and a time duration d , find-ing the most likely trajectory is an optimization problem to max Tr Pr( Tr | P,q ) , where Tr = ( s 1 ,  X  X  X  ,s l ), s with constraints c 1 = c,c l = c 0 and P l i =1 d i = d . With pa-rameters  X  = ( P,q ) learned by our framework, this bound-ary value problem [13] can be solved by dynamic program-ming algorithms.
Workflow analysis conventionally relies on detailed work-flow logs [1, 15, 7]. The workflow processes are typically represented by activity graphs. Given the execution logs, which are lists of activity records, the workflow mining can be formalized as a graph mining problem by deeming the ex-ecution logs as walks on the activity graphs [1]. In practice, there might be discrepancies between the actual workflow processes and the processes perceived by the management. In this case, to discover a completely specified workflow de-sign model, Van der Aalst et al. [15] presented an algorithm to extract a process model from the workflow logs and rep-resent it in terms of a Petri net. Instead of discovering the complete model, Greco et al. [7] later formalized the prob-lem of discovering the most frequent patterns of executions, i.e., the workflow substructures that have been scheduled more frequently and had lead to a desired final configuration. However, these methods rely on the workflow logs which are often recorded by people in the healthcare industry. Thus, the results may be distorted due to the missed activities and bias in the logs. These distorted results can be misleading for many operation and management tasks in hospitals, such as the inspection of workflow compliance. In comparison, as we discussed in Section 1, in this paper we propose a proac-tive approach to workflow modeling by mining the digital location traces of moving objects automatically recorded by RTLS in the hospitals, which requires minimum amount of human intervention. The statistical modeling results pro-vided by our approach are helpful for a range of operation and management tasks in hospital environments.

In terms of methodology, another category of related work is the modeling and prediction of human activities. For in-stance, Yin et al. [17] proposed stochastic process models to predict the goals of indoor human activities. Furthermore, for multiple-goal recognition, Chai and Yang [3] proposed a two-level architecture for behavior modeling and Hu and Yang [8] developed a dynamic Bayesian model where skip-chain conditional random fields were used for modeling in-terleaving goals. However, these approaches are supervised and require sufficient training data. Also, the activities con-sidered in the above papers are not within the hospital envi-ronments, where specialized workflow and activities happen. In the hospital environments, the desired knowledge to be discovered is different from and more complicated than that within other environments, such as school or company.
In terms of analytics of location traces, trajectory pattern mining is also related to this work. For instance, Giannotti et al. [6] introduced trajectory patterns as frequent behaviors in terms of both time and space, where the frequent trajec-tory patterns are computed based on the given thresholds. In [9], methods were proposed to discover the periodic pat-terns from spatio-temporal data, where a periodic pattern is defined as a regular activity which periodically happens at certain locations. Also, Yang and Hu [16] proposed meth-ods to discover sequential patterns from imprecise trajecto-ries of moving objects. However, these methods developed for outdoor space are not designed for the purpose of work-flow modeling in the indoor hospital environments, and more importantly, the mined frequent patterns cannot provide a parsimonious description of healthcare activities in hospitals and support the applications we have considered.

Finally, the last category of related work is the detection of area-of-interest with trajectory data. For instance, Liu et al. [11] proposed a non-density-based approach, called mobility-based clustering, to identify the hotspots of mov-ing vehicles in an urban area. The key idea is that sample objects are used as  X  X ensors X  to perceive the vehicle crowded-ness in nearby areas using their instant mobility, rather than the  X  X bject representatives X . Moreover, Zheng et al. [18] pro-posed a stay point concept and identified hotspots from hu-man moving trajectory. One location was considered as a hotspot if a lot of moving objects stay nearby over a thresh-olded time period. In addition, Giannotti et al. [6] used the neighborhood function to model Regions-of-Interest. Basi-cally, they partitioned the spatial space into grids and quan-tified the interest of each grid with the density and the di-rection information of each grid. As we have discussed, even some methods mentioned above are very successful for ana-lyzing outdoor location traces, most of them are not appli-cable to the proposed indoor hospital environments because of the unique characteristics of the indoor space.
In this paper, we exploited the location traces of medical devices for modeling the healthcare workflow patterns in the hospital environment. Specifically, we developed a stochas-tic process-based framework, which provides parsimonious descriptions for long location traces. This framework pro-vides new opportunities to understand the logistics of a large hospital in a concise manner. From the application per-spective, the discovered knowledge, such as workflow states, transition patterns, and co-transiting relationships, can be integrated for use in the management information system we developed. With this system, we showed that valuable intelligent applications for healthcare operation and man-agement can be enabled to manage, evaluate and optimize the healthcare services.
 This research was partially supported by National Science Foundation (NSF) via grant numbers CCF-1018151 and IIS-1256016.
 [1] Rakesh Agrawal, Dimitrios Gunopulos, and Frank [2] A. Banerjee, I. Dhillon, J. Ghosh, and S. Sra. [3] X. Chai and Q. Yang. Multiple-goal recognition from [4] Y. Ge, H. Xiong, Z.H. Zhou, H. Ozdemir, J. Yu, and [5] Y. Ge, H. Xiong, C. Liu, and Z.H. Zhou. A taxi [6] F. Giannotti, M. Nanni, D. Pedreschi, and F. Pinelli. [7] Gianluigi Greco, Antonella Guzzo, Giuseppe Manco, [8] D.H. Hu and Q. Yang. Cigar: concurrent and [9] Z.H. Li, B.L. Ding, J.W. Han, R. Kays, and P. Nye. [10] C. Liu, Y. Ge, and H. Xiong. A stochastic model for [11] S.Y. Liu, Y.H. Liu, L.M. Ni, J.P. Fan, and M.L. Li. [13] T.J. Perkins. Maximum likelihood trajectories for [14] J. Rissanen and G.G. Langdon. Arithmetic coding. [15] Wil Van der Aalst, Ton Weijters, and Laura Maruster. [16] J. Yang and M. Hu. Trajpattern: Mining sequential [17] J. Yin, D. Shen, Q. Yang, and Z.N. Li. Activity [18] Y. Zheng, L. Zhang, X. Xie, and W.Y. Ma. Mining
