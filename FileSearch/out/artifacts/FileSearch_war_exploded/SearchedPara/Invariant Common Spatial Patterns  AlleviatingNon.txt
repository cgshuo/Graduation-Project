 5 Dept. of Neurology, Campus Benjamin Franklin, Charit X  Univ ersity Medicine Berlin, Germany Brain-Computer Interfaces (BCIs) translate the intent of a subject measured from brain signals di-rectly into control commands, e.g. for a computer applicati on or a neuroprosthesis ([1, 2, 3, 4, 5, 6]). The classical approach to brain-computer interfacing is operant conditioning ([2, 7]) where a fixed translation algorithm is used to generate a feedback signal from the electroencephalogram (EEG). Users are not equipped with a mental strategy they should use , rather they are instructed to watch a feedback signal and using the feedback to find out ways to vol untarily control it. Successful BCI operation is reinforced by a reward stimulus. In such BCI sys tems the user adaption is crucial and typically requires extensive training. Recently machine learning techniques were applied to the BCI field and allowed to decode the subject X  X  brain signals, plac ing the learning task on the machine side, i.e. a general translation algorithm is trained to infer the specific characteristics of the user X  X  brain signals [8, 9, 10, 11, 12, 13, 14]. This is done by a statistica l analysis of a calibration measurement in which the subject performs well-defined mental acts like i magined movements. Here, in principle no adaption of the user is required, but it is to be expected th at users will adapt their behaviour during feedback operation. The idea of the machine learning approach is that a flexible adaption of the system relieves a good amount of the learning load from the subject. Most BCI systems are somewhere between those extremes. Although the proof-of-concept of machine learning based BC I systems 1 was given some years ago, several major challenges are still to be faced. One of them is to make the system invariant to non task-related fluctuations of the measured signals during fe edback. These fluctuations may be caused by changes in the subject X  X  brain processes, e.g. change of t ask involvement, fatigue etc., or by artifacts such as swallowing, blinking or yawning. The cali bration measurement that is used for training in machine learning techniques is recorded during 10-30 min, i.e. a relatively short period of time and typically in a monotone atmosphere, so this data d oes not contain all possible kinds of variations to be expected during on-line operation.
 The present contribution focusses on invariant feature ext raction for BCI. In particular we aim to enhance the invariance properties of the common spatial pat terns (CSP, [15]) algorithm. CSP is the solution of a generalized eigenvalue problem and has as such a strong link to the maximization of a Rayleigh coefficient, similar to Fisher X  X  discriminant ana lysis. Prior work by Mika et al. [16] in the context of kernel Fisher X  X  discriminant analysis contains the key idea that we will follow: noise and distracting signal aspects with respect to which we want to m ake our feature extractor invariant is added to the denominator of a Rayleigh coefficient. In other w ords, our prior knowledge about the noise type helps to re-design the optimization of CSP featur e extraction. We demonstrate how our invariant CSP (iCSP) technique can be used to make a BCI syste m invariant to changes in the power of the parietal  X  -rhythm (see Section 2) reflecting, e.g. changes in vigilanc e. Vigilance changes are among the most pressing challenges when robustifying a B CI system for long-term real-world applications.
 In principle we could also use an adaptive BCI, however, adap tation typically has a limited time scale which might not allow to follow fluctuations quickly en ough. Furthermore online adaptive BCI systems have so far only been operated with 4-9 channels. We w ould like to stress that adaptation and invariant classification are no mutually exclusive alterna tives but rather complementary approaches when striving for the same goal: a BCI system that is invarian t to undesired distortions and non-stationarities. Neurophysiological background. Macroscopic brain activity during resting wakefulness con tains distinct  X  X dle X  rhythms located over various brain areas, e .g. the parietal  X  -rhythm (7-13 Hz) can be measured over the visual cortex [17] and the  X  -rhythm can be measured over the pericentral sensorimotor cortices in the scalp EEG, usually with a frequ ency of about 8 X 14 Hz ([18]). The strength of the parietal  X  -rhythm reflects visual processing load as well as attention and fatigue resp. vigilance.
 The moment-to-moment amplitude fluctuations of these local rhythms reflect variable functional states of the underlying neuronal cortical networks and can be used for brain-computer interfacing. Specifically, the pericentral  X  -and  X  rythms are diminished, or even almost completely blocked, b y movements of the somatotopically corresponding body part, independent of their active, passive or reflexive origin. Blocking effects are visible bilateral bu t with a clear predominance contralateral to the moved limb. This attenuation of brain rhythms is termed e vent-related desynchronization (ERD) and the dual effect of enhanced brain rhythms is called event -related synchronization (ERS) (see [19]).
 Since a focal ERD can be observed over the motor and/or sensor y cortex even when a subject is only imagining a movement or sensation in the specific limb, this f eature can be used for BCI control: The discrimination of the imagination of movements of left hand vs. right hand vs. foot can be based on the somatotopic arrangement of the attenuation of the  X  and/or  X  rhythms. However the challenge is that due to the volume conduction EEG signal recorded at th e scalp is a mixture of many cortical activities that have different spatial localizations; for example, at the electrodes over the mortor cortex, the signal not only contains the  X  -rhythm that we are interested in but also the projection of parietal  X  -rhythm that has little to do with the motor-imagination. To this end, spatial filtering is an indispensable technique; that is to take a linear combinati on of signals recorded over EEG channels and extract only the component that we are interested in. In p articular the CSP algorithm that optimizes spatial filters with respect to discriminability is a good candidate for feature extraction. Experimental Setup. In this paper we evaluate the proposed algorithm on off-line data in which the nonstationarity is induced by having two different back ground conditions for the same primary task. The ultimate challenge will be on-line feedback with s trong fluctuations of task demands etc, a project envisioned for the near future.
 We investigate EEG recordings from 4 subjects (all from whom we have an  X  X nvariance measure-ment X , see below). Brain activity was recorded from the scal p with multi-channel amplifiers using 55 EEG channels.
 In the  X  X alibration measurement X  all 4.5 X 6 seconds one of 3 d ifferent visual stimuli indicated for 3 seconds which mental task the subject should accomplish dur ing that period. The investigated men-tal tasks were imagined movements of the left hand, the right hand, and the right foot. There were two types of visual stimulation: (1: imag_lett ) targets were indicated by letters (L, R, F) appearing at a central fixation cross and (2: imag_move ) a randomly moving small rhomboid with either its left, right or bottom corner filled to indicate left or right hand or foot movement, respectively. Since the movement of the object was independent from the indicated ta rgets, target-uncorrelated eye move-ments are induced. Due to the different demands in visual pro cessing, the background brain activity can be expected to differ substancially in those two types of recordings. The topography of the r 2  X  X alues (bi-serial correlation coefficient of feature valu es with labels) of the log band-power dif-ference between imag_move and imag_lett is shown in the left plot of Fig. 2. It shows a pronounced differene in parietal areas.
 A sham_feedback paradigm was designed in order to charaterize invariance pr operties needed for stable real-world BCI applications. In this measurement th e subjects received a fake feedback se-quence which was preprogrammed. The aim of this recording wa s to collect data during a large variety of mental states and actions that are not correlated with the BCI control states (motor im-agery of hands and feet). Subjects were told that they could c ontrol the feedback in some way that they should find out, e.g. with eye movements or muscle activi ty. They were instructed not to per-form movements of hands, arms, legs and feet. The type of feed back was a standard 1D cursor control. In each trial the cursor starts in the middle and sho uld be moved to either the left or right side as indicated by a target cue. When the cursor touched the left or right border, a response (correct or false) was shown. Furthermore the number of hits and misse s was shown. The preprogrammed  X  X eedback X  signal was constructed such that it was random in the beginning and then alternating peri-ods of increasingly more hits and periods with chance level p erformance. This was done to motivate the subjects to try a variety of different actions and to indu ce different states of mood (satisfaction during  X  X uccessful X  periods and anger resp. disfavor durin g  X  X ailure X ). The right plot of Fig. 2 visual-izes the difference in log band-power between imag_move and sham_feedback . A decreased alpha power in centro-parietal areas during sham_feedback can be observed. Note that this recording in-cludes much more variations of background mental activity t han the difference between imag_move and imag_lett . Common Spatial Patterns (CSP) Analysis. The CSP technique ([15]) allows to determine spatial filters that maximize the variance of signals of one conditio n and at the same time minimize the variance of signals of another condition. Since variance of band-pass filtered signals is equal to band-power, CSP filters are well suited to discriminate mental sta tes that are characterized by ERD/ERS effects ([20]). As such it has been well used in BCI systems ([ 8, 14]) where CSP filters are calculated individually for each subject on the data of a calibration me asurement.
 Technically the Common Spatial Pattern (CSP) [21] algorith m gives spatial filters based on a dis-criminative criterion. Let X 1 and X 2 be the (time  X  channel) data matrices of the band-pass filtered EEG signals (concatenated trials) under the two conditions (e.g., right-hand or left-hand imagination, We define the two matrices S d and S c as follows: The CSP spatial filter v  X  R C ( C is the number of channels) can be obtained by extremizing the Rayleigh coefficient: This can be done by solving a generalized eigenvalue problem .
 The eigenvalue  X  is bounded between  X  1 and 1; a large positive eigenvalue corresponds to a pro-jection of the signal given by v that has large power in the first condition but small in the sec ond condition; the converse is true for a large negative eigenva lue. The largest and the smallest eigen-values correspond to the maximum and the minimum of the Rayle igh coefficient problem (Eq. (1)). to maximize. On the other hand, the projection of the activit y that is common to two classes v &gt; S c v should be minimized because it doesn X  X  contribute to the dis criminability. Using the same idea from [16] we can rewrite the Rayleigh problem (Eq. (1)) as follows : which can be interpreted as finding the minimum norm v with the condition that the average power difference between two conditions to be  X  . The norm is defined by the common activity matrix S c . In the next section, we extend the notion of S c to incorporate any disturbances that is common to two classes that we can measure a priori.
 problem (Eq. (2)) or a similar problem discussed in the next s ection. Moreover we denote by V the matrix we obtain by putting the C generalized eigenvectors into columns, namely V = { v j } C j R  X  C and call patterns the row vectors of the inverse A = V  X  1 . Note that a filter v j  X  R C has its corresponding pattern a j  X  R C ; a filter v j extracts only the activity spanned by a j and cancels out all (see Fig. 2).
 For classification the features of single-trials are calcul ated as the log-variance in CSP projected signals. Here only a few (2 to 6) patterns are used. The select ion of patterns is typically based on eigenvalues. But when a large amount of calibration data is n ot available it is advisable to use a more refined technique to select the patterns or to manually c hoose them by visual inspection. The variance features are approximately chi-square distribut ed. Taking the logarithm makes them similar to gaussian distributions, so a linear classifier (e.g., lin ear discriminant analysis) is fine. For the evaluation in this paper we used the CSPs correspondi ng the the two largest and the two smallest eigenvalues and used linear disciminant analysis for classification. The CSP algorithm, several extentions as well as practical issues are reviewed in detail in [15].
 Invariant CSP. The CSP spatial filters extracted as above are optimized for t he calibration mea-surement. However, in online operation of the BCI system dif ferent non task-related modulations of brain signals may occur which are not suppressed by the CSP filters. The reason may be that these modulations have not been recorded in the calibration measurement or that they have been so infrequent that they are not consistently reflected in the st atistics (e.g. when they are not equally distributed over the two conditions).
 The proposed iCSP method minimizes the influence of modulati ons that can be characterized in advance by a covariance matrix. In this manner we can code neu rophysiological prior knowledge or further information such as the tangent covariance matri x ([22]) into such a covariante matrix  X  . In the following motivation we assume that  X  is the covariance matrix of a signal matrix Y . Using that maximize var ( X 2 v ( 2 ) j ) and minimize var ( X 1 v ( 2 ) j ) and var ( Y v ( 2 ) j ) . Pratically this can be accomplished by solving the followin g two generalized eigenvalue problems: X 2 ) against invariance (as characterized by  X  ). Section 4 discusses the selection of parame-Note that for  X  = 0 . 5 there is a strong connection to the one-vs-rest strategy fo r 3-class CSP ([23]). Features for classification are calculated as log-variance using the two filters from each of v ( 1 ) j and invariance constraints in (kernel) Fisher X  X  Discriminant proposed in [16].
 A Theoretical Investigation of iCSP by Influence Analysis. As mentioned, iCSP is aiming at robust spatial filtering against disturbances whose covari ance  X  can be anticipated from prior knowl-edge. Influence analysis is a statistical tool with which we c an assess robustness of inference proce-dures [24]. Basically, it evaluates the effect in inference procedures, if we add a small perturbation of O (  X  ) , where  X  1. For example, influence functions for the component analys es such as PCA and CCA have been discussed so far [25, 26]. We applied the mac hinery to iCSP, in order to check whether iCSP really reduces influence caused by the disturba nce at least in local sense. For this purpose, we have the following lemma (its proof is included i n the Appendix).
 Lemma 1 (Influence of generalized eigenvalue problems) Let  X  k and w k be k-th eigenvalue and eigenvector of the generalized eigvenvalue problem respectively. Suppose that the matrices A and B are perturbe d with small matrices  X   X  and  X  P where  X  1 . Then the eigenvalues e w k and eigenvectors e  X  k of the purterbed problem can be expanded as  X  k +  X   X  k + o (  X  ) and w k +  X   X  k + o (  X  ) , where M The generalized eigenvalue problem eqns (3) and (4) can be re phrased as For simplicity, we consider here the simplest perturbation of the covariances as  X  1  X   X  1 +  X   X  and  X  2  X   X  1 +  X   X  . In this case, the perturbation matrices in the lemma can be e xpressed as  X  1 =  X  ,  X  2 =  X  , P = 2 ( 1  X   X  )  X  . Therefore, we get the expansions of the eigenvalues and eig envectors as d +  X   X  1 k , c k +  X   X  2 k , v k +  X   X  1 k and u k +  X   X  2 k , where M ( 1  X   X  )(  X  1 +  X  2 ) +  X   X  . The implication of the result is the following. If  X  = 1  X  1 2 d 1 eigenvector does coincide with the one for the original prob lem up to  X  order, because the first term of  X  1 k (resp.  X  2 k ) becomes zero (we note that d k and c k also depend on  X  ). Test Case with Constructed Test Data. To validate the proposed iCSP, we first applied it to specifically constructed test data. iCSP was trained (  X  = 0 . 5) on motor imagery data with the invari-ance characterized by data from a measurement during  X  X yes o pen X  (approx. 40 s) and  X  X yes closed X  (approx. 20 s). The motor imagery test data was used in its ori ginal form and variants that were modified in a controlled manner: From another data set during  X  X yes closed X  we extracted activity related to increased occipital alpha activity (backprojec tion of 5 ICA components) and added this with 3 different factors (  X  = 0.5, 1, 2) to the test data.
 The upper plots of Fig. 2 display the classifier output on the c onstructed test data. While the per-formance of the original CSP is more and more deteriorated wi th increased alpha mixed in, the proposed iCSP method maintains a stable performance indepe ndent of the amount of increased al-pha activity. The spatial filters that were extracted by CSP a nalysis vs. the proposed iCSP often look quite similar. However, tiny but apparently important differences exist. In the lower panel of from two approaches resemble each other strongly. However, the corresponding patterns reveal an important difference. While the pattern of the original CSP has positive weights at the right occipital side which might be susceptible to  X  modulations, the corresponding iCSP has not. A more detaile d inspection shows that both filters have a focus over the right (sensori-) motor cortex, but only the invariant filter has a spot of opposite sign right posterior t o it. This spot will filter out contributions coming from occipital/parietal sites.
 Model selection for iCSP. For each subject, a cross-validation was performed for diff erent values of  X  on the training data (session imag_move ) and the  X  resulting in minimum error was chosen. For the same values of  X  the iCSP filters + LDA classifier trained on imag_move were applied to calcu-late the test error on data from imag_lett . Fig. 3 (left plots) shows the result of this procedure. The shape of the cross-validation error on the training set and t he test error is very similar. Accordingly, the selection of values for parameter  X  is successful. For subject zq  X  = 0 was chosen, i.e. classical CSP. The case for subject zk shows that the selection of  X  may be a delicate issue. For larges val-ues of  X  cross-validation error and test error differ dramatically . A choice of  X  &gt; 0 . 5 would result in bad performance of iCSP, while this effect could have not b een predicted so severely from the cross-validation of the training set.
 Evaluation of Performance with Real BCI Data. For evaluation we used the imag_move session (see Section 2) as training set and the imag_lett session as test set. Fig 3 (right plot) compares the classification error obtained by classical CSP and by the proposed method iCSP with model parameter  X  chosen by cross-validation on the training set as described above. Again an excellent improvement is visible. EEG data from Brain-Computer Interface experiments are hig hly challenging to evaluate due to noise, nonstationarity and diverse artifacts. Thus, BCI pr ovides an excellent testbed for testing the quality and applicability of robust machine learning metho ds (cf. the BCI Competitions [27, 28]). Obviously BCI users are subject to variations in attention a nd motivation. These types of non-stationarities can considerably deteriorate the BCI class ifier performance. In present paper we pro-posed a novel method to alleviate this problem.
 A limitation of our method is that variations need to be chara cterized in advance (by estimating an appropriate covariance matrix). At the same time this is als o a strength of our method as neuro-physiological prior knowledge about possible sources of no n-stationarity is available and can thus be taken into account in a controlled manner. Also the select ion of hyperparameter  X  needs more investigation, cf. the case of subject zk in Fig. 3. One strategy to pursue is to update the covariance matrix  X  online with incoming test data. (Note that no label informat ion is needed.) Online learning (learning algorithms for adaptation within a BCI session) c ould also be used to further stabilize the system against unforeseen changes. It remains to future res earch to explore this interesting direction.  X  References
