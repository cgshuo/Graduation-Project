 Quer y re w r i t in gus in g vi e w shasma ny i mp o rta n tapp li cat ion ssuchas in data in tegrat ion a n dquer y cach in g [1]. A view i sapre -defi n ed quer yw h i ch ma y o rma yno tbemater i a li zed .A contained rewriting (CR) ,o rs i mp ly rewriting , o fquer y Q us in g vi e w V i sa n e w quer y Q such that ,w he n e v a l uated ov er the a n s w ers t o the vi e w, Q pr o duces part o ra ll o fthec o rrect a n s w ers t o the o r i g in a l quer y Q , f o ra ny in sta n ce o f the database .

T he pr o b l em o ffi n d in gc on ta in ed re w r i t in gs has bee nw e ll stud i ed in re l at ion a l databases [ 4 ,5,1]. Rece n t ly, c on ta in ed re w r i t in gs o f tree patter n quer i es us in g vi e w s w ere stud i ed in [ 2 ] f o rthec l ass P { /,//, [] } .A tree patter nin P { /,//, [] } represe n ts a n XPath e x press ion. I t i satree wi th e v er yno de l abe l ed wi th a nXML tag , a n de v er y edge l abe l ed wi th e i ther /o r // ( see S ect ion 2f o rm o re deta il s ). I t w as sh own in [ 2 ] that , g iv e n quer y Q a n d vi e w V in P { /,//, [] } , ac on ta in ed re w r i t in g o f Q us in g V ca n be f o u n db y fi n d in ga useful embedding (UE) o f Q in V .How e v er , there ca n be ma ny U Es , a n ds o me o fthemma y be redu n da n t in that the re w r i t in gs o bta in ed fr o mthemarec on ta in ed in th o se o bta in ed fr o m o ther U Es .Fo re x amp l e , f o rthe vi e w V a n dquer y Q sh own in Fi g .1 ( a ) a n d ( b ), there are 8 0U Es , but 7 9o f them are redu n da n t . Redu n da n t U Es are use l ess a n d the yw aste c o mputat ion a l res o urce because a ll resu l ts pr o duced b y them ca n be pr o duced b yo ther re w r i t in gs .T heref o re i t i s i mp o rta n tf o r the redu n da n t rem ovin ga ll redu n da n t U Es i sacha ll e n g in gpr o b l em .

In th i spaper ,w efirstsh ow that the cr i ter ion g iv e nin[ 2 ] f o r i de n t i f yin g i rredu n da n t U Es i s w r on g , a n d in fact ,i t i s n e i ther suffic i e n t no r n ecessar y. T h i s i sd on e in S ect ion 3.1. W ethe n prese n ts o me usefu lo bser v at ion s on the re l at ion sh i ps bet w ee nU Es (S ect ion 3.1). B ased on these o bser v at ion s ,w eg iv e aheur i st i ca l g o r i thm f o rc o mput in ga ll i rredu n da n t U Es (in S ect ion 4 ). W e dem on strate the effic i e n c yo f o ur a l g o r i thm b y e x amp l es .

W e will in tr o duce s o me backgr o u n dk nowl edge a n d no tat ion s in the n e x t sect ion, bef o re pr o ceed in gt o prese n t o ur ma jo rresu l ts in S ect ion s 3 a n d4 . XTree and Tree Patterns. L et  X  be a nin fi ni te set o f tags .An xml tree ( XTree ) i satree wi th e v er yno de l abe l ed wi th a tag in  X  .A tree pattern ( TP ) in P /,//, [] } i satree wi th a u ni que distinguished node ,wi th e v er yno de l abe l ed wi th atag in  X  , a n de v er y edge l abe l ed wi th e i ther / o r // .T he path fr o mther oo t t o the d i st in gu i shed no de i sca ll ed the distinguished path 1 .Fi g . 2sh ow ss o me e x amp l e TP s ,w here s in g l ea n dd o ub l e lin es are used t o represe n t /-edges a n d //-edges respect iv e ly, a n dac i rc l e i susedt oin d i cate the d i st in gu i shed no de .A TP c o rresp on ds t o a n XPath e x press ion. T he TP s in Fi g . 2 ( a ) a n d ( b ) c o rresp on d t o the XPath e x press ion s a [ c ] //b [ d ] a n d a [ c ] //b [ x ] //y respect iv e ly.
L et P be a TP .W e will use DN ( P ), a n d DP ( P ) t o de no te the d i st in gu i shed no de a n dthed i st in gu i shed path o f P respect iv e ly. Fo ra ny tree T ,w e will use N ( T ), E ( T ) a n d rt ( T ) t o de no te the no de set , theedgeset , a n dther oo t o f T respect iv e ly. W e will a l s o use label ( v ) t o de no te the l abe lo f no de v , a n dca ll a no de l abe l ed a a n a -node .In add i t ion, i f ( u, v )i sa /-edge ( resp . //-edge ), w e sa y v i sa /-ch il d ( resp . //-ch il d )o f u .

A matching o f TP P in a n XTree t i samapp in g  X  fr o m N ( P ) t o N ( t ) that i s (1) root-preserving :  X  ( rt ( P )) = rt ( t ), ( 2 ) label-preserving :  X  v  X  N ( P ), label ( v )= label (  X  ( v )), a n d (3) structure-preserving : f o re v er y edge ( x, y )in P ,i f i t i sa / -edge , the n  X  ( y )i sach il d o f  X  ( x ); i f i t i sa // -edge , the n  X  ( y )i sadesce n da n t o f  X  ( x ). Each match in g  X  pr o duces a subtree o f t r oo ted at  X  ( DN ( P )), de no ted t  X  ( DN ( P )) ,w h i ch i sk nown as a n answer t o the TP .W euse P ( t ) t o de no te the set o fa ll a n s w ers o f P ov er t .Fo raset T o f XTrees ,w edefi n e P ( T )=  X  t  X  T P ( t ). Containment and Containment Mapping. L et P a n d Q be TP s . P i ssa i dt o be contained in Q , de no ted P  X  Q ,i ff o re v er y XTree t , P ( t )  X  Q ( t ). Fo r P a n d Q in P { /,//, [] } , P  X  Q iff there i sac on ta in me n tmapp in gfr o m Q t o P . Reca ll [3]: A containment mapping ( CM ) fr o m Q t o P i samapp in g  X  fr o m N ( Q ) t o N ( P ) that i s l abe l-preser vin g , r oo t -preser vin gasd i scussed in the l ast sect ion, structure -preser vin g (w h i ch now mea n sf o ra ny /-edge (x,y) in Q ,(  X  ( x ) , X  ( y )) i s a /-edge in P , a n df o ra ny //-edge ( x, y ), there i sapathfr o m  X  ( x ) t o  X  ( y )in P ) a n d i s o utput -preser vin g ,w h i ch mea n s  X  ( DN ( V )) = DN ( P ).
 Rewriting TP Using Views. A view i sapre -defi n ed TP .L et V be a vi e w a n d Q be a TP .In th i spaper w e i mp li c i t ly assume that rt ( Q ) a n d rt ( V ) ha v e the same l abe l. A compensation pattern ( CP )o f Q us in g V i sa TP Q such that (1) f o ra ny XTree t , Q ( V ( t ))  X  Q ( t ), a n d ( 2 ) there e xi sts a n XTree t such that Q ( V ( t )) i s non-empt y. I t i sc l ear that label ( rt ( Q )) = label ( DN ( V )). L et Q be a CP o f Q us in g V .W euse Q  X  V t o represe n tthe TP o bta in ed b y merg in g rt ( Q ) a n d DN ( V ). T he d i st in gu i shed no de o f Q bec o mes that o f Q  X  V .W eca ll Q  X  V a contained rewriting o f Q us in g V .Fi g . 2sh ow sa vi e w V , a TP Q , a CP Q o f Q us in g V , a n dthec o rresp on d in g CR Q  X  V .No te that c on d i t ion (1) in the defi ni t ion o fc on ta in ed re w r i t in g i sequ iv a l e n tt o Q  X  V  X  Q .T he maximal contained rewriting (MCR) o f Q us in g V i sdefi n ed t o be the u nion o fa ll CRs o f Q us in g V [ 2 ].
 G iv e n TP Q a n d vi e w V in P { /,//, [] } ,[ 2 ] sh ow s that the e xi ste n ce o fa CR o f Q us in g V ca n be character i zed b y the e xi ste n ce o fa useful embedding (UE) o f Q in V .In br i ef , ausefu l embedd in g o f Q in V i sapart i a l mapp in g f fr o m N ( Q ) t o N ( V ) that i sr oo t -preser vin g ,l abe l-preser vin g , structure -preser vin gasdefi n ed in ac on ta in me n tmapp in g ( e x ceptthatthe y are requ i red only f o rthe no des o f Q on w h i ch the fu n ct ion f i sdefi n ed ), a n dsat i sfies the f ollowin gc on d i t ion s .(1) i f f ( x )i sdefi n ed , the n f i sdefi n ed on parent ( x )( the pare n t o f x ). ( 2 ) f o re v er y no de x on the d i st in gu i shed path DP ( Q ), i f f ( x )i sdefi n ed , the n f ( x )  X  DP V , a n d i f f ( DN ( Q )) i sdefi n ed , the n f ( DN ( Q )) = DN ( V ); (3) f o re v er y path p  X  Q , either p i sfu lly embedded ,i. e ., f i sdefi n ed on e v er yno de in p , or i f x i sthe l ast no de in p such that f ( x )i sdefi n ed a n d f ( x )  X  DP ( P )( x i sca ll ed the anchor node ), a n d y the no de i mmed i ate ly f ollowin g x ( y i sca ll the successor o f x ), the n e i ther f ( x )= DN ( V ), o rtheedge ( x, y )i sa // -edge .

G iv e n a U E f fr o m Q t o V , a clip-away tree ( CAT ) CAT f ca n be c on structed as f ollow s .T he r oo t o f CAT f i s l abe l ed label ( DN ( V )). Fo r each path p  X  Q that i s no tfu lly embedded in V , fi n dthea n ch o r no de x a n d i ts success o r y , the n c onn ect the r oo t o f Q y ( Q y i s subtree o f Q r oo ted at no de y ) t o rt ( CAT f )wi th the same t y pe o fedgeas ( x, y ). T he d i st in gu i shed no de o f CAT f i sthe no de c o rresp on d in g t o DN ( Q ). T he MCR o f Q us in g V i stheu nion o fa ll CRs f o u n dth i s w a y. W efi x quer y Q a n d vi e w V .Fo r U E f ,w edefi n e CR f = CAT f  X  V ,n ame ly CR f i sthe CR o bta in ed fr o m f .L et f a n d g be U Es .W esa y f i sc on ta in ed in g i f CR f  X  CR g .
 Definition 1. AUE f and the rewriting CR f are said to be redu n da n t if CR f is contained in the union of the CRs generated by other UEs. Otherwise they are said to be i rredu n da n t .
 U s in gthe in depe n de n ce o fc on ta inin g patter n spr o pert y pr ov ed in [6], w ek now that f i sredu n da n t i fa n d only i fthere i sa no ther U E g such that CR f  X  CR g . T hus the ab ov edefi ni t ion o fredu n da n c y c oin c i des wi th that in [ 2 ].
In tu i t iv e ly redu n da n t U Es a n dthe i rc o rresp on d in g CRs ma y be i g no red because a ll a n s w ers pr o duced b y them ca n be pr o duced b y CRs o bta in ed fr o m o ther U Es . 3.1 Re-examining the Conditions Given in [2] Fo r TP s in P { /,//, [] } ,L emma 1o f [ 2 ] ga v eac on d i t ion f o r i rredu n da n t U Es , a n d i tc l a i ms the c on d i t ion i ssuffic i e n ta n d n ecessar y. Fo reas y refere n ce w ec o p y the l emma be low.
 T he f ollowin ge x amp l es sh ow that the ab ov e l emma i s w r on g , a n d in fact , the c on d i t ion i s n e i ther suffic i e n t no r n ecessar y f o r f t o be i rredu n da n t .Sin ce the r oo t o fthequer yi sa lw a y smappedt o the r oo t o fthe vi e w, w e o m i tsuche x p li c i t descr i pt ion in the e x amp l es .
 Example 1. C on s i der the vi e w V 1 a n dquer y Q 1 in Fi g .3. L et f be the U E w h i ch only maps the no des 1, 2 ,3 t o( 2 ), (3), a n d (1) respect iv e ly. L et g e x te n d f b y mapp in gthe no de 4 t o the no de (3). CR f a n d CR g are sh own in Fi g .3 ( c ), ( d ) respect iv e ly. C l ear ly, CR g  X  CR f ( a n d CR f CR g ). T heref o re g i sredu n da n t . B ut f o re v er yno de in Q 1 that i s no t embedded b y g , there i s no e x te n s ion o f g w h i ch embeds that no de .Ino ther wo rds , f o re v er yno de on w h i ch g i su n defi n ed , c on d i t ion 1 o fthe l emma i strue , but g i s no t i rredu n da n t .
 T he e x amp l eab ov ea l s o dem on strates that (1) CR g  X  CR f d o es no t i mp ly that f must be a n e x te n s ion o f g , a n d ( 2 ) g i sredu n da n td o es no t i mp ly there i sa n e x te n s ion h o f g such that CR g  X  CR h .
 Example 2. C on s i der V 2 a n d Q 2 in Fi g . 4 .L et f map the no des 1, 2 ,3 a n d 5 t o the no des ( 2 ), (3), ( 4 ) a n d (1) respect iv e ly. L et g e x te n d f b y mapp in gthe no des 6 a n d7t o the no des (3) a n d ( 4 ) respect iv e ly as w e ll. g i sthe only e x te n s ion o f f , a n d g d o es no tembedthet wo u -no des , a n dthe no de (6) a n d ( 7 ) are spec i a l w rt g .Ino ther wo rds , f o re v er yno de on w h i ch f i s no tdefi n ed , e i ther c on d i t ion 1o rc on d i t ion 2 i strue , but f i sredu n da n t because CR f  X  CR g ( CR f a n d CR g are as sh own in Fi g . 4 ).
 Example 3. C on s i der V 1 a n d Q 3 in Fi g . 4 .L et f map the no des 1, 3, 4t o the no des ( 2 ), (1), (3) respect iv e ly. L et g e x te n d f b y mapp in g no de 2 t ono de (3) as w e ll. g i sthe only e x te n s ion o f f , a n de v er yno de that i s no t embedded b y f i se i ther no t embedded b y g ( the z -no des ), o r i t (no de 2 )i sthed i st in gu i shed no de o f Q 3 a n d i t i smappedt o DN ( V 1 ) b y g , a n dthere i sa no de ( the l eft z -no de ) in c o mparab l et ono de 2 ,w h i ch i s no tdefi n ed b y g .Ino ther wo rds , f o re v er y no de on w h i ch f i s no tdefi n ed , e i ther c on d i t ion 1 o rc on d i t ion 3 i strue .B ut CR f i sredu n da n t because CR f  X  CR g .
 T he ab ov ee x amp l es sh ow that the c on d i t ioninL emma 1o f [ 2 ]i s in suffic i e n t . T he n e x te x amp l e will sh ow i t i s no t n ecessar y e i ther .
 Example 4. C on s i der V 3 a n d Q 4 in Fi g . 4 .L et f map the x -no de (in Q 4 ) t o the x -no de in V 3 .T he z -no de i sthe only no de no t embedded b y f , a n d i t i sthe d i st in gu i shed no de o f Q .T he only e x te n s ion g o f f maps the z -no de in Q 4 t o the z -no de in V 3 ( the d i st in gu i shed no de o f V ). C l ear ly f i s i rredu n da n t ( CR f a n d CR g are as sh ow in the figure ), but there i s no y ,in c o mparab l e wi th z , such that g ( y )i su n defi n ed , z i s no tspec i a lwi th respect t o g , a n d z i s embedded b y g .T hat i s , f o rthe z -no de ,non e o fthec on d i t ion s in the l emma h ol ds . 3.2 Su ffi cient Conditions for Redundant UEs and Other Observations Fin d in gas i mp l e , e x act c on d i t ion f o r i rredu n da n t U Es tur n s o ut t o be qu i te cha ll e n g in g .F r o mpract i ce p oin t o f vi e w, i t i sm o re i mp o rta n tt oi de n t i f yU Es that are redu n da n t , because such U Eca n be i g no red w he n c o mput in gthe M CR . In th i s sect ion w epr ovi de s o me suffic i e n tc on d i t ion sa n ds o me re l ated o bser v a -t ion s .T he y will be used in o ur heur i st i ca l g o r i thm ( t o be prese n ted in the n e x t sect ion) f o rfi n d in g i rredu n da n t U Es .By defi ni t ion, a U E f i sredu n da n t i fthere i sa no ther U E g such that CR f  X  CR g .T heref o re ,w e will first loo katc on d i t ion s u n der w h i ch CR f  X  CR g .

In the f ollowin g ,i f U E f i sdefi n ed on no de x  X  N ( Q ), w esa y f embeds x .I f f embeds a ll no des on path p  X  Q ,w esa y f fu lly embeds p .
 Lemma 1. Let f and g be two useful embeddings. If f and g embed the same set of nodes in Q ,then CAT f = CAT g and CR f = CR g . However, CAT f = CAT g does not imply f and g embed the same set of nodes.
 Proof. By defi ni t ion, i f f a n d g embed the same set o f no des in Q , the n CAT f = CAT g a n d CR f = CR g .T he e x amp l ebe low sh ow sthat CAT f = CAT g d o es no t i mp ly f a n d g embed the same set o f no des .Fo r V 5 a n d Q 5 in Fi g .5 ( a ) a n d ( b ), l et f a n d g be as f ollow s : f :1  X  (1) , 2  X  ( 2 ) , 3  X  (3) , 4  X  (5) , 5  X  (6) . g :1  X  ( 4 ) , 2  X  (6) , 4  X  (5) , 5  X  (6) .
 T he n CAT f = CAT g a l th o ugh g a n d f d ono t embed the same set o f no des . Lemma 2. Let Q be the query, and V be the view in P { /,//, [] } . CAT f  X  V  X  CAT g  X  V if, but not only if, CAT f  X  CAT g .
 T he pr oo f o f  X  X  f  X  X  sstra i ghtf o r w ard .A sa n e x amp l et o sh ow CAT f  X  V  X  CAT g  X  V d o es no t i mp ly CAT f  X  CAT g , c on s i der V = a//x , a n d Q = a//x/y .L et f map rt ( V ) t o rt ( Q ), l et g e x te n d f b y mapp in gthe x -no de in Q t o the x -no de in V .T he n CAT f = x//x/y a n d CAT g = x/y .T hus CR f  X  V = a//x//x/y a n d CAT g  X  V = a//x/y . C l ear ly, CAT f CAT g , but CAT f  X  V  X  CAT g  X  V .

T he the o rem be low pr ovi des a suffic i e n tc on d i t ion f o r CR f  X  CR g ,w h i ch i s the ma in i dea beh in d o ur a l g o r i thm in the n e x t sect ion. In the the o rem , x ( p, f ) de no tes the a n ch o r no de o fpath p wi th respect t oU E f .
 Theorem 1. Let f and g be two useful embeddings. CR f  X  CR g if the following conditions are satisfied. 1. Every path in Q that are fully embedded by f is also fully embedded by g ; 2. For every path p in Q that is not fully embedded by g either x ( p, f )= x ( p, g ) , 3. Either both g ( DN ( Q )) and f ( DN ( Q )) are defined, or both are undefined. Proof. By defi ni t ion, in Q only paths that are no tfu lly embedded b y g will c on tr i bute t o CAT g .Fo r each path p that i s no tfu lly embedded b y g ,i t i s no t fu lly embedded b y f e i ther ( c on d i t ion (1)). F urtherm o re , b y c on d i t ion ( 2 ), e i ther success o rarec onn ected b y a //-edge .In case (A), the subtree c on tr i buted b y p t o CAT g i s i de n t i ca l t o that c on tr i buted b y p t o CAT f ;in case (B), the subtree c on tr i buted b y p t o CAT g i s a subtree o f the subtree c on tr i buted b y p t o CAT f . Sin ce x ( p, g ) a n d i ts success o rarec onn ected b y a //-edge , theedgebet w ee n rt ( CAT g ) a n d the success o r o f x ( p, g )i sa l s o a //-edge .T heref o re , there i sa h o m o m o rph i sm fr o m CAT g t o CAT f .F urtherm o re , c on d i t ion (3) e n sures that e i ther b o th g ( DN ( Q )) a n d f ( DN ( Q )) are defi n ed ,o rb o th are u n defi n ed .In the f o rmer case , g ( DN ( Q )) a n d f ( DN ( Q )) are b o th DN ( V ); in the l ater case , g ( DN ( Q )) ca n be mapped t o f ( DN ( Q )) b y the h o m o m o rph i sm .T hus in b o th cases , there i sac on ta in me n tmapp in gfr o m CAT g t o CAT f .T hat i s , CAT f  X  CAT g .H e n ce CR f  X  CR g .
 T he ab ov ethe o rem pr ovi des a suffic i e n tc on d i t ion f o r f t o be redu n da n t : f i s redu n da n t i fthere i sa no ther U E g that sat i sfies the c on d i t ion s (1) t o(3)in the the o rem .No te that the c on d i t ion s (1) a n d ( 2 ) are equ iv a l e n tt o sa y g i sa n e x te n s ion o f f , a n df o re v er y path on w h i ch g embeds m o re no des tha n f , the a n ch o r no de (w rt g )i sc onn ected t oi ts success o r vi aa //-edge .No te a l s o that the c on d i t ion (3) in T he o rem 1i s n ecessar y. A sa n e x amp l e , c on s i der V = a/x a n d Q = a//x .L et g map x in Q t o x in V , but f d ono t .T he n g i sa n e x te n s ion o f f , a n d CAT g has no /-ch il d .B ut CR f CR g .
 U s in gtheab ov ethe o rem ,w eca nv er i f y that , f o rthe vi e w V a n dquer y Q in Fi g .1, the U Ethatembedsa ll no des e x cept 13, 1 4 , a n d 15 c on ta in sa ll o ther U Es .

O n em i ght won der w hether i t i sp o ss i b l ef o rtheret o be t wo U Es f a n d g such that f embeds m o re no des on path p 1 tha n g , but l ess no des on path p 2 tha n g , rt ( CAT f ) a n d rt ( CAT g ) ha v e no /-ch il d , a n db o th f a n d g are i rredu n da n t . T he n e x te x amp l eg iv es a p o s i t iv ea n s w er t o th i squest ion.
 Example 5. C on s i der the vi e w V a n dquer y Q in Fi g .6. L et f a n d g be as f ollow s : f :1  X  (1), 3  X  (3) , (5)  X  ( 4 ), 2  X  ( 2 ), 4  X  (3), 6  X  ( 4 ) g :1  X  (3), 3  X  ( 4 ) , 2  X  (6), 4  X  ( 7 ), 6  X  ( 8 ), 8  X  9 C o mpared wi th g , f embeds m o re no des on the d i st in gu i shed path , but l ess no des on the non-d i st in gu i shed path . CR f a n d CR g are as sh own in Fi g .6 ( c ) a n d ( d ). Bo th f a n d g are i rredu n da n t .No te there i s no U Ethatembedsb o th no de 5 a n d no de 8 .
 In w hat f ollow s ,w e will use P y t o de no te the subtree o f P r oo ted at no de y , a n duse V L as a sh o rtha n df o r V DN ( V ) .W e will a l s o use Q f t o de no te the patter n o bta in ed b y merg in gther oo ts o f V L a n d CAT f ( see Fi g .5 ( c )). Fo ra U E f a n da path p (in Q ) that i s no tfu lly embedded b y f ,w e will use y ( p, f ) t o de no te the success o r o f x ( p, f )( reca ll: x ( p, f )i sthea n ch o r no de o f p wi th respect t o f ). A s ash o rtha n d w e will use x f t o de no te the l ast no de on DP ( Q ) that i s embedded b y f .
 Proposition 1. Let f and g be useful embeddings. (1) If x f is a descendant of x g ,then CR f CR g . (2) If x f = x g ,then CR f  X  CR g iff Q f  X  CAT g , (3) If x f is an ancestor of x g , and there are no //-edges on DP ( V ) ,then CR f  X  Proof. W eusethefactthat CR f  X  CR g iff there i sac on ta in me n tmapp in gfr o m CR g t o CR f . (1) I f x f i sa n desce n da n t o f x g the n | DP ( CR g ) | &gt; | DP ( CR f ) | , a n dthusca nno tbe ( 2 )I f x f = x g , there i sa no b vio us on e -t o-on ec o rresp on de n ce bet w ee n the no des (3) I f x f i sa n a n cest o r o f x g , a n dthereare no //-edges on DP ( V ), the n DN ( V )on P r o p o s i t ion 1 i mp li es that (1) U Es that embed m o re no des on DP ( Q ) ca nno tbe c on ta in ed in th o se that embed l ess no des on DP ( Q ). ( 2 )i f f a n d g embed the same no des on DP ( Q ), o rthe y sat i sf y c on d i t ion (3), the n test in gf o r CR f  X  CR g ca n be d on eb y test in g Q f  X  CAT g ,w h i ch i seas i er because Q f a n d CAT g are usua lly sma ll er tha n CR f a n d CR g .

T he n e x tpr o p o s i t ion ca n be used t o determ in e non-c on ta in me n t o f U Es qu i ck ly. Proposition 2. If g ( DN ( Q )) is defined, but f ( DN ( Q )) is not, then CR f  X  CR g implies there is a homomorphism from V L to Q L ( Q L is the subtree of Q rooted at DN ( Q ) ), and there is a homomorphism from CAT g to Q L ,andthereisatleast one //-edge on DP ( V ) .
 T he ab ov epr o p o s i t ion i s true because CR f  X  CR g i mp li es there i sac on ta in me n t mapp in gfr o m CR g t o CR f ,w h i ch maps g ( DN ( Q )) t o f ( DN ( Q )). T hus there must be a //-edge on DP ( V ). I f w erestr i ct the c on ta in me n tmapp in gt ono des in Q g ,i t bec o mes a h o m o m o rph i sm fr o m Q g t o Q L .T hus there i sah o m o m o rph i sm fr o m V
L t o Q L , a n dfr o m CAT g t o Q L . W eare in terested in aset o f U Es that has the f ollowin gpr o pert y: (1) the u nion o fCRsge n erated b y these U Es i sequ iv a l e n tt o the M CR ; a n d ( 2 )noU E in the set i sc on ta in ed in a ny o ther .W eca ll such a set o f U Es a minimal cover set .
An a iv e appr o ach t o fi n d in gam ini ma l c ov er set i st o, first , fi n da ll o fthe U Es us in gthea l g o r i thm in [ 2 ], a n dthe n, f o reach U E f , test w hether i t i sc on ta in ed in a no ther g us in gthemeth o d o fc on ta in me n tmapp in g , a n d i f y es , d i scard i t . T h i smeth o d i s v er yin effic i e n t in ge n era l. Fo re x amp l e , f o rthequer y Q a n d vi e w V in Fi g .1, there are 8 0U Es , but only on e o fthem i s i rredu n da n t .I f w ec o mpare e v er y pa i r o f U Es ra n d o m ly w e wo u l dha v et o make at l east 7 9 c on ta in me n t tests ( e . g ., in the l uck y case w eha v ech o se n t o c o mpare the i rredu n da n t on e wi th e v er yo ther ) 2 . Reca ll that fi n d in gthee xi ste n ce o fac on ta in me n tmapp in g fr o m tree patter n P 1 t o P 2 takes O ( | P 1 || P 2 | )w here | P 1 | represe n ts the n umber o fedges in P 1 [3].
 W e now prese n t a heur i st i ca l g o r i thm f o rfi n d in gam ini ma l c ov er set o f U Es . Our a l g o r i thm uses T he o rem 1 t o fi l ter o ut s o me redu n da n t U Es first ( see Al g o r i thm 1). T he ni tc o mpares the U Es that embed the same no des on DP ( Q ) t o see w hether further redu n da n c y ca n be rem ov ed .T h i sca n be d on eb y c o mpar in g the i rC AT s (P r o p o s i t ion 1 ( 2 )). Fin a lly i tdea l s wi th the case w here f embeds l ess no des tha n g on DP ( Q ). In such case w ek now CR g CR f (P r o p o s i t ion 1 (1)). So w e only n eed t o test w hether CR f  X  CR g .W ed o th i sus in g P r o p o s i t ion 1 (3) a n d P r o p o s i t ion 2first , bef o re res o rt in gt o the meth o d o fc on ta in me n tmapp in g . T he a l g o r i thm i s summar i zed in t o the f ollowin gsteps . 1Fil ter redu n da n t U Es us in g Al g o r i thm 1. 2 I ftherearet wo o rm o re U Es l eft after the ab ov estep , d ivi de them in t o 3Fo r i =1 t o N  X  1, a n d j = i +1 t o N ,i fthereare g  X  S i a n d f  X  S j , S teps 2 a n d 3 are eas y t o u n dersta n d , the y are app li cat ion s o f P r o p o s i t ion s 1 a n d2 .W e now descr i be S tep 1in m o re deta il. G iv e n quer y Q ,w eg iv eeach no de v au ni que i de n t i f yin g in teger N v such that f o ra ny t wo no des u a n d v in a ny path p  X  Q , u i sadesce n da n t o f v iff N u &gt;N v .T h i s n umber i sass i g n ed us in g breadth-first traversal , start in gfr o m rt ( Q ) a n dthe n umber 0, wi th in creme n t 1. Fi g .6 ( b ) sh ow ssucha Q .No te th i spr o cess takes t i me lin ear in the s i ze o f Q .
S upp o se p 1 = DP ( Q ) a n d p 2 , ... ,p k are a ll o ther paths in Q .T hese paths ca n be i de n t i fied b y fi n d in gthe l eaf no des .P aths c o rresp on d in gt ol eaf no des w h i ch are desce n da n ts o f DN ( Q ) ca n be i g no red .F urtherm o re , paths that ha v eac o mm on a n cest o r w h i ch ca nn e v er be embedded in t o V b y a ny U E ( such no des are eas ily f o u n dafterge n erat in ga ll U Es us in gthea l g o r i thm in [ 2 ]) ca n be treated as a s in g l epath .

S upp o se w eha v e n U Es f 1 , ... ,f n .W ereprese n teach U E f i b y a v ect o r a y ( f )= M +0 . 5o ther wi se ,w here M i sthema xi ma lv a l ue am on gthe i de n t i fiers o fa ll p o ss i b l e success o r no des acr o ss a ll U Es 3 .Fo re x amp l e , f o rthequer y Q a n d vi e w V in Fi g .6, M = 8 . 5. All U Es t o gether f o rm a n  X  k matr ix, de no ted A =( a i,j ). W e mark each v a l ue in the matr ix wi th e i ther /o r //, represe n t in g the fact the c o rresp on d in g no de i sc onn ected t oi ts pare n t wi th a /-edge o ra //-edge .T he v a l ue M +0 . 5i smarked wi th //.

In Al g o r i thm 1, w efirsts o rt the r ow s in desce n d in g o rder o fthesum o f v a l ues in the r ow, a n dthe nin desce n d in g o rder o fthe n umber o f v a l ues marked //. T he a i m o fth i s i st o arra n ge th o se U Es w h i ch are m o re li ke ly t o c on ta in o ther U Es at the t o p , s o as t o rem ov eredu n da n t U Es ear ly, thus reduc in gthe n umber o f subseque n tc o mpar i s on s .In tu i t iv e ly, the m o re //-ch il dre n the CAT has , a n dthe m o re no des a nU Eembeds , the m o re li ke ly i tc on ta in sm o re o ther U Es .So rt in g us in gthesum o f v a l ues in ar ow will a l s o he l pt o arra n ge U Es in such a w a y that i f i  X  j , the n r ow j ca nno tbea n e x te n s ion o fr ow i , because f o ra ny U E f a n d g , g i sa n e x te n s ion o f f i mp li es the sum o f success o r no des o f g i sgreatertha n the sum o f success o r no des o f f .T h i s i spart ly due t oo ur n umber in gscheme in w h i ch desce n da n ts ha v ea l arger n umber tha n a n cest o rs on each path .T h i s will a l s o e x p l a in w h yw eha v ech o se n the breadth -first ( rather tha n depth -first ) tra v ersa l w he nn umber in gthe no des in Q :w e w a n tt o treat the paths in Q as e v e nly as p o ss i b l e , but s li ght ly fa vo r paths that ha v em o re no des embedded b y s o me U E . T he reas on w eha v ech o se n M +0 . 5 rather tha n  X  f o rfu lly embedded paths ca n a l s o be e x p l a in ed here :i ft wo o rm o re U Es b o th fu lly embed s o me paths o f Q ,w earest ill ab l et o arra n ge them b y the n umber o f no des the y embed on o ther paths .W ech o se M +0 . 5 rather tha n M +1 in o rder t o d i st in gu i sh th i s Algorithm 1. Fil ter in gmatr ix A =( a i,j ) us in g T he o rem 1 spec i a lv a l ue fr o mthe real success o r no des (w h i ch are a ll in tegers ) a n da voi d the c on fus ion in the case w here there i sa no de in Q w h i ch i s n umbered M +1. Fi g .6 ( e ) sh ow sthes o rted matr ix represe n t in ga ll U Es f o rthe V a n d Q sh own in Fi g .6 ( a ),( b ). T he a l g o r i thm the n pr o ceeds t o check the r ow s on eb yon efr o m t o pt o b o tt o m , t o see i fa ny o ther r ow i sc on ta in ed in the curre n tr ow ( thus ca n be rem ov ed ) us in g T he o rem 1.
 Example 6. C on s i der the quer y Q a n dthe vi e w V in Fi g .1. U s in gthea l g o r i thm in [ 2 ]w eca n fi n d8 0U Es .T he p o ss i b l eset o f success o r no des f o r the three paths in Q are { 13, 7 , 4 ,1 } , { 1 4 , 8 ,5, 2 } , a n d { 15, 1 2 ,9,6,3 } respect iv e ly (T hus M =15 . 5). Fo ra ll o fthese U Es w e will ha v ea nU Ematr ix A w h i ch c on ta in s 8 0 r ow sa n dthreec ol um n s .P art o fthematr ix i ssh own in Fi g .1 ( c ). T he first r ow o fthes o rted matr ix c on ta in sthe v ect o r (13, 1 4 , 15), w here each e l eme n t in the v ect o r i sass o c i ated wi th //. U s in g Al g o r i thm 1, w e will c o mpare th i sr ow wi th a ll o ther r ow s .Sin ce the v a l ues in th i sr ow are greater tha no requa l t o the c o rresp on d in g v a l ues in o ther r ow s , a n deach v a l ue in th i sr ow i smarked //, a n d a 1 , 1 =13 = M ,w eca n rem ov ea ll o ther r ow s .W eare l eft wi th only on er ow, w h i ch represe n ts a s in g l e U E .T he m ini ma l c ov er set c on ta in s only th i s U E . Example 7. C on s i der the vi e w V a n d Q in Fi g .6. T here are 7 U Es w h i ch make up the matr ix sh own in Fi g .6 ( e ). All v a l ues in the matr ix are marked //. U s in g Al g o r i thm 1, w eca n rem ov ethe 3 rd ,5 th , a n dthe l ast r ow s w he n the y are c o mpared wi th the first r ow; w eca n the n rem ov ethe4tha n d 6 th r ow sb y c o mpar in gthem wi th the 2 n dr ow. T he rema inin gt wo r ow stur n ed o ut t o be no tc on ta in ed in each o ther .So the y f o rm the m ini ma l c ov er set . W esh ow ed that the c on d i t ion sf o r i rredu n da n t U Eg iv e nin[ 2 ]i s in c o rrect , a n d i t i s n e i ther suffic i e n t no r n ecessar y. W ethe n pr ovi ded s o me suffic i e n tc on d i-t ion sa n d separate n ecessar y c on d i t ion sf o r U Ec on ta in me n t .U s in gthesere -su l ts ,w edes i g n ed a heur i st i ca l g o r i thm f o rrem ovin gredu n da n t U Es fr o ma g iv e n set .W edem on strated , us in ge x amp l es , that o ur a l g o r i thms ca n be s i g -ni fica n t ly faster tha n the brute -f o rce meth o d o ftest in g U Ec on ta in me n tus in g c on ta in me n tmapp in gs pa i rb y pa i r .

