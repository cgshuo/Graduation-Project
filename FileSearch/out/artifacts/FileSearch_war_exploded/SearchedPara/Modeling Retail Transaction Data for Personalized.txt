 Retail transaction data conveys rich preference information on brands and goods from customers. How to mine the transaction data to provide personalized recommendation to customers becomes a critical task for retailers. Previous recommendation methods either focus on the user-product matrix and ignore the transactions, or only use the partial information of transactions, leading to inferior performance in recommendation. Inspired by association rule mining, we introduce association pattern as a basic unit to capture the correlation between products from both intra-and inter-transactions. A P robabilistic model over the A ssociation P atterns (PAP for short) is then employed to learn the po-tential shopping interests and also to provide personalized recommendations. Experimental results on two real world retail data sets show that our proposed method can outper-form the state-of-the-art recommendation methods. H.2.8 [ Database Applications ]: Data mining recommendation, association pattern, probabilistic model
Massive transaction data sets have been routinely record-ed in offline retails, which convey rich preference informa-tion on brands and goods from customers. It becomes a critical task for retailers to mine these valuable transaction data to provide personalized recommendation to customers, so that they can stimulate consumption and compete with e-commerce business where recommender systems have al-ready been widely employed. In fact, in the past decades data mining technologies, like association rule mining, have been applied on transaction data to discover interesting re-lations between products. For example, some useful rules are found in the sales data of a supermarket indicating that if a customer buys onions and potatoes together, he or she is likely to also buy hamburger meat. The obtained rules can help retailers in promotional pricing or product place-ments, but usually lack personalization which is important to customers. Therefore, how to model the transaction data to provide personalized shopping recommendations becomes a key challenge.

Previous methods on recommender systems, like collabo-rative filtering methods [3], mainly focus on directly mod-eling the user-product matrix. In this way, the transaction information is usually ignored in these methods. However, transactions indicate the strong correlation between prod-ucts and are very prominent in retail as compared with the correlation in e-commerce. For example, we compared the sales data from a large retailer BeiRen with data from the biggest e-commerce website Taobao in China. We found that in the retail data set there is 33 . 6% transactions containing more than two products, while in the e-commerce data set there is less than 12%. Some recent work on basket recom-mendation did take transactions into account . However, in their work, only partial transaction information: either pat-terns across transactions [4], or patterns within transactions [7] has been utilized.

In this paper, we present a novel approach on modeling re-tail transaction data for personalized shopping recommenda-tion. Inspired by association rules, we introduce association patterns as basic units to capture the correlation between products and summarize the dataset. Here an association pattern is defined as a weighted pair of products from ei-ther intra-and inter-transactions of a user. The weight of a pattern describes correlations strength between the two products in the pattern, which is defined according to the time span between the two products. In this way, the orig-inal transaction data can been turned into a collection of association patterns, which preserves the important correla-tion information within and across transactions.

By assuming the association patterns are generated from some low-dimensional latent shopping interests, we propose a P robabilistic model over the A ssociation P atterns (PAP for short) to model the generation process and learn the rep-resentation of shopping interests. With the learned model, we can then inference the shopping interests of each indi-vidual and provide personalized shopping recommendations. Experimental results on two real world retail datasets show that our proposed method can outperform the state-of-the-art recommendation methods.

The remainder of this paper is organized as follows. We first discuss related work in section 2. Section 3 introduce our model. We present our experiments and discussion in section 4, then make a conclusion in section 5.
In this section, we will briefly review the related work on general recommender systems, and the work on transaction data mining for recommendations.

The content-based method recommends products based on a comparison between contents of products [1]. Howev-er, content information may not always available in many cases, which limits the usage of this model. Collaborative filtering is a popular recommendation method, which tries to predict the utility of products for a particular user based on the products rated by other users [1, 5]. Algorithms of collaborative filtering essentially can be grouped into t-wo general classes: memory-based methods, e.g. KNN, and model-based methods, e.g. matrix factorization model.
KNN makes prediction based on the entire collection of previous rated products [6]. The rate to an unknown prod-uct for a given user can be calculated as an aggregation of similar users X  behaviors. However this kind of algorithm on-ly concerns local information in choosing similar users, and it leads to a inferior performance in recommendation.
Matrix factorization models map both products and user-s into a low-dimensional latent space. For example, BPR (Bayesian Personalized Ranking) is a popular factorization model[5, 8]. The model tries to obtain the representation of users and products by optimizing a personalized ranking for all products.

Recently, some work in recommendation also take transac-tion information into account. For example, the rule-based models utilize data mining algorithms(i.e. Apriori and FP-growth)to recommend products by mining frequent item-sets from dataset. However the models tend to generate a large number of patterns once mining a large data set, most of which are spurious, not relevant to recommenda-tions [4]. Rendle et al. [6] propose a factorization model by emphasizing correlations of products belonging to different transactions, while Xiang Wu et al. [7] utilize relations of products in the same transaction to recommendation songs for users.
In this section we will describe our P robabilistic model over A ssociation P attern in detail. In the following, we first introduce the concept of association patterns, then describe the generative model (i.e. PAP) over the association pat-terns, we finally present how to infer customers X  shopping interests with the learned model and provide personalized recommendations.
Correlation between products is a basic factor in shop-ping behavior and critical for recommendation, which can be revealed by the co-occurrences between products. We in-troduce the concept of association patterns to describe the co-occurrences between products in user transaction data. According to different co-occurrence types, there are two kinds of association patterns, namely Intra Association Pat-tern and Inter Association Pattern, as shown in Figure 1.
Definition 1. Intra Association Pattern. Given the transaction set T u = { t u 1 ,t u 2 ,...,t u | T | } of user u ,where Figure 1: Association patterns between two transactions. The solid lines among product a, b, c stand for intra asso-ciation patterns, and the dotted lines among a, b, c and d stand for inter association patterns. is the count of transactions belonging to u ,anintraas-sociation pattern is defined as a weighted pair of products of the pattern.

Definition 2. Inter Association Pattern. Given the transaction set T u = { t u 1 ,t u 2 ,...,t u | T | } of user u ,where is the count of transactions belonging to u ,aninteras-sociation pattern is defined as a weighted pair of products &lt;I i ,I j ,w ij &gt; ,where I i  X  t u m , I j  X  t u n , m = n ,and w denotes the weight of the pattern.

The weight of an association pattern represents the cor-relation strength between the pair of products. Obviously, the intra association pattern indicates strong correlations between products since customers prefer to buy them to-gether, while the inter association pattern indicates weak correlation. To reflect this, here we define the weight based on the time-stamp of the transaction the products belong to. Let I i  X  t u m and I j  X  t u n , the weight of an association pattern is defined in following unified form: where K is a normalization factor. As we can see, the weight of an intra association pattern is 1 by definition, while that of an inter association pattern is less than 1 and decayed with the time span between the two transactions.

Based on the definition of association patterns, the orig-inal transaction data set can be turned into a collection of association patterns. By this transformation, we can accu-mulate all the important co-occurrence information within and across transactions from different users.
Although the association patterns reflect the correlations between products, they can be hardly directly utilized for recommendation due to the sparsity. To learn useful cor-relation information for recommendation, we assume that all the association patterns are generated from some latent low-dimension shopping interests. In this way, we introduce a generative model, namely PAP, to describe the generation of the association patterns and learn the latent shopping interests.

Specifically, PAP assumes that two products in an associ-ation pattern are drawn independently from a latent shop-ping interest. The key idea is that if two products co-occur more frequently, they are more likely to belong to the same interest.

Formally, let S denotes the whole collection of association patterns, S shares a n-dimensional latent shopping interests.  X  denotes a multinomial distribution of shopping interests, with  X  k = p ( z = k ) standing for the proportion of the k -th shopping interest.  X  k denotes a multinomial distribution of products, with  X  k,m standing for the proportion of prod-uct I m on the k -th shopping interest( m  X  k,m =1). The generative process of PAP is described as follows: Algorithm 1 The generative process of PAP 1: sample a distribution of shopping interests  X   X  2: for each shopping interest z 3: for each pattern &lt;I i ,I j &gt;  X  S where parameter  X  and  X  are Dirichlet priors. Figure 2 shows the probability graph of generative process.
Based on the generative process mentioned above, we can obtain the joint probability of pattern &lt;I i ,I j &gt; : the marginal distribution of &lt;I i ,I j &gt; can be calculated through integrated  X  and  X : and the likelihood of the whole pattern-set S is:
We use Gibbs sampling to approximate inference. In our model there are three parameters need to be estimated: z ,  X , and  X . Concerning that we can integrate out parame-ters  X  ,  X  because of conjugate prior  X ,  X  . Given association pattern &lt;I i ,I j &gt; , we just need to sample parameter z : terns, except &lt;I i ,I j &gt; . X  k , X  k,m can be calculated as: where n k is the number of pattern &lt;I i ,I j &gt; assigned to the k -th interest, n k,i is the number of I i assigned to the k -th interest, and | S | is the number of patterns in pattern-set S .
Figure 2: probabilistic model over association patterns
With the learned shopping interests, we now aim to infer individual shopping interests for each user for recommenda-tion. Through Bayesian theory, given association pattern &lt;I i ,I j &gt; , we can get the probability of the k -th shopping interest:
P ( z = k | &lt;I i ,I j &gt; )= P ( &lt;I i ,I j &gt; Then the proportion on k -th shopping interest for user u can be calculated as: where S u denotes the collection of association patterns mined from transaction set T u ,and P ( &lt;I i ,I j &gt; obtained as follows: To conduct personalized shopping recommendation to users, we calculate users X  preference to products with respect to their shopping interests as follows: By sorting the products according to P ( I i | u ), we can rec-ommend top-k products to uesrs.
To demonstrate the effectiveness of our model, we choose two real retail data sets: BeiRen dateset and Tafeng dataset. BeiRen dataset is collected by a large retail department store in China, recording brands of merchandise products from 2011 to 2013. Tafeng dataset 1 is offered by RecSys, which covers products from food, office supplies to furniture. The detail is showed in Table 1.

First we preprocess two datasets before evaluation. We reserve products and brands in datasets bought at least 10 times. We hold out 50% of the data set for training, with the remaining for test, The time of transactions in two datasets is recorded by the day, thus we assign K = 365 in Equation 1. We evaluate our model against four state-of-the-art methods in product recommendation:TOP(the most http://recsyswiki.com/wiki/Grocery shopping datasets id name #users # products # transactions 1 BeiRen 18315 1442 242894 2 Tafeng 7141 6894 37269 popular products are recommended),KNN, NMF, and BPR method.
 We compare the performance of different recommendation methods with the widely used F -measure[2,6,7]overtop-5, top-10 products. Figure 3: Comparisons of TOP, KNN, NMF, BPR and our model PAP on BeiRen data set. Figure 4: Comparisons of TOP, KNN, NMF, BPR and our model PAP on Tafeng data set.
 Figure 3 and Figure 4 show the results on BeiRen and Tafeng dataset. We can see that KNN performs worst in recommendation because it only utilizes local information. By simply recommending top popular products, Top method outperforms KNN slightly. Surprisingly, Top method per-forms the second best on Tafeng datset, indicating that the top method is very unstable. The BPR and NMF methods represent users and products into a low-dimensional laten-t space to avoid data sparsity, and the two methods show little difference in performance.

Comparing to other methods, our model outperforms all other methods, with F -score promoted at least 33% and 16% respectively. The improvement is statistically significant( p -value &lt; 0 . 01)
In this paper we proposed a novel P robabilistic model over the A ssociation P attern for personalized recommendation. With a generative process to reduce association patterns into a n-dimensional latent shopping interests, we recommend user top-k products by user X  X  preference. In the future we will try to consider sequential patterns, and make dynamic personalized recommendation.
This research work has funded by 973 Program of China under Grants N o.2014CB340401, 863 Progr am of China un-der Grants No.2014AA015204, No.2012AA011003, Project supported by the State Key Program of National Natural Science of China under Grant No .61232010, Projec t support-ed by the National Science Foundation for Young Scientists of China under Gra nt No.61203298, and The National Key Technology R &amp; D Program under Grant s No.2012BAH39B04.We would like to thank the anonymous reviewers for their help-ful comments. [1] G. Adomavicius and A. Tuzhilin. Toward the next [2] K. Choi, D. Yoo, G. Kim, and Y. Suh. A hybrid [3] Y. Koren, R. Bell, and C. Volinsky. Matrix [4] B. Mobasher, H. Dai, T. Luo, and M. Nakagawa. [5] S. Rendle, C. Freudenthaler, Z. Gantner, and [6] S. Rendle, C. Freudenthaler, and L. Schmidt-Thieme. [7] X.Wu,Q.Liu,E.Chen,L.He,J.Lv,C.Cao,and [8] X. Yu, X. Ren, Y. Sun, Q. Gu, B. Sturt,
