 Ivo D. Shterev i.shterev@duke.edu Duke University, Durham NC 27705, USA David B. Dunson dunson@stat.duke.edu Duke University, Durham NC 27708, USA Watermarking is the process of imperceptibly em-bedding a watermark signal into a host signal (au-dio segment, pixel patch from image or video frame). The watermark signal should only introduce tolera-ble distortion to the host signal and it should be recoverable by the intended receiver. Watermark-ing techniques differ by the way they modulate the host signal to embed information. There are two ma-jor classes of watermark embedding schemes, namely spread spectrum and quantization index modulation (QIM) ( Chen &amp; Wornell , 2001 ).
 Spread spectrum watermarking ( Cox et al. , 2007 ; Hartung et al. , 1999 ) constitutes a popular class of watermarking algorithms. In their simplest form, the watermarked signal is constructed by adding the host and watermark signals together, i.e. additive water-mark embedding. Although, in terms of additive noise attacks they have been outperformed by the more ro-bust QIM watermarking techniques ( Chen &amp; Wornell , 2001 ), spread-spectrum techniques have advantageous features that make them preferable in some water-marking scenarios. Examples of such inherent features include their simplicity and robustness to removal at-tacks. Another advantage is that spread-spectrum wa-termarking can be applied in different forms (multi-plicative watermarking ( Huang &amp; Zhang , 2007 )) that can further improve performance in some cases. They can also effectively exploit the human visual system (HVS) ( Podilchuk &amp; Zheng , 1998 ) to reduce percep-tual degradation of the host signal.
 Many attacks have been designed to hamper the performance of watermarking in general and spread-spectrum watermarking in particular. The attacks are usually classified with respect to the attacker X  X  as-sumed knowledge about the watermark scheme. Ro-bustness attacks pertain to the class of attacks under which the attacker has no knowledge of the watermark scheme. Examples of such attacks include adding ran-dom noise ( Chen &amp; Wornell , 2001 ) to the watermarked signal, replacing signal blocks with perceptually simi-lar blocks computed in a certain way ( Kirovski et al. , 2007 ), applying a geometric transformation (cropping, scaling, translation, etc.) to the watermarked signal, or applying a malicious filtering operation ( Su et al. , 2001 ), to name a few. Other attacks belong to the so called worst case class of attacks, where the at-tacker has knowledge about the watermark technique and designs the attack such that the watermark detec-tor (decoder) performance is minimized, under suit-ably defined distortion constraints. Usually, this type of attack is based on game theory ( Cohen &amp; Lapidoth , 2002 ) and is mostly of theoretical importance. A third class of attacks aims at compromising the watermark system security (security attacks) ( Cayre et al. , 2005 ; Freire &amp; Gonzalez , 2009 ). Under this scenario, the attacker has access only to the wa-termarked data and tries to estimate the secret key used for embedding the watermark. Having estimated the secret key, he can then reconstruct the water-mark and remove it from the watermarked data (the so called removal attacks), thus creating a forgery of the host signal, which can then be freely copied and distributed by pirates. Although ( Cayre et al. , 2005 ; Freire &amp; Gonzalez , 2009 ) develop theoretical security attack frameworks, the proposed algorithms do not perform well with real correlated host signals. Another type of attack is the so called sensitiv-ity analysis attack, which constitutes a powerful subclass of removal attacks ( Kalker et al. , 1998 ; Linnartz &amp; van Dijk , 1998 ; Choubassi &amp; Moulin , 2007 ). In their attempt to estimate the watermark signal, they rely on unlimited access to the decoder. In this paper, we consider the scenario in which a watermark signal is repeatedly embedded in specific (possibly secretly chosen) host signals. The host sig-nal can represent a patch of pixels from image or video frame. The host signals may be perceptu-ally similar or quite disparate, as the watermark al-gorithm may choose, for security reasons, to embed the watermark in specific signals of the host data based on a secret message bitstream. Repetitive wa-termark embedding is of particular interest in image and video watermarking ( Voloshynovskiy et al. , 2001 ; Doerr &amp; Dugelay , 2004 ; Kalker et al. , 1999 ), where the watermark signal is repeatedly allocated into small blocks to ensure robustness and resistance to geometric (desynchronization) attacks. However, the proposed attacks related to this scenario assume that the wa-termark signal is not secretly hidden but is added to every host signal and therefore do not try to estimate an embedded message bitstream.
 The attack model proposed in this paper jointly es-timates the embedded message bitstream and water-mark signal from the watermarked data, without ac-cess to the decoder. We develop a probabilistic model based on Bayesian statistics. The algorithm models the host signal as having a multivariate Gaussian dis-tribution with unknown mean and full covariance ma-trix. The watermark signal itself is also modeled as having a multivariate Gaussian distribution, but with separate unknown mean and full covariance matrix. The model parameters are updated sequentially from their respective conjugate full conditional posterior distributions, via Markov chain Monte Carlo (MCMC) sampling. To further increase the convergence speed of the proposed algorithm, we develop a variational Bayesian (VB) ( Beal &amp; Ghahramani , 2003 ) solution to it. In addition to its suitability for large scale data analysis, the VB solution also allows for diagnosing convergence, via the lower bound to the log-likelihood. Both MCMC and VB solutions perform comparably with respect to probability of bit error and relative watermark reconstruction error, with both synthetic and real host data.
 Our model borrows similar ideas from sparse factor regression formulations (sparse models) used in gene expression data analysis ( West , 2003 ; Carvalho et al. , 2008 ). The objective of such sparse models is to spec-ify a prior for the elements of a highly sparse factor loadings matrix, with most elements being exactly zero and few of them having relatively large variances. To contrast with our model, the role of the zero elements here is taken by the data points (signals) that are not watermarked, which do not necessarily constitute the majority of all data points. The watermarked data points have the interpretation of the non-zero elements in the factor loadings matrix. However in our case, they are a sum of the host and the watermark signals, with the watermark signal being much weaker than the host signal. The problem becomes that of a joint identification-estimation of a subtle signal. Throughout this paper, random variables are denoted by small letters. Random vectors and their realiza-tions are denoted by bold small letters. The notation x  X  R d indicates a d -dimensional random vector of real elements. Square random matrices and their real-izations are denoted by bold capital letters. The nota-tion X  X  R d  X  d indicates a d  X  d matrix of real elements and X  X  is its transpose. The probability of an event is denoted by Pr( ). The notation x  X  p ( x ) indicates that x has a probability density function (pdf) p(x). In this paper we concentrate on one of the most pop-ular additive spread-spectrum watermarking systems, in which a watermark signal is repeatedly used to em-bed a message bitstream into a host data. The wa-termark encoder is shown in Fig. 1 . Considering the i th data point and depending on the message bit b  X  { 0 , 1 } , the encoder adds ( b i = 1) the watermark signal w to the host signal x i , or leaves the host sig-nal unchanged ( b i = 0). The watermarked signal can therefore be written as where i  X  { 1 , . . . , n } and n is the number of available data points. The watermark decoder is shown in Fig. 2 . The de-coder has access to the watermark signal w . Based on the received (watermarked) signal y i and the wa-termark signal, the decoder computes a detection test statistic f ( y i , w ) and compares it to a suitably chosen threshold  X  . The decoder then outputs an estimate  X  b i of the embedded message bit b i in the following way Throughout the paper, the document-to-watermark (DWR) ratio is defined as DWR = 10 log 10  X  2 x / X  2 w , where  X  2 x is the variance of a single element in x i , for ment in w . It is assumed that the attacker has access to the wa-termarked signal, but has no access to the watermark decoder. The complete form of the attack model can be summarized as follows: where N ( x |  X  ,  X  ) is the d -variate Gaussian distribu-tion of x with mean  X  and covariance matrix  X  , IW (  X  |  X  0 ,  X  0 ) is the inverse Wishart distribution of  X  with degrees of freedom  X  0 and base covariance ma-trix  X  0 , Bernoulli( b i |  X  ) is the Bernoulli distribution of b with mean  X  , and Beta(  X  | a  X  , b  X  ) is the Beta distri-bution of  X  with parameters a  X  and b  X  .
 A graphical representation of the attack model is shown in Fig. 3 . The blue circle represents the observed variable, the white circles represent hidden (latent) variables and the squares represent hyper-parameters. Conditional dependence between vari-ables is shown via the directed edges. In this section we derive the update equations for the attack model parameters, with respect to the MCMC and VB solutions. The update equations are based on the full likelihood of the model, which can be written as As it can be seen the likelihood ( 10 ) is in an intractable form, since it is not possible to jointly estimate all model parameters directly from ( 10 ). That is why the MCMC and VB solutions developed below update ev-ery model parameter sequentially from its respective conditional posterior distribution. While the MCMC solution is based on exact conditional posterior distri-butions, the VB solution utilizes an approximation to the true conditional posterior distribution. 4.1. MCMC Update Equations We derive the MCMC update equations, based on the exact full conditional posteriors of the attack model parameters and construct a Gibbs sampler that itera-tively samples from these update equations.
 The full conditional posterior distributions of the model parameters are as follows:  X  updating {  X  ,  X  } .  X  updating w .  X  updating b i .  X  updating  X  .  X  updating { m , V } .  X  updating x i . 4.2. VB Update Equations The VB approach tries to find a tractable lower bound L ( q ) to the logarithm of the marginal likelihood ( 10 ), which can be iteratively updated (tightened). If we de-note by  X  the model parameters { w ,  X  ,  X  , m , V , b ,  X  } that we want to update, the optimal posterior update that gives the tightest bound ( Beal &amp; Ghahramani , 2003 ) is given as where hi  X  j denotes expectation with respect to all pa-rameters except for the j th parameter that is being updated.
 Using ( 28 ), the posterior VB updates of the model parameters are as follows:  X  updating {  X  ,  X  } .  X  updating w .  X  updating b i .  X  updating  X  .  X  updating { m , V } . We perform experiments with both synthetic and real host signals. To quantify the performance of our al-gorithm, we compute the probability of error P e =
P i 1( b i 6 =  X  b i ) and the relative watermark reconstruc-and  X  w is the estimated watermark signal.
 In all experiments, the model hyper-parameters are initialized as a  X  = b  X  = 0 . 5 n ,  X  0 = m 0 = 1  X  0 = d + 1,  X  0 = 1 n P i ( y i  X   X  0 )( y i  X   X  0 )  X  and V 95% credible intervals of the individual samples in the watermark signal estimate  X  w . With respect to the MCMC solution, we performed 2000 iterations of the Gibbs sampler, discarding the first 1000 as burn in iterations and averaging the results of the remaining 1000 iterations. For the VB solution, we performed 100 iterations and using the last iteration updates of h w i , and h b i i , as the estimated watermark signal  X  w and message bit  X  b i for i  X  { 1 , . . . , n } , respectively. We implemented the proposed attack model solu-tions in R , with some of the routines implemented in C/C++ . It takes approximately 6 minutes for the MCMC solution to perform 2000 iterations, using 4096 64-dimensional data points. In contrast, the VB so-lution performs 100 iterations in less than a minute, using the same data points. 5.1. Synthetic Host Signals In this subsection we perform experiments with syn-thetic host signals. We generated n = 4096, d = 64-dimensional host data points. Each data point was in-dependent and identically drawn from N 0 , IW d + 1 , IW ( d + 1 , I ) , where I is the identity matrix. In this way, the host signal covariance matrix, although randomly drawn, imposes some structure on the host signal. The watermark signal was drawn from a mul-tivariate Gaussian with mean N 0 , IW ( d + 1 , I ) and covariance IW ( d + 1 , I ). The watermark signal was zero mean transformed and scaled so that DWR = 30db. The watermark message bits were drawn from Bernoulli(0 . 5), and the watermarked signal was formed by additive spread-spectrum modulation. The host image and the difference between the watermarked and host images are shown in Fig. 4 . Each block of pix-els was formed by row-wise transformation of the data point into an 8  X  8 matrix. The blocks were then or-dered row-wise to form the whole image.
 Experimental results of the difference b i  X   X  b i for i  X  { 1 , . . . , n } , the watermark signal w and its estimate  X  w for the MCMC and VB solutions are shown in Fig. 5 . The results show that the algorithm was able to obtain a good estimate of the watermark signal and message bitstream, with only a small fraction of misidentified bits. Based on the experimental results, we can see that the MCMC and VB solutions perform compara-bly in terms of P e and R w . 5.2. Real Host Signals In this subsection we perform experiments with real image signals. We applied our algorithm on gray scale images. In the experiments we used image sizes of 512  X  512 and 1024  X  1024 pixels. The images were split in 8  X  8 patches of pixels, making a total of n = 4096 and n = 16384 patches respectively. The pixels within each patch were concatenated row-wise to form the d -dimensional ( d = 64) data points. The host signal was then normalized to have zero mean. As in the case of synthetic host signals, the water-mark signal was drawn from a multivariate Gaus-sian with mean N 0 , IW ( d + 1 , I ) and covariance IW ( d + 1 , I ). The watermark signal was then scaled such that DWR = 30db and embedded by additive spread-spectrum modulation with Pr( b i = 1) = 0 . 5, for i  X  { 1 . . . n } . The real host images used in the experiments are shown in Fig. 6 .
 Experimental results for the MCMC and VB solutions applied to the real host images from Fig. 6 are shown in Fig. 7 . It can be seen that both solutions perform comparably with respect to real host signals. Computations of the lower bound L ( q ) for the VB so-lution applied on the real host images in Fig. 6 are shown in Fig. 8 . The results show that the VB so-lution converges in less than 20 iterations for all real host images considered in the experiments. To quantify the performance of the attack model with respect to different DWR levels, we perform experi-ments with the real host images in Fig. 6 and vary-ing the DWR  X  { 20 , . . . , 40 } . The interval of values for the DWR was chosen so that the middle is at DWR = 30db, at which level no perceptual degrada-tion to the host image was observed. The watermark signal was drawn from a multivariate Gaussian with mean N 0 , IW ( d +1 , I ) and covariance IW ( d +1 , I ). For each host image, the watermark signal was drawn only once and then zero mean transformed, and scaled down differently to achieve the different DWR levels. Experimental results of P e and R w as functions of DWR are shown in Fig. 9 and Fig. 10 respectively, with both solutions performing comparably. We presented a new attack model on repetitive spread-spectrum watermarking systems, based on Bayesian statistics. The proposed algorithm jointly estimates the watermark signal and message bitstream, directly from the watermarked signal and without access to the watermark decoder. We developed MCMC and VB solutions that perform comparably in terms of prob-ability of error and relative watermark reconstruction error, on both synthetic and real host signals. Fast convergence is observed in both solutions, particularly in the VB solution where the algorithm converges in less than 20 iterations, with both synthetic and real host signals. While the MCMC solution is expected to result in more accurate estimates for infinite number of iterations, the VB solution is computationally more efficient and therefore more appropriate for large data sets. We demonstrated that the attack model is able to correctly infer a large part of the message bitstream while at the same time obtaining a good estimate of the watermark signal. The authors wish to acknowledge the helpful sugges-tions of the reviewers.
 Bas, P., Chassery, J. M., and Macq, B. Geometrically invariant watermarking using feature points. IEEE Transactions on Image Processing , 11(9):1014 X 1028, September 2002.
 Beal, M. J. and Ghahramani, Z. The variational bayesian em algorithm for incomplete data: with application to scoring graphical model structures. Bayesian Statistics 7 , pp. 453 X 464, 2003.
 Carvalho, C. M., Chang, J., Lucas, J. E., Nevins, J. R.,
Wang, Q., and West, M. High-dimensional sparse factor modeling: Applications in gene expression ge-nomics. Journal of the American Statistical Associ-ation , 103(484):1438 X 1456, March 2008.
 Cayre, F., Fontaine, C., and Furon, T. Watermark-ing security: Theory and practice. IEEE Transac-tions on Signal Processing , 53(10):3976 X 3987, Octo-ber 2005.
 Chen, B. and Wornell, G. W. Quantization index modulation: A class of provably good methods for digital watermarking and information embedding.
IEEE Transactions on Information Theory , 47(4): 1423 X 1443, May 2001.
 Choubassi, M. El and Moulin, P. Noniterative algo-rithms for sensitivity analysis attacks. IEEE Trans-actions on Information Forensics and Security , 2(2): 113 X 126, June 2007.
 Cohen, A. S. and Lapidoth, A. The gaussian water-marking game. IEEE Transactions on Information Theory , 48(6):1639 X 1667, June 2002.
 Cox, I. J., Miller, M. L., Bloom, J. A., Fridrich, J., and Kalker, T. Digital Watermarking and Steganog-raphy, 2nd Ed. Morgan Kaufmann, 2007.
 Doerr, G. and Dugelay, J. L. Security pitfalls of frame-by-frame approaches to video watermarking.
IEEE Transactions on Signal Processing , 52(10): 2955 X 2964, October 2004.
 Freire, L. P. and Gonzalez, F. P. Spread-spectrum watermarking security. IEEE Transactions on In-formation Forensics and Security , 4(1):2 X 24, March 2009.
 Hartung, F., Su, J. K., and Girod, B. Spread spec-trum watermarking: Malicious attacks and counter-attacks. In Proc. SPIE Security and Watermarking of Multimedia Contents , San Jose, CA, 1999. Huang, X. and Zhang, B. Statistically robust detec-tion of multiplicative spread-spectrum watermarks. IEEE Transactions on Information Forensics and Security , 2(1):1 X 13, March 2007.
 Kalker, T., Linnartz, J. P., and van Dijk, M. Wa-termark estimation through detection analysis. In
Proc. International Conference on Image Process-ing , Chicago, IL, 1998.
 Kalker, T., Depovere, G., Haitsma, J., and Maes, M.
A video watermarking system for broadcast moni-toring. In Proc. SPIE Security and Watermarking of Multimedia Contents , San Jose, CA 1999.
 Kirovski, D., Petitcolas, F. A. P., and Landau, Z. The replacement attack. IEEE Transactions on Audio, Speech, and Language Processing , 15(6):1922 X 1931, August 2007.
 Linnartz, J. P. and van Dijk, M. Analysis of the sen-sitivity attack against electronic watermarks in im-ages. In Proc. Workshop on Information Hiding , Portland, OR, 1998.
 Lu, C. S. and Hsu, C. Y. Near-optimal watermark esti-mation and its countermeasure: Antidisclosure wa-termark for multiple watermark embedding. IEEE Transactions on Circuits and Systems for Video Technology , 17(4):454 X 467, April 2007.
 Podilchuk, C. I. and Zheng, W. Image-adaptive water-marking using visual models. IEEE Transactions on Selected Areas in Communications , 16(4):525 X 539, May 1998.
 Su, J. K., Eggers, J. J., and Girod, B. Analysis of digital watermarks subjected to optimum linear fil-tering and additive noise. Signal Processing , 81(6): 1141 X 1175, June 2001.
 Tang, C. W. and Hang, H. M. A feature-based robust digital image watermarking scheme. IEEE Trans-actions on Signal Processing , 51(4):950 X 959, April 2003.
 Voloshynovskiy, S., Deguillaume, F., and Pun, T.
Multibit digital watermarking robust against local nonlinear geometrical distortions. In Proc. Inter-national Conference on Image Processing , Thessa-loniki, Greece, 2001.
 West, M. Bayesian factor regression models in the large p, small n paradigm. Bayesian Statistics 7 ,
