 C. Dance, L. Fan Abstract. Digital cameras normally sample one color at each pixel. Missing colors are obtained by spatial in-terpolation, decreasing resolution relative to images ac-quired with a greyscale sensor. The consequence for doc-ument imaging is higher text recognition error rates. This paper introduces the horizontal X  X ertical regres-sion (HVR) method for document-optimized color re-construction. HVR exploits a local two-color approxi-mation, making spatial interpolation unnecessary. Com-parison with the best alternative reconstruction methods indicates large reductions in error rates for text result-ing from HVR, as well as improvements in intermediate color and binary images.
 Keywords: Color reconstruction  X  Document cameras  X  Bayer pattern 1 Introduction Our research has been motivated by the convenience of using cameras for document capture, in contrast to con-ventional scanners [8]. Digital still cameras are portable and offer face-up, near-instantaneous image acquisition. Recently there has been tremendous growth in their res-olution and ubiquity. At the time of writing, consumer digital still cameras exist with resolutions of 7 megapix-els, which is approximately that of a 300-dpi scan of an A4 page. Digital cameras are also becoming common on mobile phones and PDAs, for which 2.1-megapixel sen-sors are currently emerging.
 lems, when compared with conventional scanners, due to the wide range of conditions in which they must operate [14]. Conventional scanners truly sample each color at each point of an image. This is achieved by sampling dif-ferent colors at different times. Digital still cameras face the additional challenge that the scene to be captured may be moving relative to the camera. While simultane-ous capture of several registered color channels is possi-ble, for instance using beam splitters to distribute light to multiple sensors, it is currently expensive and poses practical problems. Instead, cameras normally sample just one color at each pixel, as illustrated in Fig. 1. two colors are  X  X issing X . Usually the missing colors are estimated by spatial interpolation of neighboring pixel values. In document imaging, such spatial interpolation inevitably introduces blur or artifacts around the thin strokes characteristic of text. Hence, the quality of doc-ument images acquired with a color sensor is usually significantly inferior to that of a grayscale sensor of equivalent resolution. This leads to poorer print qual-ity and more character recognition (OCR) errors. Peo-ple are more reluctant to share low-quality document images and less able to reuse and conduct information retrieval tasks based on error-rich text. Improving the re-construction of digital color camera images of documents is therefore an important problem.
 sion (HVR) method for document-optimized color recon-struction. HVR exploits a common piece of prior knowl-edge about most document images: that they have a foreground and background color. This local two-color approximation makes it possible to interpolate missing colors in color space, rendering spatial interpolation un-necessary. The method can detect situations, such as im-ages embedded in documents, where the approximation is inappropriate and apply alternative methods to such regions. We demonstrate that HVR consistently reduces color reconstruction errors relative to known alternative reconstruction methods. Binary images so obtained are sharper and OCR error rates are substantially lower. HVR improves the speed of the overall process of ob-taining OCR results from raw color sensor data. color reconstruction. Section 3 introduces HVR itself and discusses related algorithm designs. Section 4 conducts a comparative evaluation of HVR with three alternative methods on synthetic and real camera data. A discussion of the limits of the proposed method (Sect. 5) precedes our conclusions (Sect. 6). Finally, an appendix explores a physical consequence of the two-color approximation that underpins our approach. 2 Previous approaches to color reconstruction Most digital still cameras acquire color images by sam-pling different color channels at different sensor locations using a color filter array (CFA), although there have been recent developments in cameras that sense all colors at every pixel [6]. Many CFA designs exist [7, 1], but the most common is the Bayer pattern, which exploits two green pixels for each red or blue pixel, mimicking the greater frequency of green cones in the human retina. However, unlike the human eye, CFAs exploit regular arrangements of colors on a grid.
 need for an interpolation or reconstruction process to es-timate missing color values. Since the publication of the earliest work in the area [9], a large number of recon-struction algorithms have appeared, and many of them have been reviewed and compared in [3, 12]. New recon-struction methods continue to appear; for instance there has been recent progress on methods that simultaneously perform image sharpening and reconstruction [11]. Ex-isting reconstruction methods exploit spatial interpola-tion, unlike the color space interpolation proposed in this paper, and could be grouped into three families.  X  Direct interpolation , for example using bilinear in- X  Constant hue interpolation , which enforces slow  X  Adaptive interpolation , which exploits different mance for images with sharp edges. Since document im-ages are characterized by sharp edges, one might expect such a method to be preferable here. Indeed, the only other known method that has been designed particularly with document images in mind, HiPass demosaicing [10] (Sect. 4), is adaptive in the simple sense that it makes a decision between vertical and horizontal interpolation. However, in practice, the significance of the details of the implementation of a CFA reconstruction method should not be underestimated. 3 Horizontal X  X ertical regression method Our method depends on two key approximations:  X  Within a local region of the document, there are just  X  Blur is independent of the wavelength of incident there are linear relations between the amounts of red, green, and blue light incident at any point on a color filter array (see Appendix for details). In this noise-free case, the color histogram of such an image is a line in color space between the foreground and background col-ors. As illustrated in Fig. 2, this implies that there is a linear relationship between the value sensed at a red pixel of a CFA and the value that would have been sensed had that pixel been coated with a green filter. ploits this linear relationship, predicting missing green values by projecting observed red or blue values onto the appropriate line. The heart of the method is to de-termine exactly what linear relationship is appropriate. This regression is complicated by the fact that pairs of colors are never simultaneously observed. We describe the process of computing the missing green value at a red pixel r 00 using values in the (2 k +1)  X  (2 k + 1) win-dow surrounding it. Pixels are indexed by their Bayer cell: for instance with k =1 1. Find horizontal and vertical sums for each channel 2. Perform a linear regression minimizing the squared 3. Estimate the missing green value as verted: r = for green on red within the same Bayer cell. An analogous method is used to obtain green given blue and vice versa, resulting in coefficients m b ,c b . Finally these coefficients are combined to estimate red on blue: r = ages, an efficient implementation of this method requires 19 operations per input pixel to perform the regressions and obtain all missing green values. This count is in-dependent of the window size employed. While this is more expensive than the methods described in [3, 10], it is comparable with the cost of a separable sinc low-pass-filter interpolation. The cost is negligible compared with other typical document imaging operations such as deskewing and OCR.
 in smooth background regions of the image. This can be detected by testing if the variance of r j i is smaller than a threshold  X  1 . Obtaining this variance requires no extra computation since it appears as the denominator in the regression.
 valid in all parts of an image. This can be detected by testing to see if the regression residual exceeds a thresh-old  X  2 &gt; X  2 .
 an alternative interpolation suitable for smooth, multi-color images is employed. We have found the parameters k =10 , X  1 =2  X  2 , X  2 =(4 k +2)  X  2 to perform well in practice, where  X  = 3 is a measure of image noise. 3.1 Closely related methods The essential principle of the HVR method is to find at least two statistics describing the red and green chan-nels that should locally have very similar values, up to a linear transformation. There are many possible choices of such statistics. Our choice was motivated by an initial consideration of a very simple approach, which compares the means and variances of observed red and green pixels over some windows:  X  r , X  g , X  2 r , X  2 g . If on average then We may therefore estimate good results in our experience, it has three significant defects:  X  When confronted with a red foreground and green  X  Large window sizes are already required for Eq. 2  X  Since the method only works with two statistics, it is For these reasons the HVR method equates multiple av-erages in horizontal and vertical directions, equating only pixels on the same row or column at any given time. 4 Results 4.1 Methods compared We performed comparisons of the HVR method with three alternatives on synthetic and real camera data.  X  LPF (low-pass filter) constructs missing green pixels  X  DLPF (diamond low-pass filter) applies a low-pass  X  HPD (HiPass demosaicing) [10] first constructs 7  X  7 4.2 Synthetic evaluation For our synthetic evaluations we applied each method to the reconstruction of the green channel of images of the upper-and lowercase alphabets plus digits. Cameras are used to image documents under a wide range of res-olutions, and the degree of focus is rather variable. It is important to have a method that functions reliably across this broad range of conditions. To simulate these conditions, we applied Gaussian kernels to blur 600 dpi binary images of 10-point text, before subsampling and adding normally distributed noise. Below we refer to the standard deviation of the Gaussian kernel as the blur radius and measure it in subsampled pixels. The binary images had background and foreground gray levels of 255 and 0, respectively. The degraded results were treated as input Bayer images.
 three ways. First, we took the root mean squared differ-ence (RMSE) between the predicted green channel and the input Bayer image without noise (the ground truth). Second, we evaluated the RMSE between the full pre-dicted RGB image and the ground truth. Finally, we thresholded both the predicted green channel and the ground truth images at a gray level of 170, which seemed to give the best contrast between splitting and merging characters. We then computed the bit error rate (BER) in the predicted binary image. Since the original images contain significant and variable amounts of white space, computation of both the RMSE and BER was restricted to pixels near characters. Such pixels were identified as those that had gray values below 240 in the ground truth images.
 Courier New (CN) fonts, at 300, 200, 150, and 120 dpi are given in Tables 1 and 2. Illustrative reconstructions are given in Fig. 4. The data clearly indicate two facts. Across all conditions tested, the HPD method outper-forms LPF and DLPF, and the HVR method outper-forms all others. Averaging over all resolutions and fonts, HVR reduces the RMSE of HPD by a factor of 3 and the BER by a factor of 5. It is unsurprising that LPF and DLPF do worse since they are exploiting only one half of the available image data.
 the same relative performance: again HVR is substan-tially more accurate. However, the increase in the error in going to a 3-channel image is by a factor of between 2 and 3. The fact that this is larger than to the fact that predicting red or blue is harder than pre-dicting green. The HVR method processes each channel in essentially the same way; hence errors in green are a good predictor of errors in blue or red.
 and BER, the dependence on method and resolution does not show any simple trend. Similarly, while RMSE and BER are related, this relationship is by no means consistent: for example, compare the RMSE and BER of DLPF for A and CN. The normalized cross-correlation coefficient over all RMSE, BER pairs is only 0.52. As would be expected, with the exception of the DPLF method, there is a clear increase in BER as resolution decreases.
 increased resolution is due to the fact that the blur ra-dius is fixed in subsampled pixels ; thus the image is less blurred relative to the 600-dpi binary original at higher resolutions. If instead the resolution is fixed and blur is increased, as shown in Table 3, it is clear that all meth-ods suffer from reduced blur. As would be expected, at blur radius 0.6, the LPF method is severely penalized relative to DLPF, as it assumes lower-frequency image content.
 by noise. Reconstruction results as a function of Gaus-sian noise standard deviation  X  are given in Table 4. While HVR maintains its superiority, the lead over other methods is reduced. In all cases, HVR remains very close to the noise level itself: after all, even a gray-level sensor with a given level of noise would produce a RMSE of  X  . 22 . 5  X  to the raster direction are given in Table 5. Since HVR depends on horizontal and vertical averages, it is reasonable to question whether its performance might degrade with rotation. While the performance of the al-ternative methods slightly improves with a small rota-tion, the performance of HVR is unchanged on average, sometimes improving and sometimes not. We observe similar results for other rotations and resolutions not described here.
 in Table 6. As expected, the performance tends to im-prove with window size. The choice of window size 21 was made on the basis of the tradeoff between being able to apply the linear prediction of HVR near color changes but still having a low error rate. 4.3 Camera image evaluation We compared OCR error rates for reconstructions us-ing the four methods on five A4 pages of single-column, 10-point Times New Roman text. The text came from Chaps. 3 and 4 of H.G. Wells X  X   X  X he Time Machine X . The 8-bit raw Bayer pattern images were acquired with a SONY DFW-SX900 camera with a resolution of 1280  X  960 pixels. This corresponds to a scanning resolution of 110 dpi.
 sharpened, upsampled by a factor of 3 using bicubic in-terpolation. They were then binarized with background surface thresholding, as described in [14]. Illustrative bi-nary images are given in Fig. 5. The text in the resulting 330-dpi images was recognized using ScanSoft OmniPage Pro 11 [2]. We computed string edit distances [5] from the ground truth, comparing character error rates (not including spaces) and word error rates.
 the error rates are primarily due to isolated random character errors, uniformly distributed through the doc-uments. There are no large burst errors due to incorrect line segmentation or locally poor image quality, nor spu-rious dots or commas due to image noise. Only DLPF and HVR produce satisfactory results. For HPD and LPF, more than one sixth of the words are incorrectly recognized. Indeed, the difference in performance of the methods is rather large, HVR producing 15 times fewer character errors than HPD and 25 times fewer than LPF. on the HVR images, more than making up for additional color reconstruction time. The average time to recon-struct using a moderately efficient double-precision C++ implementation of each reconstruction method and to recognize each page are given in Table 8. 5 Discussion The HVR method avoids breakdown in case of multi-colored images through the measurement of regression residuals. In such cases the performance is limited by that of the alternative multicolor interpolate employed. There are three main ways in which even bicolored parts of pages can be detected as multicolored. 1. Show-through and bleed-through are well-known ef-2. Changes in illuminant intensity or color across the 3. Chromatic aberration refers to the difference in fo-constructing colors from paper documents. Images of whiteboards, signs, and other categories frequently sat-isfy the local two-color assumption.
 6 Conclusion We have introduced the horizontal X  X ertical regression (HVR) method for document-optimized color recon-struction. The HVR method depends on a local two-color approximation, which is sufficiently accurate for most document images. It is able to detect situations where the assumption is inappropriate and apply alternative methods. While HVR requires slightly more computa-tion than some alternative CFA reconstruction meth-ods, the additional effort is negligible compared with other document image analysis processes. Indeed, the improved binary images resulting from HVR methods frequently results in reduced overall processing time. This is because OCR needs to explore fewer possible candi-date recognition alternatives given higher-quality input. We have indicated how the method may be extended to a variety of different color filter array patterns. strated several substantial benefits of the proposed method. In our experiments, HVR reduces root mean squared reconstruction errors by a factor of 3, bit error rates by a factor of 5, and character recognition error rates by more than an order of magnitude compared with the best competing alternative. Finally, since the method produces results that truly have two colors locally, the color estimates in the images are more accurate and more suitable for emerging mixed raster content compression and reproduction techniques that assume piecewise con-stant foreground and background colors.
 References Appendix: Approximate linear relationship between colors Under reasonable physical assumptions, the intensity E ( x,  X  ) of light of wavelength  X  formed by a camera at a point x on an image plane can be approximated by a convolution process [4]. For a planar object parallel to the image plane, it is reasonable to talk of an  X  X rigi-nal image X  f ( x,  X  ) that is convolved with a point spread function (PSF) h ( x,  X  ). The PSF implicitly depends on factors such as the aperture and distance to the image plane. Studies of the accuracy of such models for image processing purposes can be found in [13]. When work-ing with a sufficiently small neighborhood of the image plane, the PSF can be considered spatially invariant. In summary, we have c  X  X  R, G, B } with transmission coefficient T c (  X  ). The transmitted light is integrated over the active area of the pixel. Even if the response over the pixel surface is nonuniform, this integration process can still be ab-sorbed into the PSF. In the absence of effects such as noise and coupling between adjacent pixels, the response of the pixel is then proportional to it has two colors locally: a foreground F (  X  ) and back-ground B (  X  ). It can then be described in terms of a switching function S ( x ), which is one for pure foreground and zero for pure background, thus pendent of wavelength h ( x,  X  )= h ( x ). Substituting for f in Eq. 5 gives where F c = d X  F (  X  ) T c (  X  ) , (8) B c = d X  B (  X  ) T c (  X  ) . (9) tions of dy 2 h ( y ) S ( x  X  y ), which is their only spatially variant component. Hence they are all linearly related.
