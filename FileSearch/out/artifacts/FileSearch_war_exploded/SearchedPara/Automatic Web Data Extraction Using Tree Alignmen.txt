 This paper investigates the automatic extraction of data from forums, blogs and news web sites. Web pages are increasingly dynamically generated using a common template populated with data from databases. This paper proposes a novel method that uses tree alignment to automatically extract data from these types of web pages. A new tree alignment algorithm is presented for determining the optimal matchi ng structure of the input web pages. Based on the alignment, the trees are merged into one union tree whose nodes record st atistical inform ation obtained from multiple web pages. A heuristic method is employed for determining the most probable c ontent block and the alignment algorithm detects repeating patterns on the union tree. A wrapper patterns extracts data from web pa ges. Experimental results show that the method achieves high extr action accuracy and has steady performance. H.3.m [Information Storage and Re trieval]: Miscellaneous -Data Extraction, Wrapper Generation, Web Algorithms, Experimentation. Data extraction, wrapper, data record extraction. Web-based information is typica lly formatted to be read by human users, not by computer applications. Information agents are being proposed which automatically extract information from multiple websites. Data is typically extracted from web sources by writing specialized programs, called wrappers [4], which identify approaches have been reported in the literature for web data extraction. Detailed discussions of various approaches can be found in several surveys [2, 4]. 
This paper presents a novel method that uses tree alignment to automatically extract data from web pages that are dynamically generated using a common templa te populated with data from databases. Particularly , the proposed approach focuses on the web pages coming from news, forums and blogs websites. There are several steps in the proposed method. (1) Tree alignment. A novel tree alignment method is proposed to find the optimal matching structur e of the two trees obtained from the web pages. The optimal matchi ng structure is used as the skeleton of the trees, which serve as an indicator to the merging procedure. The proposed algorithm adopts various constraints (such as the constraints on the linear sequence and the constraints characteristic of the algorithm is the flexible weighting schema for the matching procedure. obtained from alignment step, the input trees are merged into one union tree whose nodes record the statistical information such as the times a node has been aligned, the text length of the node. (3) Most probable content block finding and repeating patterns mining. A heuristic method is employed to find the most probable content block. The alignment algorithm is utilized again to detect the repeating patterns on the union tree. (4) Wrapper generation and data extraction. The wrapper is generated based on the most pr obable content block and the repeating patterns. 
The rest of this paper is or ganized as follows. Section 2 discusses some of the most cl osely related works. Section 3 presents the wrapper generation method using tree alignment. Section 4 shows the experimental results. Section 5 gives several conclusions and future works. RoadRunner [3] works by comparing the HTML structure of two given sample pages belong to the same "page class" or so called similar pages, generating as a result a schema for the data contained in the pages. It uses a matching algorithm to compare the page with the current template and adjusts the current template when mismatches happen. EXALG [1] is an improved approach and can overcome the main limita tions of RoadRunner. It uses differentiating roles and equivalence classes to help detecting the unknown template. Zhai and Liu [7] proposed a method based on visual information to segment data records and identify individual data records in a page. Zigoris et al. [8] used the edit-distance that provides a measure of similarity between trees (and their sub-trees) and the alignment provides a way to identify the common elements of each tree, with respect to both structure and the vertex labeling. Reis et al. [5] presen ted an algorithm called RTDM to match and cluster the input trees. They built a ne-pattern that accepts all the pages in one cluster. 
Compared with these methods, the method proposed in this study presents a new tree alignm ent algorithm which integrates the linear sequence constraints a nd the tree structure constraints into one alignment step. The algorithm gets an accurate skeleton of the input trees due to the flexible constraints schema used. The algorithm is dedicated to adopt different node features and different matching wei ghts while the others haven't take into account the categories of html tags , the properties of different level nodes and the text features. A kind of linear regression method is presented to get the we ight of different tag-matching automatically. The proposed method employed the most probable content block finding step to locate the content blocks. The statistics recorded in the union tree makes this step more accurate. Because the heuristic is often used to differentiate the content from junk information in the conventional automatic methods, it is difficult to distinguish the cont ent block from noise. But as web pages are increasingly added in, the proposed method obtained the statistical information of the same tag and steady features to make the decision. In this paper, two data structures: token sequence and token tree are used to represent the structure aspect. The token sequence is a tree is a root token tree, while every offspring node forms a token tree itself. The definitions used in the tree alignment algorithm are presented as follows. DEFINITION 1. Tag-matching: 
Let Tx be the token tree of a HTML web page. Sx be the token sequences in preorder walk of the token tree Tx . Let Sx[i] be the i-th item of the sequence Sx , Tx[i] be the i-th corresponding node in the tree Tx . As for the two trees T 1 and T 2 and the corresponding sequences S and S 2 . It is called a tag-matching between S S matching and the G ij is used to represent th e gain of this matching. DEFINITION 2. Constraints on tag-matching: sequences S 1 and S 2 . Let S 1 [x.i] be the i-th item of S the j-th item of S 2 . 
Let } ] . [ , ] . [ ], . [ ] . [ | {
The order constraint is defined as fellow: 
Let L(i) denote the depth of i-th node in the tree. (The depth of a node is the length of the path to its root) 
The strict level constr aint is defined as: 
The loose level constr aint is defined as: 
Taking into account the parent-child relation of a tree, we get the hierarchical constraint. 
The strict hierarchical constraint is defined as: 
The loose hierarchical constraint is defined as: DEFINITION 3. Optimal ma tching between two trees: Let D be the tag-matching collecti on defined in Definition 2. The optimal matching between the two trees is: S and S 2 , and satisfies the predefined constraint R sum of the matching gain in D m . store the last item of each previous alignment path. The alignment constraint Rc built from the constraints on the tag-matching is also needed. The alignment al gorithm is shown below: 1. Inset the match of the root node &lt;0,0&gt; into D 2. for each node in S 1 , i = 1 , ..., n 1 3. for each node in S 2 , j = 1 , ..., n 2 4. if S 1 [i] matches S 2 [j] , create a new node 5. for each preNode in D 6. if curNode and preNode satisfy 7. if curNode and preNode satisfy 8. Calculate the G ij , record the sum of G 9. endif 10. else 11. Trace back on the preNode . 12. If find a match in the preNode 13. Record the  X  G ij in curNode. Insert curNode into D 14. endif 15. endif 16. If  X  G ij in curNode is greater than 17. Set the curNode as the maximum 18. endif 19. endfor 20. endif 21. endfor 22. endfor 
Compared with the previous tree mapping methods [5, 6, 7 and 8], this algorithm gets an accurate skeleton of the two trees because it relaxes the hierarchical constraint ( R hl paper) by using the R ls or R ll . Take Figure 1 for example, the T 1 &gt;. However, T 2 [1] and T 2 [2] are in the same level and have the the common structure of two trees. The algorithm enables this type of linking by using the constraints R ls or R ll , which cannot be utilized in the previous methods. 
The algorithm also has the advantage of employing different weights for various tag-matching. A kind of linear regression method is employed to get the weight of different tag-matching. Let w i be the weight of tag-matching and w i &gt; w we found a collection of similar web pages belong to the same "class" (The web pages share the common format and layout characteristics, usually generated with the same template, for example, the web pages of the same board in one forum website). 
Let D mn be the sum of the gains in the best alignment between the trees T m and T n . procedure. 
The sum of the gains in the collection is: 
Because the collection is the similar web pages belong to the same  X  X lass X . A set of w i is selected which makes the maximum f . 
The group of equations is rewritten as: The solution of the equations (8) is used as the weight of each type of tag-matching ( w i ). 
Using the alignment algorithm, each node was annotated with the aligning state. Based on that, the trees are merged into one union tree whose nodes recorded th e alignment information. After processing several trees, the statistics such as the ratio of the times a node has been aligned was utilized to make the decision whether a node should be kept or not. The union tree also becomes more compact after deleting some useless nodes. 
A heuristic method was employ ed to determine the most probable content block (the data in the content block is what we want to extract). It's shown in formula (9). Where, f i is the feature and w i is its weight. 
The variance of the text length of nodes is employed as a heuristic feature. The reason for employing this feature is that the several non-content blocks such as banners, menus and junk links is more stable. Another feature is the ratio of the length of the link length is also used. The string edit distance is also employed as a feature because the content of j unk information is rather stable compared to the content of posts and news. 
Once the most probable content was obtained, the alignment algorithm presented in this work was utilized again to find the repeating patterns. The union tree was split into several subtrees according to the content block nodes and the alignment algorithm was used to measure the similarity between subtrees. The repeating patterns finding step is especially useful for the web pages coming from forums and blogs . In the news web pages, the content block itself is usually utilized to generate the extracting pattern. 
Thus, based on alignment, merg ing, content block finding and the repeating patterns mining, a wrapper was built to extract the data from web pages. This approach is compared with the RTDM [5] because it is the most relevant work in the sense of the task domain and techniques used. The extracted web data was manually compared with the original web pages, to check their accuracy and completeness. For each web page category (News, Forum and Blog), 30 websites experiments. There were 9000 web pages in the test corpus. The evaluation metrics were precision and recall. Precision is the percentage of correctly extracted data among all extracted data data that existed on response pages. 
Table 1 lists the RTDM method and our method with four stands for Recall. Experimental results show that the RTDM method performs better in the ne ws websites while our method gets the best performance in blogs websites. It is because that RTDM method is dedicated to news websites and not adept in the forums and blogs web pages. The proposed method has the schema that deal with the web pa ges that contain repeating pattern which enable a better performance on the forums and blogs websites. The proposed method got better performance in the blogs websites (precision 93.5% and recall 96.1%) than in the forums websites (precision 92.4% an d recall 96.0%). It is partly because forums are more complex than blogs. A t-test shows that there are significant difference between R ll and the RTDM, and between R hl and RTDM. There are no significant difference between R ls and the RTDM, and between R hs and RTDM. The proposed method gets the best pe rformance under the constraint R , gets comparable performance under R ls and R hl . The constraint R lead to the worst performance because it is too strictly to catch the skeleton under the complex nest structure of trees. 
The alignment algorithm is used at the tree alignment stage and the repeating patterns mining stage. A variance analysis showed that there were significant difference between the various difference between various constraints at the repeating patterns mining stage. News Forum Figure 2. The impact of the number of trees which are merged Figure 3. The impact of the number of samples for obtaining 
The system performance was evaluated under various size of union tree. Figure 2 shows the ex perimental result. Here the  X  X ews_p X  and  X  X ews_r X  are the precision and recall gotten from the news corpus, and  X  X orum_p X  and  X  X orum_r X  are the precision and recall gotten from the forum corpus . The x-axis shows the number convergence while the number is about 30. That means the 30 samples are appropriate to build the union tree and get the extraction template, which will save much time. 
Figure 3 shows the impact of th e size of the collection for obtaining the tag-matching weight . The system performs better on the blog corpus again. Figure 3 also shows that the weight setting procedure needs more samples than the union tree building (50 web pages in the forum and blog corpus, 80 web pages in the news corpus). As the weight setting is time-consuming (C better to get them in advance. In this work, an automatic wrapper generation method is proposed using tree alignment. A novel tree alignment method is utilized to find the optimal matching struct ure of the two web pages. The input trees are merged and record the statistics into one union tree based on the alignment result. A heuristic method is employed to find the most probable content block in the union tree. The alignment algorithm is utilized to detect the repeating patterns on the union tree and generates a wrapper onto it. Experimental results show that the method ac hieves high extraction accuracy and has steady performance. 
There are several important issues remaining to be addressed in the future work. First, tag-mi ssing may be a primary research objective. It is also important to make the most probable content block detecting more accurately and thus enhance the repeating pattern mining procedure. [1] Arasu A and Hector GM. 2003. Extracting structured data [2] Chang CH, Kayed M, Girgis MR, Shaalan K. 2006. A survey [3] Crescenzi V, Mecca G and Merialdo P. 2001. Roadrunner: [4] Laender AHF, Ribeiro Neto BA, da Silva AD, Teixeira JS, [5] Reis D C, Golgher P B, Silva A S, Laender A F. 2004. [6] Yang W. 1991. Identifying syntactic differences between two [7] Zhai YH and Liu B. 2005. Web data extraction based on [8] Zigoris P, Eads D, Zhang Y. 2006. Unsupervised Learning of 
