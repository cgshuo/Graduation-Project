 The digital image stitching technology has become a hot research field nowadays. It deals with remote sensing images collected by satellites or planes as well as aerial images collected by UAV (unmanned aerial vehicles ). Besid es, the digital image stitching technology is widely used in most fields of scientific research and mapping support services such as engineering area mapping, geographical environment protection, natural disaster prevention, and so on.
 transforms one or more images from the space geometry model to the coordinate plane of the other image and then aligns the overlapping areas between the images. At present, the image registration method based on image features is the main tendency in the field of image mosaic. The core of the method is to find all of the matching feature point pairs by measuring similarity between each of the two images and then figure out the coordinate transform ation parameters of image space through matching feature point pairs. Fi nally, it will conduct the proc ess of image registration by coordinate transformation parameters.

However, there are lots of algorithms for detecting and extracting the feature points of a single image such as Harris algorithm [2], Canny algorithm, SIFT algorithm [8,9] and so on. Among them, the SIFT algorithm, which is based on scale space, has the advantage of maintaining invariance for the cases of image scaling, translation, rotatio n and even affine transformation. On the other hand, Mikolajczyk made an experimental comparison among 10 kinds of general local invariant descriptors in 2005, which indicated that SIFT descriptor performed best and had the most excellent resolution [3]. S o, in view of the above advantages of SIFT algorithm, we choose the SIFT algorithm for aerial image feature extraction and feature matching.
 that, under the premise of the selected algorithm, not only can we obtain more SIFT feature points in a single aerial image, more SIFT matching point pairs and more SIFT matching point pairs after RANSAC (Random Sample Consensus) [4] algorithm eliminating matching errors, but also keep the tint of a single image unchanged. effect generated by atmospheric particulate matter will easily interfere with the fidelity and contrast of a single aerial image, lea ding to loss of aeri al image features. In addition, it is crucial to rely on limited aerial images to obtain more accurate feature information because the aerial im age acquisition work can not be performed repeatedly in some cases.

In view of the above shortcomings and needs, through research and analysis, we find out that it is likely to get a smaller number of SIFT feature points and SIFT matching feature point pairs if we directly perform the operation of feature extraction and feature matching upon a erial hazy images. However, at the stage of image preprocessing, there image, more SIFT matching point pairs and more SIFT matching point pairs after RANSAC algorithm el iminating matching errors if we have removed haze from hazy images by using haze removal technology, which has a positive effect on aerial image registration and automatic image mosaic .
 abroad. Tan [5] removes the haze by maximizing the local contrast of the restored image (easily lead to the loss of image feature information). Fatal [6] estimates the albedo of the scene and then infers the medium transmission. Fatal ` s approach is relatively Kaiming He [7] put forward a new kind of prior rule called dark channel prior, which will directly evaluate the transmission information of light in the h aze and then remove the haze from a single input image. This effective method of removing haze can both maximally retain the feature information of the original image and adjust the overall color brightness of the image and keep the color unchanged. Theref ore, we dehaze from aerial hazy images by using haze removal technology based on dark channel prior. different image conditions. We construct two datasets, including images ob tained by unmanned aerial vehicle , and the satellite images collected from Google Earth. In each dataset, by using the proposed adaptive dehazing method, we compare the statistic al results of feature detection, image matching and image mosaic k ing based on Scale -invariant feature transform (SIFT) detector and descriptor before and after haze removal. 2.1 Image Haze Removal The key part o f the haze removal method is th e y propose a new prior  X  dark channel prior [7] , to estimate the transm iss ion direc tly from a hazy image. Sim plify, the dark channel prior means that in most of the non -sky patches, at least one color channel has very low intensity at some pixels. In other words, the minimum intensity in such a patch should have a very low va lue. And due to the additiv e airlight, a haz y image is brighter than its haze -free version in where the transmission is low. So the dark channel of these images will have higher intensity in regions with denser haze. A ccording to haze removal approach prop osed by He et.al, a haze -free image can be recovered from a widely used model: atmospheric light, t is the medium transmission describing the portion of the light that is not scattered and rea ches the camera and  X  0 is a lower bound to restrict the transmission t(x) . Then, we can estimate the tra nsmission t (x) simply by w here c I is a color channel of I ,  X  is a constant parameter to keep a very small amount of haze for the distant objects on images, and () x  X  is a local patch centered at x.
 size is lar ger, the dark channel prior performs better because the probability that a patch contains a dark channel will increase to some extent. However, halos near depth edges may be stronger if the patch size is too large. So, the patch size will influence image q uality significantly. In haze removal algorithm proposed by He et.al, the patch size is fixed to be 15. In our paper, we propose a novel method to adaptively remove the haze effects in different image conditions. 2.2 Image Segmentation using Kernel Graph Cuts In our preliminary experiments, we found that the effect of image quality recovery will be relatively distinguishing in different patch sizes towa rds sky region as well as non -sky region. In other words, when the two regions of a single image are removed h aze in different patch sizes , the number of detected keypoints will be different. Therefore, in order to obtain the optimal patch size for the sky and non -sky regions respectively, we segment hazy images into sky region s and non -sky region s using Kernel Gr aph Cuts . kernel model, which uses K -means clustering algorithm to generate the parameters of data cuts needed by Graph cuts. Then , the algorithm uses Gra ph cuts algorith m to segment image s. The algorithm can divid e a single image into several regions u nsupervised ly. In Salah X  X  algorithm, the energy equation of the simplified kernel -induced distance segmentation model is as follows, where the total number of regions and Graph cuts algorithm.  X  is the penalty for each pieel mar ked as foreground or background . smooth term in neighborhood D . The first term on t he right side of the Equation (3 ) is the data item, the second term is the smoothing term.  X  is the positive coefficient, which is used to adjust the weight of the data item and the smoothing item . 2.3 Obtain Optimal Patch S ize using Random Walk After image segmentation, we implement training work to obtain the optimal patch size of the sky region and the non -sky region individually . At the optim al patch size, the sky or non -sky region will be ext racted more keypoints after haze removal than other patch sizes . Howeve r, it is a time -consuming work to calculate the average number s of detected keypoints and then directly obtain the value of optimal patch size . Therefore, in order to make our approach efficient ly , we find out the optimal patch size of the two regions using the random walk algorithm [ 12 ] .
 a one -dimensional random walk problem. The algorithm to obtain optimal patch size using random walk is shown in Algorithm 1. According to random walk algorithm, it more likely to be optimal patch size . Algorithm 1. Obtain Optimal Patch S ize using Random Walk Input: A training set with M segmented images .

Initialize: ( ) 0
Do for t = 1, 2, ..., T :
Output: T he optimal patch size 3.1 Experimental Setting In this part, t o validate the performance of our proposed method, experiments are carried o ut on two sets of hazy images. The first dataset UAV is collected by our group. This data set includes 55 images obtained by the unmanned aerial vehicle. T he or i ginal resolution of these image s is 4000 X 3000 . The second data set GE is collected from Google Earth , whi ch provides us a series of satellite images from all over the worl d . This dataset has 100 images totally, is collected from four different cities that were se riously suffer ing from heavy haze . In addition, t he resolution of the images is 800 X 500 and the overlap part betwee n images pairs is between 20% and 50%. In Table 1 , we demonstrate some basic information about the se four different cities .
In each dataset, we conduct the following three experiments: keypoint detection, keypoint matching and image mosaicking [13] . We use the OpenCV toolbox provided by Rob Hess from Oregon State University [14 ]. All the experiments were carried out on an Intel (R) Core(TM) 2.6 GHz PC running under Windows 10 operating system with 16.0GB RAM . 3.2. Experiments on GE Dataset In the experiments on GE dataset, we keep the original resolution 800 X 500 of images to test the performance of keypoint detection and matching. Firstly, we test the keypoint detection performance based on SIFT detector on 100 collected images. In Tab le 2 , we show the number of keypoints detected by SIFT detector before and a fter haze removal. From Table 2 , it is obviously that the number of keypoints increase s dramatically by 262.04 % on average. I n Fig. 2 , we show this improvement in keypoint detection task. Apparently, more keypoints will be detected after haze removal, especially those aerial images with heavy haze .

In this part , we combine 100 images into 16 0 pairs. Then , we evaluate the keypoint matching performance based on SIFT descriptors in 16 0 image pairs. In Table 3 , we provide the number of matching keypoints of SIFT descriptors in the case of before and after haze removal. From this table, the average number of matching keypoints will increase a bout 17 7.89 % without RANSAC. With RANSAC, this average number increases about 178.20 %. In Fig. 3 , we demonstrate a group of example images of the keypoint matching task .
In this part , we use 25 images to do this exper iment. And the resolution of each image is 400 X  250 . In Fig 4 , we demonstrate the result of image mosaicking task. Compared with the results without haze removal, our methods based on haze removal helps us to obtain better mosaicking results. 3.3. Experiments on UAV Dataset In the experiments on UAV dataset, we down -sample d the images to 1000 X 750 to test the performance of keypoint detection and mat ching on lower resolution image . In this part, we firstly evaluate the keypoint detection performance based on SIFT detector on 55 collected images. In Table 4 , we provide the number of keypoints detected by SIFT detector before and after haze removal. From this table, we could find the number of detected keypoin ts increase about 10.2 5 % on average . This improvement shows the haze removal is effective to reduce the bad effect of haze in keypoint detection . I n Fig. 5 , we demonstrate a group of example images in the keypoint detection task. From the comparisons of this group, we can easily find that most of newly detected keypoints are located in the regions that are badly influenced by haze. In hazy im age, the buildings in a distant view (shown in the black box) cannot be distinguished clearly. And it also has a bad influence on the keypoint detection. After we utilize the algorithm of haze removal, more keypoints could be detected in these regio ns .
Based on the geographic position of the collected images, we divide the collected images into seven groups. In the image matching experiment, we could combine 55 images into 167 aerial image pairs. In each pair, the overlap part is not le ss than 20%. In this part, we evaluate the keypoint matching performance based on S IFT descriptors in 167 pairs. In Table 5 , w e provide the number of matching keypoints of SIFT descriptors in the case of bef ore and after haze removal. From this table, we could find the average number of matched keypoints will increase about 3.80% without RANSAC method. With RANSAC, this average number increases about 5.36%. This improvement also evidences that the haze removal is effective to reduce the bad influence of haze in the task of keypoint matching. In Fig. 6 , we demonstrate a group of ex ample images of the keypoint matching task. Similar with our previous results in keypoints detection task, after haze removal, we could obtain more matched keypoints , especially for the buildings in a distant review. These results evidence the effectiveness of the algorithms for haze removal in hazy aerial images. 
Fig. 7 shows the result s of image mosaicking task on one sample image . Compared with the results without haze removal, our methods based on haze removal helps us to obtain better mosaicking results . 3.4 A daptive haze removal In our paper, we propose a novel method to adaptively remove the haze effects in different image conditions. In this section, we apply our proposed method to obtain optimal patch size for both sky region and non -sky region individually . And we will evaluate the effectiveness of our method as well. 
Firstly, we divide UAV dataset into two subsets which are named as UAV -Training and UAV -Testing respectively. The UAV -Training subset, as a trai ning set, contains 35 images. And UAV -Testing subset, as a testing set, contains 20 images. Secondly, to obtain optimal patch size, we conduct training task on UAV -Training using Algorithm 1 described in Section 2.3. Thirdly, t o evaluate the effectiveness of our proposed method, we test the learnt model on UAV -Testing. Besides, all images in UAV -Training and UAV -Testing are down -sampled to 1000  X  750 .
We use our adaptive method to obtain the optimal patch size for sky and non -sky region. In image segmentation, to segment a single image into two consecutive regions , the parameter L in Equati on (3) is set to 2 and the parameter  X  in Equatio n (3) is set to 10 . In random walk method, the step size  X   X  is 2, the maximum patch size N is 100, and the iteration times T is set to be 100. We could obtain the optimal patch size for sky demonstrate the average numbers of detected keypoints on sky and non -sky region in different patch size . We could find the results obtained by our adaptive method are consistent with the results of the exhaustive method. In this part , w e test our adaptive model on UAV -Testing subset as well as GE dataset . The optimal patch size obtained by our adaptive model, for non -sky region is 40 and the optimal patch size for sky region is 34. As we known, in He X  X  method, the patch size is fixed to be 15 for all images or regions. In Table 6, w e provide the results of keypoint detection and matching (with RANSAC) for different methods, including: the method without haze removal (Without haze removal), the proposed method based on fixed patch size (Fixed method), and the proposed adaptive method (Adaptive method). Based on these results, we could find our adaptive method performs better than others. Images of outdoor scenes are usually degraded by the haze in the atmosphere. This kind of degraded images lose s the contrast and color, which is possible to have a bad effect of detecting, describing, and matching image local features, or some related image applications. In thi s paper, we try to explore the performance based on haze removal technique using dark channel prior for aerial image obtained by the unmanned aerial vehicle. In our paper, we propose a novel method to adaptively r emove the haze effects in different image conditions. We did experiments on two self -constructed dataset s based on scale -invariant feature transform for keypoints detection, keypoints matching, and image mosaicking. Our results evidence that the haze remova l i s effective to decrease the bad effect of haze of these tasks. The adaptive method also demonstrates better performance than fixed one. Future work will be explored from two aspects. The first directi on is to test the performance of other local feature detectors and descriptors. The second direction is to propose new real -time haze removal models for aerial images obtained by the unmanned aerial vehicle .

