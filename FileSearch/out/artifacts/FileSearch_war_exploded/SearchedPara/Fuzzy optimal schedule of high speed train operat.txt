 1. Introduction
Nowadays, energy usage in railway systems is being thor-oughly studied in order to find strategies for increasing energy efficiency in traffic operation. It is not only an environmental problem, but also it worries railway infrastructure administrators and operators as an economical aspect.

The two main procedures to reduce energy consumption in rail traffic operation is the design of efficient drivings (also called ecodriving) and optimal timetable design. The design of ecodriving consists on, given a run time, des ign the speed profile that consumes the minimum energy ( Bocharnikov et al., 2007 ; Lukaszewicz, 2000 ; Wong and Ho, 2004 ; Acikbas and Soylemez, 2008 ). The ecodriving makes use of coast commands along the line (not just before the train arrival at station) and the coasting points depend on the slopes, the stop points and the speed limit reductions along the trip. When the train is coasting, its consumpt ion is null (or just the consump-tion necessary to feed on-board auxiliary systems).

In Sicre et al. (2010) , ecodriving was designed for high speed lines in collaboration with Renfe (the Spanish railway operator). These designs were tested in commercial high speed trains of
Renfe, with the collaboration of ADIF (the Spanish railway infra-structure administrator), and measures showed average energy savings of 20% due to the application of ecodriving.

Train commercial timetables are calculated from the running times between consecutive stations and commercial dwell times.
Each running time is the addition of the minimum run time (flat out running) plus a slack time. The problem of train timetable design the commercial travel time require ment between terminal stations.
These slack times are necessary to observe the commercial timetable when delays arise, and to adjust the compatibility between train movements at junctions, such as meet-passes, overtakes, or even scheduled commercial correspondences between services.
When trains are running on time during real time operation, the slack times can be utilized to reduce the energy consumption by means of ecodriving.

The train timetable design problem has been investigated in literature and many scheduling techniques have been developed.
Some techniques are based on heuristic algorithms, simulation and expert systems, and others are based on mathematical programming.
In Golshani and Thomas (1981) , different heuristic procedures are proposed to distribute slack time along a route to design the train timetable, and a search techni que based on Genetic Algorithms is presented in Babar Kan (2006) to solve the train scheduling problem. In Abril et al. (2008) , the problem of railway scheduling is solved by distributed tree CSP (constraint satisfaction problem) structures.
 solve the train scheduling problem was Amit and Goldfarb (1971) .
Then, many mathematical programming models and algorithms were developed as heuristic algorithm in Carey and Lockwood (1995) , Kraay and Harker (1995) , Higgins et al. (1997) and Sahin (1999) . A non linear mixed integer programming model combined with a branch and bound model is applied in Higgins et al. (1996) to design a schedule on a railway single line track. In Liebchen (2008) the application of the integer programming model to the Berlin subway is presented.
 not consider uncertainty and parameters such as delays are given fixed values. However, measurements of reliability and punctu-ality of scheduled transport services incorporating uncertainty are important in planning ( Carey, 1999 ).
 stochastic programming models have been applied to solve the train timetabling problem under uncertainty, as in Khan and Zhou (2010) , where uncertain disturbances and travel time are incor-porated and the objective is to minimize the total trip time and reduce the expected schedule delay at the terminal station. In
Yang et al. (2010) , stochastic information about the number of passengers boarding the train is introduced in the model by means of three criterion: expected value, optimistic and pessi-mistic criterion and the timetable problem of a double and single track line is solved by a MIP model combined with a branch and bound algorithm.
 (that guarantee a feasible solution in all scenarios are often too conservative) have been relaxed in other proposed models like light robustness Fisschetti and Monaci (2009) , or recoverable robustness Liebchen et al. (2009) combining stochastic program-ming and robust optimization.
 lines. And when track-renewals a re implemented, or when commer-cial travel time between terminal st ations is modified, the previous statistical data are not valid anymore because these changes will affect the distribution and values of delays along the line. Thus, frequently the uncertainty in parameters cannot be modeled as probability, and is better represented by fuzzy knowledge modeling.
Uncertainty modeled as fuzzy knowledge ( Bellman and Zadeh, 1970 ) has been applied to scheduling p roblems to minimize lateness ( Chanas and Kasperski, 2001 ), combining fuzzy logic with hybrid genetic algorithms ( Vasant and Barsoum, 2009 ), to traffic manage-ment ( Balaji and Srinivasan, 2011 ) and to different railway applica-tionsasin( Tsang and Ho, 2004 ) where the negotiation problem between the train service provider and the infrastructure provider is solved as a prioritized fuzzy constraint satisfaction, or in Jia and
Zhang (1994) ,and Fay (2000) whereatraintrafficcontrolsystemis proposed based on a fuzzy-knowledge-based system.
 the railway schedule problem. Chang and Thia (1996) present the on line rescheduling of mass rapid transit trains by the applica-tion of a fuzzy expert system that controls the dwell time at stations, defining regularity, risk and congestion at platforms as fuzzy sets, but uncertainty in delays is not modeled. The time-table problem for a single-line railway is stated in Yang et al. (2009) given fuzzy information on passenger demand. Fuzzy passenger demand leads to fuzzy passenger time to get on-of the train. A goal-programming model is constructed to minimize the total passenger time and the total d elay, by calculating the expected value of fuzzy variables. A branch and bound algorithm is imple-mented to seek the optimal timetable. In Isaai et al. (2011) amodelis proposed for the selection of the best train schedule applying fuzzy
AHP for multidimensional service evaluation. It deals with the existing vagueness in timetabling evaluation. The same technique is applied in Hanaoka and Kunadhamraks (2009) to evaluate the logistics performance of intermodal freight transportation.
Fuzzy mathematical programming addresses optimization problems under uncertainty, cha racterizing parameters as fuzzy numbers and constraints as fuzzy sets, and has been applied to different schedule tra nsportation problems ( Chanas et al., 1984 ;
Chang et al., 2004 ; Sakawa et al., 2002 ). In Ren and Sheridan (1994) freight train dispatching problem is solved by fuzzy linear program-ming model coordinated with a fuzzy linguistic knowledge base.
None of the previous models include energy consumption minimization. There are some studies in literature that investi-gate the consumption reduction in the timetable design, although uncertainty in delays is not considered.

The timetable optimization problem proposed in Kraay et al. (1991) considers the minimization of fuel consumption as well as delays. The proposed model is a nonlinear MIP model with convex objective function. The consumption model presented is simpli-fied and does not take into account the limits of the traction force.
In Ghoseiri et al. (2004) a multi-objective MIP model is presented to minimize the total passenger time and the fuel consumption. In the proposed model uncertainty is not considered either and the consumption model calculates energy consumption for the aver-age speed of the track section and traction effort unbounded, thus time and consumption calculations are simplified.
 Kwan and Chang (2005) applyaheuristic-basedEvolutionary
Algorithm to design the mass rapid transit system timetable, minimizing operating costs and passenger dissatisfaction that requires the existence of an Automated Train Regulator for the dynamic application of the schedule. In this paper cost associated to energy consumption is evaluated although not detailed. It considers and selects the driving at the station given just 3 possible speed profiles per interstation. This is applicable just for metro or com-muter lines equipped with on-board ATO systems, but too restrictive in the driving model, and delays are not taken into account.
Kim et al. (2010) propose a mathematical programming time-table model and a heuristic model to reduce the peak traction energy of mass rapid transit railways. Given an initial schedule, the timetable is shifted to reduce the peak traction energy. The model does not minimize the consumption but electrical losses and voltage drop, and delays and punctuality requirements are not incorporated.

In Malavasi et al. (2011) models are proposed to estimate consumption on a metro line, and the impact of energy transfer between trains in energy consumption. The simulator could be used to synchronize braking and acceleration phases to improve energy transfer. In Miyatake and Ko (2007) , the authors formulate an energy-saving operation problem considering DC feeding system as an optimal control problem, although timetables are not designed.

Energy efficiency associated to the optimal design of driving has been demonstrated in different studies and measurements.
A simulation-based design model of ecodrivings for metro lines equipped with ATO systems is presented in Dom X   X  nguez et al. (2011) . Sicre et al. (2010) propose a procedure to design eco-driving in high speed lines based on simulation and a timetable optimization model where the energy is minimized although punctuality requirements are not considered. These ecodriving models have been applied to real lines and energy savings achieved were between 13% and 21%.

The objective of this paper is the design of energy efficient timetables for high speed lines under uncertainty and the asso-ciated efficient commands of the ecodriving. High speed lines in Spain have specific characteristics to be considered when designing an efficient timetable: long distances between stations, double-track, spare capacity, passenger exclusivity and punctu-ality compromise at station arrivals. They have associated high consumption due to speed (300 X 350 km/h) and high speed trains are manually driven. The type of commands that a driver can execute must be taken into account in the model to obtain realistic designs.

The global design of trains timetable over a time window is not necessary as compatibility constraints between train movements are not relevant in these lines (meet-pass, overtake y ). The time interval constraint between consecutive trains (minimum inter-val) is guaranteed imposing the time slot given by the infra-structure administrator. Thus, the model is focused on the joint design of ecodriving and timetable of a single train to minimize energy consumption, as well as the punctuality requirements at each commercial station.

The model calculates the optimal distribution of slack times along the trip of a train, fulfilling punctuality required at station arrivals, given uncertain information about delays, modeled as fuzzy numbers. The first part of the model calculates the optimal runtime-consumption Pareto curves (ecodrivings) at each stretch, based on Genetic Algorithm (GA) and detailed simulation of the train motion ( Section 2 ). In Section 3 , the second part of the model, a fuzzy mathematical programming model with beha-vioral response, calculates the efficient timetable. The behavior response ( Carey, 1998 ) of the driver to delayed scenarios is included in the timetable model objective function. In Section 4 a study case is presented with real data of the Spanish high speed line Madrid X  X arcelona and results are described and discussed. Finally, conclusions are presented in Section 5 . 2. Joint design approach
The objective of this work is the minimization of the energy consumption of a railway service by the optimal distribution of the available slack time among all the stretches of the service taking into consideration punctuality constraints at every station arrival. For this purpose, the followed approach is based on Fuzzy Mathematical Programming combined with Genetic Algorithms and Simulation ( Fig. 1 ).

A commercial service consists of n stations, so it can be divided into n 1 stretches between consecutive stops. When a commercial timetable is built up, a slack time is added to the minimum travel time of each stretch and when a delay arises the slack time is utilized to recover the delay and allow punctual arrival at the next out time (minimum travel time) between terminal stations plus an additional time that depends on the length of the service, according to UIC Code 451-1. In the scenario where no delays occur, this slack time may be used to perform an energy efficient driving (ecodriv-ing). Energy savings associated to ecodriving measured in Spanish high speed lines were 20% (average value).

Along each stretch, the set of all the drivings that, for a fixed run time, consume the minimum energy form what is called the
Pareto curve for that stretch. Fig. 2 shows a run time-consump-tion graph where each dot represents a specific driving for that stretch. Drivings located on the Pareto curve are the optimal for the energy point of view, for each run time.

These n 1 Pareto curves are utilized as input data for the fuzzy mathematical programming model that optimally distri-bute the available slack time among the stretches, and whose output will be the commercial run time of each stretch and the timetable of each station of the service.

Pareto curves are obtained combining a detailed simulator of the train motion with a Genetic Algorithm (GA); the simulator outputs run times and energy consumptions of drivings, and the
GA uses these values in its iterative process for selection, cross overs and mutations.

To model the punctuality constraints, fuzzy sets are utilized to describe the uncertainty of the delays, and the overall optimiza-tion model is based on fuzzy mathematical programming.
The objective function minimizes the consumption of a delayed scenario and the driver X  X  behavior affecting the consump-tion is incorporated as a fuzzy function of recovered delay at each stretch.

In the following, parameters and variables of the fuzzy linear programming model are defined:
Parameters a , b i,j parameters that define the linear piecewise approxi-f
DL i fuzzy delay at station I departure dl i upper limit of the w -a -cut of delay at i departure dl i lower limit of the w -a -cut of delay at i departure n number of stations
Npi required necessity of punctuality at station i arrival f
K i fuzzy parameter to model driver X  X  behavior
K i lower limit of
T si commercial stop time at station i t ri minimum run time between station i and i  X  1 t ri maximum run time between station i and i  X  1
T tot total travel time between terminal stations ~ Z fuzzy goal Z w a i upper limit of Z a -cuts Variables
C i minimum consumption of the commercial time between
C w 0 i consumption of the time between stations i and i  X  1, at D i commercial departure from station i D w i departure from station i at delayed scenario w S i slack time between stations i and i  X  1
S w i slack time between stations i and i  X  1 at delayed
T w si station i stop time at delayed scenario w d w i binary variable: 1 if the train arrives late to station i ,at 2.1. Ecodriving design: simulation and genetic algorithms manual driving is applied, human driving constraints must be taken into account in order to guarantee a realistic driving. but a limited and configurable set of commands to be applied along the trip, which is a list of efficient strategies (coasting and speed regulation without braking), that depend both on the constraints associated to the manual driving and the train and line characteristics.
 and consists in the application of no traction and no braking command to the train letting the train run by its inertia and with no associated consumption.
 efficient version of speed regulation. Speed will be maintained always that tractive effort is needed. Otherwise it will coast, letting the increase of its speed. If the train reaches the speed limit, brake will be applied in order not to exceed it. When decreases due to downhill, the train coasts up to the holding speed command value. Then, sufficient traction effort will be again applied to get constant speed ( Fig. 3 ). This strategy tries to avoid unnecessary breaking in speed regulation ( Hee-Soo, 1998 ). the design of an efficient timetable by the optimal distribution of slack times is presented in this work. Secondly, the design of the optimal driving to apply on each stretch of the service is devel-oped. For this purpose, it is essential that the simulation model is as accurate as possible in order to obtain a realistic solution. 2.1.1. Genetic algorithm
To generate the Pareto curves for each stretch (realistic drivings with the minimum energy consumption for each run time) Genetic Algorithm is applied due to its ability to combine different pieces of efficient driving designs to obtain new efficient drivings with different associated running times.

The process starts with the definition of the structure of a driving, which consists of different sections of speed regulation without braking and a final coasting before the braking process arriving at stations. The number of sections is a parameter that may depend on the length of the stretch, and the holding speeds are selected below the maximum speed limits.

At the first iteration of the Genetic Algorithm, a random population of drivings defined by different sections of speed regulation without braking and a final coast are generated, simulated and evaluated by the fitness function defined by
Eqs. (1) and (2), where E holds for energy and w E and w t weighting factors ( Acikbas and Soylemez, 2008 ). Eq. (2) penalizes driving strategies whose run time exceeds the target time ( T a factor equal to the run time ( T ) divided by T target . f  X  w E E E f  X  w E E E
The population of the following iterations consists of the elite group from the previous one, a set of cross overs, some mutation drivings and finally a set of random generated drivings to complete the size of the population. A cross over is defined between 2 random drivings by a random kilometric point that will result in two new different drivings, and the mutations are obtained by small changes in
The parameters that define the amount of cross overs, mutations and size of the elite group are configurable, and so is the number of the maximum and minimum allowable holding speed. 2.1.2. Simulation
The aim of the simulator is the accurate calculation of the run time and energy consumption of driving taking into account the limitations of manual driving. For that purpose, a detailed discrete-event deterministic model based on object-oriented programming (OOP) and implemented in the programming language C  X  X  has been developed. For efficient purposes, it combines two ways for advan-cing the simulation clock: next-event advance and fixed-discrete step advance ( Law and Kelton, 2000 , Goodman et al., 1998 ). The necessary input data to carry out t he simulations is organized in three sets: train, line, and driving strategy, considering all the main variables that affect the train dynamics.

The model of the train takes into account: length and mass of the train, running resistance, traction maximum curve, variation of efficiency with speed and effort ratio, auxiliary equipment consumption and rotary inertia.

The line characteristics considered in the model are speed limits (both permanent and temporary), tunnels, grades, grade transitions (considering also the length of the train), curves and neutral sections.

The limitations given by the manual driving are also taken into (function of the distance), minimum time between consecutive commands and the delay in the execution of commands.

With the aim of obtaining accurate calculations, the simulator has been also adjusted and validated against real measurements registered on-board on high speed trains during commercial services and nocturnal tests along Madrid X  X arcelona high speed line. It was shown that the simulated run times differ on average 1.22% from measured times, and the difference between energy consumptions is 0.45%, which provides strong evidence for the validity of the simulator. This accurate simulator was used for the design of ecodrivings (with the given running times) providing important energy savings. A thorough description of the simula-tor can be found in Sicre et al. (2010) . 2.2. Timetable design: fuzzy linear programming
Vagueness in knowledge about delays is modeled by means of fuzzy delays and fuzzy constraints incorporated in a fuzzy mathematical programming model to calculate the timetable. 2.2.1. Uncertainty: fuzzy delays
The proposed timetable optimization model considers the existence of delays and punctuality constraints that have to be observed when the train arrives at the stations. When the time-table has to be designed for a new railway line or train service or in general when knowledge about disturbances in the line is vague, this information can be modeled as fuzzy numbers ( Bellman and Zadeh, 1970 ). Additionally, punctuality constraints have to be defined as fuzzy constraints.

Let DLi be the new delay that arises at the station i departure and is defined by a fuzzy number f DL i ( Fay, 2000 ). As shown in Fig. 4 , the fuzzy number is positive given that early departures are not permitted, and the possibility of a punctual departure (delay equal to 0) is l . The most possible value for the delay is x the maximum delay is x b , with possibility equal to 0. Then, the membership function of the fuzzy delay is as indicated in Eq. (3) and Fig. 4 .
DLi  X  x  X  X  where x a is the delay value with associated possibility 1 (kernel), and x b is the maximum delay (upper limit of the support) 2.2.2. Fuzzy linear programming model
Conventional mathematical programming models maximize an objective function subject to constrains. In real world pro-blems, however constraints and objective function are very fuzzy. Fuzzy programming considers uncertainty modeled as fuzzy sets and goal and constraints are given by fuzzy sets. Some violation of constraints is allowed and the degree is defined as a membership function of the constraint ( Tanaka and Asai, 1984 ; Chanas et al., 1984 ).

Consider the classical linear programming model: min X where C i is the consumption at each stretch between stations, and is a function of the run time. Each Pareto curve obtained by the
GA  X  simulation model is convex and can be adjusted as a polygonal, that is, piecewise linearized.

Traffic model constraint equations will be detailed later, as well as punctuality constraints. Punctuality is referred to the arrival at a commercial station, that is, the arrival of a train at a station i ,ina delayed scenario w should observe the scheduled arrival:
A r A i 8 i 4 1  X  5  X  where A w i is the arrival at station i in a delayed scenario and A arrival time of the scheduled timetable to be designed.
When uncertainty in delays is modeled as fuzzy numbers, a degree of violation of the constraint is allowed, that is ~
A ~ r A i 8 i 4 1  X  6  X 
Then the objective function: g min X
Can be expressed in terms of the satisfaction of a fuzzy goal ~ C ~ r ~ Z  X  8  X 
This fuzzy programming model is formulated by fuzzy func-tions whose concept is also called the extension principle to calculate the maximum possibility of fulfilling all the constraints and the objective function equation, by means of the application of the extension principle, and the max X  X in operators. 3. Fuzzy linear programming model with behavioral response
The fuzzy optimization model has to distribute the slack time along the different stretches in the line, calculating the slack Si for each stretch between stations i and i  X  1. 3.1. Traffic model
Let t ri be the minimum run time between station i and i  X  1, S the slack time between stations i and i  X  1(stretch i )forthedesigned commercial timetable and T si the stop time at station i for the commercial timetable to be designed, modeled as a parameter.
The total travel time between terminal stations is fixed and must be the sum of run times and stop times at every station.
X  X  S i  X  t ri  X  T si  X  X  T tot 8 i o nT s 1  X  0  X  9  X 
The run time is bounded between a minimum t ri (flat out driving running at maximum permitted speed) and a maximum value t ri (to avoid designing a stretch with an excessively low average speed). Thus, the maximum slack time at stretch i will be t t ri . A minimum bound for the slack time is considered and could be decided by the railway operator. With this constraint, the slot assigned by the railway infrastructure administrator to the train is modeled and the time interval between consecutive trains (minimum interval) is guaranteed. s r S i r t ri t ri  X  10  X 
The departure time D i from a station i for the designed commercial service can be calculated as a function of departure time from station i 1:
D  X  D i 1  X  X  t ri 1  X  S i 1  X  X  T si , 8 1 o i o nD 1  X  0  X  11  X 
On the other hand, delayed scenarios are considered to check are modeled as fuzzy numbers added to the departure time.
When a train is delayed at station i 1, the following slack time is reduced to recover the delay. If that is not enough and the train arrives late to the next station, the stop time at the delayed scenario can be reduced to minimize this past delay. But new delays at station i will have to be recovered by means of the slack time at stretch i .
 calculated before introducing the new delay at this station, and is a function of the departure time of the previous station and the new delay arisen at station i 1, modeled as a fuzzy number f D 1 w  X  0  X  12  X  minimum value (to allow passengers get on-off the train) and thus, the difference between the commercial stop and the minimum stop time is the delay that can be recovered during the train stop: 3.2. Punctuality model viously presented, is illustrated in Fig. 5 : ~ A w i ~ r A i 8 i 4 1  X  14  X  slack time variables: punctual, or a minimum value of punctuality could be fixed. This last constrain is easily understood by the railways operator, thus a punctuality level required for each station is defined Npi. The necessity of a punctual arrival is 1 less the possibility that the arrival at a scenario w is after the scheduled arrival Ai . the fuzzy numbers a -cuts. As it is shown in the previous figure, necessary to evaluate the punctuality constraint.
 rewritten in terms of the a -cuts upper limit of the delay, dl
D 1 w  X  0  X  16  X  where the scenario w with an associated possibility value a ,is obtained calculating the upper limit of the w -a -cut of every delay at each station: dl w a i  X  x b  X  x b x a  X  p , 8 i o n  X  17  X  early departures (before the scheduled departure). On the other hand, if the train is delayed the punctuality constraints will try to fulfill the scheduled departure time as close as possible:
D r D w i i o n  X  18  X 
The equation to determine if the train arrives on time to station i is
D i 4 1  X  19  X  i and 0 if it arrives on time. The possibility that the scenario w is delayed is d w i multiplied by the possibility of the scenario w : a
The punctuality constraint at each station i is d i p w r 1 Npi 8 i 4 1  X  20  X  where Npi is the required necessity of punctuality at station arrival. 3.3. Consumption model
The consumption of each stretch is a function of the run time, that is of the slack time, according to the Pareto curves obtained by the GA and simulation model previously presented. If the consumption of the designed timetable has to be calculated, then the consumption is a function of Si :
C approximated consumption curve of the stretch between stations i and i  X  1( Fig. 6 ). 3.4. Objective function
The classical approach to this problem is the minimal consump-tion of the designed timetable, considering the previous definition of the consumption: min C T  X  min
When fuzzy parameters are introduced, the objective function is expressed by means of a fuzzy goal ~ Z . The objective function proposed in this paper minimizes the consumption of a delayed scenario. This means that a more possible scenario is considered rather that the no delay scenario, to minimize the associated consumption. g min
That is, if a fuzzy goal ~ Z is defined, the objective function can be expressed as ~ C Tw ~ r ~ Z  X  24  X 
Let ~ Z be a triangular fuzzy number. Then the membership
That is, the upper limit of Z a -cuts have to be calculated as well as the lower limit of the consumption a -cuts to calculate the possibility of ~ C Tw being less than ~ Z ( Fig. 7 ): Z i  X  zb a  X  zb za  X  X  26  X 
The fuzzy function to calculate the fuzzy consumption is obtained by the application of the extension principle and the max X  X in operators:
As the consumption function is increasing with the delay the extension principle can be expressed in terms of interval calcula-tion for different a -cut of fuzzy delays. To compare and calculate the possibility of C T being less than Z , the lower limits of consumption a -cut have to be calculated (see Fig. 7 ), that are a function of the lower limit of the delays a -cut, dl w a l dl
If the solution is feasible for the punctuality constraints calcu-lated for the delays upper limit of the a -cuts, the consumption scenario (lower limits of the delays a -cuts) will also be punctual.
The basic definition of the consumption of a delayed scenario w 0 would assume that the driving executed in a delayed scenario will be also on the optimal Pareto curve, being S w 0 i the slack time of the scenario evaluated w 0.
 C 3.5. Fuzzy behavioral response
The behavioral response described in Carey (1998) describes the phenomenon observed that if more time is allowed for an activity then the activity itself often takes longer to complete, and this behavior has to be taken into account in the optimization model. The behavioral response model proposed in this paper refers to the driver X  X  behavior depending on the train delay at the station departure.

The behavior of the driver will affect the driving style if the train is late with respect to the designed timetable, trying to recover the delay nearly as soon as possible, and thus, the consumption will be higher that the optimal corresponding to the Pareto curve for that run time. That behavior can be modeled and included in the objective function, by means of an extra consumption that will be an increasing function with the delay that is recovered at a specific stretch: S i S w 0 i .
Thus, the consumption of the delayed scenario w 0, incorpor-ating the driver X  X  behavioral response to delays is
C
This scenario w 0 is forced to be punctual by the equation: d p w 0  X  0 8 i 4 1  X  31  X 
The driving style for delay recovery can be simulated with the detailed simulator to obtain a new curve for each time. That is, for on the Pareto curve, but for that slack time, if the train is delayed and the recovered delay at this stretch is, for example 1 min, the consumption will be located on the delayed curve ( Fig. 8 ).
Simulation results of the delay recovery behavior show that the function can be approximated as proportional to delay recovery: f  X  S S w 0 i  X  X  K i  X  S i S w 0 i  X  , K i 4 0  X  32  X 
The recovery delay behavior can also be considered as fuzzy and dependant on the driver. It can be considered the value K as the most possible proportional function, but a fuzzy f K i can be defined, as shown in Fig. 9 .Themaximumvalue K ib is the corresponding to the  X  X  X ecover the delay as soon as possible X  X  behavior that is the one with maximum possibility and the highest consumption. The mini-mum value of K is 0 and in that case the consumption would be on the optimal Pareto curve, that can be considered to have 0 possibility (that means that the drivers behavior is not modified by the delay and will consume the optimal).

As the behavioral response consumption function is increasing in the objective function, obtain the lower limit of the consump-tion a -cut.

K i  X  a  X  K ib  X  X  33  X 
C of a and finding the maximum value of a that fulfills all the constraints and the fuzzy objective function for the defined fuzzy goal ( Tanaka and Asai, 1984 ): 4. Case study application of the proposed model in the Spanish high speed line
Madrid X  X arcelona. The commercial service selected is a real one, currently in service, with intermediate stops at Madrid, Cala-tayud, Zaragoza, Le  X  rida, Tarragona, and Barcelona. Thus, the number of stations is 6. The total travel time of the actual timetable is T tot  X  11,880 s, and it is carried out by the Talgo X 
Bombardier S-102 high speed train. The specific characteristics of this train and line have been parameterized and introduced in the simulation model.
 ( Ts ), the minimum run time of each stretch, as well as the punctuality requirement modeled as a necessity level of punctuality, and the parameters of each fuzzy delay f DL i :( l , x a , x 2157 s, which is equal to the total travel time minus the minimum imposed by the manual driving, the Pareto curves of each stretch where obtained by the application of the GA  X  simulation model. The polygonal definition for each Pareto Curve is presented in
Table 2 : 1000 train motion simulations/iteration were calculated per inter-station, and 10 iterations were necessary, taking 3.5 min the generation of each Pareto curve.

Additionally, the simulator was used to analyze the consump-tion of the recovery delay behavior ( K ). It was shown that it can be approximated by: K bi,j  X  a i,j
For the definition of the fuzzy goal ~ Z (Eq. (24)), the parameters z and z b (Eq. (25)) have to be selected. The z a parameter of the fuzzy goal has been calculated solving the optimization problem with no delays and no punctuality constrains at any station, thus the minimum consumption of this timetable is obtained: z  X  7473 kWh.

On the other hand, a pessimistic scenario w 0 is evaluated for the calculation of z b parameter. For that purpose, the optimization model has been executed for the scenario corresponding to the maximum delay at each station. The calculated consumption of the scenario is z b  X  7860 kWh. 5. Results and discussion
Four different scenarios w for the punctuality constraints have been evaluated, one for each different level of the  X  X  X ecessity of punctuality at station i arrival X  X , Npi . The scenario w 0 has itera-tively been evaluated for increasing values of a to find the maximum a that fulfills the consumption goal defined as fuzzy.
The resulting maximum a that fulfills punctuality constraints and fuzzy goal ~ Z is 0.6. The delay corresponding to this a is dl i  X  30, 8 i o n , and is the delay scenario of the objective function consumption evaluation.

For that value of a ,a Ki has been obtained from the fuzzy definition of K , for each station and can be found in Table 3 . This table also shows the results about the designed timetable with the proposed model, as well as the actual commercial timetable in service. Column  X  X  X ons. to next timetable X  X  is the consumption of the stretch, starting at that station, for a run time corresponding to the timetable (the current commercial one or the designed one). Column  X  X  X ons. to next delay 30 s X  X  is the consumption of the stretch, starting at that station, for a run time corresponding to the delayed scenario w 0, that is, a delay of 30 s at every station departure (compared to the actual commercial timetable or the designed one).

As a summary, Table 4 shows the energy savings achieved with the application of the proposed timetable design model. Comparing the consumption of the timetables (C in Table 4 ), the savings achieved with the designed one are 5.25%, and comparing the delayed scenarios (C0 in Table 4 ), the new designed timetable achieves 6.67% of energy saving fulfilling the modeled punctuality requirements.

The commands of the associated designed ecodrivings for each stretch are shown in Table 5 , where K.P. stands for kilometric point and defines the start point for the specified command, and SRWB stands for  X  X  X peed regulation without braking X  X  command.
As an example, Fig. 10 illustrates the simulated speed profile corresponding to the ecodriving designed for Calatayud X  X aragoza stretch.

Thelistofefficientcommandsthatformthedesignedecodriving could be displayed on board to the driver on real time to be executed. In the future high speed trains equipped with ATO system, efficient commands would be automatically executed. Depending on the on board regulation algorithm, the value for K should be adjusted. If the on-board algorithm always calculates the optimal driving on the Pareto curve, then the K of behavioral response would disappear (that is, K  X  0), but if a more conservative algorithm is implemented, an intermediate value for K should be selected, modeling how fast delays are recovered with the regulation algorithm.

Previous results ( Sicre et al., 2010 ) demonstrated that the execution of designed ecodriving without modifying timetables in high speed lines lead to energy savings around 20%, measured in Spanish high speed lines. It has to be noticed that the proposed model based on the timetable design produces additional energy savings that do not substitute but complement the previous one, by the optimal distribution of slack times. 6. Conclusions
The aim of this paper is the reduction of energy consumption in railways traffic operation, specifically in high speed lines. For this purpose, a model has been presented for the joint design of energy efficient driving and efficient timetables.

The main contribution of this paper is the incorporation of the railway operator punctuality constraint under uncertainty to the timetable optimization problem, as well as the effect of the driver X  X  behavior recovering delays.

In this model, fuzzy delays and fuzzy punctuality constraints at station arrival are considered. The objective function is expressed as a fuzzy goal for the consumption of a delayed scenario. The new proposed objective function incorporates also the behavioral response of the driver in delayed scenarios, when the train is delayed with respect to the commercial timetable.

The optimal Pareto curves run time-consumption for each stretch along the line are inputted to the timetable model. These curves are generated by a model based on Genetic Algorithms and detailed simulation of the train motion. Each point of the Pareto curve is an ecodriving designed to be realistic and executable by a driver, taking into account limitations of manual driving.
The model has been applied to a real high speed line in Spain and has been demonstrated that significative energy savings can be obtained by the efficient design of timetables, given fuzzy knowledge about delays and punctuality constraints. It has been shown that the consumption of the new design scenario is 6.7% less than the timetable in service.

To conclude, it has to be highlighted that the proposed strategy allows energy savings in high speed lines with very low asso-ciated investments, distributing the slack times according to the punctuality requirements of the railway operator.
 References
