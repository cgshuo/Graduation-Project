 1. Introduction
Many studies have shown that the heart rate (HR) response can be used to estimate heart function ( Desai et al., 2001 ; Nishime et al., 2000 ; Watanabe et al., 2001 ). The electrocardiograph or continuous monitoring of the blood pressure is normally used to measure the HR, but photoplethysmography (PPG) is an easier method compared to them. The sensor of PPG is placed at the finger whose weight is light and hence could be much easier to wear. Some studies used it to develop a simple telemetry device for monitoring pulse rate at a finger ( Yamashita et al., 1995 ; Rhee et al., 2001 ). These technologies could be applied to home care, mental stress, or exercise physiology. Johansson et al. used the PPG waveform to estimate the respiratory volumes ( Johansson and Oberg, 1999a, 1999b ).

However, the stability of PPG signal is lower than the electrocardiograph signal for HR extraction ( Yu et al., 2006 ). The following mechanisms can interfere with the PPG waveform: (1) raising and lowering the hand to which the sensor is attached results in the baseline changing with the local venous and arterial hydrostatic pressure ( Murray and Forster, 1996 ), (2) the change in intrathoracic pressure during the respiratory cycle displaces the baseline and changes its amplitude ( Johansson and Oberg, 1999a, 1999b ), (3) changes in amplitude result from the interaction of the left ventricular stroke volume and peripheral vascular applied to analyze biomedical control and feature extraction ( Lin et al., 2003 ; Huang et al., 1999; Lin and Lee, 1996). One of the advantages of fuzzy logic is that it can be applied empirically without explicit mathematical models of the underlying nonlinear physiological systems. Also, it is easy to implement a feature extraction system using fuzzy logic since this is based on linguistic rules. In this paper, we propose an HR detection method that includes a slope calculation, a fuzzy logic discriminator (FLD), and an algorithm for determining the peak index. The use of the differential waveform allows the drift in the baseline PPG signal to be removed and enhances the change in the perfusion duration of
PPG. The FLD was used to evaluate the truthfulness of each peak as a weight. The determining algorithm used the weight of a peak to detect the index of maximum slope and adjusted the input parameters of the FLD for the next peak. The capability of our proposed HR detection method was tested using the following six examples of contamination: raising and lowering the hand, respiration disturbance, changes in amplitude, presence of no dicrotic notch or of double dicrotic notches, and premature atrial contraction (PAC). To evaluate the performance we also used wavelet multiresolution analysis and a correlation detection method to extract the HR for these six different examples. design of the FLD parameters, the flow diagram of the determin-ing algorithm, the correlation method, and the wavelet method.
The six different cases for the PPG waveform also are detailed in this section. Section 3 compares the performance of the FLD method with those of the correlation and wavelet methods, and presents the recorded HR responses. The results are discussed and conclusions are drawn in Section 4. 2. Materials and methods system. The entire system includes a specific simple pulse oximeter (SpO 2 ) monitor, a differentiator, parameter calculation, an FLD, a determining algorithm, and a peak detector. The SpO 2 monitor used (SA200, Rossmax, Taiwan) a sampling rate of 250 Hz outputted PPG digital signals corresponding to red and infrared light intensities via a serial port to the computer. The PPG signal of the SpO 2 monitor is preprocessed by a differential equation to evaluate the slope signal and remove the baseline drift of the PPG signal and enhance the change in the perfusion duration of PPG.
The disturbance characteristics of P re _Ratio , P os _Ratio , and y (defined in Section 2.1.1) are then extracted from the slope signal. The FLD uses these parameters to evaluate a weight representing the truthfulness of the peak of the slope signal, and a determining algorithm uses this weight to detect the actual peaks of the perfusion cycle and adjust P re _PP , P os _PP , and N_PP (defined in Section 2.1.1). Based on the determining algorithm, the peak
P os _PP is defined as the interval between the current peak and the next peak of the slope signal: P _ PP  X  I  X  n  X  1 :  X  4  X 
PP (defined in Section 2.1.4) is the actual peak-to-peak interval for two contiguous perfusion cycles of the PPG waveform. A normalized parameter, N_PP , is recursively adjusted using both the normalized parameter and the PP : N _ PP  X  n  X  1  X  0 : 8 N _ PP  X  n  X  0 : 2 PP ;  X  5  X  when the actual peak of the perfusion cycle of the PPG waveform is determined by the FLD. The ratio of P re _PP and N_PP ( P re _Ratio ) and the ratio of P re _PP and N_PP ( P re _Ratio ) are defined as P _ Ratio  X  Abs P re _ PP N _ PP 1 ;  X  6  X  P _ Ratio  X  Abs P os _ PP N _ PP 1 :  X  7  X 
The angle ( y ) formed between one specific P 3 and its two contiguous peaks of the notch cycle, P 2 and P 4 , is given by y = + P 2 P 3 P 4 in Fig. 2 (b). We observed that y is acute when the specific peak, P 3 , is an actual peak of the perfusion cycle, and obtuse between the peak of the notch cycle, P 4 , and its two contiguous peaks of the perfusion cycle, P 3 and P 5 (i.e., y  X = + P 3 P 4 P 5 ). 2.1.2. The interfered PPG waveform
The peripheral pulse wave is generated by blood ejected from the heart during the opening of the aortic valve. The waveform is shaped by this pressure interacting with complex elastic and resistive elements in the vascular tree. In this study, we selected the following five typical changes in PPG waveforms: (1) changes in the baseline PPG waveform due to raising and lowering the hand, (2) modulation of the baseline and amplitude of the PPG waveform by positive pressure ventilation, (3) changes in amplitude resulting from changes in the left ventricular stroke volume or in the power of the photodiode of the pulse oximeter, by the photodiode to balance the ratio of the red light and infrared light when it calculates the percentage of the oxygen saturation in the blood. In Fig. 3 (c) the amplitude of the PPG waveform is smaller at the end of the ventricular diastole.

Case IV: The dicrotic notch is classically attributed to closure of the aortic valve at the end of the ventricular systole. The vertical position of the notch on the waveform has been used as an indicator of vasomotor tone. Diseases of the myocardium or aortic valve can result in the dicrotic notch disappearing from the PPG waveform, as shown in Fig. 3 (d). The presence of double dicrotic notches is due to strong pressure waves being reflected back via the brachial and femoral artery pathways to reach a finger transducer at a different time, as shown in Fig. 3 (e). Case V: Fig. 3 (f) shows the PPG waveform in the presence of a PAC. Two rhythmic beats appear continuously, with the smaller wave caused by the decreased preload from the premature beat. In the usual methods, the PAC peak would be considered as the second peak, and the interval between the two peaks of the perfusion cycle would increase. 2.1.3. Fuzzy logic discriminator
The FLD is designed to have three inputs: P re _Ratio , P os _Ratio , and y (the angle formed by three contiguous peaks). The fuzzy term set for input P re _Ratio comprises four membership functions: BEST, GOOD, WORSE, and WORST. These fuzzy terms are defined using triangular functions in the [0 2] subset of real numbers. The fuzzy term set for input P os _Ratio comprises two membership functions: GOOD and WORSE. These fuzzy terms are defined using trapezoid functions in the [0 2] subset of real numbers. The fuzzy term set for y , which is also defined using triangular functions defined in the [0 1 360 1 ] subset of real numbers, comprises four membership functions: ACUTE, NOT-ACUTE, FLAT, where x=P re _Ratio or y , is defined by and m indicates the defined center of fuzzy term i. In other words, m in Eq. (8) represents the center of the triangular membership ( x+n i )/( n i m i ) define the left spread and right spread of the [ m , n i ], respectively. The trapezoid membership function trapezoid_i ( x ), x=P os _Ratio is defined as
The output of the FLD is weighting factor W , which represents the degree of truthfulness of the current peak. The fuzzy term set for the weighting factor has four fuzzy terms of singleton type: X 0=0, X 0.4=0.4, X 0.7=0.7, and X 1=1.

There are two major concepts in constructing the fuzzy logic rules in the FLD. In Section 2.1.1 we described three parameters: P _Ratio , P os _Ratio , and y . Eq. (6) indicates that P re _Ratio approaches 0 as P re _PP approaches N_PP , which means that the algorithm will reset input parameters of the next peak using
Eqs. (2), (4), (6), and (7). Based on the determining algorithm, the peak detector determined the perfusion peak of the raw PPG waveform, P [ n ], by identifying the maximum value of the PPG peak of perfusion cycle. PP is defined as PP  X  n  X  0 : 5 P re _ PP :  X  13  X 
An interpolated perfusion peak, P [ n ], will be inserted between the two contiguous perfusion peaks, P [ n 1] and P [ n +1]. When the output value does not belong to the above-described cases, the peak is considered to be a false peak. The input parameters of the next peak are then adjusted using Eqs. (3), (4), (6), and (7). 2.2. Wavelet filter A discrete wavelet transform (DWT) is defined as DWT  X  m ; n  X  X  x  X  k ; c m ; n  X  k  X 
X found that c  X  k  X  is the pulse response of the digital filter, so multiresolution filters could be achieved using the DWT. Important information related to high-frequency levels can be kept by applying a threshold value to the input to be filtered. The S th analysis level threshold value Z s is usually defined as follows:  X  u max f 9 D s  X  n 9 g ;  X  15  X  where u as the threshold coefficient, and 0 % u % 1. We set u =0.2, and perform six-times downsampling. 2.3. Correlation detection
The correlation signal was generated by shifting the one cycle pattern, x , over the PPG signal, y , and simultaneously computing the correlation coefficient r xy [ k ] for each time index k =1, y , N according to Suhrbier et al. (2006) , the point of x is 500 r 3. Results
Fig. 6 shows the five cases that illustrate the differences between tachograms derived by applying the different extraction methods. In Cases I, II, and IV (1), the variable of beat-to-beat HR is larger when the change of baseline of PPG waveform is larger. Moreover, because the wavelet method does not easily smoothen the PPG waveform having the double dicrotic notches in Case IV (2), the double HR would occur. For Case V, the wavelet and correlation methods all could not extract the accurate HR when the PPG waveform has the presence of a PAC. In order to compare the performance of these detection methods, the numbers of heart beats extracted by each detection method are listed in Table 2 . The differences in HR ( D HR) between manual detection (which was chosen as the reference) and the other extraction methods are shown in Fig. 7 for the five cases. The root-mean-square error (RMSE) values relative to the reference are presented duration of D HR is shorter for the FLD method than for the other detection methods. In our experiments, we found that interference from breathing, changes in amplitude, and the absence of the dicrotic notch did not affect the precision and stability of extracting the HR for these detection methods, as shown in Fig. 7 (b) X (d).
However, changes in baseline, the presence of double dicrotic notches, and cardiovascular diseases increase the likelihood of these methods incorrectly identifying peaks or missing actual peaks. The FLD algorithm is more robust than the other methods in Table 2. as weight in the algorithm to determine the truthfulness of the peak of the slope signal. The FLD effectively discriminates the effect of artifacts caused by cardiovascular diseases or motion disturbances.
The fuzzy logic rules were obtained by observing many types of PPG waveforms corresponding to the sub jects with the different cases: (1) large changes in the baseline PPG waveform, (2) changes in the baseline and amplitude of the PPG signal due to breathing, (3) large changes in the amplitude, (4) the presence of non-dicrotic notch or of double dicrotic notches, and (5) the waveform being affected by cardiovascular diseases. Hence, unlike normal general-purpose smoothing methods, the proposed FLD embeds expert knowledge of the PPG waveform into its structure and reasoning process. determine the truth of each peak of the slope signal as a weight, and using this weight in a determining algorithm to determine the actual peak of the perfusion cycle and adjust the input parameters of FLD. Then, the peak detector determined the perfusion peak of the raw PPG waveform and calculated the HR.
An interpolated peak was inserted near the time of the missing peak, which allowed the beat to be monitored.
 Acknowledgment
Taiwan, Republic of China, under Grant no. NSC 96-2221-E-324-054-MY3.
 References
