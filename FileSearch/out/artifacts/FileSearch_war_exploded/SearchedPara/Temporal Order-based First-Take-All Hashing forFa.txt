 Attention Deficit Hyperactive Disorder (ADHD) is one of the most common childhood disorders and can continue through adolescence and adulthood. Although the root cause of the problem still remains unknown, recent advancements in brain imaging technology reveal there exists differences between neural activities of Typically Developing Children (TDC) and ADHD subjects. Inspired by this, we propose a novel First-Take-All (FTA) hashing framework to investi-gate the problem of fast ADHD subjects detection through the fMRI time-series of neuron activities. By hashing time courses from regions of interests (ROIs) in the brain into fixed-size hash codes, FTA can compactly encode the tem-poral order differences between the neural activity patterns that are key to distinguish TDC and ADHD subjects. Such patterns can be directly learned via minimizing the training loss incurred by the generated FTA codes. By conducting similarity search on the resultant FTA codes, data-driven ADHD detection can be achieved in an efficient fashion. The experiments X  results on real-world ADHD detection bench-marks demonstrate the FTA can outperform the state-of-the-art baselines using only neural activity time series with-out any phenotypic information.
 ADHD detection; First-Take-All; Time series hashing
Recent advancements in brain imaging technology, one of the greatest efforts in Neuroscience, aim to uncover features unique to certain neurophysiological phenomena [4, 20]. The intuition is that the neural activity pattern of a healthy hu-man subject ought to appear different from that of a pa-tient suffering from some neural disorder, such as Attention  X  Corresponding author 9]. In this context, fMRI time-courses 1 offer a feature-rich representation of high level functional organization in the brain (Figure 1).

Considering the representations, we aim to exploit its rich nature for the task of ADHD diagnosis as a pattern classi-fication problem [22]. Utilizing the structure of the resting-state fMRI time-courses, we generate hash codes encoding the temporal structure of the data. These hash codes can then be compared to detect similarities and differences be-tween the fMRI time-courses of healthy patients versus those diagnosed with ADHD. It is known that neural connections exist whether or not regions of the brain are functionally ac-tive, hence forth the resting-state fMRI provides a controlled dataset to test for fundamental differences in functional neu-ral networks in the brain.

Tasked with hashing time-series data, our approach cen-ters on fast detection based on retrieval of the similar dis-order patterns from a database of brain neural imaging ac-tivities. Specifically, we propose the First-Take-All (FTA) hashing method for encoding varied-length fMRI sequences into fixed-size hash codes. The problem of fast matching similar fMRI sequences boils down to a fast search of simi-lar hash codes based on their Hamming distances that can be calculated efficiently.

Specifically, the algorithm first projects an input sequence of varied length onto different subspaces, each representing a sequence of latent patterns. After encoding the tempo-ral order of these patterns to hash the fMRI time-courses, the pattern that appears first among a selection of patterns is used to index the time-course 2 . This scheme can yield a compact encoding of temporal relations between the se-lected patterns that really matter in distinguishing between healthy individuals and those diagnosed with the ADHD. The optimal pattern projections will be learned to result in the hash codes that minimize the diagnosis errors. In this way, FTA allows for not only high detection rates, but a scal-able solution for detecting fMRI sequences. Since the pro-jections are learned as opposed to randomly generated, the solution scales well with large-scale input fMRI sequences using compact hash codes.

Suitably, the objective of this paper is to provide a scal-able and efficient [18, 28] solution to the problem of detect-ing neurodevelopmental disorders (specifically ADHD) via fMRI time-courses. Doing so also reverberates to improved success in brain imaging technologies. The proposed tempo-ral order-based hashing algorithms are much more generic, providing a new framework for fast matching and detection to other forms of time-series data. In this paper, the method has implications on functional neural analysis[14, 17]. Be-ing able to reliably infer causal relationships between brain structures and functions presents an interesting opportunity for further investigations, the range of which include areas of classification outside neurodevelopmental disorders [13]. Ul-timately, learning the projections to hash a time-series space efficiently provides important practicality to the design.
In medical imaging terminology, a  X  X ime course X  refers to an obtained sequence for an imaged area. In this paper, we will use this term interchangeably with  X  X ime series X  when there is no confusion in the context.
Without loss of generality, we can also designate the second or the third appearing pattern or so on to hash a fMRI sequence. As a convention, we choose the first-appearing pattern in this paper.
 Learning models. In addition, other efforts suggest that a detection scheme for analysis of fMRI time-courses can be expanded to other neural datasets and disorders[10, 7]. This offers an expanded utility to the model presented in this paper, in which the FTA can be used on other prob-lems within Neuroscience and a host of other topic areas, all whilst preserving efficiency. Lastly, DTW offers an ele-ment of distinction between former methods in time-series analysis versus those of which focus specifically on preserv-ing temporal order during encoding of time-series data [2]. In doing so, FTA provides clear advantages over methods which eschew these temporal features [16].
In this paper, we introduce a novel hashing-based paradigm to automatically identify ADHD subjects. The structure of our method can be summarized as following: First, brain at-lases containing a number of Regions of Interest (ROIs) will be constructed and corresponding time courses of each ROI will be extracted based on the ADHD subjects X  resting state fMRI data of the brain. Then, we propose a new tempo-ral order-preserving hashing algorithm called First-Take-All to hash time courses into binary sequences. With those se-quences, we compare the distance (similarity) between them to determine whether a patient is an ADHD subject.
In brain neuroanatomy, many approaches, such as auto-mated anatomical labeling (AAL) [29], Eickhoff-Zilles (EZ) [11], Talairach and Tournoux (TT) [21] and Harvard-Oxford (HO) [15], have been proposed to construct brain atlases by using structural anatomic or functional information. After that, voxels in the regions that have structural or functional similarities will be grouped into Regions of Interest (ROIs) and the time courses of these ROIs can be extracted from the voxels of the subjects X  resting state fMRI data. Since the brain atlas construction and time-course extraction are not the focus of this paper, we will employ the existing brain at-lases pre-constructed by the neuroanatomy community. The details will be presented in Section 5.

With time courses of ROIs extracted, every subject can be mapped to a unique vector (multivariate) sequence which describes the brain activities of that subject. For exam-ple, X = [ x 1 , x 2 ,  X  X  X  , x T ] can be a subject X  X  time-courses of ROIs, where each x t  X  R D ,t = 1 ,  X  X  X  ,T represents the brain activities of that subject in D different ROIs. For our convenience, we will refer to Time Courses of ROIs as TC s in the rest of this paper for short.
Now we propose a hashing algorithm for time-series data which can map a TC into a fixed-size hash codes regard-less of its original length. It can be roughly divided into 2 parts. First, a TC will be projected into several subspaces to produce a set of projection sequences. Then, we generate hash codes for entire TC by conducting an operation called First-Take-All ( FTA ) on those projection sequences. figure 2. Accordingly, we propose to minimize the variance of pattern occurrence together with the other criteria to learn the projection ma-trix W in Section 4. This regularization term is more likely to generate a salient pattern that really matters in detecting ADHD.
 Now putting the expected appearing moments of K patterns into m = [ m 1 ,  X  X  X  ,m K ], we wish to develop an ordinal hash-ing algorithm directly encoding their temporal order for a TC. Specifically, we perform a First-Take-All (FTA) com-parison to rank the patterns by their temporal order  X  the pattern whose expected appearing moment comes first wins the FTA comparison, and its index is used to hash the entire TC.
 For example, when we have two projected sequences (i.e., K = 2), FTA simply encodes the pairwise order between two corresponding patterns. When K &gt; 2, FTA makes a higher-order comparison to decide which pattern appears first. Note that the output FTA hash code is not binary; instead it is a K -ary code. For this reason, we call K the FTA base.

For a pairwise FTA comparison involving only two pat-terns, knowing the first coming pattern completely encodes the temporal order between these two patterns. This can be generalized to high-order comparison if more than two patterns are involved for choosing the first-coming pattern. Such a high-order FTA comparison could generate more compact code to distinguish between different types of TCs. For example, suppose there are three types of TCs have dif-ferent orders of patterns 1  X  2  X  3  X  4, 1  X  3  X  2  X  4 and 1  X  4  X  3  X  2, respectively. Then an effective FTA comparison only needs to make a order-3 comparison between the last three patterns 2, 3 and 4, which will output the FTA code 2, 3 and 4 to distinguish these three types of TCs. In this case, there is no need to make comprehensive comparisons between all possible pairs of patterns.

However, the patterns whose orders matter in classify-ing different types of TCs are unknown a-priori. A suitable group of patterns must be learned so that the same type of TCs will have similar pattern orders. We will discuss the detail about the learning of these patterns in Section 4.
Mathematically, the index of the first-appearing pattern can be expressed as where  X   X  { 0 , 1 } K , 1 |  X  = 1 and h is an 1-of-K indicator of the FTA winner  X  its unique nonzero entry is indexed by the first-appearing pattern in the input TC, and P = [ p 1 ,  X  X  X  , p K ].

An algorithmic description for the entire FTA hashing procedure is shown in Algorithm 1. Multiple FTA codes can be generated with a set of projection matrices. The code length L in the algorithm represents the number of hash codes generated for a TC.

Figure 3 illustrates the FTA comparison when K is set to 3. Here p 1 , p 2 and p 3 in Figure 3 are the probability of each pattern appearing over the time axis t . From them, we can
Now consider a pair of TCs X ( i ) and X ( j ) , along with their label s i and s j . We hope that through our learning algorithm, the resultant FTA hash codes can reflect the label similarity between two TCs. In other word, when s i = s j , there is a greater chance that the same pattern will appear first in both X ( i ) and X ( j ) ; otherwise, different patterns will appear first if s i 6 = s j if s i 6 = s j .

Mathematically, it is easy to see that h ( i ) k h ( j ) k is the proba-bility that the k th pattern will appear first in both X ( i ) and X ( j ) . Suppose h ij represents the probability that the same pattern will appear first in both TCs. It can be computed as by summing up over all patterns Our goal is to maximize h ij when s i = s j and to minimize it when s i 6 = s j . This results in the following objective function Here, s ij = 1 i.f.f. s i = s j ; and s ij = 0 otherwise. We wish to minimize it for all TC pairs. Suppose the training set is T = { X ( i ) ,s i } N i =1 with N TCs. Then the total logarithmic training loss over T becomes Minimizing it can minimize the pairwise diagnosis errors on the training set incurred by the resultant FTA hash codes.
In addition to the minimization of training loss, it is worth mentioning that the redundancy between the learned pat-terns also affects the FTA hashing performance. With a set of redundant patterns learned, their projection sequences would be highly correlated or even identical to one another. This could reduce the degree of the temporal order being dis-tinguished between different patterns. In this case, a smaller perturbation or local warping would change the temporal orders significantly, thereby degenerating the FTA X  X  perfor-mance in presence of noises.

To improve the resiliency of FTA against perturbations or noises on TCs, we wish to reduce the redundancy between patterns by minimizing the following normalized inner prod-ucts between projection vectors Clearly, minimizing it can make the learned projection vec-tors as orthogonal to each other as possible, thereby mini-mizing the redundancy between the corresponding patterns .
In addition to the training loss (8) and the projection orthogonality (9), we also consider to minimize the variance
The projection orthogonality can also be imposed as a hard constraint in the optimization problem. However, by exper-iments, we found that the performance is more stable by posing it as a soft term that penalizes the projection redun-dancy in the objective function.
 dataset, a dataset developed for ADHD detection. First we give a brief introduction on ADHD dataset. Then we discuss the experiment setting. We compare the proposed method with several supervised and unsupervised baselines with dif-ferent evaluation metrics. Finally, we study the impact of the hyper-parameters K and L on the performance.
We evaluate the proposed FTA approach on ADHD-200 dataset. ADHD-200 was initially prepared by ADHD-200 Consortium[23] for the ADHD-200 Global Competition, a competition that aimed to improve the understanding of the neural basis of ADHD through the implementation of the sci-entific discovery. It contains 776 records of the resting-state fMRI and anatomical data across 8 independent imaging sites, 491 of which come from typically developing individ-uals and 285 from children and adolescents diagnosed with ADHD (ages: 7-21 years old). Accompanying phenotypic information includes: diagnostic status, dimensional ADHD symptom measures, age, sex, intelligence quotient (IQ) and lifetime medication status. Preliminary quality control as-sessments (usable vs. questionable) based upon visual time-series inspection are included for all resting state fMRI scans. An additional 197 individuals from six imaging sites were re-leased without the diagnosis labels during the competition for testing purposes and their labels were released separately afterwards. More information on the dataset can be found at http://fcon 1000.projects.nitrc.org/indi/adhd200/.
In order to bring the ADHD-200 Global Competition to a wider audience, The Neuro Bureau 5 made preprocessed ver-sions of the competition data freely available to the general public to help those whose specialities lay outside of resting-state fMRI analysis to bypass technical obstacles. There are several preprocessed datasets available which were prepro-cessed by different pipelines. In order to fairly compare the proposed method with the baselines, we choose the dataset preprocessed by Athena pipeline[1] which is also used by the baseline methods. More information about the Athena pipeline can be found at Neuro Bureau X  X  website 6 .
For the sake of fair comparison, we follow the experiment setting similar with the baselines. For the proposed FTA hashing, we determine the values of hyper parameters K , L ,  X  and  X  by conducting 5-fold cross validation on the train-ing set. As mentioned in section 3.1, the TCs we used for evaluation were extracted from the pre-constructed brain atlas which was built with automated anatomical labeling (AAL)[29]. The way to extract TCs is averaging the time courses within each ROI voxel 6 . Note that the AAL atlas was constructed using anatomic and cyto-architectonic in-formation and did not incorporate functional information. Thus the resultant TCs do not contain any prior phenotypic information which may impact the evaluation. Based on the cross validation, FTA base K and code length L are set to 2 and 200 respectively.

We compare the proposed method with following algo-rithms: http://www.neurobureau.org/ http://www.nitrc.org/plugins/mwiki/index.php/neurobureau: AthenaPipeline Figure 4: Prediction Accuracy versus Execution Time. Comparison between FTA and unsupervised baselines training set (491 TDC and 285 ADHD children) thus the ability of a classifier to detect ADHD children is dampened  X  the prior distribution of TDC is biased by a large number of TDC samples in a general population. Such an unbalance between TDC and ADHD subjects can be relieved by impos-ing a larger penalty on missing ADHD subjects. However, we do not perform such a re-balance for the sake of a fair comparison with the other baselines.

Next we perform efficiency evaluation for all four meth-ods. Since all three baselines adopt Dynamic Programming (DP) to perform similarity search, it can be expected that they will have a much slower speed than the proposed FTA hashing which performs similarity search by the Hamming distance. Figure 4 shows the Prediction Accuracy versus the Execution Time for all the methods. Compared with the baselines, FTA achieves more than 30% higher predic-tion accuracy on the entire test set and at least 7 times faster than DP based baselines. That suggests the proposed FTA hashing can be used for fast detection of ADHD subjects.
Now we compare the proposed method with two super-vised baselines: JHU[12] and AGDM[10]. The approach proposed by JHU is a weighted combination of several algo-rithms including CUR decompositions, random forest, gra-dient boosting and support vector machine et al. It adopts both fMRI data and the accompanying phenotypic informa-tion like IQ to predict the ADHD subjects. On the contrary, another baseline AGDM only requires fMRI data to make the prediction. According to [10], features called AGDM were extracted from fMRI data to encode the brain network structure first. Then they were used to train a SVM clas-sifier which made the final prediction. Since two baseline methods have different experiment settings, we follow their individual settings to make a fair comparison.
 Similar to Section 5.3, we train and test the FTA on all the training subsets across the eight sites. More specifically, we randomly sample 3 , 000 pairs from all the 8 training sub-
Table 3 shows the comparison results between the FTA and the AGDM on individual sets. Apparently, the FTA significantly outperforms the AGDM on every evaluation metrics. Specifically, the average prediction accuracy and the average sensitivity of FTA outperform the AGDM by around 15% and 20% respectively. This means more than 75% of subjects can be correctly classified, and nearly half of ADHD patients can be successfully detected by the FTA. Moreover, the specificities of FTA on all four subsets are obviously boosted compared with the AGDM. Especially on KKI and Peking, the specificity achieves 1  X  all TDC sub-jects are correctly identified.
 Similar results can be found about the sensitivity. On the NeuroIMAGE and the OHSU subsets, the sensitivities have reached over 0 . 7 and 0 . 6, much closer to the corresponding specificity. Consider our discussion in Section 5.3  X  the low sensitivity is caused by high ratio of TDC in the training set. We calculated the percentage of TDC and ADHD subjects on each subset, which are illustrated in Figure 5. It shows that the ratio of TDC/ADHD subjects on NeuroIMAGE and OHSU is close to 1, while it is much higher on KKI and Peking. This implies that the low sensitivity is caused by a high ratio of TDC/ADHD.
Finally, we evaluate the FTA X  X  performance by varying its hyper-parameters. In particular, we study the impact of the code length L and FTA base K on the performance. Besides the AAL, we also conduct experiments with TCs extracted Figure 8: Test accuracy across different ROIs, using different L values followed by an increase after K = 6. Overall, all four ROI atlases, begin to converge to a median of performance when K approaches 7. Throughout the tests, the results indicate only small dependencies contingent on the values of K .
Considering K is the number of patterns involved in gen-erating a hash code, assessing its role offers a way to tune the amount of discriminant information available at any given comparison. From Figure 7, it seems that for slight increases in K (e.g., from K = 4 to K = 6 for CC200) the amount of information increases, offering an increased test accuracy. However, there appears to be a point at which further in-creasing the value of K no longer improves the test accuracy (beyond K = 6). Ultimately, this leads to a decline in per-formance due to the redundancies in the comparison of a too large number of patterns.
 Now let us assess the code length parameter L . Fixed at K = 2, a variety of code lengths were tested, ranging from L = 10 to L = 1000. In Figure 8, it can be seen that L acts differently across different ROIs, especially between the range of 10 to 200 code length. Incidentally, it is shown that this range experiences the most abrupt shifts in perfor-mance, whilst the range 200-1000 shows either constant or steady trends. In the case of AAL and HO, they are par-ticularly sensitive to this parameter. Within the L = 10 to L = 200 range, the performance reaches its peak and then drops subsequently. Extending to the set of other ROIs, Fig-ure 8 shows that this trend (to a lesser degree) is exhibited on CC200 and TT as well.

Resulting from this experiment, it can be shown that vary-ing code lengths has impact on performance, with tuning required particularly in the range of compact codes from L = 10 and L = 200. Yet similar to K , simply increasing the value indefinitely does not result in a better test ac-curacy because of higher redundancies that might exist in longer codes.
In this paper, we propose a novel FTA algorithm to hash time series of varied length into fixed-size codes. We use the resultant hash codes to efficiently detect the ADHD subjects by fast retrieving the similar subjects. To maximize its per-[13] J. A. Etzel, V. Gazzola, and C. Keysers. An [14] M. D. Fox, A. Z. Snyder, J. L. Vincent, M. Corbetta, [15] J. A. Frazier, S. Chiu, J. L. Breeze, N. Makris, [16] T.-c. Fu. A review on time series data mining. [17] J.-D. Haynes and G. Rees. Decoding mental states [18] E. J. Keogh and M. J. Pazzani. Scaling up dynamic [19] E. J. Keogh and M. J. Pazzani. Derivative dynamic [20] S. Kl  X  oppel, A. Abdulkadir, C. R. Jack, [21] J. L. Lancaster, M. G. Woldorff, L. M. Parsons, [22] S. Lemm, B. Blankertz, T. Dickhaus, and K.-R. [23] M. P. Milham, D. Fair, M. Mennes, S. H. Mostofsky, [24] G. A. Ojemann, J. Ojemann, and N. F. Ramsey. [25] R. A. Poldrack. Region of interest analysis for fmri. [26] L. Rabiner and B.-H. Juang. Fundamentals of speech [27] R. P. N. Rao. Brain-Computer Interfacing: An [28] C. A. Ratanamahatana and E. Keogh. Making
