 We present a study to understand the effect that negated terms (e.g.,  X  X o fever X ) and family history (e.g.,  X  X amily his-tory of diabetes X ) have on searching clinical records. Our analysis is aimed at devising the most effective means of handling negation and family history. In doing so, we ex-plicitly represent a clinical record according to its different content types: negated, family history and normal content; the retrieval model weights each of these separately. Em-pirical evaluation shows that overall the presence of nega-tion harms retrieval effectiveness while family history has little effect. We show negation is best handled by weighting negated content (rather than the common practise of re-moving or replacing it). However, we also show that many queries benefit from the inclusion of negated content and that negation is optimally handled on a per-query basis. Ad-ditional evaluation shows that adaptive handing of negated and family history content can have significant benefits. Categories and Subject Descriptors: H.3.3 [Informa-tion Storage and Retrieval] General Terms: Measurement, Experimentation.
Negation and reference to family history are two unique characteristics of clinical records that affect natural language processing of clinical text [3]. Commonly mentioned condi-tions in a patient record (e.g.,  X  X ever X  or  X  X racture X ) often appear in negated form (e.g.,  X  X enies fever X  or  X  X o fracture X ) [3]. Previous research has largely focused on identifying the negated portions of text, or reference to family history con-tent (e.g., X  X amily history of heart disease X ) [3, 1]. From an information retrieval (IR) perspective, previous studies have considered how negation may adversely affect retrieval [ 5, 6]. For example, when searching patient records using the query  X  X atients with heart murmour X , the retrieval system might return a large number of irrelevant documents containing  X  X o heart murmur X . Traditional keyword-matching IR sys-tems denote the presence of the query terms in a document as an indicator of relevance. Empirical analysis of the effect of negation on IR system effectiveness shows mixed results: Koopman et al. [ 5] found IR term-weighting methods natu-rally accounted for negation, while Limsopatham et al. [6] developed a technique that showed handling negation im-proved effectiveness.

In this paper, we provide a specific analysis of how and why negation affects retrieval effectiveness. In doing so, we uncover why previous studies of negation in IR produced differing results. In addition to negation, we also consider how the reference to family history also influences IR effec-tiveness. We explicitly represent, within the language mod-eling framework, a clinical record according to its different content: negated , family history and normal (i.e., all other normal content); the importance of each of these content types is then weighted separately. Relevance of a particular document to a query is estimated based on the mix of the three content types within the document.

An evaluation using the TREC Medical Records Track shows that handling negation does improve retrieval per-formance. However, further analysis revealed that many queries benefit from the inclusion of negated content. An outcome of this finding is that the common approach [ 8] of removing or replacing negated content from the docu-ment representation is sub-optimal; rather, negated content should be weighted separately, ideally on a per-query ba-sis. The significant potential benefits of adaptive per-query handling of negated , family history and normal content are presented in further retrieval experiments.
Accounting for negated terms in clinical text has been an important topic in health informatics, with much of the fo-cus being within the computational linguistics and natural language processing (NLP) fields. The main focus of these efforts is on negation detection and negated scope detection. Chapman et al.[ 2] developed NegEx , an algorithm which is effective in determining negated findings or diseases from clinical text. NegEx has become a common tool for identi-fying negated content; the tool was extended as the ConText algorithm, which in addition to negation also identifies hypo-thetical, or historical references in clinical text [ 4]. ConText wasalsoextendedtoidentifyreferencestofamilyhistory. Previous studies reported the effectiveness of NegEx to be at least 90% F-measure [2, 4].

Less research has been performed on the effect of negation on searching clinical text. Previous studies in this area have mainly considered how the negated content of a document can be removed or separated prior to indexing the docu-ments; the assumption being that the presence of negated content always harms retrieval effectiveness [ 1, 6]. This as-sumption was pervasive amongst teams participating in the TREC Medical Record Track: many participants dealt with negation by pre-processing clinical records with the NegEx algorithm to remove negated content [ 8].

In this paper, we firstly empirically investigate the as-sumption that negation always harms retrieval performance. This is important to understand as previous studies differ in their findings on the effect of negation: Koopman et al. [5] found IR term-weighting methods naturally accounted for negation, while Limsopatham et al.[6] developed a technique that showed penalising negation improved effectiveness. In addition to the effect of negation, we also consider the less studied effect of family history references on clinical IR.
The previous work described here, and the focus of this study, is on explicitly negated terms found in documents, which differs from other work concerned with negation in queries (e.g., the Boolean query  X  X ypertension NOT obe-sity X ). Dealing with negation in queries presents its own set of challenges but is out of the scope of this study.
We model retrieval as a language modeling process, where the standard document representation is enhanced to han-dle three different types of content within the document: negated , family history and normal .Tothisaim,wesepa-rate these different contents such that a document D can be represented by  X  D = D nor  X  D neg  X  D fh .

Separating the different contents allows weighting each content type differently. For example, instead of remov-ing negated content from the document, a negative weight can be assigned to the negated content when estimating the probability of a document being relevant to a query Q :
This approach of subtracting the score contribution of negated content is similar to Limsopatham et al. [ 6], who reported improvement in retrieval effectiveness using this approach. However, we further enhance this by mixing the estimates of negated , family history and normal content: P (
Q |  X  D )  X   X  nor P ( Q | D nor )+  X  neg P ( Q | D neg )+ where  X  nor,fh,neg are the mixing parameters that control the weights for normal , negated and family history con-tent respectively. Weights of normal and family history are bounded by 0  X   X  nor , X  fh  X  1, however negation weights are instead bounded by  X  1  X   X  neg  X  1; this is done to han-dle negative weighting for negation (making it equivalent to Eq. 1). Eq. 2 explicitly scores a clinical record according to its different types of content; the effect of negation and family history can then be investigated by varying  X  .
The Indri toolkit 1 was used to implement Eq. 2.For negation and family history detection we used the standard ConText algorithm [ 4]. Spans of text in a document are annotated with XML elements &lt;negated&gt; or &lt;fhistory&gt; , all other content is annotated &lt;normal&gt; (spans may over-lap). Documents are then indexed using Indri X  X  XML in-dexer, which stores the normal , negated and family history content in separate fields, thus providing the three repre-sentations of a document, D nor , D neg and D fh . For re-trieval with mixed weights we used the Indri Query Lan-guage #wsum method to assign weights to specific fields, e.g., if a query text is Dementia , and the mixing parame-ters are  X  nor =1 . 0,  X  neg =  X  1 . 0and  X  fh =0 . 5, we gen-erate the query #wsum(1.0 dementia.normal -1.0 demen-tia.negated 0.5 dementia.fhistory) . This query can be interpreted as requesting medical records than mention de-mentia but not in a negated form; while, the mention of dementia in the family history is weighted half that of an affirmative mention in the normal content.
Our experimental evaluation is conducted to answer the following research questions: RQ1: What effect does negation have on overall retrieval RQ2: What effect does family history have on overall re-RQ3: Does negation always harm effectiveness (and there-RQ4: Can retrieval effectiveness be significantly improved
The test collection used in our experiments was the TREC 2011 &amp; 2012 Medical Records Track (MedTrack) [ 8]. The unit of retrieval was a patient record rather than an indi-vidual report; thus, reports belonging to a single patient X  X  record were concatenated into a single document called a patient visit document. 2 The resulting corpus contained 17,198 patient visit documents.

The evaluation measures used in MedTrack 2011 were bpref and precision @ 10 (P@10). However, in MedTrack 2012 inferred measures and P@10 were used. Inferred mea-sures required specific relevance assessments (prels) not avail-able for 2011, but bpref and P@10 could be used for 2012 as qrels were available. While it is possible to separate the eval-uation into two parts (34 queries for 2011 and 47 for 2012), it is more desirable to have a single, larger query set for more powerful statistical analysis. Therefore, we combine the query sets and use bpref and P@10.

To evaluate RQ1 (the overall effect of negation), we ad-just the weight of negated content while fixing the weights for normal and family history. This is done by varying  X  neg in Eq. 2 from -1 to 1 in 0.1 increments. Negation removal equates to  X  neg = 0: this is the approach most systems at TREC Medtrack subscribe to, including the system that achieved the highest results (Udel) [8]. Note that in our experiments we do not explicitly compare with TREC sys-tems because they mix negation handling (if any) with other techniques and engineering solutions (such as discriminating between type of reports). Instead, we consider two base-lines to handle negation: that with  X  neg = 0 (negation removal), which is used by most TREC system, and that with  X  neg =  X  1 (negation penalisation), which resembles the strategy by Limsopatham et al. [ 6].

To evaluate RQ2 (the overall effect of family history) we adjust the weight of family history content while fixing the weights for normal and negated by varying  X  fh in Eq. 2 from 0to1in0.1increments.

To evaluate RQ3 (does negation always harm performance) we have a two-fold approach. Firstly, we investigate in-Table 1: TREC MedTrack retrieval results for nega-tion removal, family history removal and both nega-tion and family history removal.  X  = statistical sig-nificance (paired t-test, p&lt; 0 . 01 ) over the baseline. Figure 1: The effect on retrieval effectiveness ( y -axis) with different weightings ( x -axis) of negation (left) and family history (right). dividual query performance for the best settings of  X  neg Secondly, we perform an exploration of the full parameter space of  X  nor ,  X  neg ,  X  fh to uncover how the weighting mix differs between queries and whether negation always harms retrieval. The sweep of the parameter space also informs RQ4 (the possible improvements from selecting an optimal mix of content).
RQ1 &amp; RQ2: What effect does negation and family history have on overall retrieval effectiveness?
Table 1 presents the retrieval results for negation removal, family history removal and both negation and family his-tory removal. Removing negated content does indeed im-prove overall retrieval performance, especially in P@10. The greater improvement in P@10 shows that negation can more adversely affect the top-ranked results. The results confirm that negation has an adverse effect on retrieval effectiveness and that removal of negated content (  X  neg = 0) can improve the overall effectiveness. RQ2 considers the effect of family history content on retrieval effectiveness. In this regard, re-moving family history content did not affect effectiveness in a statistically significant way: Table 1 showsonlyminor changes in P@10 and bpref for family history removal.
The results in Table 1 report the effect of simply remov-ing negation and family history; in our method, this corre-sponded to assigning a weight of 0 to  X  neg and  X  fh .How-ever, Eq. 2 also allows assigning different weights to the different types of content. The effect on retrieval for differ-ent weighting values is illustrated in Figure 1.The x -axis refers to different values of  X  neg from -1.0 to 1.0 and  X  from 0.0 to 1.0. In both cases the weight for normal con-tent is fixed,  X  nor =1 . 0. The y -axis shows the retrieval effectiveness (bpref and P@10).

For negation weighting, Figure 1 shows that negative weights Figure 2: Per-query effectiveness change in P@10 after applying negation weighting (  X  neg =  X  0 . 7 ). of  X  neg are more effective (for both bpref and P@10) than negation removal (  X  neg =0 . 0). This finding is consistent with Limsopatham et al. [ 6] and supports their negative weighting method. It also highlights that common approaches of simply removing negated content [ 8] are sub-optimal; a more appropriate method is to negatively weight such con-tent. The optimal effectiveness differs depending on the eval-uation metric  X  bpref is maximised with  X  neg =  X  1 . 0, while P@10 is maximised with  X  neg =  X  0 . 7. This difference again highlights that negation affects the top-ranked documents (measured by P@10) in a different way to the longer result set (measured by bpref).

In contrast to negation, weighting the contribution of fam-ily history content has little effect on effectiveness. However, it is important to note that removing the document portions that dealt with family history (i.e.,  X  fh = 0) did not actually degrade performance. Analysis on individual queries showed that family history did indeed have little effect on every query  X  it was not the case that family history harmed and improved an equal number of queries, leading to an overall performance comparable to the baseline.

In summary, these results show that negation has overall a detrimental effect on retrieval effectiveness; while, family history does not affect retrieval in a significant way.
RQ3: Does negation always harm (should we al-ways exclude or negatively weight negated content)?
The overall retrieval results motivate always negatively weighting negated content; the best P@10 settings being  X  neg =  X  0 . 7. To verify whether this holds for each of the 81 queries, we analyse the effect of negation weighting on individual queries. Figure 2 shows the change in P@10 for each query when using the best setting of  X  neg (-0.7) com-pared to the baseline. In the figure, positive values indicate queries that benefit from negation handling, while negative values indicate queries harmed by negation handling. The results confirm that overall negation handling has positive effects; however, there were a number of queries that were harmed or not affected ( X  P @10 = 0). This finding, i.e., the difference between overall effectiveness and individual query effectiveness, explains the mixed results of previous studies. Studies that considered overall results concluded that nega-tion harms effectiveness [ 6], while other studies that used a different set of individual queries found that negation had less of an adverse effect [ 5].

The analysis on individual queries suggests that a single parameter setting across all queries is sub-optimal. We thus perform a full exploration of the parameter space to de-termine the optimal parameter value on a per-query basis. Figure 3 presents the optimal  X  value for each of query.
For normal content we observe that most queries are op-timised with  X  nor =1 . 0, although there are still a number Figure 3: Optimal  X  (based on P@10) for each query. Optimal weighting of negated content is polarised (between -1.0 and 1.0), showing that negated con-tent can sometimes aid effectiveness.
 Table 2: Potential improvements for optimal per-query weighting of different content, compared to the best fixed overall weighting baseline (  X  nor =1 . 0 ,  X  neg =  X  1 . 0 ,  X  fh =0 . 8 ).  X  =pairedt-test, p&lt; 0 . of queries for which the best effectiveness is achieved by re-ducing the importance of normal content.

For negated content, results are mixed: a number of queries are most effective with negative weighting, while only a few queries benefit from negation removal (  X  neg =0 . 0), and a large number of queries (  X  30%) are most effective with positive negation handling (  X  neg =1 . 0). The overall results presented in the previous sections highlighted the preference for negative weighting over negation removal. However, the exploration of the optimal parameters illustrated here shows that there is a large number of queries that benefit from in-cluding negation via positive weighting. These might be documents that contained both affirmed and negated refer-ences to a query term where the overall status was affirmed. For example, a patient who tested positive to a condition at the beginning of their hospital admission, were treated, and a further test showed the condition was no longer present. Additionally, these could be examples where the NegEx al-gorithm incorrectly annotated a portion of text as negated when it should have been marked as normal.

For family history, the optimal parameter settings show that generally this can be treated like normal content.
The results show that the optimal parameter settings vary significantly between queries. Negation does not always harm performance: in many queries a positive weight should be assigned to negated content. The optimal weights also vary for both normal and family history content.

RQ4: Can retrieval effectiveness be significantly improved by finding an optimal mix of normal, negated and family history content?
Given the variability in optimal parameter values, a per-query approach may be beneficial. To quantify the possible advantage of an adaptive strategy that optimally mixes con-tent types, we adjust weighting parameters on a per-query basis using the best settings determined in the previous sec-tion. Table 2 shows the retrieval results using this optimal per-query weighting as compared to the best fixed overall weighting baseline (  X  nor =1 . 0,  X  neg =  X  1 . 0,  X  fh =0
Optimal per-query weighting can significantly improve re-trieval effectiveness, more so in the top-ranked results (P@10). This again highlights how negated content does not always harm effectiveness and may be important to include for cer-tain queries. It also motivates further research into an adap-tive per-query estimation of the weighing parameters. Meth-ods for estimating per-query parameters are often investi-gated in IR [ 7]. A supervised machine learning method may be employed, with the optimal parameter settings identified here supplied as training data. In addition, a set of features must be selected which might indicate which content type is most important given the query; some useful features to choose in this regard might include statistics related to fre-quencies of occurrences of terms both in normal and negated content, and collection-level statistics, for example, how rare is a term and how often does it occur negated.
This study provides an understanding of how and why negation affects clinical IR: overall, negation harms retrieval, family history has little effect. We show that assigning a negative weight to negated content is more effective than thecommonpractise[ 8] of removing or ignoring this con-tent. However, on an individual query level, negated con-tent can be beneficial and therefore negated content within a document should not be ignored. The difference between overall retrieval effectiveness and individual query effective-ness explains the mixed results of previous studies in this area [ 5, 6]. Considering negated, family history and nor-mal content separately is flexible and effective for handling these different content types. This approach can easily be applied to other content types beyond negation and family history. An analysis of the optimal weighting showed that significant improvements are possible if the right content mix is chosen. The analysis also reveled possible limitations of our study in that some errors could come from the NegEx and ConText algorithms (while NegEx does have F-measure 90% [2, 4], ConText has not been robustly evaluated). This may explain why no significant improvements were found when tuning the family history weights, although this may also indicate that family history is less important that nega-tion. Future work will investigate an adaptive per-query method to automatically derive the importance of different content type in a clinical document to improve retrieval.
