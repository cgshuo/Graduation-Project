 As editing tools are popular nowadays, digital images can be tampered easily. Data hiding can be used to protect images from tampering, of which fragile watermarking that any modification to the content would be detected is an important branch [1-3]. In recent years, some fragile watermarking methods are developed to have the self-recovery ability to the tampered regions in an image, which is also called self-embedding. The idea was first brought forward by Fridrich in 1999 [4]. 
Recently, Wang and Tsai propose a method to embed the fractal code of the region of importance (ROI) into the LSBs of the original image to achieve high quality resto-ration of the ROI when it is inpainted [5]. Cheddad et al. down-sample the half-toning order to increase the restoration area, Lee and Lin propose an effective dual water-mark scheme for image tamper detection and recovery, in which two copies of wa-termark for each non-overlapping block are embedded into bit-planes of the original image [7]. Furthermore, Yang and Shen create an index table for an original image and embed the vector quantization (VQ) of each block into the original image as a basis for recovery, which has higher probability of image recovery with a better qual-ity of recovered images [8]. Zhang et al. expand the secret data and embed them ran-areas are not more than 59% [9]. 
The above methods have good ability to recover the images that are tampered, espe-cially for the grey images. In this paper, we mainly focus on the recovery of color im-age. When a color image is generated from a camera, color filter array (CFA) interpola-sample the original color image into a grey image in the form of Bayer patterns, which areas. Then the reference data are extracted fr om the areas that are not tampered, and the tampered areas are recovered via CFA interpolation to the reference data. When embedding the secret bits into the original image for recovery, we first down-sample the original image into a grey im age. The imaging procedure in a camera includes the CFA interpolation, which is usually represented by the Bayer pattern [11]. The pattern is shown in Figure 1. 
Oppositely, we can also generate a grey image from an existing color image. For an channel according to the model of Bayer pattern [12]: generated using Equation (2). Remove three least significant bit-planes of D I , Rearrange the pixels in D to a new map D ' by two predefined integers p and q , p  X  [1, M ), q  X  [1, N ), where p and q will be kept by users as secret keys for self-recovery. 
Hence, each pixel of D' has 5 bits where D' with the total length 5 MN will be used as a reference for image recovery. three channels, Input S into a hash function to generate some binary bits, where n is the length of the binary outputs. The hash function must have strong colli-sion resistance that means it X  X  difficult to find any two different inputs correspond to the same output, like the algorithm MD5. 
For each block, we divide the binary outputs into 64 segments with the same length, and calculate the parity of each segment. Then we have 64 bits for each block, which will be used as authentication bits. This way, totally we have MN authentica-tion bits for the image I . 
The watermark is composed of the refere nce bits from D' and the authentication bits, the total length of which is 6 MN . Replace the two LSB layers of the image I with way, we obtain a watermarked image. Suppose there are no changes to the size of the watermarked image W on the receiv-ing side. Extract the hidden bits from the two LSB layers, from which we separate MN bits for authentication. Divide W into MN /64 non-overlapping blocks, calculate described during watermark embedding, and generate 64 new  X  X uthentication bits X  for judgment is virtually impossible. 
If some blocks are judged to be tampered, separate the reference bits from the ex-Equations (1) and (2). For the points in F that have been judged as tampered, replace them with the points in X , as shown in Equation (8). where ( i , j ) is the coordinate of the image. 
With the grey image F ', regenerate a color image by CFA interpolation as described in the literature [10] and [11]. For example, we consider the case of interpolating the missing green component g i , j from the existing values around. Calculate the horizontal where R m , n and G m , n denote the known red and green CFA components at position ( m , n ). Then the missing green component is interpolated as follows: More details are described in the literature [10]. To achieve more precise interpola-tion, the horizontal and vertical estimations are multiplied by weights according to CFA interpolated to the grey image F '. By replacing the tampered pixels in W with C , we finally obtain the restored image using Equation (12). Some experiments have been implemented to verify the proposed method. We use the test image from the Kodak PhotoCD library (sized by 512 X 768), one of which is shown in Figure 2 (a). We reconstruct the reference images by the scheme in [9] and the proposed scheme. Figure 2 (b) and (c) are cropped from both reconstructed im-ages for better comparison, where (b) corresponds to the scheme in [9] and (c) corre-sponds to the proposed scheme. It can be discovered that the image reconstructed from the proposed scheme is significantly clearer. 
Figure 3 (a) shows a watermarked image and the value of PSNR compared to the original image is 46.7 dB, which is impercep tible. (b) is the tampered version of the map, in which the white represents the areas  X  X ot tampered X  while the black repre-sents the  X  X ampered X . After self-recovering procedure, PSNR of the restored image shown in (d) is 40.5 dB. 
Figure 4 shows the result of an experiment is implemented on the image  X  X ena X  of size 256 X 256, which is compared with the methods in [7] and [8]. The values of PSNR posed method, as methods in [7, 8] uses 3 LSBs while we uses 2 LSBs. Values of PSNR of the self-recovered image decrease while the tampering rate gradually increase from 10% to 50%. As the methods uses grey image, we turn our restored image into grey and calculate the PSNR. Results show that our scheme has better recovery quality. accompanied with some hash bits generated from each block. The hash bits can be ex-tracted to authenticate whether the watermarked image is tampered. When regions are tampered, extracted information are used to regenerate a color image by CFA based interpolation, which is then used to recover the lost information of the watermarked image. 
Results show the method has better recovery quality, as our method is proposed ac-cording to the imaging algorithm of the digital imaging. The proposed scheme can also be used in the digital camera. After CCD catches the view, the Bayer patterns can be embedded into the image while the procedure of CAF interpolation happens. This work was supported by the Natural Science Foundation of China (60872116, 60832010, and 60773079), the Shanghai Natural Science Foundation (09ZR1412400), the Innovation Program of Shanghai Municipal Education Commission (10YZ11), and the Shanghai Postdoctoral Science Foundation (10R21413200). The authors are with School of Comm unication and Information Engineering, Shanghai University, China (corresponding author to provide phone: 86-21-56331551; fax: 86-21-56331964; email: zxqian@shu.edu.cn) 
