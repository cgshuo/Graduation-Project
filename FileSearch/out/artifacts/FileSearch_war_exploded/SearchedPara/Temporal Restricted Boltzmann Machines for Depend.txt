 There has been significant interest recently in ma-chine learning methods that induce generative mod-els with high-dimensional hidden representations, including neural networks (Bengio et al., 2003; Col-lobert and Weston, 2008), Bayesian networks (Titov and Henderson, 2007a), and Deep Belief Networks (Hinton et al., 2006). In this paper, we investi-gate how these models can be applied to dependency parsing. We focus on Shift-Reduce transition-based parsing proposed by Nivre et al. (2004). In this class of algorithms, at any given step, the parser has to choose among a set of possible actions, each repre-senting an incremental modification to the partially built tree. To assign probabilities to these actions, previous work has proposed memory-based classi-fiers (Nivre et al., 2004), SVMs (Nivre et al., 2006b), and Incremental Sigmoid Belief Networks (ISBN) (Titov and Henderson, 2007b). In a related earlier work, Ratnaparkhi (1999) proposed a maximum en-tropy model for transition-based constituency pars-ing. Of these approaches, only ISBNs induce high-dimensional latent representations to encode parse history, but suffer from either very approximate or slow inference procedures.

We propose to address the problem of inference in a high-dimensional latent space by using an undi-rected graphical model, Restricted Boltzmann Ma-chines (RBMs), to model the individual parsing decisions. Unlike the Sigmoid Belief Networks (SBNs) used in ISBNs, RBMs have tractable infer-ence procedures for both forward and backward rea-soning, which allows us to efficiently infer both the probability of the decision given the latent variables and vice versa. The key structural difference be-tween the two models is that the directed connec-tions between latent and decision vectors in SBNs become undirected in RBMs. A complete parsing model consists of a sequence of RBMs interlinked via directed edges, which gives us a form of Tempo-ral Restricted Boltzmann Machines (TRBM) (Tay-lor et al., 2007), but with the incrementally speci-fied model structure required by parsing. In this pa-per, we analyze and contrast ISBNs with TRBMs and show that the latter provide an accurate and theoretically sound model for parsing with high-dimensional latent variables. Our TRBM parser uses the same history-based probability model as the ISBN parser of Titov and Henderson (2007b): v t is a parser decision of the type Left-Arc , Right-Arc , Reduce or Shift . These decisions are fur-ther decomposed into sub-decisions, as for example P ( Left-Arc | v 1 , ..., v t  X  1 ) P ( Label | Left-Arc , .
 The TRBMs and ISBNs model these probabilities.
In the ISBN model shown in Figure 1, the de-cisions are shown as boxes and the sub-decisions as shaded circles. At each decision step, the ISBN model also includes a vector of latent variables, de-noted by  X  X  X , which act as latent features of the parse history. As explained in (Titov and Hender-son, 2007b), the temporal connections between la-tent variables are constructed to take into account the structural locality in the partial dependency struc-ture. The model parameters are learned by back-propagating likelihood gradients.

Because decision probabilities are conditioned on the history, once a decision is made the correspond-ing variable becomes observed, or visible. In an ISBN, the directed edges to these visible variables and the large numbers of heavily inter-connected la-tent variables make exact inference of decision prob-abilities intractable. Titov and Henderson (2007a) proposed two approximation procedures for infer-ence. The first was a feed forward approximation where latent variables were allowed to depend only on their parent variables, and hence did not take into account the current or future observations. Due to this limitation, the authors proposed to make latent variables conditionally dependent also on a set of explicit features derived from the parsing history, specifically, the base features defined in (Nivre et al., 2006b). As shown in our experiments, this addition results in a big improvement for the parsing task.
The second approximate inference procedure, called the incremental mean field approximation, ex-tended the feed-forward approximation by updating the current time step X  X  latent variables after each sub-decision. Although this approximation is more accurate than the feed-forward one, there is no ana-lytical way to maximize likelihood w.r.t. the means of the latent variables, which requires an iterative numerical method and thus makes inference very slow, restricting the model to only shorter sentences. In the proposed TRBM model, RBMs provide an an-alytical way to do exact inference within each time step. Although information passing between time steps is still approximated, TRBM inference is more accurate than the ISBN approximations. 3.1 Restricted Boltzmann Machines (RBM) An RBM is an undirected graphical model with a set of binary visible variables v , a set of binary la-tent variables h , and a weight matrix W for bipar-tite connections between v and h . The probability of an RBM configuration is given by: p ( v , h ) = (1 /Z ) e  X  E ( v , h ) where Z is the partition function and E is the energy function defined as: where a ble and latent variables respectively, and w symmetric weight between v ible variables, the latent variables are conditionally independent of each other, and vice versa: where  X  ( x ) = 1 / (1 + e  X  x ) (the logistic sigmoid).
RBM based models have been successfully used in image and video processing, such as Deep Belief Networks (DBNs) for recognition of hand-written digits (Hinton et al., 2006) and TRBMs for mod-eling motion capture data (Taylor et al., 2007). De-spite their success, RBMs have seen limited use in the NLP community. Previous work includes RBMs for topic modeling in text documents (Salakhutdinov and Hinton, 2009), and Temporal Factored RBM for language modeling (Mnih and Hinton, 2007). 3.2 Proposed TRBM Model Structure TRBMs (Taylor et al., 2007) can be used to model sequences where the decision at each step requires some context information from the past. Figure 2 shows our proposed TRBM model with latent to latent connections between time steps. Each step has an RBM with weights W smaller weight matrices corresponding to different sub-decisions. For instance, for the action Left-Arc , W tent vector and the sub-decisions:  X  X eft-Arc X  and  X  X abel X . Similarly, for the action Shift , the sub-decisions are  X  X hift X ,  X  X art-of-Speech X  and  X  X ord X . The probability distribution of a TRBM is: where v T steps 1 to T i.e. v 1 to v T . The notation for latent in the past time step that is connected to the current latent vector through a connection of type c . To sim-plify notation, we will denote the past connections { h (1) , ..., h ( C ) } by history t . The conditional distri-bution of the RBM at each time step is given by: p ( v t , h t | history t ) = (1 /Z ) exp ( X  where v t variable respectively at time step t . h ( c ) latent variable in the past time step, and w ( c ) notes the weight of the corresponding connection. 3.3 TRBM Likelihood and Inference Section 3.1 describes an RBM where visible vari-ables can take binary values. In our model, similar to (Salakhutdinov et al., 2007), we have multi-valued visible variables which we represent as one-hot bi-nary vectors and model via a softmax distribution: Latent variable inference is similar to equation 1 with an additional bias due to the temporal connec-tions. Here,  X  denotes the mean of the corresponding la-tent variable. To keep inference tractable, we do not do any backward reasoning across directed connec-for latent variables takes into account both the parse history and the current observation, but no future ob-servations.

The limited set of possible values for the visi-ble layer makes it possible to marginalize out latent variables in linear time to compute the exact likeli-hood. Let v t ( k ) denote a vector with v t v decision is: where Z =  X 
We actually perform this calculation once for each sub-decision, ignoring the future sub-decisions in that time step. This is a slight approximation, but avoids having to compute the partition function over all possible combinations of values for all sub-
The complete probability of a derivation is: p ( v T 1 ) = p ( v 1 ) .p ( v 2 | history 2 ) ...p ( v T 3.4 TRBM Training The gradient of an RBM is given by: where hi tion d . In general, computing the exact gradient is intractable and previous work proposed a Con-trastive Divergence (CD) based learning procedure that approximates the above gradient using only one step reconstruction (Hinton, 2002). Fortunately, our model has only a limited set of possible visible val-ues, which allows us to use a better approximation by taking the derivative of equation 5: Further, the weights on the temporal connections are learned by back-propagating the likelihood gra-dients through the directed links between steps. The back-proped gradient from future time steps is also used to train the current RBM weights. This back-propagation is similar to the Recurrent TRBM model of Sutskever et al. (2008). However, unlike their model, we do not use CD at each step to com-pute gradients. 3.5 Prediction We use the same beam-search decoding strategy as used in (Titov and Henderson, 2007b). Given a derivation prefix, its partial parse tree and associ-ated TRBM, the decoder adds a step to the TRBM for calculating the probabilities of hypothesized next decisions using equation 5. If the decoder selects a decision for addition to the candidate list, then the current step X  X  latent variable means are inferred us-ing equation 4, given that the chosen decision is now visible. These means are then stored with the new candidate for use in subsequent TRBM calculations. We used syntactic dependencies from the English section of the CoNLL 2009 shared task dataset (Haji X c et al., 2009). Standard splits of training, de-velopment and test sets were used. To handle word sparsity, we replaced all the (POS, word) pairs with frequency less than 20 in the training set with (POS, UNKNOWN) , giving us only 4530 tag-word pairs. Since our model can work only with projective trees, we used MaltParser (Nivre et al., 2006a) to projec-tivize/deprojectivize the training input/test output. 4.1 Results Table 1 lists the labeled (LAS) and unlabeled (UAS) attachment scores. Row a shows that a simple ISBN model without features, using feed forward infer-ence procedure, does not work well. As explained in section 2, this is expected since in the absence of explicit features, the latent variables in a given layer do not take into account the observations in the pre-vious layers. The huge improvement in performance on adding the features (row b ) shows that the feed forward inference procedure for ISBNs relies heav-ily on these feature connections to compensate for the lack of backward inference.

The TRBM model avoids this problem as the in-ference procedure takes into account the current ob-servation, which makes the latent variables much more informed. However, as row c shows, the TRBM model without features falls a bit short of the ISBN performance, indicating that features are indeed a powerful substitute for backward inference in sequential latent variable models. TRBM mod-els would still be preferred in cases where such fea-ture engineering is difficult or expensive, or where the objective is to compute the latent features them-selves. For a fair comparison, we add the same set of features to the TRBM model (row d ) and the per-formance improves by about 2% to reach the same level (non-significantly better) as ISBN with fea-tures. The improved inference in TRBM does how-ever come at the cost of increased training and test-ing time. Keeping the same likelihood convergence criteria, we could train the ISBN in about 2 days and TRBM in about 5 days on a 3.3 GHz Xeon proces-sor. With the same beam search parameters, the test time was about 1.5 hours for ISBN and about 4.5 hours for TRBM. Although more code optimization is possible, this trend is likely to remain.
We also tried a Contrastive Divergence based training procedure for TRBM instead of equation 7, but that resulted in about an absolute 10% lower LAS. Further, we also tried a very simple model without latent variables where temporal connections are between decision variables themselves. This model gave an LAS of only 60.46%, which indi-cates that without latent variables, it is very difficult to capture the parse history.

For comparison, we also include the performance numbers for some state-of-the-art dependency pars-ing systems. Surdeanu and Manning (2010) com-pare different parsing models using CoNLL 2008 shared task dataset (Surdeanu et al., 2008), which is the same as our dataset. Rows e  X  i show the per-formance numbers of some systems as mentioned in their paper. Row j shows the best syntactic model in CoNLL 2009 shared task. The TRBM model has only 1.4% lower LAS and 0.8% lower UAS com-pared to the best performing model. 4.2 Latent Layer Analysis We analyzed the latent layers in our models to see if they captured semantic patterns. A latent layer is a vector of 100 latent variables. Every Shift operation gives a latent representation for the corresponding and partitioned their representations into 50 clus-ters using the k-means algorithm. Table 2 shows some partitions for the TRBM model. The partitions look semantically meaningful but to get a quantita-tive analysis, we computed pairwise semantic simi-larity between all word pairs in a given cluster and aggregated this number over all the clusters. The se-mantic similarity was calculated using two different similarity measures on the wordnet corpus (Miller et al., 1990): path and lin . path similarity is a score between 0 and 1, equal to the inverse of the shortest path length between the two word senses. lin simi-larity (Lin, 1998) is a score between 0 and 1 based on the Information Content of the two word senses and of the Least Common Subsumer. Table 3 shows tent representations give a slightly better clustering than ISBN models. Again, this is because of the fact that the inference procedure in TRBMs takes into ac-count the current observation. However, at the same time, the similarity numbers for ISBN with features
Cluster 1 Cluster 2 Cluster 3 Cluster 4 contends expected bridging cause remarked thought tightening extended are not very low, which shows that features are a powerful way to compensate for the lack of back-ward inference. This is in agreement with their good performance on the parsing task. We have presented a Temporal Restricted Boltz-mann Machines based model for dependency pars-ing. The model shows how undirected graphical models can be used to generate latent representa-tions of local parsing actions, which can then be used as features for later decisions.

The TRBM model for dependency parsing could be extended to a Deep Belief Network by adding one more latent layer on top of the existing one (Hinton et al., 2006). Furthermore, as done for unlabeled images (Hinton et al., 2006), one could learn high-dimensional features from unlabeled text, which could then be used to aid parsing. Parser la-tent representations could also help other tasks such as Semantic Role Labeling (Henderson et al., 2008).
A free distribution of our implementation is avail-able at http://cui.unige.ch/  X  garg .
 This work was partly funded by Swiss NSF grant 200021 125137 and European Community FP7 grant 216594 (CLASSiC, www.classic-project.org).
