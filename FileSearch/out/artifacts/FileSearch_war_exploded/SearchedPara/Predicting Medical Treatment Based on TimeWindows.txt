 Weiwei Wang 1 , Hui Li 1 , Lizhen Cui 1 , Xiaoguang Hong 1 , 2 , and Zhongmin Yan 1 Recently, precision medicine is an important topic that means develop appro-priate model for different persons to predict health status and prevent illness. Electronic health records (EHRs), refers to the systematized collection of patient and population electronically-stored health information in a digital format, has been increasing as the development of computer technology.But there are some challenges of EHRs using such as EHRs have high dimensionality and noise[16]. How to mine useful information from EHRs is a tricky problem.
 when signs are coming, Such as early detection of heart failure[3] can give new opportunities for delaying or preventing progression to diagnosis of heart failure and reduce cost.. how to early detect attack of disease is a important problem. There are some methods that use traditional medical knowledge. When the scale of EHRs is becoming larger, this method becomes impractical. Other method use traditional machine learning model such as SVM (support vector machine), logistic regression and so on. These model have a certain effect but not very ideal.
 occurrence of disease. It is essential for patients even the public. For exam-ple,epidemic disease such as flu can quickly spread[7]. Early detection of a dis-ease outbreak is critical because it would allow faster communication between health agencies and the public, and try to reduce the impact of it.
 care, deep learning is most used for medical image recognition and get a good result[13]. Some model focus on prediction of one disease or an indicator of the body such as blood pressure[8]. Previous models such as don X  X  well handle with longitudinal records or focus on multiple diseases.
 medical treatment and which diagnosis will be got in a time windows using previous medical treatment records. As is shown, the model not only predict the possibility of a time windows but also give a diagnosis ranking that a patient may get. Some method focus on one diagnosis such as hypertension[12]. The contributions of the paper are listed as follows:  X  A deep learning model is represented for prediction of medical treatment  X  The result of experiment is shown that the deep learning model is better about disease prediction and deep learning technology about healthcare. Section 3 give a introduction of dataset and dataset processing. In section 4, a deep learning model based on RNN is presented for medical treatment possibility and diagnosis prediction. Section 5 shows and analyzes the results of experiment. Section 6 concludes the paper. This section introduces related works on disease risk prediction in a explicit time windows. Then we focus on deep learning model using in healthcare. 2.1 Disease Risk Prediction Disease risk prediction has been extensively studied. [1] propose a generalized additive models with pairwise interactions (GA 2 Ms) to predict pneumonia risk and Hospital 30-day readmission. GA 2 Ms consider pairwise interactions in fea-ture space. [2] uses RNN model to predict diagnosis and medicine codes in next patient visit and gives the time duration to next patient visit. [15] enhances the classical Support Vector Machine -Recursive Feature Elimination (SVM-RFE) approach to estimate disease risk from hospital discharge record data. 2.2 Deep Learning in Healthcare Deep learning have been a hot topic recently. Some people apply deep learning to the medical field and have achieved good results. The results are divided into supervised learning and unsupervised learning. Unsupervised learning contains autoencoders, deep brief network and so on.[11] propose denoising autoencoder-s to representation learning which called deep patient. Using deep patient can get better experiment results for disease prediction. [5] uses PCA and sparse autoencoders for learn feature representation to enhance cancer diagnosis and classification. [9] uses a modified version of convolutional deep brief network for large-scale data sets. Data from deep brief network have better result compared with the original dataset. Supervised learning have a lot of model such as RNN. [8] propose a model for predicting blood pressure using LSTM with a contextu-al layer. The model can predict diastolic BP and systolic using data collected from BP wireless home BP monitors. [10] focus on intensive care unit (ICU) to recognize patterns using clinical measurements. This section introduce the brief of dataset. Then time windows definition and data group is given. The whole process of data processing is shown in Fig.1. 3.1 Dataset Brief The complete dataset is from a province of China, which time interval is between December 15, 2006 and July 29, 2015, total 55 months. The number of records is more than 48 million. Each record contains patient number, patient visit number, diagnosis item, medical item, visit time and procedure. The number of unique medical items is more than 20000.
 are ICD10, some diagnosis codes are ICD9, even the others are missing or wrong. And medical items have the same problem as diagnosis. What the experiment need is medicine codes extracted from medical items. For diagnosis code, ICD9 codes are converted to ICD10 according to disease name and previous medical treatment records with the patients. For medicine codes, medical items are con-verted to medicine codes when it is match with Pharmacopoeia of the People X  X  Republic of China or filtered when it isn X  X . 3.2 Time Windows Definition Because of sparseness of visit records before January 1, 2011, the records be-tween January 1, 2011 and July 29, 2015 are selected. Here two time windows are defined: observation windows and prediction windows. In this dataset, ob-servation windows is between January 1, 2011 and July 29, 2015. The patients that take at least a medical treatment between January 1, 2011 and July 29, 2014 will be reserved. The number of medical treatment is shown in Fig.2. Al-most of patients take medical treatment within 20 times. And next 3-months, 6-months, 9-months, 12-months will be prediction windows, in which possibility of take a medical treatment and diagnosis will be predicted. The obtained dataset contains 28753 persons and 289471 medical treatment visits. It means that on average a person takes 10 times medical treatments. There are 1236 unique diag-nosis filtered from diagnosis items. Each diagnosis is identified by ICD10, which is a medical classification list by the World Health Organization. The number of medicine is 1096 matched with Chinese Pharmacopoeia and reserved from medical items.
 3.3 Diagnosis Grouping Because of high dimension of diagnosis, diagnosis codes are grouped by 3-digital ICD10 codes. It means that according to ICD10 codes, first three digital of each ICD10 codes is grouped, which on behalf of category of each diagnosis. For example, C16.901 is behalf of gastric stromal cell tumor, and the coarse-grained classification C16 is behalf of gastric malignancy. There are 588 unique groups called y that will be predicted. The reason of diagnosis grouping is reduce the impact of similar diseases and give a more accurate result. This section gives definition of problem. Then it introduces GRU units. Finally, the prediction model based on RNN is presented. 4.1 Problem Definition At first, the notations is listed in Table 1.
 treatment will be expressed as x t , in which i th medical treatment of a patient. The number of medical treatment is expressed by n . Each x t contains diagnosis codes and medicine codes, which is a multi-hot vector. The length of x t is sum of unique diagnosis codes and unique medicine codes. The 1 is behalf of a person gets corresponding diagnosis or takes corresponding medicine, 0 on the contrary. As mentioned above,the length of x t is 2332 summed by 1096 and 1236. 4.2 GRU Units The model implement RNN using GRU units[4]. The definition of simple RNN is shown in Formula 1, but the simple RNN is not applied to long time series data. t. GRU is selected instead of LSTM, because GRU can get almost same per-formance as LSTM[6], and the structure of GRU is simpler than LSTM. The following equations represent the process of parameter update.  X  represents the sigmoid function. z t stands for the update gate and r t stand for the reset gate.  X  h t stands for the intermediate memory unit. And tanh is the activation function of intermediate memory unit. h t is the output of GRU units. 4.3 Model Presentation The model is shown as Fig.3.The input of model contains two parts: diagnosis vectors d t and medicine vectors m t . These vector are multi-hot vectors. The vectors will be concatenated to a vector x t . The vectors will be input in time order. In order to speed up, a hidden layer is set to reduce the dimension and get hidden representation h 1 t . The model learns hidden representation h 2 t and h 3 t from time series records of patient using two GRU units. The output of model is divided into two parts. One part called p is to predict the possibility of next medical treatment in a time windows. The activation function of possibility pre-diction is softmax function. And the other part called y is to predict of diagnosis which patient can get. The activation of it is sigmoid function. The loss function consists of two parts: they are both cross entropy. The training process is make loss function reduced. The loss function of prediction model is defined as: a medical treatment and  X  y stands for relative likelihood of get diagnosis in the case of take a medical treatment. So reduce the loss function can improve the performance of the model.
 First, experiment setting is given. Then evaluation metrics are shown. Finally, we show the results of experiment. 5.1 Experiment Setting The dataset is divided by two parts: 85% of dataset is the training set and 15% of dataset is the test set. Cross validation was used in the experiment Dropout is used to avoid over fitting between recurrent units if length of recurrent units is more than one layer. Dropout[14] is also used in between recurrent layer and output layers. The idea of dropout is to randomly drop units (along with their connections) from the neural network during training. Using this can he performance of neural networks. Experiment set 100 epochs for training and earlystoping is used to the prediction model that can stop training when a monitored quantity has stopped improving. It shows that the experiment stopped early in 20 epochs.
 and 12 months. According to these time windows, the possibility of medical treatment and diagnosis is evaluated. 5.2 Baselines The experiment set some baseline: periment of LR use last medical treatment. LR a regression model where the dependent variable is categorical. hidden layer, and the output layer is linear regression model. The same as LR, MLP can X  X  support sequence input, here we use last time record as input. 5.3 Evaluation of Possibility Prediction Metric of possibility are AUC, accuracy, precision and recall. AUC is area of ROC curve. Accuracy is the number of correctly identified divided by the number of all persons. The precision is the number of correctly identified positives divided by the number of identified positive persons. The recall is the number of correctly identified positives divided by the number of all positive persons in the test set. Then, F-score is defined as: s is respectively shown in Fig.4. The AUC, accuracy, precision and recall are more than 0.8. Especially, AUC is almost 0.9, that indicates the possibility of predic-recall are all better than MLP and LR.
 window increases, the advantage of RNN model is more and more obvious. The RNN model all can get good result regardless of the size of the prediction window. 5.4 Evaluation of Diagnosis Prediction Metric of diagnosis prediction are top-k precision, which defined as: most likely diseases. Top-k precision is used to evaluate how the model can predict which diagnosis in a time windows. Doctors can follow this predict to give better advice for patients. The result of top-k precision is shown as Fig.6. As is shown, top-1 precision of the model is over 0.65 and top-3 precision is almost prevented the happening of coming diseases. In this paper, we propose a deep learning model based on recurrent neural net-work to predict the possibility of get medical treatment of which diagnosis will get. The model extracts features from sequential measurement data by using the hidden layers of recurrent structure. Using the model, some disease can be early detected, in this case patients can reduce pain and reduce cost. Doctors can get useful information from prediction information. For some infectious dis-eases, the public can also take early measures. The experiment uses dropout and earlystoping to avoid over fittong.The experiment shows that the model can get better effect than other methods in possibility and diagnosis prediction of medical treatment.
 This work is partially supported by the Science and Technology Development Plan Project of Shandong Province No.2014GGX101019, 2015GGX101007; the Fundamental Research Funds of Shandong University No.2015JC031; Shandong Province Independent Innovation Major Special Project No.2016ZDJS01A09.
