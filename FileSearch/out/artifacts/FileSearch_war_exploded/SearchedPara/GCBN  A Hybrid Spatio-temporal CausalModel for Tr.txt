 With the development of Intelligent Transportation Systems(ITS), more and more real-time traffic data such as sensor data or GPS data can be easily collected. It is clearly that these large amounts of real-time traffic data pro-vide a solid foundation for traffic speed predictions. There are various methods for traffic speed predictions such as auto-regression [5], Kalman filtering [7], Bayesian networks [14], etc. As discussed in [14], Bayesian network performs better than traditional methods in traffic prediction problems because it takes advantage of the spatio-temporal causal relations of road segments. However, learning the structure and parameters of the Bayesian network is difficult and time-consuming, which means it is difficult to use Bayesian network in a real-time system. To challenge this problem, we attempt to introduce the Granger causality test in the Bayesian network l earning. The Granger causality test [6] is a model for determining whether one event is useful in predicting another, aiming at mining the causal information among events. Comparing to the max-imum likehood method, the Granger causality test contains better information for predictions as its definition implies.

In a word, we present a new hybrid method called GCBN (Granger Causality based Bayesian Network) for traffic speed prediction based on Granger causality tests and Bayesian networks. Firstly, we perform Granger causality tests to dis-cover the spatio-temporal causal relations and magnitudes among road segments of the traffic network. Secondly we transform the causal relations into a binary Bayesian network to predict the probability of the speed variation for a specific segment. Thus, the predicted continu ous traffic speed is estimated based on a linear model.

The rest of the paper is organized as follows. In Section 2, we introduce the preliminary concepts and definitions in this paper. Section 3 shows the key point of our algorithm in detail, that is, how to perform traffic speed predictions. The integrated model is shown in section 4. S ection 5 presents the experiments and discussions. Section 6 gives our conclusions. 2.1 Granger Causality Test In this paper, we consider the causality is time constrained. That is, C t causes E t +1 if and only if p ( E t +1 t related to E in t +1, meaning the cause is ahead of the effect. And the magnitude
Granger causality[6] is first proposed by Clive Granger, the Novel prize winner in the area of econometrics, which is based on the intuition that a cause helps predict its effects in the future. For example, a time series C is said to Granger causes E , if the error of the auto-regressive model for E in terms of past values which indicates the existence of some formal transformations between the prob-ability and Granger causality.

The Granger causality test does not i ndicate the causal effect is positive or negative correlative directly. That is, the result of the Granger causality test does not tell us an increase(decrease) in a ca use in the past increa ses or decreases its effect in the present [2][4]. But in [2], the author suggests to use the sum of the jointly significant Granger coefficients to estimate the direction of variation or the sign of the causal relation.

Note that the Granger causality test is another attempt to define the causal-ity, it is certainly not meant to be equivalent to the true causality [1][10]. But actually, the Granger causality test was successfully adopted by researchers in economics [2][6], neuroscience [3], climat e [11] and Internet [9] to help get better understanding. 2.2 Problem Definition Definition 1. The Traffic Network: The network TN consists of n segments can be divided according to intersections or toll stations. For convenience, in the following paper, a segment means one segment with a specific direction, then we rewrite TN = { s 1 , ..., s n } ,where n =2 n .
 Definition 2. Speed Variational Rate: The quotient between | x i t +1  X  x i t | and thetimeinterval t and VT is the highest allowable speed.
 a speed-based vector, a time series de scribing the varying traffic speed with respect to s i ,where t is the current time interval. Let W t be the causal matrix, where w ji t  X  0isthe j th column and i th row element of W t ,representingthe magnitude that s j causes s i discovered from X .Let G t =( V t , E t ) be a directed and weighted causal graph based on W t ,where V t is a set of nodes representing n segments and E t is a set of edges representing cau sal relations associated with w t . Our main problem is how to take full advantage of G t to construct a binary Bayesian network for predicting the speed variational rate q ( s i t )moreefficient and i =1to n . Generally, for predicting the speed variational rate q ( s i t ), traditional Bayesian networks can be applied as well. Since q ( s i t ) is continuous, building a Bayesian network with continuous variables is required. For this purpose, one can assume the nodes are Gaussian and the joint probability distribution is GMM, then adopt the EM algorithm to learn the structure and parameters. However, as dis-cussed above, the traditional Bayesian network approach faces problems such as complexity, inefficiency and unreliability. In this paper, we address these prob-lems and present another method to build a Bayesian network for prediction with lower cost.

Suppose the current time interval is t , the basic form in our model to predict the speed variational rate in t +1 is shown in figure 1. The parents of a node can be itself(endogenous) or others(exogenous). In detail, after Gran-ger causality tests given the dataset X from 1 to t (discussed in Section 4), there are h i segments found as causes of s i , which means these h i segments are parents of s i according to the Bayesian networks X  interpretation. We denote them as  X  i .Thenwehave  X  i = { s 1 , .., s j , .., s h i } , |  X  i | = h i .

The feature of our model is discrete. We discretize the continuous speed variational rate q ( s i t ) into binary, that is 0 and 1 denoting the minimum and maximum, respectively. Then, the comple xity of the model is greatly reduced. Thus, the observational probabilities and the binary conditional probability ta-ble(CPT) are necessary in our model.

Firstly, since the traffic speeds of current and previous time interval are known to us, we can estimate the speed variational rate of each parent node. For the that is: where VT is the highest allowable speed which is set to 120km/h in data pre-processing. The meaning of (1) is that the higher speed variational rate, the higher probability of reaching the maximum.

Secondly, the CPT is estimate d as follow. According to D  X  Separation and the definition of time constrained causality, although s i in t + 1 is not independent of s j in t , they are independent in the same time interval t . Therefore, s j t is independent of each other for j =1to h i . Then, we can use a specified function such as linear function or exponent function to model the CPT, by the linear weighted superposition assumption. Due to the limit of space, here we only use conditional multinomial distribution [12](also known as softmax )tomodelthe CPT. denoting all kinds of binary combinations of q ( s j t )for j =1to h i orderly. And  X  t is the offset factor, w than 0 remain. For example, when h i =2andset Z = 2 h then the CPT is estimated as table 1 shows. Therefore, according to the Bayesian networks X  theory, we can have: Then, q ( s i t +1 ) can be calculated as: [2], the direction of variation or the sign of the causal relation can be estimated by the sum of the jointly significant Granger coefficients. Therefore, we can derivate: where  X  ji l is the Granger coefficient, and k is the maximal lag in the Granger causality test(discussed i n Section 4). Then, we can compute the predicted speed  X  x where sign ( U )=1if U  X  0, sign ( U )=  X  1otherwise. As we have presented the key point of our method in the above paper, in this sec-tion, we would like to illustrate the integrated model. After data pre-processing, causal information generation and Bayesian network construction are the two main tasks. 4.1 Causal Information Generation Since the speed-based vectors are time seri es themselves, Grang er causality tests are excellent to discover the causal relations among segments and then generate the causal information, including W t and G t .

Suppose there are h i segments have direct spatial relations to s i .Thatis,if s j has direct spatial relation to s i , then it is reachable from s i to s j or from s j to s i without any other segments in the network. Specially, a segment has direct spatial relation t o itself. We denote these h i segments as  X  i . Then, for mining the causes of s i , the Granger causality test is performed by conducting the following regressions: where  X  i t is an uncorrelated white-noise series and k is called maximal lag, the number of past data points that are used to predict the current data point in t . Ideally k can be equal to infinity, but in practice, k is usually finite and more smaller than the length of given time series. Generally, the best k can be decided by BIC or AIC criterion, or simply by user -setting. Next, the F-test is performed where the null hypothesis is s j does not Granger causes s i ,thatis,  X  ji l =0for l =1to k . Then, the p value obtained from F-test can tell us whether or not the null hypothesis is established. If not, then, we can obtain the result that s j Granger causes s i given the historical data from 1 to t . Moreover, we can measure the magnitude of Granger causality by the log ratio of the prediction error [13], so: When j = i , it means the general Granger causality. When j = i , the causality is called Granger autonomy [13], that is, to identify if s i Granger causes itself. In other words, Granger autonomy means the traffic speed of s i is affected by its own past besides others X  related to it. In particular, if s j does not Granger causes s i given the historical data from 1 to t , w ji t is set to 0.
Then, the causal graph G t based on W t can be built after Granger causality tests. Figure 2(a) shows an example of Granger causal graphs. Furthermore, a chart of Granger causal flow [8] is helpful to illustrate the causal relations in another way by calculating the result of the weighted out-degree minus weighted in-degree. For example, the causal flow of Node s 4 in figure 2(a) is 3+3  X  (1+3) = 2. The nodes with positive or negative flow is called sources or sinks. The bigger sources or sinks are worth paying more attention as they are usually the main causes or the main effects of incidents. 4.2 Bayesian Network Construction Granger causal graphs do not consider the temporal dimension. Therefore, most of time Granger causal graphs are only used to make a further understanding qualitatively as figure 2 shows, but not used to make predictions quantitatively. Since the cause is ahead of its effects, we can assume the delay time is equal to the user-set time interval such as fifteen minutes to one hour. Under this view, we can attach a temporal attribute to each node in the graph, and transform the graph into a Bayesian network for prediction. Figure 2(b) illustrates this idea when we observe the traffic status in t and would like to make predictions in the future. And the model for prediction is already discussed in Section 3. 4.3 GCBN Here we summarize our model GCBN, des cribed in Algorithm 1. Since the data pre-processing procedure is not the main point in this paper, we just consider the input as a set of GPS data of size N after data pre-processing procedure collected in t ,where t is the current time interval. The time complexity of GCBN can be analyzed as follows: (a) In step 1, we need O ( N ) operations to analyze the data quantity and generate the speed-based vectors. (b) In step 2-13, the main step is is needed to execute vector autoregression |  X  | +1 times 1 .Since n  X |  X  | and m k in practice, the overall time complexity of GCBN is MAX ( N,n  X  m  X  k 2  X  X   X  | 3 ). This suggests our method can be applied in different network of diverse scales andusedinanonlinesettingwhenweset m and k appropriately.
 Algorithm 1. GCBN In this section, we report the empirical analysis and prediction evaluation of our model on real traffic GPS data collected by traffic agencies. 5.1 Setting In this paper, we focus one of the most important regions of the freeway network in Guangdong province, China. The raw traffic GPS data for experiment are generated by 89007 probe vehicles from March 1, 2010 to July 31, 2010, and the data quantity reaches 5113503 totally. We set 1 time interval as 15 minutes, then the average data quantity of a segment in a time interval is 10. We define the maximal length of time series as 432 time intervals(3 days) for Granger causality tests. The maximal lag is selected by BIC. And we set offset factor  X  =0. 5.2 Causal Analysis We set the system update frequency as 24 time intervals(6 hours) and run GCBN from March to July. Besides, for better comparison, we also use Bayes Net Tool-box 2 to learn a traditional Bayesian network(TBN), where Gaussian distribu-tions are used to model continuous-valued nodes. Figure 3. shows the graphs for five months, generated by GCBN and TBN respectively. For TBN, it is frequent that one segment is independent to other segments in our experiment, even itself in previous time, and then the existent probabilities of edges are much lower. As for GCBN, the darker colors of edges indicate that, with Granger causality tests, GCBN can find more causal patterns than TBN when learning the struc-ture every time, which means GCBN can use more advantageous information to predict the traffic speed better.

Figure 4 shows the charts of Granger causal flow for each month and all months in GCBN. We can see that the segments with higher causal weight lie between two main intersections, the cl oser to the inters ection, the higher causal weight as a whole. That means those segments are sources and it is at higher risk when congestion occurs in those segments. On the other hand, the sinks are up streams of sources. Then, the main causal pattern is that segments around the intersection causes their up streams, which is reasonable because the traffic stream is from upstream to downstream and congestion in upstream will block the stream. Besides, the causal pattern is stable for each month, which means the causalities or autonomies are reliable. Therefore according to the above discussion, with the help of charts of Granger causal flow, we can locate the key causes and effects more convenient. 5.3 Prediction Evaluation Here, we evaluate our method GCBN to predict the traffic speeds comparing with auto regression(AR), Kalman filter(KF) and the traditional Bayesian net-work(TBN).

For investigating the performance of our method, tests are performed on the following two evaluation metrics: Root Mean Square Error (RMSE). RMSE [14] is widely used to quantify the difference between the predicted values and the true values, which is defined as: Root Mean Square Error with Cost(RMSEC). In the congestion predic-tion problem, it is intuitive that the cost is much bigger when we don X  X  predict true congestion than when we predict false congestion. Thus, in the speed predic-tion problem, the cost is much bigger if any predicted error occurs when the true traffic speed is lower. Therefore, we set u p a cost matrix for better evaluating the accuracy of prediction: Predicted Result Analysis. In this experiment, we first focus on 3 important holidays in China as rush hours. The result in figure 5 shows that our method GCBN outperforms AR, KF and TBN on all the two evaluation metrics. Espe-cially, on RMSEC, our method GCBN achieves 17.71%, 40.42% and 35.74% rel-ative improvements compared with AR, KF, TBN respectively, which indicates the good performance of GCBN to predict the traffic speed when the probability of congestion is higher. Secondly, we ra ndomly select 30 moments from March to July. GCBN shows better performance as well. As a whole, our method performs better than AR, KF , TBN on RMSE, RMSEC at both ordinary and specific times.

Figure 6(a) shows the predicted results of four methods with respect to s 1 for ten time intervals, and the observed speeds of s 1 and s 3 are also shown in the figure. As we can see, GCBN discovers the spatio-temporal causal relation between s 3 and s 1 , which makes GCBN predict the traffic speed of s 1 in the sixth time interval much more accurate than others. This suggests that our method is more sensitive to the spatio-temporal causal relation among segments than TBN, which brings great benefits to the traffic speed or congestion prediction, especially when the probability of congestion is higher.
 Computational Complexity Analysis. Figure 6(b) presents the comparison of computing time for four methods. AR X  X  computing time of learning or pre-dicting is least as it is the most simple method in our experiment. Compared to KF and TBN, our method X  X  computing time is much smaller because our method can learn the structure and parameters at the same time and there is no any iterative process in our method. Figure 6(c) presents the computing time of GCBN for learning or predicting under different number of segments. When the number of segments increases, the computing time of GCBN grows almost linearly. And the analysis of computational complexity in Subsection 4.5 shows our method only need linear time to analyze the data quantity and generate the speed-based vectors, which indicate s our method can be applied in different network of diverse scales and used in an online setting. In this paper, we present a new hybrid method called GCBN for both traffic anal-ysis and prediction based on Granger causality tests and Bayesian networks. Firstly, for reducing the complexity of the model and reflecting the essential causal relations in traffic network, we propose to predict the probability of the speed variation for a segment by a binar y Bayesian network. Secondly, we intro-duce the conception and methodology of Granger causality from the economics field, and adopt the Granger causality test to determine the structure and pa-rameters of the Bayesian network. In comparison with three methods, GCBN demonstrates excellent performance as Gra nger causality tests can help discover the spatio-temporal causal relations among segments more accurate. Besides, the analysis of computational complexity shows, the operations grows almost linearly when the number of segments increase and our method can be applied in different network of diverse scales and used in an online setting. Acknowledgements. This work is supported by the Fundamental Research Funds for the Central Universities under Project No. 12lgpy40 and Guangdong Natural Science Foundati on under Proj ect No. S2012010010390.

