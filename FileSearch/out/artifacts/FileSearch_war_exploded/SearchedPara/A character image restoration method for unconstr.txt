 ORIGINAL PAPER Yunxue Shao  X  Chunheng Wang  X  Baihua Xiao Abstract Despite the success of methods on constrained handwriting databases, recognition of unconstrained hand-ficulty for recognizing unconstrained handwritting is that some connected strokes are involved or some strokes are is proposed for unconstrained handwritten Chinese character acters. To show the effectiveness of the proposed method, mated features. Experimental results show that the extended further improving the recognition rate.
 Keywords Character image restoration  X  Unconstrained handwritten Chinese character recognition  X  Similar character discrimination 1 Introduction The problem of handwritten Chinese character recognition many applications. A lot of methods have been proposed, and very high recognition rates have been obtained on most of tion. At the character normalization stage, many methods have been proposed to reduce the within-class shape varia-nonlinear normalization (NLN) based on line density equal-used in most HCCR systems with success. Compared with linear normalization, the NLN largely reduces the within-class shape variation. To overcome the insufficient shape restoration capability of one-dimensional methods, Hori-uchi et al. [ 8 ] proposed a pseudo 2D nonlinear normaliza-tion (P2DNLN) method by equalizing line density functions of each row/column instead of the line density projections. Although this method is more effective than NLN, it is com-putationally expensive. A more efficient pseudo 2D normal-polation (LDPI) [ 9 ], is proposed. This method achieves a comparable performance with P2DNLN while the computa-tional complexity is much smaller.

At the feature extraction stage, a large variety of meth-can be measured from the skeleton [ 16 ], chaincode [ 1 ]or performance and the ease of implementation. Previous stud-improved version, the normalization-cooperated chaincode feature (NCCF) [ 17 ] and the normalization-cooperated gra-that the NCGF outperforms both the normalization-based gradient feature (NBGF) and the normalization-cooperated chaincode feature (NCCF) in most cases.

After character normalization and feature extraction, clas-usually applied to HCCR. The most popular one is the modi-fied quadratic discriminant functions (MQDF1 and MQDF2) proposed by Kimura et al. [ 1 ]. The MQDF improves the generalization performance via replacing the eigenvalues in the minor subspace of each class with a constant. Besides MQDF1 and MQDF2, the pseudo-Bayes classifier [ 22 ], asymmetric Mahalanobis distance (MD) [ 23 ], determinant normalized QDF [ 24 ], MQDF3 [ 25 ] and DLQDF [ 4 ]are some other improvements of QDF, and comparable perfor-mance are achieved.

To further improve the recognition rate, many pair-often combined with a baseline classifier (MQDF is usu-compound Mahalanobis function (CMF) method, proposed sures with the class-wise Mahalanobis distance. Gao and Liu [ 2 , 27 ] proposed a LDA-based compound distance to dis-criminate similar character pairs. They showed that under restrictive assumptions, the previous CMF is a special case of the LDA-based compound distance method. Their experi-ments demonstrated that the LDA-based compound distance method outperforms the previous CMF methods. Leung and tackle the problem of similar character classes. Additional features are extracted from these critical regions and used posed an average symmetric uncertainty (ASU)-based criti-method, which emphasizes the difference between confus-of this method is that it expands important regions at the normalization stage and therefore does not suffer from the information loss during the feature extraction stage. Shao based method for further improving the performance. In this method, the self-generation samples are used for training a more stable MQDF classifier at the training stage and are used for voting at the recognition stage.

Despite the success of these methods on the constrained handwriting databases, the recognition of unconstrained handwritten Chinese characters remains a big challenge. The National Laboratory of Pattern Recognition (NLPR) in the Institute of Automation of Chinese Academy of Science (CASIA) has built new databases of unconstrained Chinese databases reveal the challenge of both isolated character recognition and handwritten text recognition. We only con-problem in this study. The unconstrained handwritten data-base CASIA-HWDB1.1 (DB1.1 in brief) is used in this study. Figure 1 shows some samples from DB1.1 and some samples from a constrained database (CASIA). As shown in Fig. 1 , that some connected strokes (marked with red) are involved or some strokes are omitted (marked with green). In this paper, a character image restoration method is proposed for unconstrained handwritten Chinese character recognition. In this method, the observed character image is modeled as the combination of the ideal character image with two types of noise images, which are denoted as the omitted stroke image and the added stroke image. To preserve the original gradi-acters. To show the effectiveness of the proposed method, mated features. For example, we extend the MQDF method in Sect. 4.1 , and the resulted compound MQDF (CMQDF) method outperforms MQDF and CMF methods. We also extend two typical confusion pair discrimination methods (LDA [ 2 ] and SVM [ 35 ]) in Sect. 4.2 , and experimental results show that the extended methods (RLDA and RSVM) outperform the original methods. This demonstrates that the proposed method is useful for further improving the recog-nition rate.

The rest of the paper is organized as follows. First, the related works are reviewed in Sect. 2 . Then, the character image restoration method is proposed in Sect. 3 . Section 4 gives the extended classifiers based on the estimated fea-conclusion is given in Sect. 6 . 2 Baseline methods A character recognition system generally consists of three major components: character normalization, feature extrac-used in our system is given in this section. 2.1 Character normalization posed in [ 34 ]. Foreground gray levels are normalized to a ferent images. The mean and standard deviation of the orig-pixel gray value f ( s , t ) is transformed to f ( s , t ) f ( s , t ) =  X  f p ( s , t ). (1) The constraint to map three values { 0 , m , m + 2  X  } to { 0 , m  X   X   X   X   X   X   X  p =  X  = m 0
Generally speaking, character normalization is to align the the within-class shape variation. The input image and the normalized image are denoted as f ( s , t ) and g ( r , c tively. Normalization is implemented by coordinate mapping r = u ( s , t ) c = v( s , t ). lated to generate the normalized image g ( r , c ) = f ( s
In this paper, line density equation-based methods (NLN) lation (LDPI) method are used. Line density equalization-based methods need to compute the density  X  of the input image first. Then, the mapping function is obtained by line density equalization  X   X   X   X   X  r = W 2 u ( s ) = W 2 s c = H 2 v( t ) = H 2 t with  X   X   X   X   X   X   X   X   X   X   X   X   X  h u ( i ) = h v ( j ) = sum = H 1 where W 1 and H 1 are the width and height of the original image, and W 2 and H 2 are the width and height of the nor-malized image. Yamada et al. defined the line density as an imum of the inverse values of L x and L y  X ( i , j ) = and y -direction, respectively. The value min { L x , L y seen as a roughly approximated diameter of the inscribed circle at each point.

Liu and Marukawa [ 9 ] proposed an efficient pseudo 2D interpolation (LDPI). LDPI partitions the 2D line density map into soft strips. One-dimensional coordinate functions are computed from the density projection of each strip and combined into a 2D function. The line density map  X  x ( i is partitioned into three horizontal strips: ( i , j ) = w k ( j ) X  where w k ( j ) are  X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X  w 1 ( j ) = t w w 2 ( j ) = 1  X  w 1 ( j ), j &lt; y w 2 ( j ) = 1  X  w 3 ( j ), j  X  y w 3 ( j ) = t w domain [0,1]: t ( x ) = The three strips are used to compute three 1D coordinate coordinate mapping function r ( s , t ) : r ( s , t ) = Similarly,thevertical2Dcoordinatemappingfunction c ( s , t can be computed. 2.2 Feature extraction is computed by  X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X  f  X  x  X  f  X  y The nonlinear mapping functions are denoted as r = u ( the preprocessed image  X  f  X  x ,  X  f  X  y ,  X   X   X  The gradients are then decomposed into eight chaincode from the eight direction planes by blurring and down-sampling. 2.3 Classification Handwritten Chinese character recognition is a large cat-egory classification problem. There are more than 90,000 Chinese characters. The most commonly used 3,755 char-acters (in the level-1 set of GB2132-80) are usually taken Generally,classifiersforsubsetsofclassescanbetterdiscrim-In this paper, the Euclidean distance from input sample to such as CMF-and LDA-based compound distance method the top candidate given by MQDF is taken as the recognition result.

The MQDF of Kimura et al. [ 1 ] has been widely applied to handwritten Japanese and Chinese character recognition with further improve the recognition rate, CMF-and LDA-based discriminate similar character pairs. 2.3.1 MQDF The input character pattern is denoted by a n -dimensional and i are the class mean and covariance matrix, respec-the covariance matrix, two forms of modified QDFs (MQDF1 and MQDF2) are adopted. MQDF1 is given by:
H ( x , X  where h 2 is a constant and  X  m and  X  m , m = 1 ,..., n are (  X  MQDF2 is employed in this paper. 2.3.2 CMF The CMF [ 26 ] method combines the modified quadratic dis-criminant function (MQDF) and the Mahalanobis function (MF) to further improve the performance. In MQDF, the minor eigenvectors of each class are totally canceled out. The Mahalanobis function makes use of these minor eigen-vectors to further discriminate confusion pairs. Similar to MQDF, the minor subspace is implicitly represented by the principal eigenvectors, and the minor eigenvectors are not necessarily stored.

To discriminate two classes  X  i and  X  j , the CMF method calculates a compound distance measure for each class. With respect to  X  i , the CMF is formulated as H where H MQDF ( x , X  i ) is the MQDF distance between x and subscript  X  X D-CMF X  means the Mahalanobis distance (MD) used in the CMF method. Note that the added MD and the baseline MQDF are computed in the same feature space. The Mahalanobis distance is calculated by CMF distance. 2.3.3 LDA-based compound distance The CMF method projects the input feature vector onto an covariance of one class only. Gao and Liu proposed a linear discriminant analysis (LDA)-based compound distance [ 2 ] to improve the separability of confusion pairs. This method considers the covariance matrices of both classes, and the rion. By LDA, the optimal discriminant vectors are obtained as w =  X   X  1 and can be rewritten as  X  So the projection axis w can be calculated by w =  X   X  1 In calculating w , the minor eigenvalues of  X  ij tend to be underestimated as in MQDF. For this reason, whenever an calculated by b = a where the constant a is selected empirically. In our exper-confusion pair, the vector w is calculated by Eq.( 19 ) and tionary.

At the classification stage, the LDA-based compound dis-tances are computed by where the Mahalanobis distance (MD) used in the LDA-based method is computed by H  X  calculated by  X  x = x T w  X   X   X   X  2 is the variance in one-dimensional subspace for class  X  space with H MQDF .Asshownin[ 2 ], H MD-LDA built from the the same feature space with H MQDF which is built from the built the H MD-LDA from the original feature space. 3 Character image restoration Many problems in image processing and computer vision are in a dire need for prior models of the images they han-damaged or modified. Armed with a good generic image such a transformation is the linear degradation model f = Tg + n (24) imaging system and n is the white Gaussian noise.
In general, information provided by the data alone is not sufficient to determine g with acceptable accuracy. Conse-quently, some a priori information or assumption about the that the ideal image can be estimated by adding or remov-ing some stroke pixels from the observed image. These two operations correspond to two different noises. The one is observed j th image in the i th class is denoted as f i , as f , j ( s , t ) = g i , j ( s , t )  X  o i , j ( s , t ) + a s.t. o i , j ( s , t )  X  0 , a i , j ( s , t )  X  0 . first column is the observed image, the second column is image and the last column is the added stroke noise image. consuming.Inthisstudy, o i , j ( s , t ) and a i , j ( s , separately, and the two estimated images g o and g a can be computed by
To estimate the omitted stroke noise image, a question needs to be answered: What is the probability that a back-noise image, we need to answer the question: What is the to a background pixel on the ideal image? If we know what can be estimated by training samples in that class. g f can be estimated by o a Substituting Eqs.( 27 ) and ( 28 )inEq.( 26 )gives observedcharacterimagesarebinaryimageorpseudo-binary image which means that if f i , j ( s , t )&gt; 0 then f i each other (the preprocessing step in Sect. 2.1 guarantees this); therefore, f i , j ( s , t )  X  1 + P ( g i , j ( s be seen as the translation of P ( g i , j ( s , t ) | f i class. Then, P ( g i , j ( s , t ) | f i , j ( s , t )) = Substituting Eq.( 31 )inEqs.( 29 ) and ( 30 )gives g g Figure 4 shows some examples of the estimated images. third column is the image estimated by removing the added stroke pixels and the last column is the ideal image. From and some omitted strokes are added. However, the estimated tive at hand. Hence, for each estimation, we hope to keep the gradient of the unchanged pixels in the observed image unchanged. Therefore, we apply the estimation process on the gradient direction planes of the observed image. The estimated gradient direction planes can be used to extract the gradient feature directly.
 0 ,..., 7 as the estimated eight direction planes, O t GO t and GA t can be computed by gradient between background pixel and stroke pixel is much the noise planes can be computed by
GO t i , j ( s , t ) =
GA t i , j ( s , t )  X  planes, M Equations( 35 ) and ( 36 ) are equal to  X   X   X   X   X  on the other hand, it omits some gradient at this pixel and we should compensate for it. The estimation GA t i , j ( s gradient at this pixel and we should eliminate it. Based on these explanations, we use = instead of  X  in Eq.( 38 ), and from now on, we compute the estimated features according to these ideas. If we make the restoration on the smoothed and downsampled eight direction planes, then this process f Eq.( 38 ), the estimated feature vectors v o i , j and v a computed by 4 Classification based on restoration In this section, we suppose that the estimated features are computed in the way proposed in Sect. 3 , and we extend to show the effectiveness of the proposed method. As we nationmethodsaccordingtowhetherconfusionpairsareused confusion pairs at the training stage. Methods such as LDA-methods need to check whether the two candidate classes compose a confusion pair or not. If they do, then use the pretrained classifier to discriminate them. Another type of discrimination method does not need to determine confusion pairs, they try to enhance the classification model or make full use of the current information. Methods such as CMF In the extended classifiers, the CMQDF method belongs to the second type and the RLDA and RSVM methods belong state-of-the-art methods in the same type, then we can say that the estimated features provide discriminative informa-tion for the two types of methods.
 4.1 Compound MQDF distance Denote x i , j as the j th pattern in the i th class and m LDA transformation matrix learned from samples x i , j , x computed by  X   X   X   X   X   X   X  y fiers H b MQDF ( y , X ), H o MQDF ( y , X ) and H a MQDF ( y tively. From now on, the superscript b means that the clas-sponding transformed features y i , j .
 formed into a feature vector y by L . Then, y is classified ing the compound distance between x and class,  X  i , x o  X  x are then transformed into y o  X  tively. Then, y o  X  crimination classifier is the compound distance function H satisfies min This method is denoted as CMQDF in this paper. 4.2 Confusion pair discrimination Most of the confusion pair discrimination methods can be extended based on the proposed method. As an example, nonlinear classifier (SVM) to demonstrate the effectiveness of the proposed method.

For each confusion pair  X  i and  X  j , x i , t and x j , t tors of  X  i and  X  j , respectively. Denote x o i , t and x the restoration feature vectors of class  X  j . Treat x o i train a two-class classifier H o MD-LDA using the LDA-based method. Similarly, another two-class classifier H a MD-LDA be trained.

To discriminate two classes  X  i and  X  j , the LDA-based method calculates a compound distance measure for each class, which is formulated as H In a similar way, we can calculate two compound distances for each class based on the two restoration features. Joining these two compound distances and the base MQDF, the confusion pair discrimination classifier H RLDA ( x , X  can be computed by H final LDA-based discrimination method based on restoration features is computed by H This method is denoted as RLDA in this paper.

In a similar way, if a SVM classifier is adopted, three SVM parameters except C and g are the default values used in LIBSVM. The parameters C and g are selected by ten-selected from { 0 . 0000025 , 0 . 000005 , 0 . 0000075 , 0 0 . 000025 , 0 . 00005, 0 . 000075 , 0 . 0001 , 0 . 00025 , 0 0075 , 0 . 001 , 0 . 0025 , 0 . 005 , 0 . 0075, 0 . 01 , 75 pattern x is classified by H RSVM ( x , X  i ) : H where x o and x a are the restoration features using m i . x , method is denoted as RSVM in this paper. In our experi-ments, the linear kernel and RBF kernel are adopted when training SVM models. 5 Experimental results We evaluated the state-of-the-art methods and their corre-sponding extended methods on the DB1.1 database [ 33 ], which is built by the National Laboratory of Pattern Recog-nition, Institute of Automation of Chinese Academy of Sci-background pixels labeled as 255. As suggested by the orga-baseareshowninFig. 6 .

To enable the evaluation of machine learning and classi-vide the feature data of DB1.1. This dataset can be down-loaded at http://www.nlpr.ia.ac.cn/databases/handwriting/ comparison and implementation, we evaluated and compared feature dimension used in the MQDF classifier is fixed as 160.

Firstly, to see whether restoration on the gradient planes (RoP) differs much with restoration on the feature vectors (RoF)ornot,weevaluatedtheperformanceofCMQDFbased normalization method is used, and the 8-direction gradient planes are extracted by the NCGF method. Table 1 presents the recognition results with varying number of eigenvectors k used in MQDF2. From this table, we can see that RoF and RoP give similar performance while RoF needs less memory and computation. Therefore, the following experiments only evaluate the RoF-based methods.

Next, to see whether the proposed method works with dif-ferent normalization methods, we evaluated the performance of CMQDF based on different normalization methods. Based malization methods: NLN and LDPI are employed in this experiment. Table 2 presents the recognition results with a varying number of eigenvectors k used in MQDF2. From this table, we can see that the proposed method performs well both on 1D nonlinear (NLN) and pseudo 2D nonlinear normalization (LDPI) methods. Recognition rates of 89.18 and 90.01% are achieved by them, respectively.
 we compared the extended classifiers with the state-of-the-extended classifiers, the CMQDF method does not need to determine the confusion pairs, and we compared it with the CMF and MQDF methods to show that the CMQDF method not only outperforms the baseline MQDF method, but also outperforms the CMF method which also does not need to determine the confusion pairs. The RLDA and RSVM meth-ods need to determine confusion pairs, and we compared them with LDA and SVM, respectively.

In this experiment, we first did not determine the candi-date confusion pairs and compared the CMQDF with CMF method which belongs to the second type. The parameter k used in MQDF and CMQDF is fixed as 40. Results of these methods with varying  X  ( N c = 2) are shown in Fig. 7 .The settings of  X  , the CMQDF outperforms the CMF and MQDF ble results. The best accuracy reaches 90.60% by CMQDF, whereas the accuracy of MQDF is 90.07%. These results demonstratedthat theestimatedfeatures provideuseful infor-mationtoimprovetheMQDFclassifier,andtheCMQDFout-performs the CMF classifier which belongs to the same type with CMQDF. Therefore, if we do not want to determine con-fusion pairs, then we can use the CMQDF method to further apply McNemar X  X  test, we counted the number of test exam-ples n 01 misclassified by MQDF but not by CMQDF and the number of test samples n 10 misclassified by CMQDF but not by MQDF. According to McNemar X  X  test, if the null hypoth-esis is correct, then the probability that z 1 = ( | n 01 ondtest,wefirstdenotetheerrorratesofCMQDFandMQDF is less than 0.025. The statistical results of z 1 and z 2 The percentage of error reduction in the CMQDF method is ( 0 . 3 . 3%. To see whether the number of candidate classes N c affects the recognition rate much, we evaluated the CMQDF mance of CMQDF with N c = 5 and N c = 8 is better than N satisfactory. The best test accuracy 90.68% is achieved by CMQDF with N c = 5 or 8 and  X  = 0 . 4 or 0.5. Increasing N c further gives little improvement.
 We then selected N cp confusion pairs for evaluating the RLDA-and LDA-based methods to see whether the esti-the minimum distance between class means on the trans-formed 160D sample space. Results of the two methods with different  X ( N cp = 20 , 000 , N c = 2 ) are shown in Fig. 9 . The baseline results are given by MQDF. It can be seen that the RLDA method outperforms the LDA-based method and MQDF in all settings of  X  . The best accuracy reaches90.93%byRLDA,whereasthebestaccuracyofLDA and MQDF is 90.66 and 90.07%. The percentage of error reduction in the RLDA method is ( 0 . 9093  X  0 . 9007 )/( 0 . 9007 ) = 8 . 6%, while the percentage of the LDA method is of varying number of N cp on recognition rate, we evaluated given by MQDF. It can be seen that the proposed method outperforms the LDA-based method and MQDF at different confusion pair numbers. Increasing N cp isshowntogivea little improvement.

To see whether the estimated features provide useful infor-mation for the SVM classifier, we compared the RSVM number of SVM classifiers is not only time-consuming, but also memory consuming while discriminating. Therefore, we only evaluated the two methods on the first 20 confusion pairs and gave the recognition rate of the two methods on ent methods on these confusion pairs are shown in Table 4 . (another value gives a similar table). SVM-L and RSVM-L mean that the SVM models are trained using the linear ker-nel, while SVM-G and RSVM-G mean that the SVM models that RSVM-L outperforms SVM-L on 15 confusion pairs and only on the first confusion pair SVM-L outperforms RSVM-L, and RSVM-G outperforms SVM-G on 14 confusion pairs and only on 4 confusion pair SVM-G outperforms RSVM-G. The average accuracies of these methods with varying  X  are shown in Fig. 11 . It is evident that the RSVM-based method outperforms the previous SVM method.

Then, the performance of the proposed method on con-strained databases was evaluated even though this method is designed for unconstrained databases. Table 5 presents the recognition results of the CMQDF method on the CASIA this table, we can see that the CMQDF method gets a com-parable performance with the CMF method. A better perfor-mance can be achieved by combining the CMQDF and CMF methods. A recognition rate of 98.62% on this database is achieved. This experiment demonstrates that the CMQDF method achieves a comparable performance as well as CMF on constrained databases while it performs better than CMF method on unconstrained databases.

Finally, results of RLDA and the state-of-the-art meth-ods on the DB1.1 database are listed in Table 6 , which establishes a benchmark for the further research. These results are cited from the corresponding article. In paper [ 34 ], some state-of-the-art methods are evaluated on the DB1.1. The implemented methods include advanced char-table, CASIA-HWDB1.0 is another database released at the same time with DB1.1. The accuracy on the test set of DB1.1 is further improved from 89.55 to 90.71% using the merged training data of databases CASIA-HWDB1.0 and DB1.1. To improve the class separability of Fisher lin-ear discriminant analysis (FDA) for large category prob-lems, the weighted Fisher criterion (WFC) was investigated in paper [ 42 ]. The sample level KNN (SKNN) method, which can capture much more information of the decision boundary and alleviate the heteroscedastic and multi-modal problems, outperforms the other methods and improves the recognition rate from 89.5 to 90%. In paper [ 32 ], they ble MQDF classifier, and the self-generated virtual samples are also used at the recognition stage for further improv-ing the recognition rate. A recognition rate of 91.17% was achieved by FSGV. In paper [ 43 ], they trained the follow-ing DNN, 1x48x48-100C3-MP2-200C2-MP2-300C2-MP2-400C2-MP2-500N-3755N, on DB1.1. Without their fast GPU implementation the nets on this task would train for 93.5% which beats the current state-of-the-art methods by a large margin. However, training a DNN on this database is very time-consuming, and if the character categories are cations. These results tell us that the HCCR problem still reveals a big challenge to attack. 6 Conclusion In this paper, a character image restoration method is proposed for unconstrained handwritten Chinese character recognition. The observed character image is modeled as the combination of ideal character image, omitted stroke image and added stroke image. To preserve the original gradient acters. To see the effectiveness of the proposed method, we extended some state-of-the-art methods based on the esti-mated features and compared the extended methods with the original methods on DB1.1 database. In our experiments, we first do not determine the candidate confusion pairs and compared the CMQDF with MQDF and CMF methods. The CMQDF method reduces the error rate of baseline MQDF by factors of 5.3%, while the CMF reduces the error rate of baseline MQDF by factors of 3.3%. Then, we selected some confusion pairs for comparing the RLDA and RSVM with LDA and SVM, respectively. The RLDA method reduces the error rate of baseline MQDF by factors of 8.6%, while the LDA reduces the error rate of baseline MQDF by factors of 5.9%. Experiments on the first 20 confusion pairs show that the RSVM outperforms SVM with different kernels. These experimental results demonstrate that the proposed method can provide useful information for discriminating similar characters.
 References
