 Determining similar objects is a fundamental operation both in data mining tasks such as clustering and in query-driven object retrieval. By definition of similarity search, query objects can only be imprecise descriptions of what users are looking for in a database, and even high-quality similarity measures can only be approximations of the users X  notion of similarity. To overcome these shortcomings, iterative query refinement systems have been proposed. They utilize user feedback regarding the relevance of intermediate results to adapt the query object and/or the similarity measure.
We propose an optimization-based relevance feedback ap-proach for adaptable distance measures  X  focusing on the Earth Mover X  X  Distance. Our technique enables quicker it-erative database exploration as shown by our experiments. H.3.3 [ Information Storage and Retrieval ]: Relevance Feedback Algorithms Relevance Feedback, EMD, Multimedia Databases
Finding similar objects in databases is an active research topic with a large number of applications from a variety of domains such as data clustering and content-based search. In distance-based similarity search, the degree of similarity between database objects and a query is modeled via a dis-tance measure in some object representation space. Ideally, similar objects have a smaller distance than dissimilar ones.  X  This work is partially f unded by DFG gr ant SE 1039/1-3.
Two common challenges of distance-based similarity search are the formulation of the query and the definition of a suit-able distance measure. Even for high-quality similarity mod-els, the distance measure can only be an approximation of the users X  notion of similarity as said notion may be differ-ent from application to application, from user to user, and ultimately from query to query. Relevance Feedback (RF) systems try to address these issues on the basis of relevance information gathered from the user. In an iterative fashion, RF systems aim at increasingly reflecting the user X  X  notion of similarity and return a larger amount of relevant objects from the database. Retrieving more relevant objects in ear-lier iterations turns effectiveness of the similarity model into efficiency for the user in this scenario.
 We propose to exploit the flexibility of the Earth Mover X  X  Distance (EMD) [10] in an extension of the traditional feed-back loop (cf. Fig. 1), thereby significantly improving the quality of the search result. To this end, we formulate the similarity adaptation as an optimization problem that min-imizes discrepancies between relevance information and the distance measure.
Two prominent distance-based relevance feedback systems for fixed-binning feature histograms are MindReader [5] and MARS [9]. In addition to updating the query point, they adapt a quadratic form distance measure to reflect (co-)vari-ance information of relevant objects.

In the text retrieval domain, an algorithm for basing the adaptation of the query (consisting of terms and according weights) on an optimization process that takes the user X  X  feedback into account was proposed in [1]. The similarity measure remains unchanged. An optimization-based RF ap-proach for multimedia databases with a framework similar to ours was recently presented in [3]. It uses genetic pro-gramming to optimize the aggregation of given attribute-wise similarity measures through varying the composition of according arithmetic opera tors. Inspired by the Simu-Figure 2: Image and visualizations of its signature generated by a clustering color and location. lated Annealing optimization technique, [2] proposes a sys-tem where each iteration of a feedback process is an iteration in a search process that becomes more focused over time.
While the EMD has been utilized in a limited number of RF algorithms [6, 10], these techniques do not adapt the EMD itself but instead rely on its good default retrieval per-formance. Rubner et al. [10] propose a RF approach termed  X  X uery-by-Refinement X  that combines the feature represen-tation from relevant objects to a representation of a new virtual query object. Thus,  X  X uery-by-Refinement X  only adapts the query representation. In [6], the EMD is used as a kernel function for an SVM-based RF system. The query results are improved by re-weighting the query signa-ture and training an SVM classifier. The feedback is not used to adapt the underlying EMD in this approach either.
Adapting the EMD to user feedback remains an open re-search topic, which we address in this paper.
We introduce the mathematical formalization of the sim-ilarity model employed in this paper.

Feature Representation. Multimedia databases typ-ically describe the objects they contain via a distribution of features that the objects exhibit. Histograms are a com-monly employed type of discrete feature representation. They reflect the relative frequency of features for partitions of the feature space (e.g., a color space). For fixed-binning his-tograms, the partitioning is determined once and then used for all objects. Histograms with adaptive binning, a.k.a. fea-ture signatures in the EMD context, provide a more flexible way to represent the feature distribution. For each object, the feature space is partitioned individually, for instance, via a clustering of the features of the object.
 Definition 1. Feature Signature. For a feature space FS, a feature signature is a set { ( p 1 ,w 1 ) , ..., ( p ples from FS  X  R . Given object o and grouping C o 1 , ..., C of object features f o 1 , ..., f o k from FS, the feature signature s = { ( p o 1 ,w o 1 ) , ..., ( p o d ,w o d ) } is defined via points p o j = 1 |
Fig. 2 shows a visualization of a signature where the brown foal, the gray horse and the shades of the green pastures sur-rounding the horses are represented by according clusters. While a signature representation can capture feature distri-butions very precisely, it also requires the similarity measure to be able to compare objects with differing partitioning.
The Earth Mover X  X  Distance. The EMD is a flexible distance measure that has been proposed for image compar-ison [10] and is successfully used for a multitude of other
Algorithm 1 : FEEDBACKLOOP(q, DB, k) similarity search tasks. It is modeled as the solution to a transportation problem that can be computed efficiently via a specialized simplex algorithm [4]. Given a number of sources with goods that are to be distributed to a number of targets, EMD calculates the most cost-efficient way of dis-tributing all goods according to source and target capacities. The cost for transporting one unit of the goods from a given source to a given target is based on a distance function that is referred to as the ground distance. In our case, the ground distance is computed between two cluster centers and thus describes how dissimilar the features from those regions are.
Definition 2. Earth Mover X  X  Distance (EMD). Giv-en two feature signatures s o , s q , and a ground distance gd , the EMD between s o and s q is defined via a minimum over transports T =[ t ij ] : EMD gd ( s o ,s q )= min where w is the total weight of the lighter signature and the set of feasible transports FEAS  X  R | s o | X | s q | is defined as
FEAS = { T  X  R | s o | X | s q | | CS  X  CT  X  CPos  X  CTrans } CS  X  X  X  i : j t ij  X  w o i CPos  X  X  X  i, j : t ij  X  0 CT  X  X  X  j : i t ij  X  w q j CTrans  X  i j t ij = w
On the intuitive level, signature s o is the collection of sources while s q is the collection of destinations. All trans-ports t ij from sources to targets have to be positive ( CPos ) and can exceed neither the available goods at the source ( CS ) nor the capacity at the targets ( CT ). In addition, as manygoodsaspossiblehavetobetransported( CTrans ).
 The possibility to flexibly replace gd and thus to adapt the EMD as a whole is key to our Relevance Feedback technique.
We introduce the proposed optimization-based extension of the feedback process that adapts a similarity measure such that the discrepancy between all user-given feedback and an adaptable distance measure is minimized. While we focus on the EMD, the optimization can readily be adopted with other flexible distance measures such as quadratic forms.
The Feedback Process. Alg. 1 lists pseudo-code for the RF process. Given an initial query object q and a de-fault ground distance (e.g., L 2 ), the RF process retrieves the k closest objects to q as determined by the EMD with the current ground distance. After returning the objects to the user, the feedback process waits for feedback from the user. Unless the user terminates the process, the feedback loop is entered and the user is asked to let the system know which of the objects in the subset that was returned are to be considered relevant for the query. Using this relevancy in-formation and possibly also relevancy information from past iterations, the task of the system is to find a new query ob-ject representation and a new ground distance for the EMD that better fit the user X  X  requirements. Lastly, a new subset of k objects similar to the new q andtheEMDwiththe updated ground distance is retrieved.

Optimization of the Distance Measure. While a well-founded heuristic for adaptGD may be able to produce a good ground distance for the EMD, it does not necessarily reflect the user X  X  feedback as well as could be wished for. In-stead of directly returning the results as determined with a heuristic ground distance, we first test if the ground distance canbeimproveduponinanextensiontothetraditional feedback loop. We phrase the adaptation of the ground distance as an optimization problem that ties the ground distance as the optimization variable to the consistency of the EMD-based similarity model with the user feedback as the optimization criterion. To algorithmically decide how beneficial a given distance measure is, we require a quality criterion that reduces the ranking of the database objects as seen from the query to a single figure.
 Definition 3. Average Precision. Given a database DB, relevant objects  X  DB, and an injective function rank : DB  X  N , the average precision of rank is given by avgPrecision(rank , )= 1 | |
A higher number of relevant objects appearing at the front of the ranking yields a higher average precision value. The optimal value is 1. Using the average precision as a measure for the quality of a ranking, we can formulate the distance measure adaptation as an optimization problem.

Definition 4. Optimal Relevancy-Consistent Dis-tance Measure. Given query q , database DB, and relevant objects  X  DB, the optimal relevancy-consistent distance measure Dist  X  according to the average precision value is where rank Dist q determines the ranking of objects in DB by ascending distance to q according to Dist.

During the Relevance Feedback process, we evaluate Def. 4 on the subset of the database for which the user has given relevancy information to the system either during the cur-rent or during prior feedback loop iterations. By optimizing the average precision on the objects fed back to the system, the final similarity measure better separates known relevant objects from other objects (cf. Sec. 5).

Adaptable ground distance for the EMD. The search space of Def. 4 depends on the adaptability of the distance measure to be considered. There is an unlimited number of ground distances defining distances between points in FS . We thus have to constrain the search space without sacri-ficing too much adaptability of the EMD. Key to defining a suitable ground distance is the observation that for each iter-ation, we are only interested in distances from a single query q to objects in the database. Thus, defining a distance for the partitioning representatives p q i of q to arbitrary points in FS fully suffices. From our experiments, we see that lim-iting the ground distance to representative-wise weighted L 2 distances results in a feasible and effective choice. The search space is thus reduced to finding a suitable matrix C =[ c ij ] of row-wise weights for weighted L 2 distances. Fig. 3 shows an example with 3 qu ery representatives where the j th weight for the L 2 distance of the i th representative is given as c ij . While the iso-distance curves are only shown for the spatial dimensions, they extend into all dimensions of FS .With C i as the i th row of C , the resulting ground distance is gd( p q i ,p )= ( p q i  X  p )  X  diag ( C i )  X 
The Optimization Algorithm. An analytical op-timization of the relevancy-consistent distance measure is infeasible due to its inherent ranking computations. This is especially true in the case of the EMD, where the objective function (average precision) and the optimization variable (the ground distance) are linked through the algorithmic optimization of multiple transportation problems. However, there is a subclass of probabilistic optimization algorithms well-suited for this situation called Simulated Annealing al-gorithms [7]. The main idea is to start the optimization at a given point in the search space (i.e., matrix C that de-fines the ground distance) and randomly navigate through the search space while evaluating the optimization criterion. Worse solutions can temporarily be adopted with a certain probability in order to overcome local optima. The worse a solution is, the less likely is its adoption. In addition, the probability for adopting worse solutions also decreases over time, as the so-called temperature of the optimization process cools down (e.g., via multiplication with a parameter coolFactor ). The optimization terminates after maxIter iter-ations. In this fashion, the algorithm first moves erratically while looking for regions with good solutions and avoiding local optima. As the temperature cools down, it converges toward a greedy algorithm. At the end, the best solution found during the optimization process is used.

We navigate through the space of ground distances by randomly partitioning the weights of each L 2 distance into two groups and increasing the weights of the first partition while decreasing those of the second accordingly. A parame-ter modRowWeight determines the magnitude of the change.
We performed a series of automated Relevance Feedback runs to evaluate the gains in effectiveness of our optimization-based EMD adaptation over  X  X uery-By-Refinement X  X 10] that relies on query movement alone.

Databases and Evaluation Setup. The experiments were conducted using features extracted from a database that includes 59,896 color images from a wide variety of themes (a.k.a.  X  X orel DB X ). Each theme includes  X  100 im-ages. Signatures with up to 20 components were created for all images via object-wise clustering of 7-dim. features (position, color, and two texture measures). 20 themes with Figure 5: First 10 results of 5 th iteration looking for doors. (a) Query Movement (b) Optimization-based limited overlap (excluding themes that exhibited hardly any feature diversity) were chosen as relevant images for 20 sep-arate feedback runs. Parameter k of the k -nearest neighbor queries was set to equal the number of relevant images such that the optimal result could potentially be attained. The theme information of the k images was used to generate feedback for the next iteration. Figures 4 (a) and (b) each depict five interpolated precision-recall curves computed as described in [8]. Each curve represents the ranking of a Relevance Feedback iteration averaged over the 20 queries. The optimization-process was initialized with a matrix C containing equal weights for all query representatives and dimensions of FS (i.e., the Euclidean distance L 2 ). The starting temperature T 0 was set to the largest theoretically possible difference in average precision and parameters max-Iter , modRowWeight and coolFactor proved suitable at 500, 5%, and 0 . 85.

EMD Adaptation Results. The precision-recall dia-gram series in Figure 4 gives information on full rankings of the databases and shows the quality of the adaptation approach. The baseline algorithm in (a) with a fixed, Eu-clidean EMD ground distance is contrasted with our optimi-zation-based adaptation in (b). Figure 4(c) shows the im-provement of the precision within the subset of the database that is retrieved in the feedback iterations and gives impor-tant additional information for assessing the feedback pro-cess. Our adaptation approach consistently shows consid-erable improvements regarding the quality of the query re-sults. While the baseline algorithm is not able to improve its results after iteration 3, the optimization-based adapta-tion improves with every iteration, leading to on average  X  40% more relevant objects in the result set of the fifth iteration compared with the query movement approach and nearly three times as many relevant objects compared to its first iteration. Figure 5 shows an example result for the fifth iteration of a feedback session looking for pictures of doors. While the query movement approach shows a first non-relevant image at position 2, the optimization-based ap-proach manages to return only images of doors for the top 10 positions shown. The first non-relevant image occurs at position 14. The average precision for k=100 is 0.47 for the baseline and 0.76 for our optimization-based approach. We have shown how the flexibility of the Earth Mover X  X  Distance as a high-quality similarity measure can be ex-ploited to explore multimedia databases via a Relevance Feedback process. The ground-distance-based Earth Mover X  X  Distance is adapted to user feedback via an optimization-based extension to the traditional feedback loop. This addi-tion is general enough to be easily extended to other adapt-able distance functions. [1] C. Buckley and G. Salton. Optimization of Relevance [2] M. Cord, J. Fournier, and S. Philipp-Foliguet. [3] C. D. Ferreira, R. da S. Torres, M. A. Gon  X  calves, and [4] F. S. Hillier and G. J. Lieberman. Introduction to [5] Y. Ishikawa, R. Subramanya, and C. Faloutsos.
 [6] F.Jing,M.Li,L.Zhang,H.-J.Zhang,andB.Zhang.
 [7] S.Kirkpatrick,C.D.Gelatt,andM.P.Vecchi.
 [8] C. D. Manning, P. Raghavan, and H. Sch  X  utze. [9] M. Ortega-Binderberger and S. Mehrotra. Relevance [10] Y. Rubner and C. Tomasi. Perceptual Metrics for
