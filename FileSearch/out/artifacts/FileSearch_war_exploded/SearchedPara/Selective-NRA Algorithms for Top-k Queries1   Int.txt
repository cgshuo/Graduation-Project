 A ssume there are a huge am o u n t o f o b j ects a n de v er yo b j ect has m attr i butes , f o r each attr i bute the o b j ect has a sc o re , these sc o res ca n be aggregated t o a t o ta l sc o re b y a n aggregate fu n ct ion, a n d w e w a n tt o k now w h i ch k o b j ects ha v e the l argest t o ta l sc o res .T h i ssce n ar io i sge n era li zed as  X  t o p -k quer i es  X .
To p -k quer y has bec o me a c l ass i ca l research area s in ce i thasma ny app li-cat ion ssuchas in f o rmat ion retr i e v a l[5],[ 7 ], mu l t i med i a databases [ 2 ],[9], data m inin g [6]. In t o p -k quer i es ,w eca n d o random access a n d sorted access t o get a no b j ect  X  ssc o re .Un der a  X  ra n d o m access  X  X  eca n get s o me o b j ect  X  ssc o re o fag iv e n attr i bute at on estep ; a  X  s o rted access  X  mea n s w epr o ceed thr o ugh a n attr i bute li st seque n t i a lly fr o mthet o p o fa li st ,i. e .i fs o me o b j ect i sthe l th l argest o b j ect in the i th li st ,w esh o u l dd o l s o rted access t o the i th li st t oo bta in the o b j ect  X  ssc o re .A s stated in [ 8 ], i fthereare s s o rted accesses a n d r ra n d o m accesses , the t o ta l access c o st will be sC S + rC R .( C S i sthe c o st o fas in g l es o rted access a n d C R i sthec o st o fas in g l era n d o m access .) In s o me cases , ra n d o m access i sf o rb i dde no rrestr i cted .[1] Fo re x amp l e , at y p i ca l w eb search e n g in ehas no w a y t o retur n asc o re o fad o cume n t o f o ur ch oi ce u n der a quer y. O n the assumpt ion that ra n d o m access i s no t supp o rted b y the database ,in[1] the auth o rs pr o p o sed the  X  X o Ra n d o m A ccess Al g o r i thm  X  (N R A)[1].

In th i spaper w efirstdem on strate s o me o bser v at ion s o f N R A a l g o r i thm a n d ter tha nN R A a l g o r i thm in terms o f access c o st a n db oo kkeep in g ; sec on d ly, w e tur nSN R Ain t o a nin sta n ce o pt i ma l a l g o r i thm w h i ch w eca ll Hy br i d -SN R A; th i rd ly, w ecarr yo ut e x te n s iv ee x per i me n ts t o c o mpare SN R A(Hy br i d -SN R A) a l g o r i thms wi th N R A b o th on s yn thet i ca n drea l-wo r l ddatasets .T he resu l ts a l s o dem on strate that o ur a l g o r i thms ha v e low er access c o st tha nN R A a l g o r i thm .

T he rest o fth i spaper i s o rga ni zed as f ollow s .In sect ion 2 ,w edefi n ethe pr o b l em a n dre vi e w re l ated wo rk .In sect ion 3, w e in tr o duce SN R A a l g o r i thm a n d Hy br i d -SN R A a l g o r i thm .In sect ion 4 ,w esh ow the e x per i me n tresu l ts .Fin a lly in sect ion 5, w ec on c l ude the paper . Our m o de l ca n be descr i bed as f ollow s : assume there are m li sts a n d n o b -j ects , the aggregat ion fu n ct ion i s t w h i ch has m v ar i ab l es .Fo rag iv e no b j ect R a n df o r li st i , R has a sc o re x i a n d 0  X  x i  X  1. R has a t o ta l sc o re o f t ( x 1 ,x 2 , ... ,x m ). W esha ll de no te the li sts as L 1 ,L 2 ... ,L m w h i ch are s o rted li sts a n dca nno tbera n d o m accessed .W e refer t o L i as li st i . Each e n tr yo f L i i s ( R, x i )w here x i i sthe i th fie l d o f R .W e assume there i sa n e x act v a l ue f o reach o b j ect , s o the l e n gth o feach li st i s n .Sin ce w ec on s i der only s o rted access , the access c o st o fa n a l g o r i thm will be C R  X  r i f r s o rted accesses are perf o rmed .

T here ha v ebee n se v era l a l g o r i thms w h i ch sat i sf y the assumpt ion o f no ra n-d o m access .T he fam o us t wo a l g o r i thms are G  X  u n tzer et a l. X  s  X  X  tream -C o mb in e Al g o r i thm  X  X  2 ] a n d F ag in et a l. X  s  X  X o Ra n d o m A ccess Al g o r i thm  X  X 1]. A sme n-t ion ed in [3], Stream-Combine a l g o r i thm c on s i ders only upper b o u n ds on ov era ll grades o f o b j ects , a n dca nno tsa y that a no b j ect i s in the t o p -k u nl ess that o b j ect has bee n see nin e v er y s o rted li st .In th i sse n se ,N R Ai s better tha n Stream-Combine .In[1], the auth o rs pr ov ed that a l g o r i thm N R Ai s in sta n ce o pt i ma l wi th o pt i ma li t y rat io m , a n d no determ ini st i ca l g o r i thm has a low er o pt i ma li t y rat io. (T he defi ni t ion o f instance optimal a n d optimality ratio appeared in [1].) In [10], the auth o rs stud i ed N R A a l g o r i thm a n dpr o p o sed a n a l g o r i thm w h i ch the y ca ll  X  X A R A X . In terms o fru n t i me c o st ,LA R Ai ss i g ni fica n t ly faster tha n N R A a l g o r i thm .How e v er ,in terms o f access c o st , the ad v a n tage o f LA R Ai s s o met i mes marg in a lly. T he o ba l deta l. prese n ted se v era l pr o bab ili st i ca l g o r i thms [ 4 ]w h i ch are a l s ov ar i a n ts o fthe N R A a l g o r i thm .

T he bas i c i dea o f N R Ai st o e v a l uate a no b j ect  X  se x act v a l ue us in g upper b o u n ds ( best value B ( d ) ( R )) a n d low er b o u n ds ( worst value W ( d ) ( R )). T he deta il o fa l g o r i thm N R Ai sg iv e n as f ollow s .I f no tspec i fied e l se w here ,w e will use the same no tat ion s ( such as W d ( R ), T ( d ) k , M ( d ) k ) as N R A a l g o r i thm used . In th i s sect ion w e will pr o p o se o ur S e l ect iv e -N R A a l g o r i thms .In the rest o fth i s sect ion w efirstg iv ea n equ iv a l e n tf o rm o fa l g o r i thm N R A X  sst o pp in gru l e , a n d SN R A; sec on d ly w e will sh ow o ur a l g o r i thm SN R A a n dpr ov e i ts c o rrect n ess ; fi n a lly w e will pr o p o se a nin sta n ce o pt i ma l a l g o r i thm based on a l g o r i thm SN R A. 3.1 Observations of NRA Algorithm Definition 1. Call an object R  X  X est competitor X  if R has the largest  X  X est value X  ( B d ( R ) ) among all  X  X iable X  1 objects which are not in the current top-k . If there is more than one best competitor, choose one which we have seen earliest (sorted accessed earliest) as the best competitor.
 T he st o pp in gru l e ( b )o f N R Ai s : X  there are no vi ab l e o b j ects l eft o uts i de T ( d ) k , that i s ,w he n B ( d ) ( R )  X  M ( d ) k f o ra ll R/  X  T ( d ) k  X  X  h i ch i sequ iv a l e n tt o W e now g iv et wo l emmas w h i ch m o t iv ate us t o pr o p o se a l g o r i thm SN R A. In th i s paper ,w e supp o se m  X  2 . Lemma 1. If at depth d object R is the best competitor and algorithm NRA does not halt at depth d ,then R has at least one missing (undiscovered) field.
 Proof. W e assume that at depth d w eha v ek nown a ll fie l ds o f R .T he n W ( d ) ( R )= B ( d ) ( R ). Sin ce R has the l argest best value , the best value o fa ll viable o b j ects ha l tatdepth d , there i ss o me o b j ect R  X  T ( d ) k such that B ( d ) ( R ) &gt;W ( d ) ( R ), the ni tf ollow sthat , R sh o u l dbe in T ( d ) k because B ( d ) ( R )= W ( d ) ( R ) &gt;W ( d ) ( R ). I t l eads t o ac onfli ct ion. So the c on c l us ion f ollow s , as des i red .
 Lemma 2. If at depth d object R is the best competitor and algorithm NRA does not halt at depth d , B ( d ) ( R ) will decrease at depth d +1 only if we sorted access R  X  X  missing field.
 Proof. I f w es o rted access i th li st w h i ch i s no t R  X  sm i ss in gfie l d , R  X  s best value will no t decrease because w ec o mpute R  X  s best value b y subst i tut in g R  X  srea l v a l ue f o rthed i sc ov ered fie l da n d bottom value f o rthem i ss in gfie l d .So R  X  s best value will decrease only i f w es o rted access R  X  sm i ss in gfie l d .( R  X  s best value ma y be won X  t decrease w he n the v a l ues at the n e x t l e v e l are the same wi th th i s l e v e l. I t i sa n ecessar y but no tsuffic i e n tc on d i t ion.) Another Observation: W e no te that the best competitor cha n ges wi th the a l g o r i thm ru nnin g .How e v er , b y d oin ge x per i me n ts ,w ef o u n d that the l ast best competitor (w h i ch mea n sthe l ast on ebef o re a l g o r i thm N R A term in ated )wo u l d o ccup y the p o s i t ion o f best competitor f o ra lon gt i me .W e specu l ate the resu l ts are m o st li ke ly s i m il ar f o rc o mm on data sets .T ab l e 1 g iv es a n e x per i me n tresu l t f o ras yn thet i cu ni f o rm data set .W eset n =100000, m = 2 , 4 ,...,1 2 , k = 2 0. T he aggregat ion fu n ct ion i s summat ion.

S upp o se that the l ast best competitor has only on em i ss in gfie l d w he n a l-g o r i thm N R Ai sru nnin g .In th i scase ,w est ill ha v et o s o rted access the best competitor  X  sa ll o ther k nown fie l ds .T h i s will in cur lo ts o fuse l ess s o rted accesses i fthe l ast best competitor c on t in ue f o ra lon gt i me bef o re the t o p -k o b j ects are 3.2 Selective-NRA Algorithm (SNRA) W e will sh ow o ur a l g o r i thm in pseud o-c o de f o rm .

A s stated in sect ion3.1, a l g o r i thm N R A perf o rms s o me s o rted accesses w h i ch will defi ni te ly no t reduce the best competitor  X  sbest v a l ue . Our appr o ach ca n a voi dtheses o rted accesses .To pr ov ethec o rrect n ess o f SN R A a l g o r i thm ,w e n eed t o g iv ea l emma first .T h i s l emma in d i cates that SN R A a l g o r i thm will no t l ead t o a n X  X n fi ni te loo p  X . Lemma 3. Assume algorithm SNRA has sorted accessed d j depth to L j ( j = 1 , 2 , ... ,m ), and the stopping rule has not been satisfied, algorithm SNRA will proceed to access the next object at least in one list.
 Proof. L et d be a n arra yo f [ d 1 ,d 2 , ... ,d m ], in the rest o f the paper w he nw esa y depth d ,i tmea n sdepth d j in L j .W e only n eed t o pr ov ethatatdepth d the best competitor has at l east on em i ss in gfie l d .T hus the rema inin gpart o fth i s l emma  X  spr oo f i sthesameas L emma 1 X  s .
 Theorem 1. If the aggregation function is monotone, then algorithm SNRA correctly finds the top k objects.
 Proof. A cc o rd in gt oL emma 3, i fa l g o r i thm SN R A d o es n X  tha l t ,i t will pr o ceed t o that a l g o r i thm SN R A ha l ts after d j s o rted access t o L j ( j =1 , 2 , ... ,m ) a n dthe o b j ects o utput b y a l g o r i thm SN R A are R 1 ,R 2 , ... ,R k .L et R be a no b j ect no t am on g R 1 ,R 2 , ... ,R k .W emustsh ow that t ( R )  X  t ( R i ) f o reach i =1 , 2 , ... ,k .
L et d =[ d 1 ,d 2 , ... ,d m ]. Sin ce a l g o r i thm SN R A ha l ts at depth d , the best com-petitor  X  sbest v a l ue i s l ess tha n M ( d ) k , the n, B ( d ) ( R )  X  B ( d ) ( best competitor )  X  M k a n d t ( R ) W ( d ) ( R i )  X  t ( R i ). C o mb inin gthe in equa li t i es w eha v esh own, w eha v e f o reach i , as des i red .
 No t only accesses fe w er o b j ects ,o ur a l g o r i thm requ i res l ess b oo kkeep in gtha n a l g o r i thm N R A. A tstep2 o fa l g o r i thm N R A, i t will update a ll see no b j ects  X  s wo rst v a l ues a n dbest v a l ues . Our a l g o r i thm j ust updates a no b j ect  X  s wo rst v a l ue w he nw es o rted access i t .T h i s i sreas on ab l e because the o ther o b j ects  X  s wo rst v a l ues will no tcha n ge i fthe y are no t accessed .
 Now w eg iv ea n e x amp l et o sh ow h ow o ur a l g o r i thm SN R Awo rks .
 Example 1. A ssume m =3, n =5, k =1, the aggregat ion fu n ct ion i s summat ion, a n dthe li sts sh own in T ab . 2ca nonly be s o rted accessed .T ab l e 3-6 sh ow h ow o ur a l g o r i thm SN R A perf o rms s o rted accesses at each step on th i s database .A t step ( a )SN R A s o rted accesses a ll the 3li sts .A fter that ,o b j ect R 1 bec o mes the t o p 1o b j ect a n d R 2 bec o mes the best competitor .T he n at step ( b )w e only s o rted access L 1 a n d L 3 s in ce L 2 i s R 2  X  sm i ss in gfie l d .Now R 1 i sthe best competitor a n d R 2 i sthet o p 1w h o se wo rst v a l ue i s 1. 8 .A tstep ( c ) L 2 i ss o rted accessed . R 1 bec o mes the t o p 1 aga in a n d R 2 bec o mes the best competitor .A tth i st i me , R 2  X  s m i ss in gfie l d i s L 3 s o at step ( d )w es o rted access L 3 .Now the best competitor i s R 4 w h o se best v a l ue i s no tm o re tha n t o p 1 X  s wo rst v a l ue .T he a l g o r i thm term in ates .T ab l e7sh ow sh ow the t o p 1o b j ect a n dthe best competitor update at each step .

O n th i s database , a l g o r i thm N R A s o rted accesses t o depth 3o feach li st a n d perf o rms 9 s o rted accesses in t o ta lw h il e o ur SN R A X  ss o rted access c o st i s7 . 3.3 Turning SNRA into an Instance Optimal Algorithm  X  X n sta n ce o pt i ma l X  in h i s no t ion. In th i s sect ion w efirstsh ow a n e x amp l ethat dem on strates SN R Ai s no t in sta n ce o pt i ma l a n dthe nw e will m o d i f y a l g o r i thm SN R A a n dtur ni tt o be a nin sta n ce o pt i ma l a l g o r i thm .
 Example 2. A ssume m = 2 , k =1, the aggregat ion fu n ct ion i s summat ion.

T ab l e8sh ow s a database ov er w h i ch a l g o r i thm N R A perf o rms only 6 s o rted accesses t o depth 3, o utputs R 1 as the t o p 1o b j ect w h il ea l g o r i thm SN R A s o rted accesses the w h ol e L 1li st a n dt o ta lly d o es n +3 s o rted accesses .(A fter depth [1 , 1], R 2 i sthe best competitor , s ow es o rted access t o depth [ 2 , 1], the n R 2 i s st ill the best competitor , the n s o rted access t o depth [3 , 1], at th i sdepth , R 3 i sthe best competitor , the n s o rted access t o depth [3 , 2 ], R 2 bec o mes the best competitor s in ce R 3  X  se x act v a l ue i s l ess tha n R 2  X  s wo rst v a l ue , the n R 2 will be the best competitor u n t il the e n d o f L 1 at depth [ n  X  1 , 2 ]. A fter depth [ n, 2 ], R 2 bec o mes the t o p 1 a n d R 1 bec o mes the best competitor .T he n s o rted access L 2 , at depth [ n, 3] R 1 bec o mes the t o p 1 a n dthea l g o r i thm term in ates .) Sin ce n c o u l d be arb i trar yl arge , a l g o r i thm SN R Ai s no ta nin sta n ce o pt i ma l a l g o r i thm . T he reas on SN R Ai s no t in sta n ce o pt i ma li sthat SN R A X  se l ects  X  s o me o fthe li sts in stead o fa ll the li sts t o s o rted access .By d oin gth i sse l ect ion, SN R A ma y d o fe w er s o rted access tha nN R A a l g o r i thm in m o st databases but ma y X  m i ss  X  s o me i mp o rta n t in f o rmat ion in s o me part i cu l ar databases li ke o ur e x amp l e2 . N e v erthe l ess ,w eca n f o rce SN R A t o be a nin sta n ce o pt i ma l a l g o r i thm b y a li tt l e m o d i f yin g o fa l g o r i thm SN R A. W eca ll the m o d i fied a l g o r i thm  X  X y br i d -SN R A X , a n d w e now sh ow i tasf ollow s .

W e no te the s o rted access c o st o f Hy br i d -SN R Ai satm o st p t i mes as a l-g o r i thm N R Aw here p i sa n c on sta n t .So a l g o r i thm Hy br i d -SN R Ai s in sta n ce o pt i ma l. Sin ce the o pt i ma l rat io o fa l g o r i thm N R Ai s m , the o pt i ma l rat io o f a l g o r i thm Hy br i d -SN R Ai s pm u n der s o me n atura l assumpt ion [1]. (In fact ,i f p =1, Hy br i d -SN R Ai sequ iv a l e n tt oN R A a n d i f p =INFINITY, Hy br i d -SN R A bec o mes SN R A.) Our a l g o r i thms w ere i mp l eme n ted in C ++. W eperf o rmed o ur e x per i me n ts on a n AMD 1.9 G H z P C wi th 2G Bo fmem o r y. In o ur e x per i me n ts w e used summat ion as the aggregat ion fu n ct ion w h i ch w as a m o st c o mm on on e .Fo r Hy br i d -SN R A w eset p =11 as defau l t .W eusedb o th s yn thet i ca n drea l-wo r l ddatat o e v a l uate SN R A, Hy br i d -SN R A a n d N R A a l g o r i thms . 4.1 Evaluation for Synthetic Data W ec on ducted e x per i me n ts on three s yn thet i cdatasets wi th d iff ere n td i str i bu -t ion s .T he y are u ni f o rm d i str i buted ,no rma l( Gauss i a n) d i str i buted a n de x p o-n e n t i a l d i str i buted .W eset n = 100000, m = 2 , 4 , ... , 1 2 , a n d k = 2 0.
Fi gure 1-3 sh ow that on the u ni f o rm ,no rma l a n de x p on e n t i a l d i str i buted databases o ur a l g o r i thm SN R A as w e ll as Hy br i d -SN R A perf o rms fe w er s o rted accesses tha n a l g o r i thm N R A, a n da l g o r i thm SN R A perf o rms the fe w est s o rted accesses am on gthesethreea l g o r i thms .W he n m i ssma ll, the d iff ere n ce i s no ts o s i g ni fica n t , but as m bec o mes l arger ,SN R Ao utperf o rms N R A m o re a n dm o re s i g ni fica n t ly in terms o fs o rted access c o st . 4.2 Evaluation for Real-World Data In add i t ion o fs yn thet i cdata ,w ecarr i ed o ut e x per i me n ts on three d iff ere n t rea l-wo r l ddatasets w h i ch w ere a ll d ownlo aded fr o m U C IKDDA rch iv e 2 .  X  T he first rea l-wo r l ddata ( CE )i s IPUMS Ce n sus D atabase .T h i sdataset  X  T he n e x trea l-wo r l ddata i s KDD cup 199 8dataset ( cup 9 8 ). I tc on ta in s 95 4 1 2  X  T he l ast data set  X  E lNino X  data set c on ta in s o cea no graph i ca n dsurface Fi gure 4 sh ow sthee x per i me n tresu l t o f SN R A, Hy br i d -SN R A a n d N R Aov er IPUMS Ce n sus data set .W etested w he n m = 4 , 5 , ... , 10 a l g o r i thm SN R A, Hy br i d -SN R A a n d N R Awo u l dd o h ow ma ny s o rted accesses t o the li sts .T he resu l tdem on strates that o ur a l g o r i thms are m o re better in terms o f access c o st e v e n th o ugh the degree o fad v a n tage i sre l e v a n tt o the spec i fic database .In add i t ion, th i sfigurea l s o sh ow sthata l g o r i thm Hy br i d -SN R A d o es a li tt l em o re s o rted accesses tha n a l g o r i thm SN R A, u n der o ur defau l tset ( p =11).
 Fi gure 5 sh ow sthee x per i me n tresu l t o f SN R A, Hy br i d -SN R A a n d N R Aov er Cup 9 8dataset .In th i sfigure ,i t i sa l s o s i g ni fica n tthat o ur SN R A d o es fe w er s o rted accesses .F urtherm o re , as m g o es l arger , the ad v a n tage o f SN R Ai sgrad -ua lly o b vio us .
 Fi gure 6 sh ow sthee x per i me n tresu l t o f SN R A, Hy br i d -SN R A a n d N R Aov er E lNino data set . O n th i sdataset o ur SN R A a n d Hy br i d -SN R A a l s o perf o rm v er yw e ll. Our a l g o r i thm sa v es 50% o f N R A X  ss o rted accesses , because o fthe  X  se l ect in g  X  strateg y. 4.3 Summarize Our e x per i me n t ill ustrates that a l g o r i thm SN R A d o es fe w er s o rted accesses tha n a l g o r i thm N R A, b o th on s yn thes i zed data a n drea l-wo r l ddata .Al g o r i thm Hy br i d -SN R A d o es a li tt l em o re s o rted accesses tha n a l g o r i thm SN R A. A s m bec o mes l arger , the decrease o fs o rted accesses bec o mes m o re s i g ni fica n t .(W he n k cha n ges ,w e o bta in s i m il ar resu l ts w h i ch are o m i tted due t o space li m i tat ion s .) T he reas on w h yo ur a l g o r i thm d o es fe w er s o rted accesses i sthat i t  X  se l ects  X  s o me li sts a n dd o es usefu l s o rted accesses in stead o fs o rted access in ga ll the li sts . In th i spaper ,w ea n a ly zed a l g o r i thm N R A a n dga v es o me o bser v at ion s .W e on s yn thet i ca n drea l-wo r l ddatash ow that o ur a l g o r i thms SN R A a n d Hy br i d -SN R A perf o rm s i g ni fica n t ly better tha nN R Ain terms o fs o rted access c o st . Ano ther in terest in gresu l tacc o rd in gt oo ur e x per i me n ts i sthata l g o r i thm N R A a n da l g o r i thm Hy br i d -SN R A are in sta n ce o pt i ma l but the y perf o rm fe w er s o rted accesses tha n a non- X  X n sta n ce o pt i ma l X  a l g o r i thm on c o mm on data sets . T h i s i sa ni ssue f o r o ur further research .In the future ,w e will a l s o c on s i der the ru n t i me c o st o f SN R A c o mpared wi th a l g o r i thm N R A. W e will des i g n s o me tech ni ques t olow er d own the ru n t i me c o st o f SN R A.
 Acknowledgements. T h i s wo rk i s supp o rted b y the N at ion a lS c i e n ce Fo u n da -t ion o fCh in au n der the gra n t No. 605330 2 0 a n d No. 60 87 3 2 10. T h i s wo rk i sa l s o supp o rted b y the S c i e n ce Research F u n d o f M OE -Mi cr o s o ft K e yL ab o rat o r yo f M u l t i med i aC o mput in ga n dC o mmu ni cat ion ( Gra n t No. 061 2 0 8 01).

