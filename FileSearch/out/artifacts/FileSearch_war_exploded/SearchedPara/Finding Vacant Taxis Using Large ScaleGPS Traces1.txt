 As an indispensable part of urban public transportation, taxi plays a significant role in people X  X  daily life [1]. However, more and more urban people suffer from waiting too long for taxis. The reasons come from the following aspects. Firstly, there exists imbalance between supply and demand. Secondly, passengers lack the information of the vacant taxis. Based on the past experience, a skillful passenger can choose an effective position. However, many people gain little skill about how long to wait and where is better for waiting. Thus, it is imperative to provide some information for passengers to find vacant taxis, such as wait time, probability of taking a vacant taxi and useful positions.

Nowadays, GPS sensors are equipped in the taxis for dispatching and ensuring security in many big cities, like New York, Singapore and Beijing. The initial functions of GPS devices are localization, navigation, and scheduling. As the usage of the GPS sensors and wireless communication units has increased a lot, a large amount of taxi GPS traces data have been accumulated. Besides the applications like  X  X ocation-based servi ces X , some fine-new functions are emerging with the collected GPS trace data set, ranging from urban design[2] to traffic prediction[3]. Based on these fresh functions, researchers have carried out many interesting studies including human mobility patterns discovering[4][5], traffic conditions detecting [6][7] and taxi mobility intelligence mining [8][9][10].
Our study is built upon the GPS traces of taxis in Beijing. The data set is collected from more than 12,000 taxis which make up approximately one-fifth of the total in Beijing. Since the data set is large scale, we firstly apply MapReduce framework[11] to preprocess the data set and generate the MGB index. Then we propose NPPCRW method to estimate the wait time and probability of taking a vacant taxi at a given time and position. Finally we recommend a preferable position for passengers.

The major contributions of our work include: 1. We divide the map by grids, each position will be mapped into the corre-2. We propose NPPCRW method to estimate the wait time and probability 3. We conduct several experiments to evaluate our methods on real data set,
The rest of the paper is organized as fo llows. Section 2 introduces the related work. In section 3, we give an overview of our work. Section 4 describes the data sets and data preprocessing. Sect ion 5 presents our model and describes how to estimate the wait time and probability of taking a vacant taxi. Section 6 provides a recommendation for passengers. Section 7 shows our experiments and evaluations on our approach. Section 8 concludes the research and gives directions for future studies. Taxi traces have become a hotspot resear ch in recent years. Existing work can be grouped into three categories: 1)Improving Taxi Dispatching, 2)Providing Recom-mendations For Taxi Drivers and 3)Providing Recommendations For Passengers. 2.1 Improving Taxi Dispatching Taxi dispatching systems have attracted more and more attentions of researchers with the popularization of GPS sensors and the development of intelligent trans-portation systems[12]. Yang et al. [13] build a model to analyze some influencing factors on customer waiting time. Yamamoto et al. [14] propose a fuzzy clus-tering and adaptive routing approach to improve dispatching system. The goal of their studies is to improve centrali zed dispatching. Compared with them, our research pays more attentions to estimate the waiting time for a vacant taxi at a given time and position. 2.2 Providing Recommendations for Taxi Drivers Yuan et al. [15] mine smarting driving directions for drivers based on the past GPS traces data set collected from a large number of taxis. Ge et al. [16] develop a recommender system for taxi drivers. Th eir system can recommend a sequence of pick-up points or parking positions for maximizing the taxi driver X  X  profit. Moreover, Li et al. [17] use L1-Norm SVM to discover the most recognizable features to distinguish the performance of the taxis. However, all these studies concerned about how to serve the taxi drivers. Our goal is to provide services for passengers. 2.3 Providing Recommendations for Passengers Phithakkitnukoon et al. [18] propose a model to predict the number of vacant taxis at a given position and to provide the information for both passengers and taxi drivers. They employ a method based on the Na  X   X ve Bayesian classifier and obtain the prior probability distribution from the historical data. However, their data size is relatively small containing the traces of only 150 taxis, which might not be enough to present the general rules with the weak statistical significance. Yuan et al. [19] propose an approach to make recommendation for passengers based on the knowledge of 1) passengers mobility patterns and 2) taxi drivers picking-up/dropping-off behaviors learned from the taxis GPS traces. However, their work ignores the conditions of road and weather. In addition, their rec-ommendation is based on road-segment level. Actually, different positions in the same road have different probabilities of taking a vacant taxi. Thus their method lacks of enough accuracy. In this section, we first give some preliminary definitions which are related to our work. Then we show the framework of our system. 3.1 Preliminary Definitions Definition 1. (Map Grid): The map is partitioned into square grids, and each grid G i can also be divided up into nine small square grids, i.e., G i : g ,g i 2 ,...,g i 9 . We map each position into G i by latitude-longitude at first, and then find the accurate small grid g ik (1  X  k  X  9) in where the position is. Definition 2. (Taxi State): The working taxi has three states: occupied, cruis-ing, parking . O represents a taxi occupied by a passenger, C represents a taxi traveling without a passenger, P represents a taxi waiting for a passenger. 3.2 System Framework The framework of our system is illustrated in Fig.1. Firstly, we apply MapReduce framework to preprocess the large sca le GPS traces data set. Then we generate data and index based on map grid. Next, we filter the data, which is queried from grid data using MGB index, by the conditions of road and weather, then we propose NPPCRW method to estimate the wait time and probability of taking a vacant taxi. Finally, we provide a recommendation for passengers. In this section, we first describe our three data sets: taxis GPS traces data set, road networks data set and weather data set. Then we introduce how to generate the MGB index by utilizing these data sets. 4.1 Date Set Description The large scale real-world taxi GPS data set is collected from more than 12,000 taxi is equipped with a GPS device with a sampling-rate of about one record per minute. Table 1 lists the field for each GPS entry, along with a sampling entry. The road networks data set contains features of each road, such as width, length, direction, etc. Moreover, we crawl the wea ther data set of 110 days from Internet, the features of weather can be regarde d as temperature, rainy, sunny, etc. 4.2 Mapping Position to Map Grid According to Definition 1, we divide the map into grids including G 1 ,...,G 9 , as shown in Fig.2. Each position can be mapped to the map grid based on its latitude-longitude. If G 5 (the middlemost big grid) is the chosen grid, we continue to turn G 5 into sudoku with area threshold. If the position is in g 55 ,weonly consider the traces information of G 5 .Ifitisin g 52 , we should consider both G 5 and G 2 .Inthesameway, g 54 corresponds to G 5 and G 4 , g 56 corresponds G 4.3 Generating MGB Index We design a hash function to map a position(longitude, latitude) to the corre-sponding grid G i : The difference range of both longitude and latitude of Beijing is 1 degree, which represents one hundred kilometers. Thus, we regard 0.001 degree(one hundred meters) as the reasonable range of grid, and set a = c = 1000 ,b = 100000 in order to assure the key is unique.

The taxi GPS data set is large scale, single node becomes less practical with limited computing and storage resources. We apply distributed process by the framework of MapReduce. In the Map function, we generate the key by longitude-latitude, and regard the raw data as the value. Then the MapReduce library groups together all values associated with the same key.

In order to acquire exact GPS traces data quickly, we should obtain index using files which are generated by the Map function. It is better to sort the records in the index file by the key, thus the prediction model can utilize binary search method to query traces information more quickly. NPPCRW method first filters the obtained data based on weather conditions, then adopts NPP(non-homogeneous Poisson process) to simulate the vacant taxis X  activities, finally corrects the simulations based on road conditions. We define the rate parameter of NPP as a time-dependent function  X  ( t ). 5.1 Estimation of Waiting Time We denote a taxi arriving time as T taxi . Thus at time t and position p ,thewait time can be defined as where f road is defined as the correct function based on road conditions.
According to Definition 2, the vacant taxi contains two states: P and C ,we do not need wait time for P taxi. The arriving event of C taxi conforms to NPP. Therefore, we have:
We partition one day into K small time units, the length of each unit is  X  (where  X t can be divisible by  X  , e.g.,  X  =5minutes,  X t =15minutes). D ( p 0 , X  ) represents the corresponding grids area according to subsection 4.2. # k,j ( C ) , # k,j ( P )and# k,j ( O ) denote the number of cruising, parking and oc-cupied taxis.

We just need to estimate T next .Let N ( t ) represents the number of arriving vacant taxis by time t ,  X  ( t ) represents the cumulative intensity function of taxi arriving rate. According to the NPP. We have following properties:
The cumulative distribution function (CDF) of the next vacant taxi arriving within passengers X  endurance limitation wait time T e is: Thus the probability density function (PDF) of T next is: where  X  ( t ) can be simplified into piecewise constant function, we assume the rate function has a cycle of 24 hours. Thus, the time interval t i is one hour, we have
We employ the maximum likelihood estimation(MLE) to estimate  X  .Wede-likelihood function is
T
We can assume the number of vacant taxis is directly proportional to the width( W ) of road, because if the road is wider, there are more taxis. We also assume the the number of vacant taxis is inversely proportional to the length( L ) of road, because if the road is longer, there are more passengers who want to take a taxi. In addition, we regard direction( D ) as a weighted factor. Thus, we can get the following formula:
We apply Eq.(11) into Eq.(12) and adop t gradient descend method to estimate all the parameters. Finally, we apply Eq.(12) into Eq.(2) to estimate the wait time of taking a vacant taxi. 5.2 Probability of Taking Vacant Taxis We define the probability of one vacant taxi arriving within time T e as P taxi . According to Eq.(7), P taxi can be formulated as: Based on NPPCRW method, we can estimate the wait time and probability of taking a vacant taxi at position p 0 and time t 0 . Furthermore, we also could provide a direct recommendation on where to take a taxi. Our recommendation assumes that passengers have their endurance limitation wait time T e ,ifthe estimated wait time exceeds T e , we need to provide them another position which is not very far. The goal of our recommendation is to make a balance tradeoff between the wait time and walk distance.
 Our recommendation provides candidate places P c for passengers: where S is the common walk speed, Dist is a function calculating distance between two positions.

We can define the walk time T walk from p 0 to p is Dist ( p,p 0 ) S . Then we define the cost function of total time from p 0 to p : Finally, we choose position p best in set P candidate with minimal Cost ( p ): In this section, we conduct comprehensive experiments to evaluate our method. In the first experiment, we will evaluate our estimation for wait time and prob-ability of taking a vacant taxi. T-Finder method [19] is our compared method. In the second experiment, we will further evaluate our recommendation for pas-sengers, Zheng X  X  method [20] is s elected as our compared method. 7.1 Evaluation on Estimation for Wait Time and Probability We perform the in-the-field study for estimation in some positions of Beijing: p ,p 2 ,p 3 and p 4 on Zhongguancun Main Street(shortened as Z), p 5 ,p 6 ,p 7 and p 8 on The Summer Palace Road(shortened as S), p 9 ,p 10 ,p 11 and p 12 near Wudaokou Railway Station(shortened as W). For each position, the users are involved in cal-culating the wait time for the first vacant taxi at several given times. Therefore, the users X  records are the real wait time at given positions and times. We also apply our NPPCRW method and T-Finder method to estimate the wait time. Here we use percent error to evaluate the relative accuracy of the estimation. The percent error is defined as: Fig.3 shows the percent error of the wait time of NPPCRW method and T-Finder method[19] with 30 test cases. The average percent error of NPPCRW is 29.95% which is lower than T-Finder X  X  31.58%. The result shows that both of their es-timations are reasonable, but NPPCRW is more accurate. We also compare the cost time except for preprocess time of b oth methods, Fig.4 shows that NPPCRW method costs much less time. The resul t reflects the MGB index plays an impor-tant role in reducing cost time when faced with large scale data set.
In order to evaluate the probability of taking a vacant taxi, we also perform the in-the-field study at p 1 ,...,p 12 and some given times. Table 2 gives the overall results of evaluation. Rank denotes the real ranking according to the average number of vacant taxis encount ered at a certain time (denoted by #). Rank T  X  Finder and Rank NPPCRW stand for ranking according to probability of finding a vacant taxi based on T-Finder X  X  method[19] and our NPPCRW method. It is obvious that our NPPCRW method is better than the compared method. 7.2 Evaluation on Position Recommendation for Passengers We further evaluate our recommendation for passengers. We randomly choose ten positions from p 1 ,...,p 12 . At each position, we take experiments at ten different times. We have two compared methods: one is Zheng X  X  recommendation[20], the other one is random selection which means randomly selecting a position within the range.

Fig.5 shows the difference of average wait time at the ten positions, our recom-mendation is significantly better than Zheng X  X [20] and random recommendations in terms of the wait time. Fig. 6 shows the difference of walk distance, our recom-mendation is similar to Zheng X  X [20] recommendation in terms of distance. And they are better than rando m selection. Therefore, our recommendation is more useful for passengers.
 In this paper, we preprocessed the large scale taxi GPS traces data set and gen-erate MGB index, then we proposed NPPCRW method to estimate wait time and probability of taking a vacant taxi on the filtered data which considers con-ditions of both road and weather. Further more, we provided a recommendation for passengers with a useful position . We evaluated our method by extensive experiments including a series of in-the-field studies. The experimental results show that our estimation and recommendation are more accurate than state-of-the-art methods.

In the future, we attempt to combine some other methods such as machine learning to improve the performance of our estimation and recommendation. We also plan to develop related applications which can serve for passengers.
