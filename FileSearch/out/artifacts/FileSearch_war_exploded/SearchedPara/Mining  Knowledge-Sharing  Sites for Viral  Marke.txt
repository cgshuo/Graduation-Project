 Viral marketing takes advantage of networks of influence among customers to inexpensively achieve large changes in behavior. Our research seeks to put it on a firmer footing by mining these networks from data, building probabilistic models of them, and using these models to choose the best viral marketing plan. Knowledge-sharing sites, where customers review products and In this paper we extend our previous techniques, achieving a large reduction in' computational cost, and apply them to data from a knowledge-sharing site. We optimize the amount of marketing funds spent on each customer, rather than just making a binary decision on whether to market to him. We take into account the fact that knowledge of the network is partial, and that gathering that knowledge can itself have a cost. Our results show the ro-bustness and utility of our approach. H.2.8 [Database Management]: Database Applications -data mining; 1.2.6 [Artificial Intelligence]: Learning -induction; 1.5.1 [Pattern Recognition]: Models -statistical; J.4 [Computer Ap-plications]: Social and Behavioral Sciences Probabilistic models, linear models, direct marketing, viral mar-keting, social networks, knowledge sharing Marketing has been one of the major applications of data mining since the field emerged. Typically, the decision of whether or not to market to a particular person is based solely on their character-istics (direct marketing), or those of the population segment to which they belong (mass marketing). This often leads to sub-optimal marketing decisions by not taking into account the effect that members of a market have on each other's purchasing deci-sions. In many markets, customers are strongly influenced by the opinions of their peers. Viral marketing takes advantage of this to inexpensively promote a product by marketing primarily to those with the strongest influence in the market. The use of relation-personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that requires prior specific permission and/or a fee. SIGKDD 02, Edmonton, Alberta, Canada. 
Copyright 2002 ACM 1-58113-567-X/02/0007 ...$5.00. s/on forums, and knowledge-sharing web sites. In these is found a wealth of social interaction, often product-related, which a com-pany could use to gather information on the relationships between its customers. Knowledge-sharing sites in particular are often product-oriented. On these sites, information about product likes and dislikes, ratings of quality, benchmarks, and comparisons are exchanged, making them an ideal source for data about customer preferences and interactions. 
In this paper, we extend ideas from our earlier work [5] and apply them to the domain of knowledge-sharing sites. We show how to find optimal viral marketing plans, use continuously valued mar-keting actions, and reduce computational costs (Sections 2 and 3). 
In Sections 4 and 5, we apply the model to Epinlons, a popular knowledge-sharing site. In practice, the relationships between customers is often unknown, but may be obtained at some cost. 
We introduce a technique for marketing in such a situation and show that it performs well even with very limited marketing re-search funds. We conclude with a discussion of related work and future directions. 
Consider a .set of n potential customers, and let Xi be a Boolean variable that takes the value 1 if customer i buys the product being marketed, and 0 otherwise. Let the neighbors of Xi be the custom-ers who directly influence Xi: Ni={X/j ..... Xt,i} ~ X-{X/}, where X={X~,...,X,}. The product is described by a set of attributes 
Y={Y1 ..... Ym}' Let Mi be the marketing action that is taken for customer i. For example, Mi could be a Boolean variable, with 
M~=I if the customer is (say) offered a discount, and Mi=O other-wise. Alternatively, M~ could be a continuous variable indicating the size of the discount offered, or a nominal variable indicating which of several possible actions is taken. Let M={Mi ..... Mn} be the marketing plan. Then, for all Xi, we will assume that 
P(Xi I X-{Xi},Y,M) = p(X i ]Nt,Y,M ) (1) uct. 
PN(Xi [ N|, Y, M ) is the effect that X:s neighbors have on is. For many products, such as cellular telephones, multi-player computer games, and Internet chat programs, a customer's prob-ability of purchasing depends strongly on whether his friends have also purchased the product. In previous work [5] we modeled this interaction with a non-linear function. In this paper, we employ a simple linear model to approximate this effect: where w# represents how much customer i is influenced by his j ~N0. While not exact, we believe it is a reasonable approxima-tion when the probabilities are all small, as is typically the case for marketing domains. Linear models often perform well, espe-cially when data is sparse [4], and provide significant advantages for computation. Note that we are modeling only positive interac-tions between customers, which we found in our previous work to be the most common type. 
N~C(Ni) Xj~Ni We also refer to this as the customer's intrinsic value. Let M0 be a particular marketing plan M is then 
ELP(Y,M) = where ri=r; and ci=c if Mi=l, and rt=ro and ci=O if Mi=O. A customer's total value is the global lift in profit from marketing to him: ELP(Y, H(M)) -ELP(Y, .if(M)). A customer's network value is the difference between his total and intrinsic values. A customer with a high network value is one who, when marketed to, directly or indirectly influences many others to purchase. Our previous work was based on this Boolean marketing case, but in this paper we explore continuous valued marketing actions as well. The expected lift in profit in the continuous case is a straightforward extension of the Boolean one. Let z be a market-formed. Let c(z) be the cost of performing the action (with c(O)=O), and r(z) be the revenue obtained if the product is pur-chased. Let f/Z(M) be the result of setting Mi to z and leaving the rest of M unchanged. The expected lift in profit from performing marketing action z on customer i in isolation is then 
ELPiZ(Y,M) = r(z)P(X i = I[Y, fiZ(M)) The global lift in profit is 
ELP(Y,M) = Our goal is to find the M that maximizes ELP(Y, M). In our pre-vious work, we assumed marketing actions were Boolean, and heuristically searched through the vast space of possible market-ing plans. Because of the linearity of the model presented here (see Equation 3), the effect that marketing to a person has on the rest of the network (their network effect) is independent of the marketing actions to other customers. From a customer's network effect, we can directly compute whether he is worth marketing to. Let the Ai(Y) be the network effect of customer i for a product with attributes Y. It is defined as the total increase in probability of purchasing in the network (including X~) that results from a unit change in Po(Xi): Ai (Y) = j~_l 0p~i =~ j y~/) (6) Since Ai(Y) is the same for any M, we define it for M = M0. We can calculate A,(Y) using the following recursive formula (see the Appendix for a proof) 
Ai(Y) = EwjiAj(Y) (7) Intuitively, customer i's network effect is simply the effect that he has on people he influences, times their effect on the network. A,{Y) is initially set to 1 for all i, then recursively re-calculated using equation 7 until convergence (note this takes approximately linear time in the number of non-zero w~j's). Empirically, we found it converged quickly (10-20 iterations). Note that while the network value of a customer depends on the marketing scenario, the network effect does not. The network ef-fect simply describes how much influence a customer has on the network. The network value depends on the network effect, the customer's responsiveness to marketing, and the costs and reve-nues associated with the marketing scenario. With the network effects in hand, we can calculate the expected lift in profit of marketing to each customer. For convenience, we define APi(z,Y) to be the immediate change in customer rs prob-ability of purchasing when he is marketed to with marketing ac-tion z: 
ZX~ (z, Y) = From Equation 6, and given that P(Xj = I IY, M 0) varies line-arly with Po(Xi =IIY, Mi), the change in the probability of purchasing across the entire network is then Typically, only a small portion of the network will be marketed to. Therefore, it is relatively safe to approximate the increase in reve-nue from the network due to marketing to customer i as his influ-ence on the network multiplied by r(0). The total lift in profit is this increase in revenue on the network, plus the change in reve-nue from customer i, minus the cost of the marketing action: 
ELPi~,otal (Y, M) = Notice that this approximation is exact when r(z) is constant, which is the case in any marketing scenario that is advertising-based (i.e., if it does not offer discounts). When this is the case, the equation simplifies to: 
ELPi~ot,a (Y, M) With Equation 8, we can directly estimate customer i's lift in profit for any marketing action z. Typically, we will want to find the z that maximizes the lift in profit. To do this, we take the de-rivative with respect to z and set it equal to zero, resulting in: rAi(Y) dA/~(z,Y) = dc(z) (9) Assuming APi(z,Y) is differentiable, this allows us to directly calculate the z which maximizes ELPiZtotat(Y, M) which, because our model is linear, is the optimal value for Mi in the M that maximizes ELP(Y, M). Hence, from the customers' network ef-fects, Ai(Y), we can directly calculate the optimal marketing plan. 
We now show how this model can be applied to knowledge-sharing sites. 
Internet use has exploded over the past decade. Millions of people interact with each other online, and, in many instances, those social interactions are recorded in archives that reach back twenty years or more ~. As a result, there are many online opportunities to mine social networks for the purposes of viral marketing. UseNet newsgroups, IRC, instant messaging, online forums, and email mailing lists are examples of possible sources. 
In this paper, we concentrate on knowledge-sharing sites. On such sites, volunteers offer advice, product ratings, or help to other users, typically for free. Social interaction on knowledge-sharing sites comes in a variety of forms. One feature that is often found is some form of explicit trust between users. For example, at many sites, users rate reviews according to how helpful or accurate they are. On others, users directly rate other users. Without a filtering feature such as this, knowledge-sharing sites can quickly become mired in inaccurate or inappropriate reviews. 
We have chosen to mine Epinions 2, possibly the best known knowledge-sharing site. On Epinions, members submit product reviews, including a rating (from 0 to 5 stars) for any of over one hundred thousand products. As added incentive, reviewers are paid each time one of their reviews is read. Epinions users interact with each other in both of the ways outlined above, by rating re-views, and also by listing reviewers that they trust. The network of trust relationships between users is called the "web of trust", and is used by Epinions to re-order the product reviews such that a user first sees reviews by users that they trust. The trust relation-ships between users, and thus the entire web of trust, can be ob-tained by crawling through the pages of the individual users 3. 
With over 75k users and 500k edges in its web of trust, and 586k reviews over 104k products, Epinions is an ideal source for ex-periments on social networks and viral marketing. Interestingly, we found that the distribution of trust relationships in the web of trust is Zipfian [25], as has been found in many social networks [24]. This is evidence that the web of trust is a representative example of a social network, and thus is a good basis for our study. A Zipfian distribution of trust is also indicative of a skewed distribution of network values, and therefore of the potential util-ity of viral marketing. 
To apply our model to Epinions, we needed to estimate some parameters, such as the effect that marketing has on a customer's probability of purchasing, the self-reliance factor fli, and the amount of influence between customers wtj. In practice, the mar-keting research department of a company, or the maintainers of the knowledge-sharing site itself, would typically have the re-sources and access to customers necessary to experimentally de-l See http://groups.google.com/and http://www.archive.org/. 2 http://www.epinions.com 3 Epinions does not provide a list of all of its users, so we seeded for X,~ Ni. For the product attribute vector Y, we used a reviews per person who submitted at least one review in the cate-gory (5.8, on average). We first tested the Boolean marketing case. We hypothesized a simple advertising situation with  X z=2, ro=l, rl=l, which meant revenues were in units of the number of products sold, and a person's internal probability of purchasing a product doubled after being advertised to 6. In earlier work, we had little effect on the qualitative nature of them. Thus, for this paper, we fixed ~z and instead varied other characteristics of the model. We had no data to estimate users' self-reliance, so we simply chose to set fl/=0.5 for all customers. To combat data sparseness, Po( Xi [ Y ) was smoothed using an m-estimate with m=2 and the population average as the prior. These parameters were all chosen before running any experiments. 
Table 1: Profit results for Boolean marketing scenario for No Marketing 37.78 37.78 37.78 Direct Marketing 37.78 42.71 66.08 
Viral Marketing 47.25 60.54 70.23 Viral marketing resulted in a considerable increase in profit over direct marketing (see Table 1). Notice that when the cost of mar-keting is a significant fraction of the revenue, the dffect marketer will choose to market to no one because the cost of marketing exceeds the expected revenue from the customer (since the cus-tomers' influences on each other are being ignored). As this sce-nario illustrates, assuming the model is accurate, viral marketing will always perform at least as well as direct marketing, often outperforming it by a substantial margin. We measured the network value of all of the customers. Figure 1 shows the 500 highest network values (out of 75888) in decreas-ing order. The unit of value in this graph is the average revenue that would be obtained by marketing to a customer in isolation, without costs or discounts. Thus, a network value of 200 for a given customer implies that by marketing to him we essentially get free marketing to an additional 200 customers. The scale of the graph depends on the marketing scenario (e.g., network values increase with ~, but the shape generally remains the same. The figure shows that a few users have very high network value. This is the ideal situation for the type of targeted viral marketing we propose, since we can effectively market to many people while incurring only the expense of marketing to those few. 
A customer with high network value is one who: (1) Is likely to purchase the product, and thus is more affected by the marketing, and (2) is trusted by many other people in the network, who tend 6 In previous work we varied the value of  X x and found that, while it affected the scale of results, they remained qualitatively simi-lar. to have low ~/, and who also have characteristic 2, and so on re-cursively. For instance, the customer with the highest network value (22,000) influences 784 people, and has a probability of purchasing of 0.03, which is 23 times that of the average person. The linear model introduced in this paper has tremendous speed advantages over a non-linear model such as that introduced in our previous work. Because of the independence that linearity pro-vides, we are able to simultaneously calculate the network value for all customers. The network value is independent of the market-ing actions being performed on others, which allows us to find the optimal marketing plan 7 without performing a heuristic search over plans. It would take approximately 100 hours to perform the single-pass search (the fastest of the heuristic search methods introduced in our previous work) with this model, or about 10-15 minutes if we make approximations in the inference. In contrast, the linear model takes 1.05 seconds to find the optimal marketing plan. At these speeds, our model could be used to find optimal marketing plans for markets involving hundreds of millions of customers in just hours. 
Continuous-valued marketing actions (M~E [0,I]) allow the mar-keter to better optimize the marketing plan -tailoring the action for each person specifically to his characteristics. Our framework allows for any function to be used to model Po( Xi I Y, Mi ), as long as it is differentiable in Mi. As in the Boolean case, we have chosen to model the effect of marketing as a multiplicative factor on the internal probability of purchasing: a(z) could be any differentiable function, and we assume o(0)=1. c(z) also could be any differentiable function. We have chosen c(z)=clz such that the cost of marketing is directly proportional to the amount of marketing being performed. ous marketing scenarios). If rl&lt;ro then the plan overestimates the revenues from influence on the network, potentially result-ing in a sub-optimal marketing plan. In our experience, this overestimation ranged from 1% to 10% of the profits. We thus believe the resulting plan was still nearly optimal. Figure 2: Marketing effect vs. marketing action. 
We believe an exponentially asymptotic function for o(z) is rea-sonable; it models the phenomenon of diminishing returns (i.e., the more money that is spent on marketing, the less improvement is derived 'from it). We also experimented with logarithmic and inverse polynomial functions, which gave similar results. The function we used was: the curvature of the function; a(z) converges to a** more quickly with a large 2. In the experiments below, we used .~=5, which is large enough that o(1) = ~ yet low enough that o(z) does not converge to a, too quickly. The resulting curve, for 6~,,--2, is 
From equation 9, we can find the optimal marketing action for each customer Z =-2 
The second derivative is negative, implying the point is a maxi-16 10 J provide a list of the people he trusts, selecting another user to query, and so on. We assume the company has a fixed amount of a user is constant. The interesting problem is thus not how many users to query, but how to select the subset of users to query that leads to the most profit. 12 
In our previous work [5], we mined a collaborative filtering sys-tem to demonstrate the advantages of our viral marketing ap-proach over direct or mass marketing. There, we used a more complicated, piecewise linear function over product ratings to determine the influences of customers on each other. In this paper, we used a model with stronger linearity assumptions to achieve greater scalability. A disadvantage of our previous work is that it required full knowledge of network structure, and restricted the marketer to selecting Boolean marketing actions. Both of these limitations were addressed and overcome in this paper. 
Interestingly, the computation of network effect (see Equation 7) is very similar to the PageRank[21] algorithm, used by Google[2] for determining important web pages. In PageRank, a web page is valued highly if many highly valued pages point to it. Similarly, in viral marketing a customer is valued highly if he influences many highly valued customers. The computation is equivalent to finding the primary eigenvector of the matrix W, where Wij=Wij (wji 
PageRank). The network effect of a customer is also proportional to the probability that a random walker, who randomly traverses the links of influence in the network backwards, is at that cus-tomer. Also related is the HITS[15] algorithm, which would find bipartite "trusts/trusted-by" sub-graphs in the web of trust. Inter-estingly, social networks, the World-Wide Web, and many natu-rally occurring networks all exhibit Zipfian, or "scale free" char-acteristics, and have been the topic of much recent research [17] [1]. 
Social networks have been the object of much research. One clas-sic paper is that by Milgram [20], which estimated that every per-son in the world is only six acquaintances away from every other. 
Some recent social network research uses the Internet as a source of data. For instance, Schwartz and Wood [23] mined social rela-tionships from email logs, the ReferralWeb project mined a social network from a wide variety of publicly-available online informa-tion [14], and the COBOT project gathered social statistics from participant interactions in the LambdaMoo MUD [11]. Our net-work was mined from a knowledge-sharing site. A good overview of Epinions and other sites like it can be found in Frauenfelder [6]. 
Several researchers have studied the problem of estimating a cus-tomer's lifetime value from data [12], generally focusing on vari-ables like an individual's expected tenure as a customer [19] and future frequency of purchases [7]. Networks of customers have received some attention in the marketing literature [10] but most of these studies are purely qualitative, or involve very small data sets and overly simplified models. Krackhardt [16] proposes a model for optimizing which customers to offer a free sample of a product to, but the model only considers the impact on the cus-tomer's immediate friends, assumes the relevant probabilities are the same for all customers, and is only applied to a made-up net-work with seven nodes. 
We have developed models for viral marketing on social networks mined from real-world data. There are many directions in which these models, or their use, could be extended. In this section, we describe some of the main ones. 
In this paper, we mined a network from a single source. In gen-eral, multiple sources of relevant information will be available; 
This research was partly funded by NSF CAREER and IBM Faculty awards to the second author. [1] A.L. Barab~isi, R. Albert, and H. Jong. Scale-free character-[2] S. Brin and L. Page. The anatomy of a large-scale hypertex-[3] D.M. Chickering and D. Heckerman. A decision theoretic [4] P. Domingos and M. Pazanni. On the optimality of the sim-[5] P. Dolningos and M. Richardson. Mining the Network Value [6] M. Frauenfelder. Revenge of the know-it-alls: Inside the [7] K. Gelbrich and R. Nakhaeizadeh. Value Miner: A data min-[8] R.A. Howard. Information value theory. IEEE Transactions [9] A.M. Hughes. The Complete Database Marketer: Second-[10] D. Iacobucci, editor. Networks in Marketing. Sage, Thousand [11] C. L. Isbell, Jr., M. Kearns, D. Korman, S. Singh, and P. [12] D. R. Jackson. Strategic application of customer lifetime [13] S. Jurvetson. What exactly is viral marketing? Red Herring, [14] H. Kautz, B. Selman, and M. Shah. ReferralWeb: Combining [ 15] J. M. Kleinberg. Authoritative sources in a hyperlinked envi-[16] D. Krackhardt. Structural leverage in marketing. In D. [17] R. Kumar, P. Raghavan, S. Rajagopalan, and A. Tomkins. [18] C. X. Ling and C. Li. Data mining for direct marketing: [19] D. R. Mani, J. Drew, A. Betz, and P. Datta. Statistics and [20] S. Milgram. The small world problem. Psychology Today, [21] L. Page, S. Brin, R. Motwani, and T. Winograd. The PageR-[22] G. Piatetsky-Shapiro and B. Masand. Estimating campaign [23] M. F. Schwartz and D. C. M. Wood. Discovering shared [24] S. Wasserman and K. Faust. Social Network Analysis: Meth-[25] G. K. Zipf. Human Behavior and the Principle of Least Ef-
In this appendix, we give a proof for Equation 7: Ai (Y) = ~ wjiAj (Y) 
As this is an iterative equation, we identify which iteration we are on by a super-script. Let be the n th estimate of customer i's network effect and probability of purchasing, respectively, and let since on the 0 th iteration no network effect is taken into account. 
For notational convenience, we also define ~Pi = ZZ... Z WaliWa2a I ""Wkan_ X  for n _&gt; 2 (11) 0P/ =XWkmm 0e/ = ZWPlo'nZZ "'" Z Wta,iWta2a , ""Wtman_2 -~WkiZX k for n_&gt;l (12) k = k m 0e/ k = Z Wki~k k = 2.~Wkil3,k = 2.~ Wkil~k k 
