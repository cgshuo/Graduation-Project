 Brain-Computer-Interfaces (BCIs) allow communication wi thout using the peripheral nervous sys-tems by detecting intentional changes in the mental state of a user (see [1] for a review). For BCIs based on electroencephalography (EEG), different mental s tates are correlated with spatio-temporal pattern changes in the EEG. These can be detected and used for transmitting information by a suit-able classification algorithm. While a variety of mental stat es can be used to induce pattern changes in the EEG, most BCIs utilize motor imagery of different limb s for this purpose. This is based on the observation that movement preparation of a certain limb leads to a power decrease (event related desynchronization -ERD) in the  X  -(  X  8  X  12 Hz) and  X  -spectrum (  X  18  X  26 Hz) over the area of the contralateral motor cortex representing the specific limb [2]. This ERD can also be observed in motor imagery, which was first used in [3] to discriminate i maginary movements of the left vs. imaginary movements of the right hand. While the methods pres ented in this paper are also applica-ble to BCIs that are not based on motor imagery, we restrict th e discussion to this class of BCIs for sake of simplicity.
 In general, a BCI has to accomplish two tasks. The first task is the feature extraction, i.e., the ex-traction of information from the EEG relevant for discrimin ating different mental states. The second task is the actual classification of these feature vectors. F or BCIs based on EEG, the feature extrac-tion is aggravated by the fact that due to volume conduction o nly the superimposed electric activity of a large area of cortex can be measured at every electrode. Wh ile it is known that the ERD caused by motor imagery originates in the motor cortex [4], the EEG m easured on the scalp over the motor cortex includes electrical activity of multiple neural sou rces that are not related to the imaginary movements. This in turn leads to a lower signal-to-noise-ra tio (SNR) and subsequently to a lower classification accuracy. For this reason, algorithms have b een developed that use multiple record-ing sites (electrodes) to improve feature extraction. One o f the most successful algorithms in this context, as evidenced by the 2003 BCI Competition [5], is the method of Common Spatial Patterns (CSP). It was introduced to EEG analysis in [6] and first utili zed for BCIs in [7]. Given two EEG data sets recorded during motor imagery of the left and right hand, the CSP-algorithm finds two linear transformations that maximize the variance of the on e while minimizing the variance of the other data set. With the CSP-algorithm used for feature extr action, it has been shown that a simple linear classification algorithm suffices to obtain classific ation rates above 90 % for trained subjects [7]. While these are impressive results, the CSP algorithm su ffers from a lack of robustness. The algorithm is trained to maximize the differences between tw o datasets, regardless of the cause of these differences. In the ideal case the spatio-temporal di fferences are caused only by the motor imagery, in which case the algorithm can be claimed to be opti mal. In practice, however, the differ-ences between two datasets will be due to multiple causes suc h as spontaneous EEG activity, other data sets, the CSP is trained on the artifact and not on the dif ferences caused by motor imagery [7]. Consequently, the CSP algorithm requires artifact free dat a, which is a serious impairment for its practical use.
 In this paper, we propose to replace the information used for training in the CSP algorithm by a-of imaginary movements originates in the motor cortex [4]. M ore specifically, we design an adap-predefined region of interest (ROI) in the cortex and the over all variance of the EEG measurements. In this way, we can design spatial filters that optimally supp ress electric activity originating from other areas than the chosen ROI. By designing two spatial filt ers with the respective ROIs centered in the hand areas of the motor cortex in the left and right hemi sphere, we achieve a robust feature extraction that enables better classification results than obtained with the CSP-algorithm. The rest of this paper is organized as follows. In the methods section, we briefly review the CSP-algorithm, derive the ASF and discuss its properties. In the results section, the ASF is applied to EEG data of three subjects, recorded during imaginary movem ents of the right and left hand. The results are compared with the CSP-algorithm, and it is shown that the ASF is superior to the CSP approach. This is evidenced by a significant increase in meas ured ERD and higher classification accuracy. We conclude the paper with a discussion of the resu lts and future lines of research. In this section we will first briefly review the CSP-algorithm , and then show how the information used for training the CSP-algorithm can be replaced by a-pri ori information. We then derive the ASF, and conclude the section with some remarks on the theore tical properties of the ASF. 2.1 The Common Spatial Patterns Algorithm Given two EEG data sets x T the number of samples, the CSP-algorithm finds a linear trans formation w that maximizes the variance of the one while minimizing the variance of the othe r data set. This can be formulated as the following optimization problem [8]: with R form of the well known Rayleigh quotient, which means that th e solution to (1) is given by the eigenvector with the largest eigenvalue of the generalized eigenvalue problem The two eigenvectors w spatial filters that maximize the variance of the one while mi nimizing the variance of the other data set. If data set x recorded during imaginary movements of the right hand, and t he differences between the two data sets are only caused by motor imagery, the two spatial filters w the second moments) extract the component of a data set cause d by the respective motor imagery. In practice, however, the differences between two datasets will have multiple causes such as spon-taneous EEG activity, mental states unrelated to the motor i magery or muscular artifacts. If the CSP-algorithm is applied to such data, the linear transform ations w artifactual components of the EEG and not the spatial-tempo ral pattern changes caused by the motor imagery. 2.2 Derivation of the Adaptive Spatial Filter feature extraction, we replace the information used for tra ining in the CSP-algorithm by a-priori information. In the case of motor imagery, the specific a-pri ori information is that the signal of interest for classification originates in the motor cortex. We will now show how the component of the EEG originating in a certain ROI, chosen to correspond to the motor cortex for our purpose, can be estimated in an optimal manner.
 does not originate in a chosen ROI. This however is not possib le due to the ill-posed nature of the inverse problem of EEG (c.f., [9]). In EEG recordings, elect ric activity originating from an infinite number of measurement electrodes. Hence, the best one can do is to find a spatial filter that in some sense optimally suppresses all activity not originating in the chosen ROI.
 Towards this goal, note that the electric field generated by t he brain at a position r outside the head is given by (c.f., [10]) with V the volume of the brain, P : R 3  X  R 7 X  R 3 the tissue dipole moment (source strength) at position r  X  and time t in x, y, and z -direction, and L : R 3  X  R 3 7 X  R 3 the so called leadfield equation, describing the projection strength of a source wi th dipole moment in x, y, and z -direction all geometric and conductive properties of the brain. In EEG recordings, the electric field of the brain is spatially sampled at i = 1 . . . N electrodes on the scalp with position r i , resulting in a measurement vector x ( t ) with the elements We now wish to find a linear transformation of the measured EEG and the overall variance. For this we define the component of t he EEG originating in a certain ROI as  X  x ( t ) , with the elements The spatial filter w is then found by and R problem is in the same form as that of the CSP-algorithm in (1) . As for (1), the solution to (7) is given by the eigenvector with the largest eigenvalue of the g eneralized eigenvalue problem The crucial difference between the CSP-and the ASF-algorit hm is that for the CSP-algorithm the covariance matrix R the measured EEG of one condition. For the ASF-algorithm, th e corresponding covariance matrix R x ( t ) We will now show how estimates of the two covariance matrices R solving (8), can be obtained. Assuming stationarity of the E EG, i.e., a constant covariance matrix, R x ( t ) with T the number of samples. The covariance matrix of the EEG origi nating in the ROI however is substantially harder to estimate. To obtain an estimate of R This is done by placing an equally spaced grid with nodes at lo cations r  X  and replacing the integral over the ROI by a sum over the M grid points, The estimated component of the EEG originating in the ROI can then be written in matrix notation as with L  X  R N  X  3 M describing the projection strength of the M sources in x, y, and z -direction to each of the N electrodes, and p ( t )  X  R 3 M representing the dipole moments of the M sources. The estimate of the covariance matrix is then given by In absence of any prior knowledge, the covariance matrix of t he sources in the ROI is assumed to be the identity matrix, i.e., R a suitable model of EEG volume conduction. For sake of simpli city, we only consider a four-shell spherical head model, i.e., each column l current dipole with unit dipole moment at position r calculating its projection to each of the N electrodes [11].
 In summary, the adaptive linear spatial filter w is given by the eigenvector with the largest eigenvalue of the generalized eigenvalue problem Note that the largest eigenvalue corresponds to the achieve d ratio of the ASF, i.e., f ( w ) =  X  . The largest eigenvalue of (13) thus is a measure for the quality o f the obtained ASF.
 It is also important to point out that the covariance matrix o f the component of the EEG originating in the ROI is assumed to be the identity matrix, implying that sources in the ROI are not correlated. This surely is an assumption that is not physiologically jus tified. We will address this issue in the discussion. Finally, note that the quality of the obtained fi lter also depends on the rank of the co-variance matrix of the electric activity originating in the ROI. The higher the rank of R tivity originating in the ROI, and consequently less degree s of freedom are available for suppressing electric activity originating outside the ROI. The quality of the spatial filter thus decreases with the rank of R ROI, which leads to a covariance matrix with a lower rank than if dipole moments in x, y, and z -direction are considered. Furthermore, this is a physiolog ically justified assumption, since neurons in a cortical column are oriented radially to the surface of t he cortex (c.f., [9]). In this section, we evaluate the effectiveness of the ASF by a pplying it to EEG data gathered from three subjects during motor imagery of the right and left han d, and compare its performance with the CSP-algorithm. Subsequently motor imagery of the left/rig ht hand will be termed condition IL/IR. 3.1 Experimental Setup Three subjects (S1, S2, S3) participated in the experiment, all of which were male, aged 26, 30, and 27 years, and had no known neurological disorders. Subje cts S1 and S2 had no experience with motor imagery or BCIs, while subject S3 participated in a motor imagery experiment for the second time. The subjects were placed in a shielded room appr oximately two meters in front of a screen, and were asked to continually imagine opening and cl osing their right/left hand as long as an arrow pointing in the respective direction was displayed on the screen. The subjects were explicitly instructed to perform haptic motor imagery, i.e., to feel ho w they were opening and closing their hands, to ensure that actual motor imagery and not visual ima gery was used. Each trial started with a fixation cross, which was superimposed by an arrow either po inting to the right or to the left after three seconds. The center of the arrow was placed in the middl e of the screen to avoid lateralized visual evoked potentials. The arrow was removed again after further seven seconds, indicating the condition in randomized order. During the experiment, EEG w as recorded at 128 channels with a sampling rate of 500 Hz. Electrode Cz was used as a reference , and the data was re-referenced offline to common average. The spatial position of each elect rode was measured with a tracking system. No trials were rejected and no artifact correction w as employed. 3.2 Design of the Common Spatial Patterns For each subject, the CSPs were found by by first bandpass-filt ering the data between 10 -30 Hz (as suggested in [7]) using a sixth order butterworth filter, and then calculating the sample covariance matrices R to 10 s (i.e., starting 500 ms after the instruction which mot or imagery to perform). Equation (2) was then solved and only the two most discriminative eigenve ctors w with the largest and smallest respective eigenvalue, were u sed to obtain estimates of the two most discriminative components of each data set. 3.3 Design of the Adaptive Spatial Filters To obtain estimates of the electric field originating in the h and areas of the left and right motor cortex, two ASFs were designed. For the first ASF, the ROI was c hosen as a sphere located 1 cm inside the cortex radially below electrode C3 (centered abo ve the hand area of the motor cortex of the left hemisphere) with a radius of 1 cm. Radially oriented dip oles with unit moment were placed on an equally spaced grid 2 mm apart from each other inside the sp here, and their respective projections to each of the electrodes were calculated as in [11] to obtain an estimate of the leadfield matrix L in (11). For this purpose, the measured positions of the elec trodes were radially projected onto the outermost sphere of the headmodel. The second ASF was design ed in the same fashion, but with the center of the sphere located at the same depth as the first one r adially below electrode C4 (centered above the hand area of the motor cortex of the right hemispher e).
 estimated according to (9), using EEG data in the same time wi ndow as for computation of the CSPS (3.5 to 10 s of each trial). The two ASFs with the ROIs cent ered below electrodes C3 and C4 were then calculated by solving the generalized eigenvalue problem (13), and taking the eigenvector with the largest eigenvalue as the ASF. The estimated activi ty inside the ROIs was then obtained by multiplying the ASFs with the observed EEG of that trial acco rding to (5). Note that this was done independently for each recorded trial.
 Figure 1: Difference plots of ERS/ERD relative to pre-stimu lus baseline (0 -3 s) between conditions IL and IR for subject S3. Time of stimulus onset is marked by th e dotted vertical line. See text for explanations. 3.4 Experimental Results To obtain estimates of the frequency bands suitable for clas sification, event related synchroniza-tion and desynchronization (ERS/ERD) was calculated for ea ch subject relative to the pre-stimulus baseline (0 -3 s) as implemented in [12]. This was done indepe ndently for the EEG measured at electrodes C3 and C4, the EEG components obtained by the CSP-algorithm and the estimated EEG components originating in the motor cortex as obtained by th e ASFs. Since motor imagery leads to a contralateral ERD, the ERS/ERD of condition IL was subtrac ted from the ERS/ERD of condition IR for measurements at electrode C3 and spatial filters focus ing on the left hemisphere, and vice versa for measurements at electrode C4 and spatial filters fo cusing on the right hemisphere. The results for subject S3 are shown in Fig. 1. As can be seen in the first column, an ERD-difference of about 3 dB can be measured over the contralateral motor cor tex at electrodes C3 and C4 in two frequency bands, starting briefly after the instruction to p erform the motor imagery. The two reactive frequency bands are centered roughly around 12 and 25 Hz, agr eeing well with the expected ERD in the  X  -and  X  -band [3]. The components extracted by the CSPs, shown in the second column of Fig. 1, show a different picture. While the first CSP (top row) e xtracts the ERD in the  X  -and  X  -band with roughly the same SNR as in the first row of Fig. 1, high-fre quency noise is also mixed in. The second CSP (bottom row) on the other hand does not extract the ERD related to motor imagery, but focuses on a strong artifactual component above 15 Hz. Th e third column of Fig. 1 shows the results obtained with the ASFs centered radially below elec trodes C3 and C4. The observed ERD is similar to the one measured directly at electrodes C3 and C 4 (first column of Fig. 1), but shows a much stronger ERD of about 7 dB in the  X  -and  X  -band. These observation are also reflected in the actual CSPs (calculated for the whole data set) and ASFs ( calculated for one representative trial) of subject S3 shown in Fig. 2. While CSP 1 focuses on electrodes in the vicinity of electrode C3, CSP 2 focuses on frontal areas of the recorded EEG that are not related motor control. The ASFs on the other hand can be seen to focus on motor areas surrounding electrodes C3 and C4, with various minor patches distributed over the scalp that suppress elec tric activity originating outside the ROI. It is thus evident that the ASFs improve the SNR of the compone nt of the EEG related to motor imagery relative to just measuring the ERD above the motor co rtex, while the CSPs fail to extract the ERD related to motor imagery due to artifactual componen ts. Similar ERS/ERD results were obtained for subject S2, while only a very weak ERS/ERD could be observed for subject S1 for all three evaluation schemes.

The ERD plots at electrodes C3 and C4 of each subject were then used to heuristically determine the time window and two reactive frequency bands used for act ual classification. These are sum-marized in Tab. 1. For classification, the reactive frequenc y bands of the data sets obtained by the CSP-algorithm, the ASFs, and the raw EEG data measured at ele ctrodes C3 and C4 were extracted by using a sixth-order butterworth filter. For each of the thr ee evaluation approaches, the feature vectors were formed by calculating the variance in each of th e two frequency bands for each trial. This resulted in a four dimensional feature vector for each t rial and each evaluation approach. The feature vectors were then classified using leave-one-out cr oss validation with Fisher Linear Discrim-inant Analysis (c.f., [13]). Note that for the CSP algorithm this required recalculation of the CSPs for each cross validation. The classification results for ea ch approach and all three subject are shown in Tab. 1.
 As can be seen in Tab. 1, the ASFs lead to an increase in classifi cation accuracy relative to measuring the ERS/ERD at electrodes C3 and C4 of 3.3 -17.4 %. The CSP-alg orithm on the other hand leads to worse classification results compared to only using the ER S/ERD measured at electrodes C3/C4. In fact, for S1 and S2 the classification accuracy was not abov e chance for the CSP-algorithm. In agreement with [7], the ERS/ERD as well as the CSP plots for su bjects S1 and S2 (not shown here) to motor imagery. Subjects S2 and S3 achieved a classificatio n accuracy of 90.3 and 94.7 % using the ASFs, while subject S1 only achieved 63 %. This correlate s with the personal report of the subjects, with S2 and S3 reporting that they considered thei r motor imagery to be successful, while S1 reported difficulties in imaging opening and closing his h ands. In this paper, we presented a new approach for feature extrac tion for EEG-based BCIs. We derived specified ROI of cortex and the overall variance of the measur ed EEG. By designing two ASFs with the ROIs centered in the hand areas of the motor cortex, we sho wed that classification accuracy of imaginary movements of the left and right hand increased bet ween 3.3 and 17.4 % relative to using the EEG measured directly above motor areas at electrodes C3 and C4. This was achieved without sets lead to a classification accuracy below that of only usin g recordings from electrodes C3 and C4 for feature extraction for one subject, and a classification accuracy that was not above chance for the other two subjects. This was due to the lack of robustness of t he CSP-algorithm, focusing on artifac-tual components of the EEG. We thus conclude that the propose d ASF-method enables a significant increase in classification accuracy, and is very robust to ar tifactual components in the EEG. While the presented results are already promising, several a spects of the ASF can be further opti-mized. These include the four-shell spherical head model us ed for estimating the leadfield matrix, which is the most simple and inaccurate model available in th e literature. Employing more realistic models for volume conduction, such as finite element or bound ary element methods (FEM/BEM), are expected to further increase classification accuracy. F urthermore, the ROIs were heuristically chosen as spheres located radially below electrodes C3 and C 4. Due to individual differences in physiology and/or misplacement of the electrode caps, the R OIs were unlikely to be centered in the hand areas of the motor cortex of each subject. Optimization of the center and extent of the ROI, either by a-priori knowledge gained by fMRI scans or by numer ical optimization of the ERD in spe-cific frequency bands, is expected to lead to higher SNRs and h ence higher classification accuracy. Another issue that can be addressed to improve performance o f the ASF is the physiologically not justified assumption of uncorrelated sources in the ROI.
 Besides optimization issues of parameters, future lines of research include extending the algorithm to multi class problems, e.g., BCIs using motor imagery of mo re than two limbs. Conceptually, this can be done by designing another ASF centered in that area of m otor cortex representing the specific limb. Further research has to show which body parts are most s uited for this task. Finally, all work presented here has been done offline. Online versions of the A SF-algorithm are under development and will be presented in future work.
 [1] J.R. Wolpaw, N. Birbaumer, D.J. McFarland, G. Pfurtsche ller, and T.M. Vaughan. Brain-[2] H.H. Jasper and W. Penfield. Electrocorticograms in man: effect of the voluntary movement [3] G. Pfurtscheller, Ch. Neuper, D. Flotzinger, and M. Preg enzer. EEG-based discrimination [4] G. Pfurtscheller and F.H. Lopes da Silva. Event-related EEG/MEG synchronization and desyn-[6] Z.J. Koles. The quantitative extraction and topographi c mapping of the abnormal compo-[7] H. Ramoser, J. Mueller-Gerking, and G. Pfurtscheller. O ptimal spatial filtering of single trial [9] S. Baillet, J.C. Mosher, and R.M. Leahy. Electromagneti c brain mapping. IEEE Signal Pro-[10] P.L. Nunez and R. Shrinivasan. Electric Fields of the Brain. The Neurophysics of EEG . Oxford [11] B.N. Cuffin and D. Cohen. Comparison of the magnetoencep halogram and electroencephalo-[12] A. Delorme and S. Makeig. EEGLAB: an open source toolbox for analysis of single-trial EEG
