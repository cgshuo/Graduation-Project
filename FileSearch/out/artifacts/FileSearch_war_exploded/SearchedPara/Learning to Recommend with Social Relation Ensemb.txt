 Recommender systems with social networks (RSSN) have been well studied in recent works. However, these methods ignore the relationships among items, which may affect the quality of recommendations. Motivated by the observation that related items often have similar ratings, we propose a framework integrating items X  relations, users X  social graph and user-item rating matrix for recommendation. Experi-mental results show that our approach performs better than the state-of-art algorithm and the method with only users X  social graph ensemble in terms of MAP and RMSE.
 H.3.3 [ Information Systems ]: Information Filtering; J.4 [ Computer Applications ]: Social and Behavioral Sciences Recommender Systems, Item Relation, Social Network, Ma-trix Factorization, Social Recommendation
Recently, the recommendation systems utilizing social net-work information have been studied extensively. Most of these methods are based on the intuition that users X  trust relations[1][7] can be employed to enhance recommendation qualities. Such trust-aware methods, which make an as-sumption that trusted users will have similar tastes[4], push forward an important step in the study of recommender sys-tems.

However, current recommender systems assume that items are i.i.d. (independent and identically distributed)[5][6]. This assumption, which ignores the connections among items, is unreasonable in many scenarios. The first scenario is friend recommendation. For example, when recommending friends to a user, the user is inclined to accept the ones who have
Figure 1: Example for Friend Recommendation social relations with his friends. Another scenario is the product recommendation, where a user tends to buy the products related to what he has bought. For example, when a user bought a battledore, he would probably buy the shut-tlecocks later.

Motivated by the above observations, in this paper we ex-plore the usefulness of items X  connections in the environment of social networks. We propose a framework fusing items X  relations, users X  social graph and user-item matrix together for recommendation. We connect these three different data resources through the shared latent factor space. That is, the user latent feature space in the users X  social graph and the item latent feature space in the items X  relations are the same with the latent feature space in the user-item rating matrix.
In this section, we first introduce the latent factor analysis method based on probabilistic matrix factorization for rec-ommendation, and then propose a method with only users X  relations ensemble. Finally, we focus on how to employ the items X  connections, which are ignored in previous works, into our recommendation framework.
Let us first consider the scenario of friend recommenda-tion in the real world. Without loss of generality, we define a subset of users as recommended items and our goal is to find the most probable items that a user may favorite. Fig. 1 shows the process of friend recommendation in social net-work, which actually includes three central elements: the users X  social network, the items X  connections and the user-item rating matrix.

As presented in Fig. 1(a), there are 6 relations among 5 users (from u 1 to u 5 ) and 4 relations among 3 items (from v 1 to v 3 ). Each user builds connections with his interested items. Fig. 1(b) shows the user-item rating matrix, which reflects the favors of these users to each item (normally, 0 and 1 represent  X  X ate X  and  X  X ike X , respectively). The prob-lem we studied in this paper is how to predict the missing values for the users by employing the users X  relations, items X  connections and user-item rating matrix.
In order to make a better prediction for the users, we intro-duce matrix factorization method to factorize the user-item rating matrix, and utilize the factorized l -dimensional latent feature vectors to represent users and items[8]. The idea of a matrix factorization method is that it tries to characterize both items and users by inferring high-quality l -dimensional factors from the rating patterns.

In this paper, we consider a user-item rating matrix R with m users and n items, where r ij  X  X  0 , 1 } represents the user u i  X  X  rating value on item v j .Let U  X  R l  X  m V  X  R l  X  n be the latent user and item feature matrices, with the column vectors U i and V j representing user-specific and item-specific l -dimensional latent feature vectors, re-spectively. We define the conditional distribution over the observed ratings as[8]: where N ( x |  X ,  X  2 ) is the probability density function of the Gaussian distribution with mean  X  and variance  X  2 ,and I istheindicatorfunctionthatisequalto1ifuser u i rated item v j ; 0 otherwise. The function g ( x ) is the logistic func-tion g ( x )=1 / (1+ exp (  X  x )), which bounds the value of pre-dictions ( U T i V j ) within the range [0,1]. We place zero-mean spherical Gaussian priors on latent user and item feature vectors: p ( U |  X  2 U )= Hence, through a Bayesian inference, we have p ( U, V | R,  X  2 R , X  2 U , X  2 V )  X  p ( R | U, V,  X  2 R This basic matrix factorization model (PMF), which maps both users and items to a joint latent factor space, is based only on the user-item rating matrix without considering the information of users X  relations and items X  connections.
Now considering the users X  social relations, suppose we have a users X  directed social network graph G =( U , E ), where U = { u i } m i =1 represents the set of users and E resents the social connections among users. Let D = { d ij denote the m  X  m similarity matrix of users in graph G .For a pair of vertices, user u i and user u j ,let d ij  X  (0 , 1] de-note the closeness between u i and u j in social graph G .We
Figure 2: Graphical Model for Recommendation use one of the most popular method Katz[3] to calculate the similarity between two users in graph G .

We further use matrix factorization method to derive a high-quality l -dimensional latent users feature representa-tion U by analyzing the similarity matrix D of graph G . The latent user feature space is the same with the user fea-ture space in the user-item rating matrix. Let U  X  R l  X  m and Q  X  R l  X  m be the factorized latent user and factor fea-ture matrices, with column vectors U i and Q k representing user-specific and factor-specific latent feature vectors, re-spectively. We define the conditional distribution over the observed users X  social relationships as: where I D ik is the indicator function that is equal to 1 if user u hasrelationwithuser u k ; 0 otherwise. We also place zero-mean spherical Gaussian priors on latent user and factor feature vectors: p ( U |  X  2 U )= In order to investigate whether a user X  X  social connections will affect this user X  X  judgement on items, we fuse the users X  social graph and the user-item rating matrix into a consis-tent and compact feature representation (PMFU). Similar to literature [5], the posterior distribution for the recom-mendation is given by: p ( U, V, Q | R, D,  X  2 R , X  2 D , X  2 U , X  2 V , X  2 Q )
In previous research, the relationships of items are often ignored. In this section, we investigate how to utilize the items X  relations for recommendation, and propose a frame-work (PMFUI) fusing users X  social connections, items X  rela-tions and user-item rating matrix together.
 Suppose we have an items X  directed relation graph G  X  .Let S = { s ij } denote the n  X  n items X  similarity matrix, which can be calculated by Katz. We factorize this item similarity matrix S to learn a high-quality l -dimensional latent items feature representation V . The latent item feature space is the same with the item feature space in user-item rating matrix. Let V  X  R l  X  n and W  X  R l  X  n denote the latent item and factor feature matrices, with column vectors V j and W t representing item-specific and factor-specific feature vectors, respectively. We define the conditional distribution over the observed connections of items as: where I S tj is the indicator function that is equal to 1 if item v connected to item v j ; 0 otherwise. We place zero-mean spherical Gaussian priors on latent item and factor feature vectors: p ( V |  X  2 V )= In order to reflect the observation that the items X  connec-tions will affect a user X  X  interests in items. We model the problem using the graphical model described in Fig. 2, which fuses the items X  connections, users X  social relations and user-item rating matrix together. Based on Fig. 2, the log of the posterior distribution is given by: ln p ( U, V, W, Q | R, D, S,  X  2 R , X  2 D , X  2 S , X  2 U , X  where C is a constant that does not depend on the parame-ters. Maximizing the log-posterior over four latent features with hyperparameters kept fixed is equivalent to minimizing the following sum-of-squared-errors objective function with quadratic regularization terms:
E ( R, D, S, U, V, Q, W )= 1 where  X  D =  X  2 R / X  2 D ,  X  S =  X  2 R / X  2 S ,  X  U =  X  2  X  Frobenius norm. A local minimum of the objective function given by Eq. 10 can be found by performing gradient descent in W , Q , U and V :  X  X   X  X   X  X   X  X  gistic function.
In this section, we first conduct several experiments to compare the recommendation qualities of our approach with the basic matrix factorization method and the algorithm with only users X  relations ensemble. We then investigate how the model parameter  X  S affects the prediction accuracy. Our experiments are based on the data published by KDD Cup 2012 1 , which provides a sampled snapshot of Tencent Weibo 2 users X  preferences for various items. These items can be persons, organizations and groups. This dataset also provides richer information in multiple domains, e.g., user profiles and social links. The directed link between two items denotes the favorite-relationship from one to the other. As our method is only based on the structural information and the users X  preferences history, we extracted a subset (500,000 users and 6,000 items) including the information of social graph and rating history. We further extracted 287,381 links among users and 170,080 links among items. The new subset contains 21,803,721 training and 1,000,000 testing user/item pairs.
 We use two popular metrics[2], the Root Mean Square Error (RMSE) and the Mean Average Precision (MAP), to measure the recommendation qualities. RMSE is the preci-sion metric of rating prediction and the expression is given http://www.kddcup2012.org/c/kddcup2012-track1 http://t.qq.com/ note the real rating value and the predicted score from user u to item v j , respectively, T is the number of testing sam-ples.

MAP is the mean average precision for a set of recom-mended lists, which is defined as, MAP = 1 r r i =1 n k =1 where r is the number of recommended lists, m means the number of  X  X iked X  items, n is the number of items recom-mendedtoeachuserand P ( k ) means the precision at cut-off k in the item list. In experiments, we set n =3.
In order to show the performance improvement of our rec-ommendation method, we compare our algorithm (PMFUI) with the basic Probabilistic Matrix Factorization method (PMF) and the one with only users X  relations ensemble (PMFU).
The experimental results using 10-dimensional latent fea-ture vectors are shown in Table 1. The parameter settings of our approach are  X  D = 10,  X  S =0 . 5,  X  U =  X  V =  X  Q  X 
W =0 . 01 and in all the experiments, the maximum it-eration times are set to 100. From Table 1, we can ob-serve that the method PMFUI outperforms the other two approaches in both RMSE and MAP metrics. And the ba-sic PMF method that only using the user-item rating ma-trix performs worst in terms of MAP, which indicates purely utilizing users X  preferences history is not applicable. In ad-dition, the results also show that the items X  relations can provide useful information for the prediction of users X  tastes.
In PMFUI, the parameter  X  S plays an important role, which balances the information from user-related social rat-ing matrix and the items X  connections graph. It controls how much our method should depend on the items X  relations. If  X 
S = 0, our method will only utilize the user-item rating matrix and the users X  social network, and if  X  S  X  X  X  ,our model will only derive latent feature vectors from items X  re-lationships. In other cases, we make predictions by fusing information from the user-item matrix, users X  social graph and items X  link matrix.

Fig. 3 shows the impacts of  X  S on RMSE and MAP. We observe that the value of  X  S impacts the results markedly, which demonstrates that fusing the items X  social connections greatly improves the recommendation quality. As  X  S in-creases, the value of MAP increases (recommendation qual-ity increases) at first, but when  X  S surpasses a certain thresh-old, the MAP decreases (recommendation quality decreases) with further increase of the value of  X  S . The other metric RMSE has similar variation trend with  X  s increasing. The fluctuation of the metrics consistencies with the intuition that purely using the users X  social network and user-item matrix or purely using the items X  relations for predictions cannot get better results than fusing these three informa-tion together. Figure 3: Impact of Parameter  X  S (Dimensional-ity=10)
In this work, we focus on how to explore the usefulness of items X  relations. We propose a framework considering items X  connections, users X  relations and user-item rating matrix for recommendation. Although our method is proposed in the social network environment, it is quite general, and can be easily extended to other scenarios. For example, we can use Cosine similarity or other similarity functions to calculate the affinities among items by utilizing items X  genres or de-mographic information. Then we can plug these items X  sim-ilarity relationships into our recommendation framework.
This work is supported by the Natural Science Founda-tion of China (60970047, 61103151, 61173068), the Doctoral Fund of Ministry of Education of China (20110131110028), the Natural Science Foundation of Shandong Province (ZR20 12FM037), the Excellent Middle-Aged and Youth Scientists of Shandong Province (BS2012DX017) and the Graduate Independent Innovation Foundation of Shandong University (YZC12084). [1] P. Bedi, H. Kaur, and S. Marwaha. Trust based [2] L. L  X  u,M.Medo,C.H.Yeung,Y.-C.Zhang,Z.-K.
 [3] L. L  X  u and T. Zhou. Link prediction in complex [4] H. Ma, I. King, and M. Lyu. Learning to recommend [5] H. Ma, H. Yang, M. Lyu, and I. King. Sorec: social [6] H. Ma, D. Zhou, C. Liu, M. Lyu, and I. King.
 [7] P. Massa and P. Avesani. Trust-aware recommender [8] R. Salakhutdinov and A. Mnih. Probabilistic matrix
