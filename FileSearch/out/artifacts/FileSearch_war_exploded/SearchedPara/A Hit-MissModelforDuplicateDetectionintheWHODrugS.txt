 The WHO Collab orating Cen tre for International Drug Mon-itoring in Uppsala, Sweden, main tains and analyses the world's largest database of rep orts on susp ected adv erse drug reac-tion inciden ts that occur after drugs are introduced on the mark et. As in other post-mark eting drug safet y data sets, the presence of duplicate records is an imp ortan t data qual-ity problem and the detection of duplicates in the WHO drug safet y database remains a formidable challenge, esp e-cially since the rep orts are anon ymised before submitted to the database. However, to our kno wledge no work has been published on metho ds for duplicate detection in post-mark eting drug safet y data. In this pap er, we prop ose a metho d for probabilistic duplicate detection based on the hit-miss mo del for statistical record link age describ ed by Copas &amp; Hilton. We presen t two new generalisations of the standard hit-miss mo del: a hit-miss mixture mo del for er-rors in numerical record elds and a new metho d to handle correlated record elds. We demonstrate the e ectiv eness of the hit-miss mo del for duplicate detection in the WHO drug safet y database both at iden tifying the most likely duplicate for a given record (94.7% accuracy) and at discriminating duplicates from random matc hes (63% recall with 71% pre-cision). The prop osed metho d allo ws for more ecien t data cleaning in post-mark eting drug safet y data sets, and per-haps other applications throughout the KDD comm unit y. G.3 [ Probabilit y and Statistics ]: Statistical computing; H.2.m [ Database Managemen t ]: Miscellaneous; J.3 [ Life and medical sciences ]: Health Algorithms Duplicate detection, hit-miss mo del, mixture mo dels The WHO Collab orating Cen tre for International Drug Monitoring in Uppsala, Sweden (also kno wn as the Upp-sala Monitoring Cen tre) holds the world's largest database of spontaneous rep orts on susp ected adv erse drug reaction (ADR) inciden ts. Spontaneous rep orts are pro vided to phar-maceutical companies and regulatory bodies by health pro-fessionals upon the observ ation of susp ected ADR inciden ts in clinical practice. The 75 mem ber coun tries of the WHO Programme for International Drug Monitoring routinely for-ward ADR case rep orts submitted to their medical pro ducts agencies to the Uppsala Monitoring Cen tre. The rst case rep orts in the WHO drug safet y database date bac k to 1967 and as of Jan uary 2005 there are over 3 million rep orts in total in the data set; curren tly around 200,000 new rep orts are added to the database eac h year.

While the analysis of spontaneous rep orting data is one of the most imp ortan t metho ds for disco vering previously unkno wn safet y problems after drugs are introduced on the mark et [16], it is sometimes impaired by poor data qual-ity [11], and in particular the presence of duplicate case rep orts. Quan titativ e metho ds are imp ortan t in screening spontaneous rep orting data for new drug safet y problems [1], and may highligh t poten tial problems based on as few as 3 case rep orts on a particular event, so the presence of just 1 or 2 duplicates may sev erely a ect their ecacy . While there is a general consensus that the presence of duplicates is a ma jor problem in spontaneous rep orting data, there is a lack of published researc h with resp ect to the exten t of the problem. A study on vaccine ADR data quoted prop or-tions of around 5% con rmed duplicates [14]. However, at times the frequency may be much higher: in a recen t re-view of susp ected quinine induced throm bocytop enia, FD A researc hers iden ti ed 28 of the 141 US case rep orts (20%) as duplicates [6].
There are at least two common causes for duplication in post-mark eting drug safet y data: di eren t sources (health professionals, national authorities, di eren t companies) may pro vide separate case rep orts related to the same event and there may be mistak es in linking follo w-up case rep orts to earlier records. (Follo w-up rep orts are submitted for exam-ple when the outcome of an event is disco vered.) The risk of duplication is likely to have increased in recen t years due to the adv ent of information technology that allo ws case re-ports to be sen t bac k and forth more easily between di eren t organisations [8], and the transfer of case rep orts from na-tional cen tres to the WHO migh t introduce extra sources of error, including the risk that more than one national cen tre pro vide case rep orts related to the same event.

Duplicate records are typically much more similar than random pairs of records. There are however imp ortan t ex-ceptions. For example, separate case rep orts are sometimes pro vided for the same patien t recorded at the same doctor's app ointmen t when the patien t has su ered from unrelated ADRs. Suc h record pairs may matc h perfectly on date, age, gender, coun try and drug substances, but should not be con-sidered as duplicates. The opp osite problem is illustrated by so called mother-c hild rep orts that relate to ADR inciden ts in small children from medication tak en by the mother dur-ing pregnancy . Suc h record pairs di er greatly dep ending on whether the patien t information relates to the mother or the child.

The need for algorithms to systematically screen for du-plicate records in drug safet y data sets is clear [5]. There are no published pap ers in this area, but general duplicate detection metho ds are available [3, 10, 12, 17]. In addi-tion, the fundamen tally similar problem of record link age (matc hing records across data sets) has been studied since the 1960s [9, 13]. We have chosen to dev elop a duplicate de-tection metho d based on the hit-miss mo del for statistical record link age describ ed by Copas &amp; Hilton [7]. The hit-miss mo del has sev eral imp ortan t bene cial prop erties. It imp oses no strict criteria that a pair of records must ful l in order to be highligh ted as susp ected duplicates, whic h is useful for spontaneous rep orting data where errors occur in all record elds. Rather than just classifying record pairs as likely duplicates or not, the hit-miss mo del pro vides a priori-tisation (scoring) with resp ect to the chance that a given pair of records are duplicates. This allo ws the num ber of record pairs highligh ted to be adjusted dep ending on the resources available for man ual review. While the hit-miss mo del pun-ishes discrepancies it rew ards matc hing information, whic h ensures that iden tical record pairs with very little data listed are unlik ely to be highligh ted for follo w-up at the exp ense of more detailed record pairs with sligh t di erences. Further-more, the rew ard for matc hing information varies dep ending on how common the matc hing event is, so that for example a matc h on a rare adv erse event is considered stronger ev-idence than a matc h on gender. The fact that most of the hit-miss mo del parameters are determined by the prop erties of the entire data set reduces the risk of over-tting the al-gorithms to training data, whic h is very imp ortan t for the WHO database, where the amoun t of lab elled training data is limited.

The aim of this pap er is to prop ose two new impro ve-men ts to the standard hit-miss mo del (a mo del for errors in numerical record elds and a computationally ecien t approac h to handling correlated record elds) and to sho w Figure 1: W jj ( j ) based on (8), for sev eral values of a and b that the adapted hit-miss mo del is very useful in real world duplicate detection. We t the hit-miss mo del to the WHO drug safet y database, and evaluate its performance on a test set of real world database records that includes a certain prop ortion of kno wn duplicates.
The hit-miss mo del is a probabilit y mo del for how dis-crepancies between database records that relate to the same underlying event occur. Let X = j and Y = k denote the observ ed values on two database records for a certain record eld and let p j and p k denote the corresp onding probabili-ties. The join t probabilit y for this pair of values under the indep endence assumption is p j p k . The hit-miss mo del pro-vides an estimate p jk for the same probabilit y under the assumption that the two records are duplicates. The con tri-bution from eac h record eld (its weigh t) to the total matc h score is equal to the log-lik eliho od ratio for the two hypothe-ses (high values corresp ond to likely duplicates): and the total matc h score is found by adding together the weigh ts for all di eren t record elds.
 Under the hit-miss mo del, eac h observ ed record eld value X is based on a true but unobserv ed event T . Observ ed values are assumed to be either misses, blanks or hits. Misses occur with probabilit y a , blanks with probabilit y b and hits with probabilit y 1 a b . For a miss X is a random variable follo wing the overall incidence of T , for a blank the value of X is missing and for a hit X = T .

Let P ( T = i ) = i and let P ( X = j j T = i ) = ji . The follo wing holds generally under the assumption that X and Y are indep enden t conditional on T : Table 1: Outcomes of interest (H=hit, D=deviation, M=miss) in the hit-miss mixture mo del, together with asso ciated probabilities and distributions for d .
Under the hit-miss mo del: and it can be sho wn that if c = a (2 a 2 b ): Based on (4): Thus, for a given record eld, we estimate b by its relativ e frequency of blanks in the entire database and i by its rel-ativ e frequency of value i among non-blanks in the entire database. c is estimated by the relativ e frequency of discor-dan t pairs for this record eld among non-blanks in the set of iden ti ed duplicate pairs, divided by 1 P i 2 i . (3), (4) and (5) give: W Thus, all mismatc hes for a given record eld receiv e the same weigh t and blanks receiv e weigh t 0. It can be sho wn that matc hes on rare events receiv e greater weigh ts than matc hes on more common events ( W jj decreases when j increases) as would intuitiv ely be exp ected. The detailed beha viour of W jj as a function of j is illustrated in Figure 1 for di eren t values of a and b .
For numerical record elds suc h as date and age, man y types of error are more likely to yield small di erences be-tween true and observ ed values. If, for example, two di er-ent sources send separate case rep orts related to the same inciden t, the dates may perhaps disagree, but it is more likely that they should di er by a few days than by sev eral years. Similarly , the registered age for patien t sometimes di ers from the true value, but then a small di erence is more likely than a large one. At the same time, there may 1. Mak e initial guesses for the parameters ^ a 1 , ^ a 2 2. Expectation step: Calculate ^ 1 ; : : : ; ^ 4 : 3. Maximisation step: Calculate the weigh ted vari-4. Iterate 2-3 until con vergence Table 2: EM algorithm for the hit-miss mixture mo del. be other types of errors ( e.g. typing errors) where a large numerical di erence is as likely as a small one. In order to handle both possibilities, we prop ose a hit-miss mixture mo del whic h includes a new type of miss for whic h small deviations from the true value are more likely than large ones. To distinguish between the two types of misses in this mo del, we refer to the rst type as 'misses' and the second type as 'deviations'. If T is the true, but unobserv ed value, then X is a random variable assumed to have been generated through a pro cess that results in a deviation with probabil-ity a 1 , a miss with probabilit y a 2 , a blank with probabilit y b and a hit with probabilit y 1 a 1 a 2 b . For a devia-tion, X follo ws a N ( T; 2 1 ) distribution and for a miss, X is a random variable indep enden t of T but with the same distribution. For a blank, the value of X is missing and for a hit, X = T .

For two observ ed numerical values X = i and Y = j , we focus on the di erence d = j i . For duplicates we must distinguish between 6 possible outcomes for the hit-miss mixture mo del as listed in Table 1 where ( d ; ; 2 denotes a normal distribution with mean and variance 2 and ( d ) denotes Dirac's delta function, whic h has all its probabilit y mass cen tred at 0. f ( d ) denotes the probabilit y densit y function for the di erence between two indep enden t random events that follo w the same distribution as T , suc h as for example hits and misses. Under the assumption that var( T ) 2 1 , the di erence between a miss and a deviation also follo ws this distribution.

Thus, the hit-miss mixture mo del for the di erence d be-tween the numerical values for two duplicates can be reduced to four comp onen ts: p d ( d ) = (1 a 1 a 2 b ) 2 ( d ) + a 2 (2 a 2 2 b ) f ( d )+
For unrelated records, d follo ws the more simple distribu-tion: and we can calculate log-lik eliho od ratio based weigh ts W ( d ) by integrating (9) and (10) over an interv al corresp onding to the precision of d (for two observ ed ages, for example, over d 1 years) and taking the logarithm of the ratio of integrals. As in the standard hit-miss mo del, single or double blanks receiv e weigh t 0.

In practice, f ( d ) must be estimated from training data (often a normal appro ximation is acceptable) and the prob-abilit y for a blank b is estimated by the relativ e frequency of blanks in the entire database. To estimate the other param-eters, an EM mixture iden ti er can be used. The restriction that the four mixture prop ortions be determined by a 1 and a 2 complicates the maximisation step of the EM algorithm, but can be accoun ted for in numerical maximisation. For a detailed outline of EM hit-miss mixture iden ti cation, see Table 2.
The standard hit-miss mo del assumes indep endence be-tween record elds and this allo ws the total matc h score for a record pair to be calculated by simple summation of the weigh ts for individual record elds. The indep endence assumption may, however, lead to over-estimated evidence that two records that matc h on a set of strongly correlated elds are duplicates, and this may hinder e ectiv e duplicate detection.

To reduce the risk for high total matc h scores driv en solely by a group of correlated record elds, we prop ose a mo del that accoun ts for pairwise asso ciations between correlated events. Let j 1 ; : : : ; j m denote a set of events related to di er-ent elds on the same database record. In the indep endence mo del, the probabilit y that these events should co-o ccur on a record is: The corresp onding total con tribution to the matc h score is: X but this is based on the assumption that the information in the di eren t record elds can be considered indep enden tly.
If no assumption of indep endence can be made, the join t probabilit y for the set of events j 1 ; : : : ; j m can only be ex-pressed as: However, the amoun t of data required to reliably estimate P ( j m j j 1 ; : : : ; j m 1 ) increases rapidly with m . As a compro-mise we prop ose the follo wing appro ximation that accoun ts for pairwise asso ciations only: For correlated record elds, (14) may be used instead of (11) to mo del the join t distribution. Let: Then: and: X Thus, the adjusted matc h score can be calculated by sub-tracting a sum of comp ensating terms from the original matc h score. Eac h comp ensating term can be written on the follo wing form: and a shrink age estimate for this log-ratio has earlier pro ven useful, as robust strength of asso ciation measures to nd interesting asso ciations in the WHO drug safet y database [1, 15]. This strength of asso ciation measure is referred to as the IC and is de ned as [1, 15]: Shrink age is achiev ed through Bayesian inference with a prior distribution designed to mo derate the estimated IC values toward the baseline assumption of indep endence ( IC = 0) [1, 15]. The adv antage of using IC values rather than raw observ ed-to-exp ected ratios is that they pro vide less volatile estimates when little data is available. In order to pro vide more robust scoring of correlated record elds, we prop ose IC shrink age estimates be used to estimate log 2 j t
The ordering of events j 1 ; : : : ; j m may a ect the magni-tude of the comp ensating term in (18) since conditioning is only allo wed on preceding events in the sequence. As a less arbitrary choice of ordering, we prop ose the set be re-arranged in decreasing order of maximal IC value with another event in the set of matc hed events.
An adapted hit-miss mo del was tted to the WHO drug safet y database based on the data available at the end of 2003, including a set of 38 man ually iden ti ed groups of duplicate records. f ( d ) functions together with tted normal distributions.
Although the WHO database allo ws for the transmission and storage of a large amoun t of data for eac h individual case rep ort, there are few records that have even the ma jorit y of the elds lled in [1]. However, all records in the data set have at least one drug substance, one ADR term and the rep orting coun try listed. For the iden ti cation of possible duplicate records, the follo wing record elds were considered the most relev ant: date of onset, patien t age, patien t gender, rep orting coun try, patien t outcome, drug substances used and ADR terms observ ed (drug substances and ADR terms are in fact sets of binary events related to the presence or absence of eac h). Table 3 lists basic prop erties for these record elds.

Some data pre-pro cessing was required. Onset dates are related to individual ADR terms, and although there tends to be only one distinct onset date per record, there are 1184 records (0.04% of the database) that have di eren t onset dates for di eren t ADR terms; for those records, the earli-est listed onset date was used. For the gender and outcome elds \-" had sometimes been used to denote missing val-ues, and was thus re-enco ded as suc h. Similarly , gender was sometimes listed as N/A whic h was also considered a missing value. For the age eld, a variet y of non-standard values were interpreted as missing values and re-enco ded as suc h. Sometimes di eren t age units had been used so in or-der to harmonise the ages, they were all re-calculated and expressed in years. Observ ed drug substances are listed as either susp ected, interactiv e or concomitan t, but since this sub jectiv e judgemen t is likely to vary between rep orters, this information was disregarded.

For large data sets, it is computationally intractable to score all possible record pairs. A common strategy is to group the records into di eren t blo cks based on their val-ues for a subset of imp ortan t record elds and to only score records that are within the same blo ck [9]. For the WHO Figure 3: Fitted hit-miss mixture mo del weigh t functions for age and date, resp ectiv ely. Note the discrete jump in the weigh t functions at d = 0 . database, we blo ck records based on drug substances crossed with ADR types so that only record pairs that have at least one drug substance in common and share at least one ADR type (as de ned by the System Organ Class, whic h is a higher level grouping of ADR terms) are scored. In addition to the impro vemen t in computational eciency , this also re-duces the risk for false leads generated by almost iden tical non-duplicate database records that refer to di eren t reac-tions in the same patien t (see Section 1). While blo cking may in theory yield extra false negativ es, duplicate records that don't matc h on at least one drug substance and an ADR type are very unlik ely to receiv e high enough matc h scores to exceed the threshold for man ual review.
The ma jorit y of the hit-miss mo del parameters are esti-mated based on the entire data set, but c , a 1 and a 2 rely on the characteristics of iden ti ed duplicate records. For the WHO drug safet y database there were 38 groups of 2-4 sus-pected duplicate records available for this purp ose. These had been iden ti ed earlier by man ual review. for a mismatc h in that particular record eld. The listed W jj values are the maxim um and minim um weigh ts for matc hes on events in that particular record eld.
Standard hit-miss mo dels were tted to the gender, coun-try and outcome record elds. Separate hit-miss mo dels were tted for individual drug substances and ADR terms, but b and c was estimated for drug substances as a group and for ADR terms as a group ( c was estimated based on (7) where P 2 i was replaced by the average P 2 i for the group). Some of the tted hit-miss mo del parameters are displa yed in Table 4. As exp ected, matc hes on common events suc h as female gender receiv e much lower weigh ts than matc hes on more rare events suc h as originating in Iceland. The penalt y for mismatc hing ADR terms is signi -can tly lower than that for mismatc hing drug substances, be-cause discrepancies are more common for ADR terms. This is natural since the categorisation of adv erse reactions re-quires clinical judgemen t and is more prone to variation.
For the numerical record elds age and date, hit-miss mix-ture mo dels as describ ed in Section 2.1.2 were tted. Fig-ure 2 sho ws empirical distributions in the WHO database for age and date together with the corresp onding f ( d ) func-tions (note as an aside the digit preference on 0 and 5 for age). Since the empirical f ( d ) functions for both age and date are appro ximately normal and since they must be sym-metrical by de nition ( d = j i and i and j follo w the same distribution), we assume normal f ( d ) functions with mean 0 for both age and date. The variances were estimated by: where n is the num ber of record pairs on whic h the estimate is based. EM mixture iden ti cation as outlined in Table 2 with the estimated values for b and 2 2 and with starting val-ues ^ a 1 = 0 : 1 and ^ a 2 = 0 : 1 yielded the follo wing parameters for the hit-miss mixture mo del for age: and for date: Because of the limited amoun t of training data available, we enforced a lower limit of 0.01 for both ^ a 1 and ^ a 2 . Thus, even though no large deviations in age and date were observ ed in our training data, the possibilit y of large errors in these record elds is not ruled out.

A problem with onset date is that quite a large prop ortion of the records in the data set ( &gt; 15%) have incomplete but not altogether missing information (suc h as 2002-10-? or 1999-?-?). This is straigh tforw ardly tak en care of in the hit-miss mixture mo del by integrating over a wider interv al, when calculating the weigh t. For example, to compare dates 2002-10-? and 2002-10-12, we integrate (9) and (10) from -12 to 20. In practice, this leads to weigh ts around 4.5 for matc hes on year when information on day and mon th are missing on one of the records and to weigh ts around 8.0 for matc hes on year and mon th when information on day is missing on one of the records.

There tend to be strong correlations between drug sub-stances and ADR terms (groups of drug substances are of-ten co-prescrib ed and certain drug substances cause cer-tain reactions) so IC based comp ensation according to Sec-tion 2.1.3 was introduced for drug substances and ADR terms as one group.
Under the hit-miss mo del, the matc h score correlates with the probabilit y that two records are duplicates. In order to con vert matc h scores to probabilities, we use a simple form of the mixture mo del discussed by Belin &amp; Rubin [2]. The assumption is that the matc h scores for duplicate records follo w one normal distribution and the matc h scores for non-duplicate records follo w a di eren t normal distribution. For the WHO database, the empirical matc h score distributions are appro ximately normal. We estimated the matc h score mean and variance for duplicates based on the scores for the 38 duplicates in training data (see Section 2.2.2): and for non-duplicates based on a random sample of 10,000 record pairs:
The only relev ant data available to estimate the overall prop ortion of duplicates in the data set was the study of du-plicate records in vaccine spontaneous rep orting data [14], whic h found duplication rates around 0.05. Based on ^ P (dup ) = 0 : 05 and the estimated matc h score distributions, we used Bayes form ula to compute the probabilit y that a given matc h score s corresp onds to a pair of duplicates:
P (dup j s ) =
In order to obtain an estimated false disco very rate of below 0.05, the matc h score threshold for likely duplicates was set at 37.5 since P (dup j 37 : 5) = 0 : 95 according to (26).
One exp erimen t was carried out to evaluate the perfor-mance of the adapted hit-miss mo del in iden tifying the most likely duplicates for a given database record. The test data set consisted of the 38 groups of iden ti ed duplicates de-scrib ed in Section 2.2.2 and to avoid dep endence between training cases, we only used the two most recen t records in eac h group. The most recen t record was designated the template record and the second most recen t record was des-ignated the test record. In the exp erimen t, eac h template record was scored against all other records within its blo ck (see Section 2.2.1) in the entire WHO database to see if any other record receiv ed a higher matc h score with the template record than the test record. While the same data set had been used in tting the hit-miss mo del, its only impact had been on the prop ortion of misses in di eren t record elds, so the risk for bias in the performance estimates is sligh t.
Another exp erimen t was carried out to evaluate the per-formance of the hit-miss mo del in discriminating duplicates from random record pairs based on the threshold of 37.5 deriv ed in Section 2.2.1. The test set used in the rst exp er-imen t could not be used to evaluate the threshold since this data had been used to determine the threshold. However, Norw ay who is one of the few coun tries that lab el duplicate records on submission, had in their last batc h in 2004 indi-cated 19 con rmed duplicates. This allo wed for an indep en-den t evaluation of the duplicate detection metho d. Matc h scores were calculated for all record pairs within the same blo ck (see Section 2.2.1) and those with scores that exceeded the 37.5 threshold were highligh ted as likely duplicates.
The performance at duplicate detection for a given database record was evaluated based on whether or not it was the test record that receiv ed the highest matc h score together with the template record. This was the case for 36 out of the 38 record pairs (94 : 7%). The two template records for whic h the test record was not top rank ed are listed in Table 5 and Table 6 together with the most likely duplicates as indi-cated by the hit-miss mo del. For the rst dicult template record, there are no strong matc hes, and based on a sup er -cial examination, the two top rank ed records whic h are not kno wn duplicates seem as plausible as the test record whic h is a con rmed duplicate. Thus, while its performance was imp erfect for this template record, the hit-miss mo del's pre-dictions are at least in line with intuition. For the second dicult template record, there are strong matc hes (matc h scores ranging from 37.78 to 47.28) with 3 records that are not con rmed duplicates. While these may well be false pos-itiv e, they could also be undetected duplicates: the records matc h on most of the elds and although some of the ADR terms di er, a more careful analysis sho ws that the listed ADR terms relate to liver and gastric problems. Thus, while the hit-miss mo del failed to iden tify the kno wn duplicate for this template record, it may have iden ti ed 3 that are cur-ren tly unkno wn.
There was a total of 1559 case rep orts in the last batc h from Norw ay in 2004. The median matc h score for the 19 kno wn pairs of duplicates was 41.8 and the median matc h score for all other record pairs (after blo cking) was -4.8. Figure 4 displa ys the matc h score distributions for the two groups. All in all, 17 record pairs had matc h scores above 37.5 and out of these, 12 corresp ond to kno wn duplicates and 5 to other record pairs. Thus, the recall of the algo-rithm in this exp erimen t was 63% (12 of the 19 con rmed duplicates were highligh ted) and the precision was 71% (12 of the 17 highligh ted record pairs are con rmed duplicates). However, the threshold of 37.5 was set based on the assumed 5% rate of duplicates in the data set, and follo wing the dis-cussion of precision-recall graphs by Bilenk o &amp; Mo oney [4] Figure 5 indicates how the precision and the recall varies with di eren t thresholds (an estimated 20% rate of dupli-cates would give a 35.2 threshold, an estimated 10% rate of duplicates would give a 36.5 threshold and an estimated 1% rate of duplicates would give a 39.6 threshold). To achiev e Figure 4: Matc h score distributions for kno wn dupli-cates and other record pairs in the Norw egian batc h, normalised in order to integrate to 1. Figure 5: Precision and recall as functions of the threshold, for the discriminan t analysis exp erimen t on Norw egian data. The dotted line indicates the selected threshold. the minim um total num ber of errors, 11 (2 false positiv es and 9 false negativ es), a threshold between 40.7 and 41.7 must be used. Precision normally tends to 1 as the thresh-old is increased, but this is not the case in Figure 5, because the highest matc h score actually corresp onds to a pair of records that were not kno wn duplicates. Table 7 lists the three record pairs with highest matc h scores among record pairs that were not con rmed duplicates and Table 8 lists the three record pairs with lowest matc h scores among con-rmed duplicate record pairs.
The exp erimen ts were run on a workstation equipp ed with a 2.2 GHz P4 pro cessor and 1 GB of RAM. Ecien t use of the available hardw are and optimised data structures re-duced computing time and memory requiremen ts so that the initial data extraction and mo del tting required a total of 50 min utes. To score a single pair of database records took 6 s , and to score a database record against the rest of the data set took about 1 second (average blo ck size in the order of 100,000 records). The scoring for all record pairs in the Norw egian data subset (1559 database records), after blo cking, took 27 seconds.
The hit-miss mo del as implemen ted on WHO data pro-duced very promising results. For records that are kno wn to have a duplicate, the hit-miss mo del reliably highligh ted the corresp onding record (94.7% accuracy). However, only a small prop ortion of database records have duplicates, so high rank ed records are not necessarily duplicates, and in order for the metho d to be truly e ectiv e at duplicate detection, it needed to pro vide an absolute estimate for the proba-bilit y that two records are duplicates. The 63% recall and 71% precision in Section 3.2 indicate that the hit-miss mo del iden ti ed the ma jorit y of kno wn duplicates, while generating few false leads, whic h demonstrates its practical usefulness.
The hit-miss mo del did fail to highligh t 7 kno wn dupli-cates in the Norw egian batc h, but from Table 8 it is clear that the amoun t of information on these records is very scarce: ages, outcomes and onset dates are missing on at least one of the records in eac h pair and while there are a few matc hing drug substances and ADR terms, there are at least as man y unmatc hed ones. The lowering of the thresh-old required to highligh t all these duplicates would yield an unmanageable prop ortion of false leads. We anticipate that any metho d would require non-anon ymised data to be able to iden tify suc h duplicates, since lack of data cannot be com-pensated for with adv anced algorithms. This emphasises the need for impro ved qualit y of case rep orts.

Fiv e of the record pairs highligh ted in the Norw egian batc h were not con rmed duplicates. One of these receiv ed the highest matc h score in the exp erimen t (the top one in Ta-ble 7), but did not seem like an obvious pair of duplicates: outcomes are missing, onset dates and ages are close but don't matc h and none of the registered ADR terms matc h. On the other hand, 6 out of the 7 drug substances on these two records are the same and this is what generated the unusually high matc h score. These drug substances are not particularly commonly co-rep orted (the pairwise asso-ciations between them are weak) whic h further strengthens the evidence. In order to determine the true status of this record pair, we subsequen tly con tacted the Norw egian na-tional cen tre who con rmed that it was indeed a pair of du-plicates: two di eren t physicians at the same hospital had pro vided separate case rep orts for the same inciden t. This demonstrates that the hit-miss mo del may accoun t for prob-abilistic asp ects of data that are not immediately clear from man ual review and that the hit-miss mixture mo del's treat-men t of small deviations in numerical record elds may be very useful in practice. The Norw egian cen tre also pro vided information on the 4 other record pairs of unkno wn status that had been highligh ted in the study: the record pair with the second highest matc h score was rep orted to be a likely but yet uncon rmed duplicate whereas the other three high-ligh ted record pairs were con rmed non-duplicates. How-ever, these case rep orts had all been pro vided by the same den tist and all referred to the same drug-ADR com bina-tion. Suc h case rep orts submitted by the same individual will tend to be similar and dicult to distinguish from true duplicates. With resp ect to duplicate detection, these record pairs are certainly false leads, but in a di eren t con text the detection of suc h clusters of case rep orts may be very valu-able (since they would generally be considered less strong evidence of a true problem than case rep orts from indep en-den t sources). The Norw egian feedbac k indicates that the rep orted 71% precision in Section 3.2 is an under-estimate. duplicates in the Norw egian data.
 Norw egian data.
 The actual precision of the exp erimen t was at least 76% (13/17) and possibly even higher. The rep orted recall rate may be either under-or over-estimated dep ending on how man y uniden ti ed duplicates remain.

The hit-miss mixture mo del is a new approac h to handling discrepancies in numerical record elds. Lik e the standard hit-miss mo del, it is based on a rigorous probabilit y mo del and pro vides intuitiv e weigh ts. For matc hes, the weigh ts dep end on the precision of the matc hing values: matc hes on full dates receiv e weigh ts around 12.0, matc hes on year and mon th when day is missing receiv e weigh ts around 8.0 and matc hes on year when mon th and day are missing receiv e weigh ts around 3.5. Both matc hes and near-matc hes are rew arded, and the de nition of a near-matc h is data driv en: for the WHO database, age di erences within 1 year and date di erences within 107 days receiv e positiv e weigh ts and are thus favoured over missing information. There is a limit to how strongly negativ e the weigh t for a mismatc h will get (see Figure 3), so any large enough deviation is considered equally unlik ely. An alternativ e mo del for dates whic h would be useful if typing errors were very common is to mo del year, mon th and day of the date as separate discrete variables. The disadv antage of this approac h is that absolute di erences of just a few days could lead to very negativ e weigh ts whereas di erences of sev eral years may yield positiv e weigh ts if the two records matc h on mon th and day. In the hit-miss mo del, on the other hand, a pair of dates suc h as 1999-12-30 and 2000-01-02 con tributes +3.18 to the matc h score, despite the sup er cial dissimilarit y.
The exp erimen ts in this article were retrosp ectiv e in the sense that they evaluated the performance of the algorithms based on what duplicates had already been iden ti ed. In the future, we aim to do a prosp ectiv e study where the hit-miss mo del is used to highligh t susp ected duplicates in an unlab elled data subset and follo w up the results by man ual review. Suc h a study should allo w for more accurate pre-cision estimates and more insigh t into how the algorithms may be best applied in practice.

The hit-miss mo del will be used routinely for duplicate detection in in the WHO database. Database wide screens will be carried out regularly and, in addition, duplicate de-tection can be carried out at data entry and automatically when a case series is selected for clinical review. The rate limiting step in duplicate detection for post-mark eting drug safet y data is the man ual review required to con rm or re-fute ndings, so further testing will be necessary to deter-mine whether the selected threshold is practically useful.
The hit-miss mo del tted to the WHO drug safet y database in Section 2.2 can be used for duplicate detection in other post-mark eting drug safet y data sets as well, pro vided they con tain similar information. An alternativ e approac h would be to use the metho ds describ ed in this pap er to t adapted hit-miss mo dels directly for the data sets of interest, since the prop erties of di eren t data sets may vary and additional record elds may be available.
In this pap er we have introduced two generalisations of the standard hit-miss mo del and demonstrated the useful-ness of the adapted hit-miss mo del for automated duplicate detection in WHO drug safet y data. Our results indicate that the hit-miss mo del can detect a signi can t prop ortion of the duplicates without generating man y false leads. Its strong theoretical basis together with the excellen t results presen ted here, should mak e it a strong candidate for other duplicate detection and record link age applications.
The authors are indebted to all the national cen tres who mak e up the WHO Programme for International Drug Mon-itoring and con tribute case rep orts to the WHO drug safet y database, and in particular to the Norw egian national cen tre for allo wing the evaluation of their data to be used in this pap er and for pro viding rapid assessmen t of the susp ected duplicates. The opinions and conclusions, however, are not necessarily those of the various cen tres nor of the WHO. [1] A. Bate, M. Lindquist, I. R. Edw ards, S. Olsson, [2] T. Belin and D. Rubin. A metho d for calibrating [3] M. Bilenk o and R. J. Mo oney . Adaptiv e duplicate [4] M. Bilenk o and R. J. Mo oney . On evaluation and [5] E. A. Bortnic hak, R. P. Wise, M. E. Saliv e, and H. H. [6] A. D. Brink er and J. Beitz. Spontaneous rep orts of [7] J. Copas and F. Hilton. Record link age: statistical [8] I. R. Edw ards. Adv erse drug reactions: nding the [9] I. P. Fellegi and A. B. Sun ter. A theory for record [10] M. A. Hernandez and S. J. Stolfo. The merge/purge [11] M. Lindquist. Data qualit y managemen t in [12] A. E. Monge and C. Elk an. An ecien t [13] H. B. New com be. Record link age: the design of [14] J. N. Nkanza and W. Walop. Vaccine asso ciated [15] R. Orre, A. Lansner, A. Bate, and M. Lindquist. [16] M. D. Rawlins. Spontaneous rep orting of adv erse drug [17] S. Sara wagi and A. Bhamidipat y. Interactiv e
