 Community detection has arisen as one of the most relevant topics in the eld of graph data mining due to its importance in many elds such as biology, social networks or network trac analysis. The metrics proposed to shape communi-ties are too lax and do not consider the internal layout of the edges in the community, which lead to undesirable re-sults. We de ne a new community metric called WCC . The proposed metric meets a minimum set of basic properties that guarantees communities with structure and cohesion. We experimentally show that WCC correctly quanti es the quality of communities and community partitions using real and synthetic datasets, and compare some of the most used community detection algorithms in the state of the art. H.3.3 [ Information Storage and Retrieval ]: Informa-tion Search and Retrieval; H.3.4 [ Information Storage and Retrieval ]: Systems and Software; G.2.2 [ Discrete Mathematics ]: Graph Theory Theory, Veri cation social networks, modularity, conductance, community detec-tion
Although graphs are a very intuitive representation of many datasets, retrieving information from them is far from easy. The increasingly growing datasets during the last years have made it very dicult to intuitively extract and analyze the information of the graphs generated from those datasets.
Communities are informally de ned as sets of vertexes which are densely connected but scarcely connected to the rest of the graph. The retrieval of vertex communities (or clusters) provides information about the sets of vertexes that respond to a similar concept [7]. In social networks, com-munities identify groups of users with similar interests, lo-cations, friends or occupations. This information is useful to craft new ways to represent data in visual analysis appli-cations [4] or to reduce the access times to this data thanks to a more coalesced data placement [18].

Several metrics have been proposed as indicators of the quality of a community [16, 9, 11]. However, the optimiza-tion of such metrics does not guarantee cohesive communi-ties with a noticeable internal structure, which can lead to undesirable results.

In this paper, we propose a new community detection met-ric called Weighted Community Clustering ( WCC ) that ful-lls a set of minimum structural properties. These proper-ties, which should be ful lled by any community detection metric for social networks, ensure that communities are co-hesive, structured and well de ned. An example of these properties is that communities in social networks must be dense in terms of triangles (transitive relations between ver-texes) and they cannot contain bridges (edges whose removal disconnected the induced subgraph of the community). Fur-thermore, we prove that the most used metrics, such as mod-ularity and conductance, do not ful ll these properties.
We show experimentaly that there is a correlation between communities with good WCC and desirable statistical val-ues. We show that while communities with large WCC are cohesive and dense, others with good values of the most widely used metrics ,such as modularity and conductance, values are not. We also compare the most used algorithms in the state of the art using WCC .

The paper is structured as follows: in Section 2, we re-view the state of the art. In Section 3, we introduce the problem of community detection, propose the new metric ( WCC ) and introduce the properties, while in Section 4, we show that the current metrics in the state of the art do not ful ll them. Finally, in Section 5, we compare several com-munity detection methods using the WCC and in Section 6 we conclude the paper.
The most widely used metric in the state of the art is is the modularity , which was proposed by Newman et al.[16]. Modularity measures the internal connectivity of the com-munity compared to an Erd  X  os-Renyi graph model. It has be-come very popular in the literature, and a lot of algorithms are based on maximizing it. Algorithms apply several op-timization procedures: agglomerative greedy [3], simulated annealing strategy [13] or multistep approaches [2].
However, it has been reported that modularity has res-olution limits [6, 8]. Communities detected by modularity depend on the total graph size, and thus for large graphs, small well de ned communities are never found. This means that maximizing the modularity leads to partitions where communities are far from intuitive.

Another widely used metric is conductance [9], which is the ratio between the edges going outside the community and the total number of edges between members of the com-munity. However, conductance has the problem that, for any graph, the partition with a unique community formed by all the vertexes of the graph obtains the best conductance, mak-ing its direct optimization not viable. A recent survey [11] of community metrics discusses the performance of many met-rics on real networks: the cut ratio, the normalized cut, the Maximum-ODF (Out Degree Fraction), the Average-ODF and Flake-ODF. In this survey, Leskovec et al. showed that, among all these metrics, conductance is the metric that best captures the concept of community. Furthermore, their re-sults reveal that the quality of communities decreases signif-icantly for those of size greater than around 100 elements.
Given a graph G = ( V;E ), the problem is to classify the vertexes of the graph into disjoint cohesive sets. The crite-rion to measure the cohesion of the sets is formally obtained by de ning a metric, that is, a function f that assigns to each subset S of V a real number such that 0 f ( S ) 1. A community is a set of vertexes S , on which we compute a degree of cohesion f ( S ). Good communities have a large f ( S ) and bad communities have a small f ( S ). The adequate metric f for a given context (social networks, biology, etc.) captures the features of the communities in that context.
A partition of V is a set P = f C 1 ;:::;C n g of non-empty pairwise disjoint subsets of V such that C 1 [[ C n = V . A metric f in G de nes in a natural way a value f ( P ) in each partition P of V by taking the weighted average of the value of the function on the sets of the partition:
For a given graph and a given metric f in G , the goal is to obtain an optimal partition , that is, a partition P such that f (
P ) is maximum. We call the communities in an optimal partition the optimal communities of the graph.
A natural way to de ne the cohesion of a community is to de ne rst the degree of cohesion of a vertex x with respect to a set S . That is, a function f that assigns to the pair ( x;S ) a real number f ( x;S ) in the range 0 f ( x;S ) 1. Then the metric on S is de ned by taking the average of f ( x;S ) with x 2 S , that is,
In this paper, we propose a de nition of metric f ( S ) that we call Weighted Community Clustering ( WCC ), which com-putes the level of cohesion of a set of vertexes S . In the rest of the paper, we refer to our proposal for f ( S ) as WCC ( S ). In order to de ne WCC ( S ) we start de ning WCC ( x;S ). With that objective, we denote by t ( x;S ) the number of tri-angles that vertex x closes with vertexes in S and by vt ( x;S ) the number of vertexes of S that form at least one triangle with x . WCC ( x;S ) is calculated as follows: WCC ( x;S ) =
Note that j S n x j + vt ( x;V n S ) = 0 implies that S = vt ( x;V ) = 0. Then the condition j S n x j + vt ( x;V n is included in the condition t ( x;V ) = 0. The left fraction of WCC ( x;S ) is the ratio of triangles that vertex x closes with set S , as opposed to the number of triangles that x closes with the whole graph. On the other hand, the right fraction is the number of vertexes that close at least one triangle with x , with respect to the union of such set and S .
The cohesion of a partition is computed as stated in Equa-tion (1), by using WCC ( S ). Therefore, an optimal partition is such that, for all vertexes of the graph, the two factors of Equation (3) are optimized. The left fraction is maximized for a vertex x when set S includes all the vertexes that form triangles with x . On the other hand, the right fraction is maximized for x when set S contains no vertexes such that x does not form triangles. The maximization process is a compromise between both terms and the resulting commu-nities are those with a signi cant number of triangles well distributed among all the vertexes forming the community, compared to their neighborhood.

Figure 1 shows some examples of communities extracted from the real graphs used in Section 5 with their correspond-ing WCC values. The color of the vertexes represents the percentage of neighbors belonging to the community. The darker the vertex, the larger this percentage. On the other hand, the size of the vertexes represents the percentage of vertexes of the community that are actual neighbors of that vertex. The larger the vertex, the better the vertex is con-nected with the rest of the community. Thus, the better the community is, the larger and darker are its vertexes. In the gure, we see that the better a community is, with larger and darker vertexes have larger WCC .
In this section we present a set of basic properties which are any good community detection metric for social networks should ful ll. These properties, guarantee communities with cohesion and structure. WCC ful lls these properties when it is maximized. For detailed proofs, deeper explanations and gures of these properties please refer to [19]. Property 1: Internal Structure. In several previous studies like [17], it has been proved that one of the main characteristics of social networks is the presence of a large clustering coecient and communities. Social networks have more triangles than expected in random graphs [17, 14] and (a) 0.0 9048 (b) 0.14191 (c) 0.25457 (d) 0.31792 (e) 0. 52118 (f) 0.65128 (g) 0.78072 (h) 0.92798 Figure 1: Examples of communities from real graphs, sorted by WCC . models describing the growth of social networks give trian-gle closing as a key factor of network evolution [10]. Thus, we take triangles as the indicator of the presence of commu-nities. Then, the cohesion of a community given by a community metric for social networks, depends on the triangles formed by the edges inside the community. Property 2: Linear Community Cohesion. Commu-nities must grow with cohesion, which means that a vertex can only join a community if it has a signi cant number of links with the members of the community. The larger the community, the more links are needed. Otherwise, the co-hesion of the community decreases. Therefore, the number of connections needed between a vertex x and a set S , so that f ( S [f x g ) f ( S; f x g ) , grows linearly with respect to the size of S . If it grew sublinearly, it would mean that the larger a community is, the easier would be for a vertex to join the community relative to the community size. On the other hand, if it grew faster than linear, the communities would have a maximum possible size.
 Property 3: Bridges. A bridge is an edge that if it is re-moved from the graph, it creates two connected components. The connections in real graphs are known not to be local, but can connect distant vertexes [12]. A bridge is a very weak relation between two sets of vertexes that are unre-lated, because it only a ects one member of both datasets. Therefore, an optimal community in social networks can not contain a bridge.
 Property 4: Cut Vertex Density. A cut vertex is a ver-tex whose removal disconnects the graph into two or more connected components. A cut vertex is certainly a weak link in a community formed by the union of the two sets, because the vertexes of the two sets have no relation among them. If the two sets have no other connection among them rather than the cut vertex, the two sets must be consid-ered as independent communities on their own if they have enough cohesion internally. Therefore, an optimal com-munity cannot contain a cut vertex if the sets that it separates have a minimum density.
The properties show that WCC is a metric capable of fa-voring those communities with a large quantity of triangles involving all the vertexes of the community, which ensures taht all the vertexes forming the community are highly con-Vertic es 27,76 9 18,7 71 36,6 92 82,16 8 Edges 352,2 85 198, 050 183, 831 504,2 30 Avg.d egree 25.37 21.1 10.0 2 12.27 Max. degree 2,468 504 1,38 3 2,552
Tabl e 1: The real world graphs used for testing. nected among them. However, this is not ful lled by other proposed metrics, such as the conductance.

Conductance is based on minimizing the cut. Minimizing the cut is problematic because the partition consisting of a single community containing all the vertexes of the graph has the best value, and thus it is the optimal community. This makes impossible to design algorithms that simply op-timize conductance. Properties 1, 2 and 3 do not apply to conductance, because as soon as there is an edge connecting two communities or a single vertex connecting to a com-munity, joining them into a single community will grant a better conductance value.

In the case of modularity, it su ers from resolution lim-its [6, 8]. Furthermore, is has been shown [1] that trees, which cannot be considered communities, can have arbitrar-ily large modularity. This behavior goes against Property 3, since in a tree every edge is a bridge. Modularity assumes that graphs are homogeneous, whereas they are not, while WCC sees the communities in a local fashion, focusing in the internal density and their neighborhood.
In this section, we select some of the most relevant com-munity detection algorithms and use synthetically generated graphs to show that WCC favors those community detec-tion algorithms that best capture the actual communities. We also use real graphs to prove experimentally that WCC captures the nature of a community by studying the correla-tion of WCC with statistical properties of the communities. The algorithms used are Infomap [20], Blondel [2], Clauset [3], Newman [15] and Duch [5].
We used synthetically generated graphs, where the com-munities are known beforehand to test the correllation be-tween good community detection algorithms and WCC . We measured the quality of each algorithms both in terms of normalized mutual information (NMI), which computes the overlap between the algorithm output and the communities of the synthetic graph, and in terms of WCC . We observed that the agreement of both metrics is excellent. The best algorithms in terms of WCC are the best also in terms of NMI, and the other way around. In other words, the syn-thetic community generation procedure, which is not based on triangles, generates communities that match our commu-nity de nition based on WCC . Therefore, we conclude that WCC is an adequate indicator of the quality of the com-munities of a partition. For a more complete description of these experiments please refer to [19].
In this section, we show that there is a correllation be-tween communities with good WCC values and good statis-tics. We study the following measures: triangle density , which is the number of internal triangles divided by the total number of possible internal ones; the average inverse edge cut , which is the average number of neighbors of a vertex that belongs to the same community divided by the number of neighbors; the average edge density , which is the average percentage of neighbors of a vertex that are actual members of the community; the modularity ; the conductance ; the nor-malized diameter , which is the diameter of the community divided by the logarithm of its size; the bridge ratio , which is the percentage of edges in a community that are bridges; and the size of the communities.

We created a pool of communities by running the commu-nity detection algorithms on four real world networks, cover-ing di erent aspects of real world data, which are sumarized in Table 1. ArxivCit is a citation network, ArxivCol repre-sents the collaborations between scientists, Enron is derived from email communications and Slashdot is extracted from a website social network. Then, we sorted all the commu-nities obtained by their WCC value decreasingly. Then, we divided the communities into 20 groups in steps of ve per-centiles according to their WCC and plotted for these 20 groups their correponding statistics in Figure 2. In all the charts, the x axis represents the group identi er (e.g. the leftmost group is always the 95 percentile containing the top 5% communities in terms of their WCC ) while the y axis shows the corresponding statistical value. The communities of size one and two, are ommited since their WCC value is zero. As shown in Figure 2(a), the leftmost communi-ties have high WCC values, and the rightmost communities have the lowest WCC values.

Broadly speaking, we observe two sections: from groups 1 to 12, the trends for all statistics show that communities with higher WCC have better properties; from groups 13 to 20 this trend apparently changes in some statistics. We focus rst on groups 1-12 and we analyze groups 13-20 below. Groups 1-12: In Figure 2(b), we see that the larger the WCC , the smaller the edge cut so, the number of exter-nal connections of the community decreases. On the other hand, in Figure 2(c) we see that the larger the WCC of a community, the larger the internal density of edges. While these two characteristics are a good starting point to iden-tify a good community, they do not imply an internal struc-ture as shown in Figure 2(d). The larger the WCC of a community, the larger its triangle density. These transitive relations between the vertexes (Property 1) indicate a good social structure of the communities.

Figure 2(e) shows how bridges penalize WCC . A large percentage of bridges is a symphtom of the presence of whiskers or treelike structures, which are inherently sparse and hence do not have the type of internal structure that one would expect from a community. We note that communities that contain bridges are not the optimal communities because of Property 3. A small diameter is another feature that any good community should have. In Figure 2(f) we see that large WCC implies smaller diameters for the communities. This means that any vertex in the community is close to any other vertex, which translates to denser communities.
In Figure 2(g-h) we compare WCC with the most popular metrics in the state of the art: modularity and conductance. We see that there is a correlation between communities with good WCC values and modularity and conductance (for conductance, the lower, the better). Finally, in Figure 2(j), we show the sizes of the communities.
 Figure 3: WCC for communities from real graphs.

Groups 13-20: We see that there is a change on the trend for some statistics for those groups that have WCC close to 0. This behavior can be explained by Figures 2(d) and (e). These gures reveal that the communities after group 13 are treelike: almost all the edges in the community are bridges, and communities hardly contain triangles. Therefore, such structures cannot be accepted as good communities. Al-though some communities in group 13-20 are isolated (and thus have good conductance), we note that this is not a su-cient condition to be good communities. For example, most communities in groups 17-20 are trees with three vertexes, which have a good conductance. As described in [1], tree like networks can have high modularity and hence, algorithms maximizing it can lead to misleading results (Figure 2(g)).
Finally, in Figure 3 we compare the di erent algorithms used in terms of WCC . Infomap arises as the best com-munity detection algorithms, outperforming those based on maximizing modularity.
In this paper, we have proposed a new metric called WCC , which compares the quality of two graph community par-titions and enables to distinguish a good from a bad one automatically. We have introduced a minimum set of prop-erties that any community detection metric for social net-works should ful ll. WCC meets these properties when it is maximized, which guarantee communities with cohesion and structure. This is something that the most popular metrics in the state of the art, such as modularity and con-ductance, do not. Then, it is possible to compare the quality of algorithms or even design ecient community computing algorithms based on WCC . We have shown experimentaly that communities with good WCC values are dense, have small edge cuts, have transitive relations without bridges and small diameters. We have also shown that looking only at the internal density and small edge cuts (like the most popular metrics in the state of the art do) does not guaran-tee well de ned communities with internal structure.
The members of DAMA-UPC thank the Ministry of Sci-ence and Innovation of Spain and Generalitat de Catalunya, for grant numbers TIN2009-14560-C03-03 and GRC-1187 re-spectively, and IBM CAS Canada Research for their strate-gic research grant. Josep M.Brunat thanks the Ministry of Science and Innovation of Spain and Generalitat de Catalunya for grant numbers MTM2011-24097 and DGR-2009SGR1040 respectively. David Dominguez-Sal thanks the Ministry of Science and Innovation of Spain for the grant Torres Quevedo PTQ-11-04970.
