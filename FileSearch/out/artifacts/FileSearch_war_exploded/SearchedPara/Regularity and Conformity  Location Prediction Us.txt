 Mobility prediction enables appealing proactive experiences for lo-cation-aware services and offers essential intelligence to business and governments. Recent studies suggest that human mobility is highly regular and predictable. Additionally, social conformity the-ory indicates that people X  X  movements are influenced by others. However, existing approaches for location prediction fail to organ-ically combine both the regularity and conformity of human mo-bility in a unified model, and lack the capacity to incorporate het-erogeneous mobility datasets to boost prediction performance. To address these challenges, in this paper we propose a hybrid predic-tive model integrating both the regularity and conformity of human mobility as well as their mutual reinforcement. In addition, we fur-ther elevate the predictive power of our model by learning location profiles from heterogeneous mobility datasets based on a gravity model. We evaluate the proposed model using several city-scale mobility datasets including location check-ins, GPS trajectories of taxis, and public transit data. The experimental results validate that our model significantly outperforms state-of-the-art approaches for mobility prediction in terms of multiple metrics such as accuracy and percentile rank. The results also suggest that the predictability of human mobility is time-varying, e.g., the overall predictability is higher on workdays than holidays while predicting users X  unvisited locations is more challenging for workdays than holidays. H.2.8 [ Database Management ]: Data mining; H.2.8 [ Database Management ]: Spatial databases and GIS Algorithms, Experimentation, Performance location prediction, regularity, conformity, location profile, spatial influence, gravity model, collaborative filtering c
Over the past decade, an overwhelming number of location-aware services and apps have profoundly changed the way people live, from route planning to dining and even social networking. Under-standing user mobility thus becomes an essential factor for improv-ing service quality and user engagement.

While sensing a user X  X  current location provides the user with timely reactive experiences, e.g.,  X  X earching for the closest sub-way station X , predicting users X  future locations can enable appeal-ing proactive experiences in various applications. For example, re-cently emerging digital assistants such as Microsoft Cortana Google Now 2 aim to push relevant information to users or help users accomplish tasks without their querying, e.g., pre-heating (or cooling) the house when the user is on the way home [30]. An accu-rate prediction of user mobility is hence crucial for such proactive services. As another example, mobility prediction brings business intelligence to advertising and marketing. Given potential high-value customers X  future locations, advertisers/marketers can better choose locations for organizing promotion events or distributing ad-vertisements and coupons. Predicting future mobility patterns of crowds can help governments deal with public emergencies such as stampede prevention 3 .

The recent development of sensing technology and smart de-vices makes various types of mobility data available to the industry and researchers, such as GPS trajectories [23, 41], cellular tower data [13], WiFi signals [27, 34], smart card transactions [39], and location check-ins from online social networks [28, 4, 19], all of which facilitate the exploration of mobility understanding and pre-diction. For instance, using cellular tower data, Song et al. [33] show that the predictability of human mobility has a limit of 93%, which demonstrates that human mobility is highly regular and pre-dictable. However, the actual prediction performance heavily de-pends on many aspects including data types, sampling frequency, and granularity of predictions [32]. Even the best results reported by state-of-the-art approaches are far below this limit [6, 19, 27].
To bridge the gap between actual prediction performance and the-oretical limit, many challenges still remain to be addressed: Regularity and Conformity. Several studies show that human mo-bility typically follows regular spatial-temporal patterns. In urban areas, people typically spend most of their time around several  X  X a-jor hubs X , such as homes and workplaces [33], and periodically commute between them [18, 6]. Meanwhile, people frequently visit some  X  X inor hubs X  in a limited radius of their major hubs [9] at cer-tain times, e.g., shopping malls, gyms, and restaurants. Neverthe-less, human mobility is not only driven by regularity . People occa-sionally change their routines and visit some unfamiliar places, e.g., a bar recommended by friends or a popular restaurant on Yelp. Such irregular visits may be explicitly or implicitly influenced by others, usually a group of people who have similar social backgrounds, in-terests, and social statuses. This phenomenon is the so-called social conformity [7].
 However, most existing approaches in location prediction typically fall into two categories: 1) developing individual mobility models, such as HMM [16], CRF [39], and periodic GMM [6], to capture users X  regular behavioral patterns; 2) building collaborative models to leverage similar mobility patterns of different users [11, 26, 4]. Few studies have incorporated both the regularity and conformity of human mobility in predicting users X  future locations. Although a few approaches have touched both factors to a certain extent, the main endeavor of these methods still focuses on a single factor, while the other one is typically used as side information or a con-straint [19], Thus, the interdependency and mutual reinforcement of regularity and conformity are not fully exploited for location predic-tion.
 Sparsity and Heterogeneity. Continuous and precise tracking of users X  long-term movements (e.g., using GPS) is often energy-intensive and costly, while mobility data captured by low-energy sensing technologies is typically sparse in terms of either granularity (e.g., cellular tower data) or sampling frequency (e.g., location check-ins). Besides, a user X  X  actual mobility is usually delineated in dif-ferent forms of mobility data, where any single type only partially reveals a user X  X  mobility patterns. However, existing models for location prediction lack the capacity to boost prediction accuracy with the help of heterogeneous mobility datasets. The difficulty lies in how to integrate the mobility patterns mined from heterogeneous mobility datasets into a unified prediction model .

In this paper, we tackle the above challenges by proposing a hy-brid model called RCH , combining both R egularity and C onformity, and employing H eterogeneous mobility data for location predic-tion. Specifically, we introduce a mobility model containing a reg-ularity term and a conformity term, where the conformity term is represented by a time-aware factorization model, and the regularity term is represented as interactions between users X  hub visit patterns and spatial influence to users X  visited venues (detailed in Sec. 3.2). The regularity and conformity terms interplay and reinforce each other. In particular, the spatial influence to venues are learned through a Gravity model (detailed in Sec. 3.3). Our main contributions are summarized as follows:  X  We introduce a hybrid model for location prediction combing both the regularity and conformity of human mobility, which ex-ploits the interdependent patterns of both routine visits and occa-sional visits.  X  We develop a method to learn a location X  X  profile from heteroge-neous mobility datasets based on a gravity model, and integrate the learned location profiles into a time-aware prediction model.  X  We evaluate our model for predicting location check-ins based on a large dataset containing 7,355,962 check-ins of 161,794 users, where the location profiles used in our model are learned from sev-eral extra city-scale heterogeneous mobility datasets, such as GPS trajectories of taxis and public transit data. The experimental re-sults validate that our model significantly outperforms state-of-the-art methods in terms of multiple metrics such as prediction accuracy and percentile rank.
The increasing availability of mobility data provides marvelous potential to study human mobility patterns. A considerable number of works have shown that human mobility is regular, predictable and unique in both temporal and spatial spaces [35, 15, 8]. Ob-servable regular movements among a few frequented locations, like home and work [9, 18], embody the regularity and predictability of human mobility. For example, using mobile phone logs of 100,000 users Gonzalez et al. [13] showed a high degree of mobility regu-larity among several highly visited haunts. Song et al. [33] demon-strated that a 93% potential predictability of mobility patterns of mobile phone users. Besides, de Montjoye et al. [8] quantified the mobility uniqueness and demonstrated four distinct points are enough to distinguish 95% of users.

In the past few years, several mobility prediction works have con-centrated on human trajectory logs from personal mobile devices, smart cards, and vehicular digital records, like GPS data [23, 27, 1], wifi [23, 34] and bus-trip records [2, 39]. They have continual spa-tial and temporal mobility records and the conspicuous characteris-tic of periodical returning to some important places. Unlike these high frequency datasets, check-ins in LBSNs are usually sparse and sporadic [24]. Location prediction based on check-ins is more chal-lenging than on dense datasets like GPS data [37].
We summarize relevant mobility prediction models and their dif-ferences in Table 1 where we list the targeted mobility data (i.e., type of mobility to be predicted) and features incorporated in the models. According to whether the prediction model is trained inde-pendently among all users (i.e., whether a user X  X  mobility model is learned from the user X  X  own historical mobility alone), we catego-rize existing models into two types: individual models and collabo-rative models.
 CI: check-in, SMP: spatial mobility pattern, TC: text content
CF: collaborative filtering, HT: heterogeneous mobility datasets
Historical spatial-temporal mobility patterns are fundamental fac-tors for inferring users X  future locations, given the regularity of hu-man mobility [27, 23, 40, 10, 39, 16]. An approach based on non-linear time series is applied for mobility prediction in [27], which focused on predicting most important places. Using a GPS trajec-tory dataset generated by 17,000 cars, Monreale et al. [23] built a decision tree, named T-pattern tree, to find the best match path and predict future movements. Yuan et al. [40] proposed a probabilis-tic model W 4 (who, when, where, what) unifying spatial, temporal and activity topics to model users X  behaviors. Using public transit records, Yuan et al. [39] provided a constraint Conditional Random Field model and successfully inferred unknown alighting/boarding stops given part of them.

The advantage of individual models is that the regularity of hu-man mobility can be well captured. However, the similarity of mo-bility patterns between different users is not considered and utilized for predicting future locations. Instead, our hybrid approach ex-cavates similar users X  mobility patterns based on social conformity and collaborative filtering in addition to learning users X  regular mo-bility patterns with a time-aware sparse group Lasso model. Fur-thermore, we collectively learn location profiles using several het-erogeneous mobility datasets generated by city-scale populations and integrate the location profiles into our hybrid prediction model.
Different people may have similar location preferences. Social relationships of users have been taken into account for location pre-diction and recommendation to relieve data sparsity [6, 12, 25, 26, 4]. For example, Noulas et al. [25] developed a supervised learn-ing model for next place prediction considering location histories of users X  friends. Cho et al. [6] introduced a time-aware Gaussian Mixture model considering both users X  periodic mobility and social activities. Sadilek et al. [26] provided a Dynamic Bayesian Net-work model, combining friends X  temporal information for location prediction. Nevertheless, social relationships are reported to offer a limited predictive power for location check-ins due to the high sparsity [24].

Collaborative filtering methods are widely applied in recommen-dation systems including location recommendations, which assumes that similar users have similar behavioral patterns like rating or pur-chasing. This assumption is also in accordance with the conformity theory in social psychology [7]. For example, matrix factoriza-tion has evolved as a critical algorithm in location recommenda-tion [5, 22, 20], where a user X  X  preference of a venue is modeled as an inner product of latent factors. Lian et al. [20] introduced a location recommendation model considering both users X  latent preferences and geographical influence of locations, however, the influence is empirically determined, instead of learned from the data. Recently, probabilistic non-negative matrix factorization has also been adopted for location recommendations [21, 29], where the users X  visited venues are considered observations of a gener-ative process. However, these recommendation models cannot be directly applied for mobility prediction. Lian et al. [19] first em-ployed collaborative filtering approaches for location prediction. Users X  location visits are separated to explorations of novel or regu-lar places based on a binary classification. They proposed a hidden Markov model for capturing regular mobility patterns and social-based collaborative filtering with 2D kernel density estimation to excavate novel mobility patterns. However, the antecedent division of mobility types through exploration prediction confronts the risk of two-layer errors.

In contrast to the above collaborative filtering approaches for lo-cation recommendation and location prediction, our method 1) si-multaneously incorporates both regularity and conformity of human mobility in a unified prediction model, and utilizes the interplay between these two factors; 2) provides a time-aware collaborative model considering users X  preference drifting at different time slots so as to enable time-aware location predictions; 3) learns spatial in-fluence on venues using heterogeneous mobility datasets based on a gravity model and feeds it into the prediction model.
Given visited venues of a group of users, our goal is to predict their future locations at a certain time. Let U = { u 1 , u M users and V = { v 1 , v 2 , ..., v N } denote N venues. Note that here V may contain unvisited venues of users in U . We categorize days into two types, workdays and holidays, and let T = { t 1 , t represent the T time slots in the two classes of days. Given a spe-cific time slot t , we predict user u i  X  X  location by calculating the mobility preferences of u i to v j for j = 1 , 2 , . . . , N at t , and returning the v j that has the maximum mobility preference. Let R ( t )  X  R M  X  N be the preference matrix of U to V at time t , i.e., R ij ( t ) indicates u i  X  X  preference to v j at t . As mentioned earlier, a user u i  X  X  visit to a venue v j can be driven by either regularity or conformity, i.e., where R ( r ) ij ( t ) is the regularity term, indicating that v ing that v j is frequently visited by users who are similar to u time t . These two factors can interplay and reinforce each other to drive u i  X  X  visit to v j . Next, we introduce both terms respectively as follows.
For simplicity, in the rest of Sec. 3.1.1, we restrict our notations and description of the model to a specific time (without considering the time varying effect), and later in Sec 3.3, we will formulate the time-aware model.

To learn users X  regular mobility patterns, we map users X  visited venues to the geospatial space. Let C = { d 1 , d 2 , ..., d geographical grid cells (e.g., 100m  X  100m) discretizing the whole geospatial space of a city. Each venue v j is associated with a geo-coordinate { lat j , lon j } belonging to a certain grid d lon j are the latitude and longitude of v j . As shown in Fig. 1 a), u visited venues are mapped to the grids shown as the ones with plus signs.

Consider the probability that u i visits v j in terms of regularity, denoted as Pr( v j | u i ) . We assume that v j belongs to a grid d and u i travels from a grid d k to v j (note that it is possible that (c) H  X  (d) Q  X  d k = d k j ). By integrating over the geospatial grids and assuming the Markov property of users X  transitions between grids, we have
The first factor of the summation term in Eq. (3) can be estimated with the visiting frequency of a grid cell. As shown in Fig 1 a) and c), we flatten the 2D grid cells to a 1D vector H i , where H visiting frequency of u i to grid d k , approximating Pr( d we term H the hub matrix of U . The second factor Pr( d k the transition probability from d k to d k j , which is learned based on a gravity model using hetereneous mobility datasets, as detailed in Sec. 3.2. The third factor Pr( v j | d k j ) can be estimated using the visiting frequency of v j in grid d k j . We combine the second and third factor together as Q jk , which represents the spatial influence of v j to grid d k as shown in Fig. 1 b) and d). Intuitively, Q indicates the degree of influence that attracts users from grid d v , and we refer to Q as the spatial influence matrix . Then, Eq. (3) can be re-written as H i Q  X  j .

Furthermore, in urban areas, the spatial distribution of users X  vis-ited venues often exhibits the hierarchical  X  X ulti-center X  character-istics [6], which is an important aspect of regularity. For exam-ple, Fig. 2 plots the location check-ins of two users, where most check-ins gather around two major hubs, typically the work and home places. Meanwhile, the major hubs of a large population tend to form spatial agglomeration and foster different functional zones [38], such as residential areas and business districts. People actually commute between these functional zones to engage in var-ious social-economic activities. As shown in Fig. 1 a), the agglom-eration of major hubs can be represented by groups of grid cells in C . Given heterogeneous mobility datasets such as public transit data and taxi GPS trajectories, Sec. 3.2 introduces a method to learn the group structure from commuting patterns. As a result, the I grid cells are clustered into G groups G = { g 1 , g 2 , . . . , g that users also frequently visit some minor hubs within the groups containing major hubs, e.g., shopping malls, restaurants, gyms, etc.
The regularity of human mobility indicates that both the major and minor hubs are sparsely distributed in the geospatial space, as exemplified in Fig. 2 where red circles are the major hubs and green ones are minor hubs. This leads to groupwise sparsity (i.e., only a few groups of grids have visited venues of u i ), and within-group sparsity (i.e., only a few grids are visited for the groups containing u major hubs) of the vector H i , as illustrated in Fig. 1. To preserve both sparsities, Sec. 3.3 presents a sparse group Lasso-based model to constrain the regularity term, given by where g is a group in G .
In addition to the regular daily movements among several venues, people sometimes seek and visit novel locations. The social confor-mity theory [7] suggests that users who have similar backgrounds, interests, and social statuses often behave similar to each other, which is also the psychological root of collaborative filtering. A widely adopted approach [5, 17] is to factorize users X  location pref-erences in terms of conformity R ( c ) into two low dimensional la-tent matrices U and V , where U i and V j are latent factors of user i and POI j , both with dimension K . Nevertheless, the preferences of people to venues may vary at different times. Sitting in a caf X  en-joying coffee and sunshine is a wonderful choice for mornings but a bar is suitable for nights in most cases. We add the time changing part of user latent factor U i ( t ) to describe changeable preferences, and U i is the stationary part for unchangeable interests for venues. The conformity term is transformed to
Next, we introduce how to learn the spatial influence matrix Q and the group structure G in Sec. 3.2, and formally propose the RCH model as well as the optimization algorithms in Sec. 3.3.
Location profiling consists of two tasks: 1) estimating the spatial influence matrix Q  X  R N  X  I , where the element in the j th row and k th column Q jk is the spatial influence of venue v j to grid d 2) learning the group structure of the hub matrix H .

The spatial influence of venue v j to grid d k is comprised of two factors (refer to Eq. (3)): the transition probability from grid d (the grid containing v j ) to grid d k and the visiting frequency of v in d k j . The latter one is easier to obtain since we can estimate it by calculating the visiting frequency at v j within grid d ducting a kernel density estimation to obtain a smooth distribution, given a mobility dataset such as location check-ins and GPS tra-jectories. However, a precise estimation of the first factor can be tricky and subtle. To address this issue, we employ and adapt a gravity model [36][3], which is widely adopted in mobility analyt-ics for a large population, to estimate transition probability using heterogeneous mobility datasets.
Let O  X  i be the number of individuals leaving grid d i , for i = 1 , 2 , ..., I , and D  X  j be the number of people going towards grid d for j = 1 , 2 , . . . , I , where  X   X  P indicates a certain type of mo-bility. In this work, we consider three types of mobility: B ( bus ) , C ( check-in ) , and A ( taxi ) , i.e., P = { B, A, C } . The gravity model states that the commuting flows from grid i to grid j with respect to a certain mobility type, denoted as T  X  i,j , is determined by O and the distance between the two grids, through a gravity-like law: where c is a constant, a and b are coefficients of O  X  i and D spectively, and r tunes the decay by distance. As a result, ( T T i,j , T C i,j ) is a vector describing heterogeneous commuting flows from grid d i to grid d j .

Our goal is to estimate the coefficients a, b, r by fitting this model using observed mobility data. We achieve it using the multivariate regression method. Applying a logarithmic transformation to both sides of (6), we obtain the following expression:
For readability, we flatten the transition matrix T  X  as a vector denotes the regressors, given by X ( i  X  1) I + j, 4 = ln O  X  i . Let  X  be a vector containing all parameters (ln c,  X  r, b, a )  X  . We propose to estimate  X  by: where  X  is the error vector.

We employ least square estimation to estimate the parameter then  X  y i = X i  X   X  is the vector of the estimated transitions. Our target is now to find a  X   X  to minimize the sum of squared residuals:
The value of  X   X  that minimizes SSE in (10) is given by:
As a result, we obtain the estimated and row-normalized [14] transition matrix  X  T  X  with respect to a certain mobility type  X   X  P . Fig. 3 a) and b) visualize the estimated transitions to two grids (A and B) using different mobility data sources, where grid A is in a bar district (Sanlitun) and grid B is in an IT district (Zhongguan-cun). We observe that transitions estimated using different mobility datasets show similar influence to certain areas (such as B) and dis-crepant influence on some other areas (such as A). We note that for the within-grid transitions, i.e., d k = d k j , users X  movements may not be observable from taxi and bus data when the grid size is too small (since people usually take a bus/taxi for commuting when the travel distance is longer than a walking distance). However, the check-in data can reflect such within-group transitions, which also suggests the necessity to use heterogeneous data for learning the (a) spatial influence to grid A (a bar district) from other grids (b) spatial influence to grid B (an IT district) from other grids Figur e 3: Spatial influence to a grid estimated based on a grav-ity model using taxi, bus, and check-in data spatial influence on a venue. Combined with the estimated visit-ing frequency of v j in d k j , denoted as  X  j , we have the final spatial influence
Next, we learn the group structure of users X  major hubs. Given the estimated transition matrix  X  T  X  for  X   X  P , we employ the Dirichlet Multinomial Regression (DMR) based model [38] to learn the group structure (also known as the functional zones ) of a city. Specifically, for grid d i , i = 1 , . . . , I , we extract all out-going  X  X ords X  of a document, and learn the  X  X opic X  distribution through the DMR topic model, where the distribution of venues in grid d deemed as meta-data of the document (such as author and email). Later, we cluster the different grids according to the learned topic distributions. As a result, the grids in a cluster are regarded as a group and we obtain a list of groups G = { g 1 , . . . , g spatial influence matrix Q  X  is with dimension N  X  I , we use the groups G to re-order the columns of Q  X  so that the columns belong-ing to a group are put together. Then, for each group g  X  G , we group g .
We learn the predictor R i,j ( t ) using a supervised learning ap-proach by constructing an optimization problem. As explained in Sec. 3.1.2, if we only consider the conformity term (refer to Eq. (5)), our problem can be solved using a time-aware matrix factorization model, given by where U  X  R M  X  K is the matrix of users X  stationary latent fac-tor and U ( t ) is the matrix of users X  time-varying latent factor. The regularizations of U , U ( t ) , V are added to reduce generalization er-rors and avoid over-fitting, and  X  balances the regularization terms between the stationary and time-varying latent factors.
 To incorporate the regularity term, we need to learn a hub matrix H ( t ) , which represents spatial distribution of users X  regular venues at t . We group the columns of the hub matrix H in the same way as Q  X  , based on the group structure learned from Sec 3.2 to obtain G sub-matrices. The inner product of H ( g ) i ( t ) and Q  X  ( g ) ity term of user u i to venue v j for grids in group g . The three spatial influence matrices Q B , Q A and Q C are linearly combined to affect the hub matrices with a parameter vector  X  B ,  X  A ,  X  C . Combining both the regularity term and conformity term, our final objective function is  X ( U , U ( t ) , V , H ( t ) ,  X  B ,  X  A ) = X where  X   X  P and  X  C = 1 .

The l 2 -norm of H ( g ) ( t ) shrinks the number of groups, and offers group-wise sparsity . We use the l 1 norm of H ( t ) , which preserves within-group sparsity , to reduce the number of nonzero elements in a group. In this way, we maintain the sparsity of major and minor hubs, as shown in Sec 3.1.1.

We note that in the above final model, the regularity term also implies certain conformity since heterogeneous mobility data con-tains mobility patterns of different groups of users; the conformity term also implies some regularity, since it captures regular temporal patterns of users X  latent preferences. Therefore, regularity and con-formity actually interplay and reinforce each other to co-influence the mobility model.
We use alternative minimization to learn all parameters:  X  Optimization of U: When U ( t ) , V , H ( t ) ,  X  B and  X  A are fixed, the optimization problem is equivalent to the minimization of: We update U by solving a least-square problem: the gradient of  X  with respect to U is: Let  X   X  U = 0 and we get the update rule of U : where T is the number of time slots.  X  Optimization of U ( t ) : For a time changing part of user latent factor of time slot  X  , when U , V , H ( t )( t  X  T ) , U ( t )( t  X  T , t 6 =  X  ) ,  X  problem is transformed to the minimization of: The gradient of  X  U (  X  ) with respect to U (  X  ) is: The changing part of user latent factor is updated as:  X  Optimization of V: Similarly, when U , U ( t ) , H ( t ) ,  X  B and  X  A are fixed, we set ( U + U ( t )) as  X  U , the latent factor is updated as:  X  Optimization of  X  B and  X  A : The optimization problem is equivalent to minimizing: where Hence, we obtain The Hessian matrix of  X (  X  B ,  X  A ) is: By applying Cauchy-Schwarz inequality, we have implying that  X  2  X  is positive-definite and  X (  X  B ,  X  A Therefore, the estimations of  X  B and  X  A can be computed by:  X  Optimization of H ( t ) : Fixing U , U ( t )( t  X  T ), V ,  X  B and  X  A , we denote as  X 
R ( t ) . For a given time slot  X  , when H ( t ) , ( t  X  T and t 6 =  X  ) are fixed, Eq. (14) is equivalent to:  X  For a M  X  N matrix X = have Hense, we can rewrite Eq. (28) as: Assuming that the regular patterns of users are independent, every row in H (  X  ) is uncorrelated with the other rows. Therefore,Eq. (30) is equivalent to: Our goal now is to find an H j (  X  ) to minimize: for j = 1 , . . . , M .
 This problem is similar to the sparse group Lasso problem [31]. We leave the detailed derivation to the appendix 4 and give the update rules as follows: 1. Check whether k F (  X  R (  X  g ) j (  X  )  X  Q ( g ) ,  X  X  ) k 2. If not, iteratively update H ( g ) j (  X  ) by Here, Algorithm 1: Optimization of RCH Model where  X  is a sufficiently large number,  X  G ( H ( g ) j (  X  ) ent of G ( H ( g ) j (  X  )) with respect to H ( g ) j (  X  ) , and Finally, we provide the pseudo-code of the whole optimization pro-cedure in Algorithm 1. The time complexities of Eq. (17)(20) and (21) are O ( T M N (max { K, I } )) . The time complexities of Eq. (27) and (28) are O ( T M N ) and O ( M P g  X  X  N L ( g ) ) (which equals to O ( M N I ) ) respectively. If the number of iterations is S , the time complexity of the whole optimization for Eq. (14) is
We utilized three real-world mobility datasets in our experiments, where the first one is the targeted mobility to be predicted, and the latter two are used together to learn location profiles (refer to Sec. 3.2).  X  Check-in Dataset. We crawled 12,133,504 location check-ins at 146,962 venues in Beijing from 1,765,633 users through Sina Weibo (China X  X  Twitter) API 5 from March. 2011 to Sep. 2013. Af-ter removing users who have less than 15 check-ins, we obtain 7,355,962 check-ins at 118,534 venues from 161,794 users where each user has 45 check-ins and visits 20 venues on average. We plot the Log-Log histograms in Fig. 4, where the number of check-ins shows a power-law distribution. Each check-in contains the user ID, check-in time, venue ID and the venue X  X  geo-coordinates.  X  Bus Dataset. This dataset contains 3 million bus-trip records from August 2012 to May 2013 in Beijing. Every trip includes the card ID, alighting time, boarding and alighting stops of the trip.  X  Taxi Dataset. This data set contains GPS trajectories of Beijing taxis from March 2011 to August 2011. We segmented the trajec-tories into 19.4 million taxi transitions. Each transition includes the (a) distibution of # check-in boarding and alighting times as well as the geo-coordinates of the origin and destination. In our experiments, we learn the models and obtain the matrix R ( t ) for time slot t . Each row of the matrix is the predicted scores for venues of a user. We use two metrics to measure the perfor-mance of location prediction: prediction accuracy (Acc @ top P ) and the average percentile rank (APR) of the actually visited venues.
Acc @ top P is the percentage of accurate predictions for a list of predictions with length P . The percentile rank of prediction for venue v j [25] is defined as: where rank ( v j ) is the position of venue v j in the predicted list and N is the number of venues. It is clear that PR is 1 if the true venue is ranked as the first. Average Percentile Rank (APR) is the average of PR over the testing set.
We compare the RCH model with 4 baselines, CEPR [19], W 3 (W 4 in [40] without "what"), PMM [6] and MF (Most Frequent).  X  MF. Most Frequent Model calculates the frequencies of user u checking in at different venues at time t based on u i  X  X  location his-tory, and assigns the most frequently visited venue as the predicted venue given time t .  X  PMM. Periodic Mobility Model employs a Gaussian mixture model centered at "home" and "work" to learn user locations, which are divided into two states, home state and work state, modeled by a 2-dimensional time-independent spatial Gaussian distribution. PMM randomly initializes the state of each location and the parameters are estimated using the EM algorithm.  X  W 3 .W 4 (who, when, where, and what) is a probabilistic mo-bility model based on interactions between user regions, locations, personal topics etc. It can be generally applied to various applica-tions such as location prediction of a tweet, location prediction of a user and time. We only make comparisons with respect to the location prediction for a user, which is calculated by: where s  X  X  0 , 1 } denotes workdays or holidays, t is time of a day, r is the latent geographical region and z is the latent topic of a tweet. Since our dataset does not include tweets, the W 4 is de-generalized to W 3 , i.e., who, where, and when.  X  CEPR. This model divides human mobility into two types, reg-ular and novel ones. It first classifies the next check-in as novel or Figure 6: Acc @ top P for different type of days and time slots (12am-4am, 4am-8am, 8am-12pm, 12pm-4pm, 4pm-8pm, 8pm-12am) regular by taking 5 different features into a supervised classifica-tion model. If the next venue is classified as regular, it employs the hidden markov model to predict the location. Otherwise, a social-based collaborative filtering algorithm is applied to explore suitable candidates.
Matrix U , V , U ( t ) and H ( t ) were initialized with the random assignments in [0 , 10] . The default values of  X  A and  X  We set the four parameters in our model,  X  ,  X  ,  X  and  X  , as  X  . The default value of  X  is (0 . 005 , 0 . 005 , 0 . 95 , 10  X  5 one by one and the results are reported in Sec. 4.2. We categorize days into two classes, workdays and holidays, and split each day into 6 time slots equally, i.e., 12am X 4am, 4am-8am, etc. Therefore we have 12 time slots in total. We performed 6-fold cross validation to evaluate all methods.

We use C/C static to represent our RCH model considering only the conformity term with/without time-varying user latent factors respectively. R is denoted as our RCH model that only contains the regularity term. RCH BAC /RCH C are the RCH model with/without heterogeneous datasets for learning location profiles 3.2, where RCH use only check-ins and RCH BAC use all three mobility datasets.
We first investigate the performance of all compared methods without considering heterogeneous mobility datasets. The average Acc @ top P with respect to P are illustrated in Fig. 5(a). The per-formances of individual models such as PMM and W 3 are not as good as the MF model, probably due to the sparsity of check-in data, and high visiting frequencies of partial venues. Cho et al. [6] used a dataset with users having at least 10 check-ins every day . In our experiment, we only filtered users who have less than 15 total check-ins, which further aggravates data sparsity and weak-ens the advantage of individual models. RCH C and CEPR perform much better than the other 3 models, outperforming MF by 13.3% and 2.6% respectively when P = 10 . The use of collaborative filtering improves the performance of CEPR and our models. How-ever, RCH C shows an extra 10.7% improvement over CEPR when P = 10 due to the incorporation of both regularity and conformity.
Fig. 5(b) shows average Acc @ top P of the 5 variational RCH models. The Acc @ top10 of the C static model is 0.06 higher than the R model, demonstrating that more check-ins are driven by con-formity than regularity in our dataset. Besides, the introduction of time-varying latent factors in C improves the result of C 4.5% when P = 30 . The combination of regularity and confor-mity of human mobility, RCH C , exceeds C and C static by 6.5% and 8.9% respectively when P = 50 . Compared with the C model, the improvement of RCH BAC is 33% higher than that of RCH when P = 60 , which indicates the predictive power of location profiles learned from heterogeneous mobility datasets. Our experi-ments demonstrate: 1) the effectiveness of combining regularity and conformity, 2) the superiority of time-aware collaborative model, and 3) the advantage of using heterogeneous mobility datasets.
Table 3 presents the APR and Figure 6 shows the Acc @ top 60 of compared models in terms of different time slots and type of day. Similar to the results of accuracy, time slot 2 of workdays has the highest APR in most cases. Although the C model has greater accu-racy than R shown in Fig. 5(b), its APR is less than that of R for 6 time slots. One possible reason is that users may have certain occa-sional movements that are not influenced by others and not highly regular for themselves (i.e., they visit such venues less regularly than their major/minor hubs). The APR of RCH C consistently out-performs C and R, which suggests that regularity and conformity are complementary drivers of human mobility.
 We studied the effects of different parameters in  X  = {  X ,  X ,  X ,  X  } . Fig. 7(a) reports the accuracy of the C model for varying K from 20 to 110 when  X  = 0 . 5 and  X  = 0 . 5 . It is clear that a larger K results in higher accuracy for different P . This demonstrates that the more dimensions into which we segment the users, the more accurate pre-dictions we have. However, when K increases, the growth on accu-racy becomes slow. Fig. 7(b) shows that the change of  X  and  X  has little impact on model C. Fig. 8(a) plots the accuracy of the R model for different  X  when  X  = 0 . 00001 , and Fig. 8(b) plots the accuracy of the R model for different  X  when  X  = 0 . 95 .  X  is the propor-tion of l 1 norm in the regularization of H ( t ) . Fig. 8(a) shows that the larger ratio of within-group sparsity tends to slightly increase prediction performance. This confirms our assumption that a user is active only in a few grids of a group. We observe from Fig. 8(b) that when  X  is less than 10  X  5 , its effect on the performance remains stable. The sudden decrease happens when  X  is larger than 10
Fig. 9(a) and 9(b) report the average Acc @ top 60 of visited venues and unvisited venues respectively. Because the MF model is not able to predict a use X  X  unvisited venuess, we compared the other 4 models. RCH BAC and CEPR benefit from the collaborative filter-ing approaches and outperform PMM and W 3 apparently for the prediction of unvisited venues. RCH BAC outperforms CEPR by 24% when P = 60 in holidays. The Acc @ top P is 7.38 times as PMM and 8.7 times as W 3 . For visited venues, the advantages of RCH BAC and CEPR compared to individual models are not as ob-vious as unvisited venues, while the improvement of RCH BAC still higher than that of CEPR. An interesting observation is that the prediction accuracy of unvisited venues on holidays is higher than workdays for both CEPR and RCH, in contrast to the previous ob-servation of higher overall predictability on workdays. This might be because people X  X  movements to new places are more alike to each other during holidays than workdays, thus conformity shows a stronger predictive power for unvisited places.
In this paper, we have proposed a hybrid location prediction model called RCH integrating both the regularity and conformity of hu-man mobility, capturing users X  regular movement patterns and their occasional visits influenced by others. In particular, we incorpo-rate heterogeneous mobility data to learn the spatial influence to venues and the group structure of different regions based on a grav-ity model. We have conducted extensive experiments using several large-scale mobility datasets, such as location check-ins, taxi tra-jectories, and public transit data, to validate the effectiveness of our model. Based on the evaluation results, our model significantly out-performs existing approaches.
There are several interesting directions that could be explored in the future. For example, given semantic information of users X  mobility such as geo-tweets and location tags, the location profiles can be further enriched, which should be beneficial for predicting the semantic mobility of users.

