 Lifestyle plays an essential role in controlling diabetes and in both the prevention and management of diabetes. Many re-ports from clinical research support the theory that healthy eating and regular exercise are much more effective at man-aging diabetes than traditional medication. In this paper we introduce an innovative approach to the multimodal recom-mender system conceived in the EU METABO project. The most important feature of the METABO Diabetes-Lifestyle Recommender (MED-StyleR) is to generate highly personal-ized recommendations that satisfy medical prescriptions for patients X  long-term health alongside short-term preferences of patients in their daily lives.
 H.4.2 [ Information Systems Applications ]: Types of Systems X  Decision support (e.g., MIS) Algorithms Clinical Decision Support System, Diabetes Management, Recommender System, Rule-based Recommendations
Diabetes is a chronic metabolic disturbance characterized by increased blood glucose concentrations and decreased insulin secretion. The International Diabetes Federation (IDF) predicts that there will be 333 million people with di-abetes worldwide in 2025, amounting to 6.3% of the world X  X  population. Furthermore, it is estimated that up to 50% of people with diabetes are undiagnosed or are unaware of their condition.

The Diabetes Control and Complications Trial [8] includ-ing 1,441 subjects with Type 1 diabetes showed that ef-fective management of blood glucose levels (BGL) can re-duce the risk of late complications -such as visual disor-ders, heart disease, foot problems and kidney failure. Re-cently, many studies have reported that computer-assisted expert systems, such as clinical decision support systems (CDSS) and telemedicine, might help practitioners and dia-betes patients to make reliable diagnoses and management decisions[1][2][7]. CDSS are active knowledge management systems that bundle basic clinical knowledge with specific in-formation about cases and patients. This knowledge is then used to support health care professionals in making decisions about short-and long-term therapies. One major difficulty in constructing knowledge-based CDSS systems lies in the need for domain experts and training the system, which is time-consuming and therefore might cover only a narrow scope of applications.

On the other hand, lifestyle plays an essential role in con-trolling diabetes, in both the prevention and management of diabetes. Many reports in clinical research support the the-ory that healthy eating and regular exercise are much more effective at managing diabetes than traditional medication. In particular, for patients with Type 2 diabetes, lifestyle changes based on a heart-healthy diet with physical exercise may be sufficient for successful control of their BGL. How-ever, changing a lifestyle requires a great deal of effort from patients and practitioners to initiate and sustain a targeted lifestyle program. Some patients report that traditional diet program and exercise prescriptions are often unrealistic and difficult to follow in the long term.

As part of the European METABO project 1 , we are devel-oping the METABO Diabetes-Lifestyle Recommender (MED-StyleR) to improve the quality of diabetes patients X  self-management programs and support physicians in their deci-sion-making by providing highly patient-specified support-ing models. The architecture of the MED-StyleR is based on CDSS components and lifestyle recommendations related to food intake and workout, in order to satisfy medical pre-scriptions for diabetics X  long-term healthy lifestyle along-side short-term preferences of patients in their daily lives. In detail the main part of the MED-StyleR consists of a knowledge-based rule engine supplemented by collaborative and case-based filters to validate the generated recommen-dations for the patients X  food intake and exercises.
In this paper, we briefly introduce the METABO project and the architecture of MED-StyleR, part of the overall CDSS model defined in the project. Specifically, we will present a rule-generation engine that provides the possibili-
EU FP7-ICT-2007-1-216270, www.metabo-eu.org ties to simply manage multimodal knowledge and to realize collaborative data processing.
METABO (Controlling Chronic Diseases related to Meta-bolic Disorders) is a European collaborative project funded by the European Commission and started in January of 2008 by 22 partners from 9 EU member states.

The aim of METABO is to set up a comprehensive plat-form, running both in clinical settings and in everyday life environments, for continuous and multi-parametric monitor-ing of the metabolic status in patients with, or at risk of, diabetes and associated metabolic disorders. The type of pa-rameters that will be monitored, in addition to  X  X raditional X  clinical and biomedical parameters, will also include subcu-taneous glucose concentration, dietary habits, physical ac-tivity and energy expenditure, effects of ongoing treatments, and autonomic reactions. The data produced by METABO will be integrated with the clinical data and the history of the patient and will be used in two major interrelated con-texts of care: 1. Setting up a dynamic model of the metabolic behavior 2. Building personalized care plans integrated into the 3. The combined use of tools for predictive modeling and
METABO consists of a global platform that collects and processes data coming from the patient and the physicians X  tools (a mobile device for the patients to acquire data from users and sensors and a web application for the physicians to present them with all the data collected and analyzed) and works as an information exchange bridge between physicians and patients. In addition, the system provides both groups of users with decision support systems to give them recom-mendations for a healthy lifestyle in a personalized short loop and for treatments in an integrated long loop (Figure 1).
The MED-StyleR is one of different specific subsystems comprising the overall METABO CDSS model that takes into account the patient X  X  metabolic changes and informa-tion about dietary, physical activities and other patterns of lifestyle. The MED-StyleR aims to support patients dur-ing everyday life by generating patient-specific recommen-dations and is intended to run on the patient X  X  mobile de-vice and to support the patients in adapting their lifestyle Figure 1: Diagram of METABO Platform (after METABO Annex I  X  X escription of Work X ) to their disease. It therefore delivers daily and highly per-sonalized recommendations for meals and physical activities that should affect the patient X  X  healthy life in the long term and his/her ambitions in the near future.
 Regarding the food intake, we want to generate highly per-sonalized recommendations with patient-specific and diabe-tes-friendly recipes. We therefore take into consideration general dietary guidelines for the intake of carbohydrates, fats and protein. The ultimate objective is to protect the heart and to control, for example, the levels of cholesterol and triglyceride and the blood pressure. This is very im-portant because diabetics are at high risk of secondary dis-orders including heart and kidney disease. In addition, to the food intake, physical exercise plays a decisive role in energy and glucose consumption. Even light exercises can have benefits for diabetics and can increase sensitivity to in-sulin, for example. However, the system must be aware of the patient X  X  glucose level and severity of disease, if provid-ing recommendations for physical activities. For example, if the current glucose level is higher than 250mg/dl, which means that the patient is suffering from hypoglycemia, the system should recommend refraining from exercise. Insulin-dependent patients especially need to be given recommen-dations during their physical exercise. For example, they should reduce their insulin dose or should take in more car-bohydrates before starting a high-impact workout. In ad-dition, patients with already weakened blood vessels in the eyes or feet should avoid high-impact exercises.
The MED-StyleR is designed to work as a knowledge-based hybrid architecture, as shown in Figure 2. The rec-ommender includes several sub-modules. These modules are responsible for gathering (GUI-based input panel) and ana-lyzing (Data Compiler, Profile Updater) daily instant data such as food intake, physical activity, the glucose level, de-mographic data such as age, gender and weight, and stereo-typical data such as obese type or lean type with absolute insulin secretion deficit. In addition, the lifestyle trend ana-lyzer analyzes the trends related to the patient X  X  food habits and physical activities that affect the rule generation and ex-Figure 2: Architecture of METABO Diabetes-Lifestyle Recommender (MED-StyleR) traction. The data are gathered partly by the patient man-ually and partly by carried sensors.
 The recommendation extractor derives practical recommen-dations for the patients in personalized form. The main part of this module is a rule engine comprising rules based on the knowledge contained in the expert knowledge base, which includes specialized domain knowledge of various ex-perts such as practitioners, nutritionists and physical train-ers, about medical diagnosis, diabetes diet and physical ex-ercises. To provide patient-specific recommendations by, for example, personalizing the patients thresholds for hypo-and hyperglycemia by collaborative filters or the Kalman Filter [9], the MED-StyleR also needs to know about the patients. This knowledge includes general demographic information, the diabetes diagnosis, therapeutic charts, food intake and food preferences, exercise schedules and much more besides, and is stored in the patient knowledge base. To validate the generated recommendations, finally, the knowledge base contains a case knowledge base, which is a collection of user profiles, former recommendations and the related feedback of patients and experts.
An in-depth investigation of structural frameworks for the recommender system, such as the collaborative filtering method, content-based recommendations, and knowledge-based recommendations, reveals that every approach has some limitations in addition to its strengths [3]. Since gener-ating recommendations to assure patients a healthier lifestyle instead of their accustomed one differs from traditional e-commerce applications that aim to satisfy the user X  X  de-mands and preferences, we have developed a knowledge-based hybrid system that exploits the strengths of existing approaches.
 As illustrated in Figure 2, the knowledge management mod-ule affects the overall data processing stages. We combine the collaborative and demographic method to analyze simi-larities between patients by using user-dependent and user-independent data. Whereas the knowledge bases are used to extract rule-based recommendations, the similarity between patients is used to verify the extracted recommendations by a case-based filtering process. The rule-based approach was chosen because of its precise logic and its ability to handle large amounts of data. Furthermore, making decisions by rules offers the possibility of using forward chaining as well as backward chaining. So we are able, for example, to ask the question:  X  X  If the user is obese and has done no physi-with?  X  X . One possible recommendation could be swimming -because it is a low-impact activity. However, we would ask:  X  X  The user likes to eat cheese. Is this advisable?  X  X  and if the user doesn X  X  suffer from lactose intolerance the answer could be  X  X  Yes  X  (Figure ?? ) X . Additionally, we could also com-bine both methods and add the question:  X  X  If eating cheese is advisable, how much would be a good portion?  X  X . Finally, the case-based approach was chosen to validate and enhance recommendations by comparison with successful recommen-dations saved in the database.

As the rule engine is a core component of the MED-StyleR we have developed a prototype rule engine that helps people in general to reduce or maintain their weight and makes it easy to extend to our target application in the METABO specialized for diabetics. Since we wanted to investigate the technical aspects of a rule engine, in the first instance, we focused on the generation of recommendations regarding the food intake.
 Concept Since excessive or unhealthy food intake is one of the main reasons for excess weight and adiposity, we focused on the balance of consumed and burned calories. As all people dif-fer in their calorie requirement, we used the Harris-Benedict equation [5] to calculate the resting metabolic rate of the respective users. We calculated the resting metabolic rate for this weight-in order to reach or maintain their reason-able weight. The desired weight was either input by the user or calculated by the normal body mass index (men: 20-25; women: 19-24) and the user X  X  height. Other information in-put by the users included demographic data such as name and age, height and actual weight. To filter food with in-tolerable ingredients in the prototype, the users were also asked to state whether they suffered from allergies, lactose intolerance or gluten intolerance. In addition, the users were able to name their likes and dislikes in terms of dishes and ingredients in order to increase or decrease the possibility of receiving corresponding meals. All the options available to manipulate the meal plans show that the meal plans were generated in a highly dynamic and personalized way. Cer-tainly, the recommended dishes could be rejected by the users. If the user rejected dishes, he/she was asked to state whether this was just an exception or whether he/she didn X  X  like the dish or ingredients at all. The answer was taken into account when updating the whole meal plan afterwards. An additional feature of the prototype was a diagram that showed the present change of weight. This was meant to enhance of the user X  X  motivation.
 Implementation The prototype consists of a database with information about some users and some dishes and a Java application that queries and stores this information and contains a Rete en-gine that is responsible for connection to the rule engine. We decided to use the Jess (Java Expert System Shell) rule engine, which is a further development of the CLIPS expert system shell [6]. One reason for this decision was the ex-cellent performance of Jess due to the use of an optimized RETE algorithm [4]. By using Jess we are also able to ma-nipulate Java objects via rule-based inferences and, because of the separation of the interface, the database and the inter-ference engine, it is very simple to insert new functionalities into the recommender system just by including necessary knowledge formulated as rules (see example below) and by defining corresponding objects and database tables. (defrule lactose-intolerant ?user &lt;-(User(lactose TRUE)) ?meal &lt;-(Meal(lactose TRUE)) =&gt; (retract ?meal))
The extraction of the recommended meals consisted of several steps and was partly iterative. Initially, the Java ap-plication reads out the information about the user and all stored dishes. Afterwards the Rete engine starts the rule en-gine. All the dishes containing intolerable ingredients were first deleted from the list of possible meals. The remain-ing meals were then rated by the stored information about the user. If the user, for example, liked or disliked par-ticular dishes or ingredients, then the corresponding rating was increased or decreased respectively by the firing rules. In addition, dishes containing too many or too few calories gained a negative rating. After this rating the best-rated breakfast, lunch and dinner were added to the meal plan of the first day. The procedure was then repeated until the whole meal plan for one week was completed. To ensure a varied meal plan, all dishes already inserted into the plan gained a small negative rating. As mentioned above, the rating for the whole week was repeated-if the user rejected one or more dishes, because the reasons for the rejection could also have an influence on other recommended dishes.
We presented a model of a lifestyle recommender system for diabetes patients. Research into the effective manage-ment of clinical knowledge and patients X  records is still chal-lenging work, and the literature so far offers ideas rather than well-defined solutions. Furthermore, the design of a recommender system for clinical purposes needs particular attention compared to general commercial recommender sys-tems that are oriented towards satisfying users X  demands. With the clinical recommender, we are trying to change pa-tients X  lifestyles and to manage their daily activity based on strictly prescribed recommendations. This means that the system must also be able to reasonably limit patients X  daily preferences if they are against the diabetes manage-ment program, rather than to recklessly encourage them. It is therefore important to design the system reliably so that patients follow recommendations confidently and, as sup-porting people or social circles also play a decisive role, the social components for lifestyle management should be taken into account, as well.
 Much work remains to be done in the METABO project. For example, the next steps will be the clinical pilot study conducted by our medical partners which is currently run-ning in seven METABO countries concurrently. This study will enable us to extend and validate the MED-StyleR in a practical way by investigating, for example, if collaborative filters really could work in our scenario.
 The work described in this paper is funded by the EU under research grant ICT-216270-METABO. [1] E. A. Balas, S. Krishna, R. A. Kretschmer, T. R. [2] T. Bodenheimer, K. Lorig, H. Holman, and [3] R. Burke. Hybrid recommender systems: Survey and [4] C. Forgy. Rete: A fast algorithm for the many [5] R. W. Frankenfield D, Muth ER. The harris-benedict [6] E. Friedman-Hill. Jess, the rule engine for the java [7] G. Kong, D. Xu, and J. Yang. Clinical decision support [8] The DCCT Research Group. The effect of intensive [9] G. Welch and G. Bishop. An introduction to the kalman
