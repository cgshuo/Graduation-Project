 Mining the latent topics from web search data and capturing their spatiotemporal patterns have many applications in information re-trieval. As web search is heavily influenced by the spatial and tem-poral factors, the latent topics usually demonstrate a variety of spa-tiotemporal patterns. In the face of the diversity of these patterns, existing models are increasingly ineffective, since they capture only one dimension of the spatiotemporal patterns (either the spatial or temporal dimension) or simply assume that there exists only one kind of spatiotemporal patterns. Such oversimplification risks dis-torting the latent data structure and hindering the downstream usage of the discovered topics. In this paper, we introduce the Spatiotem-poral Search Topic Model (SSTM) to discover the latent topics from web search data with capturing their diverse spatiotemporal patterns simultaneously. The SSTM can flexibly support diverse spatiotemporal patterns and seamlessly integrate the unique fea-tures in web search such as query words, URLs, timestamps and search sessions. The SSTM is demonstrated as an effective ex-ploratory tool for large-scale web search data and it performs supe-riorly in quantitative comparisons to several state-of-the-art topic models.
 H.3.3 [ Information Search and Retrieval ]: Search process Algorithms, Experimentation Spatiotemporal, Search Engine, Query Log
With the rapid growth of web search data, there is a great demand for developing effective text mining models to analyze search en-gine query log, since discovering the web search topics and captur-ing their spatiotemporal patterns are vital for applications such as Google Trends 1 and Foursquare [11]. However, little work has been done on analyzing query log from the spatiotemporal perspective. Although some admixture topic models [2] have been proposed to accommodate the demands of analyzing timestamped or GPS-labeled data, to the best of our knowledge, none of them supports discovering topics by considering different spatiotemporal patterns simultaneously. However, in the field of query log analysis, it is critical to model the existence of diverse spatiotemporal patterns. For instance, a topic about Terrorism maywidelyexistfromthe spatial perspective and lasts for a long time period from the tem-poral perspective. In contrast, a topic about Storm Sandy may be primarily related to the coastal regions of the United States and has a relatively short longevity. Besides the existence of diverse spa-tiotemporal patterns, query log data have some unique features such as query words, URLs, timestamps, search sessions, etc. These in-formation should be seamlessly integrated for discovering the web search topics from query log.

To handle the aforementioned challenges, we propose the Spa-tiotemporal Search Topic Model (SSTM) to discover the latent top-ics from query log and capture their diverse spatiotemporal pat-terns simultaneously. To the best of our knowledge, the SSTM is the first model that accommodates a variety of spatiotemporal pat-terns in a unified fashion. We carry out large-scale experiments and the experimental results show that the SSTM outperforms several state-of-the-arts in terms of perplexity as well as in the tasks such as location prediction and time predication. The remainder of the paper is organized as follows. In Section 2, the related work is re-viewed. Section 3 discusses the spatiotemporal patterns. Section 4 presents the SSTM and details its parameter inference method. Section 5 presents experimental results, and conclusions are pro-vided in Section 6.
We review some recent related work in this section. In [1], a framework for quantifying the spatial variation of search queries is developed on complete Yahoo query log. The Topic-Over-Time model [14] is proposed to associate each topic with a continu-ous distribution over timestamps. In [4], the authors proposed a model for the monitoring topic and vocabulary evolution over doc-uments. In [16], LPTA is proposed to exploit the periodicity of the terms as well as term co-occurrences. Wang et al. [13] proposed a topic model to capture the relationships between locations and words in news and blogs. Yin et al. [15] studied the problem of discovering geographic topics from GPS-associated tweets. Sizov et al. [12] proposed models for characterization of social media by combining text features with spatial knowledge. Eisenstein et http://www.google.com/trends/ al. [3] proposed a multi-level gen erative model that reasons about lexical variation across different geographic regions. Hao et al. [5] proposed the location-topic model to mine location-representative knowledge from a collection of travelogues. Hong et al. [6] pre-sented an algorithm by modeling diversity in tweets based on topi-cal diversity, geographical diversity, and an interest distribution of the user. In [10], a probabilistic approach is proposed to model the subtopic themes and spatiotemporal theme patterns simultaneously. With the popularity of applying topic modeling to spatial, tempo-ral or even spatiotemporal information, few prior work has been done on analyzing web search data by jointly modeling diverse spa-tiotemporal patterns. Hence, the major distinction of the proposed SSTM is its capability of discovering web search topics while cap-turing their diverse spatiotemporal patterns simultaneously.
In this section, we review the spatial temporal patterns that are used in existing work. The existing spatial patterns can be broadly divided into two categories: the local pattern ( S l )andthe global pattern ( S g ) [12, 13]. The logic behind this categorization is that some topics demonstrate geographic locality while the others do not. Specifically, S g assumes that each topic is related to some locations and the geographic distance between the locations is not considered while S l assumes that topics have geographic locality and each topic is related to a specific area on the map. The exist-ing temporal patterns can be broadly classified into three types: the periodic pattern ( T p ), the background pattern ( T g )andthe bursty pattern ( T b ) [8, 16]. A periodic topic is one that repeats in regu-lar intervals; a background topic is one covered uniformly over the entire period; a bursty topic is a transient topic that is intensively covered only in a certain time period. We now present the spa-tiotemporal patterns that will be used in this paper. Assume that we have the spatial pattern set S and the temporal pattern set the existing work, we create a set of spatiotemporal patterns applying the Cartesian product on S and T . In this way, we get very diverse spatiotemporal patterns, which are presented in Table 1. Note that the spatiotemporal pattern proposed in [10] is captured by p 2 in Table 1.

We represent each query log entry in a format as follows: Here uid is the user identifier, w is the word vector for the query, where l is the names of the locations, l lat and l lon represent the latitudes and longitudes of the corresponding locations, u ? clicked URLs of this query. The location information is not readily available in query log, we employ the method in [9] to extract the locations l and obtain the latitudes l lat and longitudes locations via a geographic dictionary. The question mark indicates that the corresponding element may not exist for some log entries. In web search, the queries are not independent from each other. The users usually submit search queries consecutively as a session to satisfy a single information need. We utilize the method in [7] to segment query log into search sessions. Finally, we group each user X  X  log entries together as a document and then organize each document via sessions.

The generative story of SSTM is presented in Algorithm 1. We assume that each user has a topic distribution and each topic is re-lated to a specific spatiotemporal pattern. When conducing web search to satisfy an information need, the user first decides the topic and then selects some query words according to the chosen topic. For each search session, the user needs to decide whether to click some URLs. If so, the clicked URLs are generated according to the chosen topic as well. Since the information within a session is coherent and is used to satisfy the same information need, we constrain that the information in the same session shares the same topic. Finally, the spatiotemporal information such as the times-tamps and the locations (or the latitudes and longitudes) is gener-ated based on the spatiotemporal pattern of the chosen topic. Algorithm 1 Generative Procedure of SSTM 1: for topic k  X  1 , ..., K do 2: draw a query word distribution  X  k  X  Dirichlet (  X  ) ; 3: draw a URL distribution  X  k  X  Dirichlet (  X  ) ; 4: end for 5: for each document d  X  1 , ..., D do 6: draw d  X  X  topic distribution  X  d  X  Dirichlet (  X  ) ; 7: for each search session s in d do 8: choose a topic z  X  Multinomial (  X  d ) ; 9: generate query words w  X  Multinomial (  X  z ) ; 11: generate URLs u  X  Multinomial ( X  z ) ; 12: end if 13: generate the temporal information t  X  p t | z ) ; 15: generate the spatial information l  X  p ( l | z ) ; 16: end if 17: end for 18: end for
We proceed to discuss a sampling method for the parameter in-ference of SSTM. The joint likelihood of the observed query words, the URLs and the spatiotemporal information with the hyperparam-eters is listed as follows: The probability of generating the query words w in the corpus is given as follows: The probability of generating the URLs u in the corpus is given as follows: The conditional probability of generating the temporal information t given the topic z can be written as: where The background pattern p ( t | z ) is modeled by a uniform distribu-tion. In p ( t | z ) , t e and t s are the newest and the oldest timestamps in the query log. The bursty pattern p ( t | z ) is modeled by a Gaus-sian distribution. The periodic pattern p ( t | z ) is modeled as a mixture of Gaussian distributions. In p ( t | z ) , n is the period id, p ( t | z,n )= 1  X  n .
 The conditional probability of generating the spatial information l given the topic z can be written as: If topic z is a global pattern, we model that spatial information by a Multinomial distribution over the locations. If topic z is a local pattern, we model the spatial information as a 2-dimensional Gaussian distribution over the latitude and longitude: After combining the aforementioned formula terms, applying Bayes rule and folding terms into the pr oportionality constant, the condi-tional probability of assigning the k th topic for the i th session can be determined by a set of formulas. For instance, if the topic k is related to the spatiotemporal pattern p 1 in Table 1, the conditional probability is defined as follows: where C DK dk is the number of sessions that have been assigned to topic k in document d , C KW kw is the number of query words that have been assigned to topic k , C KU ku is the number of URLs that have been assigned to topic k , N iw is the number of w in the i th session and N iu is the number of u in the i th session. Similarly, we can derive the remaining conditional probabilities when the corre-sponding topic is related to other spatiotemporal patterns such as the distribution parameters of the bursty pattern, the periodic pat-tern and the local pattern after each iteration of the sampling pro-cedure. For example, we update the Gaussian distribution of the bursty pattern by the sample mean and sample variance as follows: where t i is the i th timestamp which exists in sessions that are as-signed search topic z . The update formulas for other spatiotempo-ral patterns can be straightforwardly obtained in a similar way.
In this section, we evaluate the SSTM on the query log of a ma-jor commercial search engine in the United States. The dataset contains 1,200,945 search queri es that were submitted by 10,213 users. After carrying out the session derivation process, we obtain 520,131 search sessions. We first evaluate SSTM by the quantitative metric of perplexity. The baselines we choose are summarized as follows: Latent Dirich-let Allocation (LDA) [2], Topics-Over-Time model (TOT)[14], Lo-cation Aware Topic Model (LATM)[13], Geodata in Folksonomies (GeoFolk)[12], Spatiotemporal Theme Pattern model (STTP) [10] and Latent Periodic Topic Analysis (LPTA)[16]. Perplexity mea-sures the ability of a model to generalize to unseen data and better generalization performance is indicated by a lower perplexity. We compare the models by a ten-fold cross validation. Figure 1(a) il-lustrates the average perplexity for each model when the number of topics is set to different values. We can see that the STTM provides significantly better fit for the data than the baselines. For instance, when the number of topics is 600, the perplexity of LDA, TOT, LATM, GeoFolk, STTP and LPTA are 14220, 9986, 9601, 9072, 5569 and 6401 while the perplexity of SSTM is 1423.
Geographical locations can be used to predict users X  behaviors and uncover users X  interests and therefore it is potentially invalu-able for many perspectives, such as behavior targeting and online advertisements. In this subsection, we focus on the task of location prediction. Our goal is to predict the location for a new search ses-sion based on the words and URLs in the session and the user X  X  in-formation. In this experiment, we filter out the original geographic information from each session and the original geographic infor-mation is utilized as the ground truth. For each new session, we predict its location as  X  l d . We calculate the Euclidean distance be-tween the predicted value and the ground truth locations and aver-age them over the whole test set. For all the models, we adopt a ten-fold cross validation setting and the numbers reported here are averaged across different folds. The experimental result is shown in Figure 1(b). We can see that LATM and GeoFolk demonstrate relatively high error because they only captures the spatial informa-tion. By considering both the spatial and the temporal information, STTP achieves better performance in location prediction, although it only captures one kind of spatiotemporal pattern. By capturing the diverse spatiotemporal patterns, SSTM further reduces the error of location prediction. For instance, when the number of topics is 1000, the error of LATM, GeoFolk and STTP are 154km, 132km and 121km while the error of SSTM is 110km.
Another interesting feature of SSTM is the capability of predict-ing the timestamps given the textual information in a search ses-sion. This task also provides another opportunity to quantitatively compare SSTM against the models that capture the temporal infor-mation such as TOT, STTP and LPTA. We measure their ability of predicting the date given the query terms in a session. We use 5,000 held-out search sessions as the evaluation data and then eval-uate each model X  X  ability to predict the date of a search session. The result is presented in Figure 1(c). SSTM demonstrates the highest date prediction accuracy. For example, when the number of topics is set to 1000. The error of SSTM is 7.73 days while those of TOT, STTP and LPTA are 14.87, 13.26 and 13.97 days.
Search engine query log usually has a mixture of latent topics, which exhibit diverse spatiotemporal patterns. Discovering the la-tent topics from query log and capturing their spatiotemporal pat-terns are critical for many applications in information retrieval. In this paper, we develop the Spatiotemporal Search Topic Model (SSTM), which explains the generation of web search topics and a variety of spatiotemporal patterns simultaneously. We evaluate the SSTM against several strong baselines on a commercial search en-gine query log. Experimental results show that the SSTM provides better fit for the latent structure of query log data. We also demon-strate that SSTM can serve as the basis for higher level tasks, such as predicting the location and time of web search behaviors. In fu-ture work, we plan to apply the SSTM for applications such as user profiling and personalized spatiotemporal web search.
This work is partially supported by RGC GRF under grant num-ber HKUST 617610. We also wish to thank the anonymous review-ers for their comments. [1] Lars Backstrom, Jon Kleinberg, Ravi Kumar, and Jasmine [2] D. M. Blei, A. Y. Ng, and M. I. Jordan, Latent dirichlet [3] J. Eisenstein, B. O X  X onnor, N. A. Smith, and E. P. Xing, A [4] A. Gohr, A. Hinneburg, R. Schult, and M. Spiliopoulou, [5] Q.Hao,R.Cai,C.Wang,R.Xiao,J.M.Yang,Y.Pang,and [6] L. Hong, A. Ahmed, S. Gurumurthy, A.J. Smola, and [7] Di Jiang, Kenneth Wai-Ting Leung, and Wilfred Ng, [8] Di Jiang, Kenneth Wai-Ting Leung, Wilfred Ng, and Hao Li, [9] Di Jiang, Jan Vosecky, Kenneth Wai-Ting Leung, and [10] Q. Mei, C. Liu, H. Su, and C.X. Zhai, A probabilistic [11] Blake Shaw, Jon Shea, Siddhartha Sinha, and Andrew [12] S. Sizov, Geofolk: latent spatial semantics in web 2.0 social [13] C. Wang, J. Wang, X. Xie, and W. Y. Ma, Mining geographic [14] X. Wang and A. McCallum, Topics over time: a non-markov [15] Z. Yin, L. Cao, J. Han, C. Zhai, and T. Huang, Geographical [16] Z. Yin, L. Cao, J. Han, C. Zhai, and T. Huang, Lpta: A
