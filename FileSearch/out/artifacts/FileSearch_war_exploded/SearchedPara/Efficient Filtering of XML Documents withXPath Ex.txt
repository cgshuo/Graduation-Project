 T he pr oli ferat ion o fthe In ter n et a n d in tra n et , a n dthee x p lo d in g vol ume o f in-f o rmat ion made a v a il ab l e on the In ter n et ha v efue l ed the de v e lo pme n t o fa wil d ra n ge o f n e w app li cat ion sbased on se l ect iv ed i ssem in at ion o f in f o rmat ion. XML a llow sthee n c o d in g o fsema n t i ca n d structura lin f o rmat ion that ca ni mpr ov e de liv er y accurac y. In a nXML fi l ter in gs y stem , c on t in u o us ly arr ivin g XML d o c -ume n ts are r o uted t o users acc o rd in gt o subscr i pt ion sspec i fied as quer i es .T h o se How e v er in rea l app li cat ion s ,XML quer i es subm i tted b y users are m o re c o mp l e x a n dma y c on ta in pred i cates wi th a n cest o ra n dpare n ta x es .

T here has bee nv ar io us wo rk [1, 2 ,3, 4 ,5,6, 7 ]on effic i e n t ly fi l ter in g XML streams wi th a c oll ect ion o f XP ath e x press ion s (XP Es ). T he XFil ter s y stem [1] ha n d l es s i mp l e XP ath lo cat ion path e x press ion sb y tra n sf o rm in gthem in t o a D eterm ini s -t i c Fini te A ut o mat on. T he YFil ter s y stem [ 2 ]i sa n e x te n s ion o f XFil ter in w h i ch agr o up o fs i mp l e XP ath lo cat ion path e x press ion sarec o mb in ed in t o as in g l e Non determ ini st i c Fini te A ut o mat on (NFA). T he XT r i e [3] ca n ha n d l et wi gpat -ter n e x press ion s involvin gpred i cates w h i ch are in ter n a lly represe n ted as trees ca ll ed the XT r i e -tree .T he XP ush [ 4 ] supp o rts t wi g patter nwi th n ested pred i-cates a n dsharethec o mm on pred i cates am on gmu l t i p l e XP ath e x press ion sb y us in ga nAl ter n at in g Fini te A ut o mat on(AFA). T he l az y fi l ter in ga l g o r i thm (LF) [5] ha n d l es the u niv ar i ate XP ath w h i ch supp o rt only  X  desce n da n t  X  a n d  X  ch il d  X  a x es .T he a l g o r i thms ab ov eca n ha n d l e only f o r w ard a x es ,w h il eca nno tdea l wi th the XP ath e x press ion c on ta inin g  X  a n cest o r  X  a xi s .

In th i spaper ,w epr o p o se a nov e lin de x structure n amed NIn de x, w h i ch sup -p o rts the effic i e n tfi l ter in g o f XML d o cume n ts based on XP ath e x press ion s w h i ch c on ta in  X  a n cest o r  X  a xi s . Our n e win de x structure off ers se v era lnov e l features that make i tespec i a lly attract iv ef o r l arge -sca l e pub li sh / subscr i be s y stems . 2.1 PXPE-Tree W ereprese n ta n part i a lXP ath e x press ion as a r oo ted u no rdered tree , ca ll ed PXP E -tree ,wi th l abe l ed v ert i ces a n dedges ,T=( V T , E T ). W eusetheterm PXP E -no de t o refer t o the v ert i ces o fa PXP E -tree . Each PXP E -no de has a u ni que in c o m in gedge ,w h i ch i s l abe l ed wi th the a xi s .F u n ct ion s ,l abe l: V T  X  String , a n da xi s : E T  X  X  ancestor, descendant, parent, child } retur n the l abe l s ass o c i ated wi th the PXP E -no des a n d edges respect iv e ly. 2.2 Common Sub-pattern W e assume that the s y mb ol subtree ( r ) e x press the subtree r oo ted at PXP E -no de r in PXP E -tree T .
 Definition 1 (Common Sub-pattern). Given PXPE-treew T 1 and T 2 ,if PXPE-tree T C whose root is n is the subtree ( n ) of T 1 and T 2 , we call the T C is the Common Sub-pattern of T 1 and T 2 .
 Definition 2 (Highest Common Sub-pattern). Given PXPE-treew T 1 and T , S T =( T c 1 ,... T c n )isthesetofcommonsub-patternsof T 1 and T 2 . We call the T i with largest height the Highest Common Sub-pattern of T 1 and T 2 .
 Two PXP E -trees ma y ha v ema ny c o mm on sub -patter n s , but there i s only on e h i ghest c o mm on sub -patter n. 2.3 Structure of NIndex W e in de xPXP E -no des in NIn de x, a n d w e only st o re on ec o p yo fthec o mm on sub -patter n s .W ec l uster the PXP E -no des in t o the tab l es b y the i rtag n ames , a n d each tab l e T t st o res a ll PXP E -no des wi th the tag t , a n deachr ow in T t c o rresp on ds t o a PXP E -no de w h i ch i sar oo t o fasub -patter no f PXP E -trees . Fo rseach in g the respect iv etab l e wi th certa in tag n ame , amapp in gtab l e ,i m -p l eme n ted in the f o rm o fahashtab l e ,i sbu il t ov er a ll (tagname, p table) pa i rs f o rretr i e vin gthep oin ter t o atab l e o fa ny tag n ame .W ema yi mp l eme n ttab l e T t b y us in g hash tab l e o r B+ tree f o reffic i e n tretr i e v a lo fr ow b yID.
Each r ow in tag tab l e i susedt o descr i be a PXP E -no de c n a n dthesub -patter n r oo ted at c n .I t in c l udes f o ur k in ds o ffie l ds :(1) structure o fthe PXP E -no de , in c l ud in gthe axis , parent , pos , p dc a n d p a .T he axis fie l drec o rds the a xi s o fthe curre n t PXP E -no de c n . desc a n d anc are respect iv e ly sh o rt f o r  X  desce n da n t  X  a n d  X  a n cest o r  X . T he parent fie l d i sthe (tagname, row num) pa i r o f the pare n t no de o f c n in PXP E -tree ,w h i ch i sthe row num th r ow in tag tab l e T tagname .T he pos fie l dde no tes the p o s i t ion o f c n am on g i ts s i b lin g no des in PXP E -tree .T he p dc fie l drec o rds the set o fa ll ch il dre no f c n wi th  X  desce n da n t  X  a n d  X  ch il d  X  a x es ,in w h i ch each ch il d i s i de n t i fied b y (tagname, row num) pa i rs .T he p a fie l drec o rds (tagname, row num) pa i rs t oo. ( 2 )A stack f o rthefi l ter in g o f  X  desce n da n t  X  a n d  X  ch il d  X  a x es .In the a l g o r i thms ,on eru n-t i me stack i screatedf o reach non-l eaf quer yno de . Each e l eme n t e in stack rec o rds the depth o f e in the data tree a n d a fl ag w h i ch i sab i t arra ywi th i ts s i ze equa l st o the c o u n t o fch il d PXP E -no des wi th  X  desce n da n t  X  a n d  X  ch il d  X  a x es o f the curre n t no de c n in the PXP E -tree .(3) Fi e l d r queries ,w h i ch in c l udes ID s o fth o se PXP E -tree , that are r oo ted at the curre n t no de c n .( 4 )Fi e l d s times ,w h i ch rec o rds the shared t i mes o f the curre n t r ow. In add i t ion, f o r each tab l e T tn ,w eass i g n a a flag ,w h i ch rec o rds w hether there i sthe o pe n tag o fae l eme n t o ftag tn dur in g the pr o cess in g o ffi l ter in g .I t i susedf o rthefi l ter in g o f  X  a n cest o r  X  a xi s , a n d ini t i a li zed b y zer o. a x es , astack will be created f o r c i w he n a start tag o fa n e l eme n t wi th tag n ame n arr iv es a n dab i t arra y f o r p dc will a l s o be created t o check the arr iv a lo f i ts desce n da n t / ch il de l eme n ts .To pr o cess  X  a n cest o r  X  a xi s , a flag i ssetf o rthetab l e
Algorithm 1. NIn de x:: startE l eme n t (n) T a w he n a start tag o fa n e l eme n t wi th tag n ame a arr iv es .W he n a n e n dtag o f a n e l eme n t wi th tag n ame n arr iv es ,w eca n check w hether D sat i sf y T as f ollow s : (1) Check  X  desce n da n t  X / X  ch il d  X  a x es o f c i b y e x am in gtheb i t arra y f o r p dc t o see each tag n ame a in p a ,w hether a flag f o rthetab l e T a i sset .I fb o th h ol d ,w eca n i mmed i ate ly se n dd o cume n t D t o th o se users w h o subscr i be the request spec i fied in PXP E -tree T .

G iv e n ar ow c i o ftag n ame n in tab l e T n , the bas i c i dea o fha n d lin gthe  X  desce n da n t  X / X  ch il d  X  a x es in startElement ( n )( as sh own in Al g o r i thm 2 )i sas f ollow s :w he n a start tag o fa n e l eme n t wi th tag n ame n arr iv es ,w e o bta in the pare n t c p o f c i first .No th in g n eeds t o be d on e i f the pare n te l eme n thas no t arr iv ed (lin e7 )o r c i u n der c p has a match ,i. e ., lin e 9yi e l ds a fa l se . Other wi se ,i f c i sa non-l eaf no de , create a stack e l eme n t s f o re l eme n t c i wi th s . depth = depth Algorithm 2. NIn de x:: e n dE l eme n t (n) o f e a n d ini t i a li ze a ll b i ts in s . flags t o0(lin e 1 4 ), a n d push e l eme n t s in t o stack [ c i ] (lin e 15); i f c i i sa l eaf no de ,w eca ni mmed i ate ly t o set the fl ag b i tf o r c in c p (lin e 1 2 ). T he bas i c i dea o fha n d lin gthe  X  desce n da n t  X  a n d  X  ch il d  X  a x es in endElement ( n )( as sh own in Al g o r i thm 3) i se v a l uat in gtheb i t arra y s . flags (lin e 13) t o determ in e w hether a match wi th subtree ( c i ) has bee n f o u n du n der p (lin e 19), as w e ll as pass in ga ll th o se b i ts in s . flags that ha v ebee n set t o1 d own t o the n e w t o pe l eme n t o f stack [ c i ] (lin e8 ).

W he n ha n d lin gthea n cest o ra xi s , g iv e n a PXP E -no de c i (wi th tag n ame n ) w h i ch has a ch il d PXP E -no de c j (wi th tag n ame m )wi th  X  a n c  X  edge in PXP E -tree , c i n eed t o check w hether the c j  X  s a flag i s non-zer o. W he n startElement ( m ) e v e n thappe n s ,w eadd a flag o f T m b y 1 (lin e 5inAl g o r i thm 2 ), a n d w he n endElement ( m ) e v e n thappe n s ,w e subtract a flag o f T m b y 1 (lin e2 3inAl-g o r i thm 3). I fa n e l eme n t e m o ftag m c o mes , the n startElement ( m ) happe n s , the a flag o ftab l e T m i s non-zer o. W eca n c on firm that a n e l eme n t e n w h i ch arr iv es bet w ee n the e m  X  startElement ( m ) a n d e m  X  endElement ( m ) has a n a n ce -s o re l eme n t e m in the d o cume n t .So the re l at ion sh i pbet w ee nPXP E -no des c i a n d c j are matched .W he n endElement ( n ) happe n s ,PXP E -no de c i checks the a flag s o fa ll h i sch il d PXP E -no des wi th  X  a n c  X  edge in PXP E -tree (lin e 9-1 2 in Al g o r i thm 3). I fa ll o fthe a flag sare non-zer o, the curre n te l eme n t o ftag n has a ll the a n cest o re l eme n ts in the PXP E -tree .I fthech il da n d desce n da n ta x es are a l s o sat i sfied (lin e 13 in Al g o r i thm 3), there i samatch in g o f PXP E -no de c i in the curre n td o cume n t .I f c i i sther oo t o f PXP E -tree , add the quer y ID s o f r queries t o the resu l ts set (lin e 16 in Al g o r i thm 3). 4.1 Experiment Setup By us in gaset o f DTD s ,w ege n erated a set o f XML d o cume n ts wi th n umber o fe l eme n ts v ar yin gfr o m 1000 t o 5000( s i ze v ar yin gfr o m 9K t o 4 00K). W e i m -p l eme n ted a nXP ath e x press ion ge n erat o r wi th f ollowin g in put parameters .T he parameter P c on tr ol sthes i ze o ftheset o f in de x ed XP Es .T he parameter p d c on tr ol s the pr o bab ili t yo fha vin ga  X  desce n da n t  X  a xi sateach no de .T he param -eter p a c on tr ol s the pr o bab ili t yo fha vin ga  X  a n cest o r  X  a xi sateach no de .T hree a l g o r i thms w ere c o mpared :(1)YFil ter ,( 2 )XT r i e , a n d (3)NIn de x. 4.2 Performance Study Fi g .1 c o mpares the sca l ab ili t yo fthea l g o r i thms as a fu n ct ion o f P, the s i ze o fthe set o f in de x ed XP Es .T he resu l ts sh ow that the fi l ter in gt i me in creases a l m o st lin ear ly wi th P, wi th NIn de x be in gthefastesta l g o r i thm .Fi g . 2c o mpares the sca l ab ili t yo fthea l g o r i thms as a fu n ct ion o fthes i ze o fthe XML d o cume n ts .T he resu l ts c l ear ly sh ow that the fi l ter in gt i me in creases lin ear ly wi th the d o cume n t s i ze f o ra ll the a l g o r i thms , a n dthea l g o r i thm based on NIn de x perf o rms best .
Fi g .3 sh ow sthat in creas in g p d , the pr o bab ili t yo f  X  desce n da n t  X  a xi s in the XP Es in creases the fi l ter in gt i me o fa ll the a l g o r i thms .T he NIn de x perf o rms best a n dthe fi l ter in gt i me in creases a l m o st lin ear ly wi th p d .InFi g . 4 ,w etestedthee ff ect o fthe p .T he resu l ts sh ow that the p a ha v e no e ff ect on o ur fi l ter in ga l g o r i thm . In th i spaper ,w e addressed the pr o b l em o ffi l ter in g XML d o cume n ts wi th l arge n umber o f user subm i tted quer i es in XP ath e x press ion s .W epr o p o sed a nov e l in de x structure , termed NIn de x, w h i ch i sdes i g n ed t o supp o rt e ff ect iv efi l ter -in gbased on c o mp l e xXP ath e x press ion sc on ta inin g  X  a n cest o r  X  a xi s .I t i sm o re c o mpact t o represe n t XP ath e x press ion sa n d reduce the n umber o fu nn ecessar y in de x pr o bes as w e ll as a voi dredu n da n tmatch in gs .T he nw epr o p o sed a n e w sh ow that o ur a l g o r i thm perf o rms w e ll acr o ss a ra n ge o fd o cume n ts a n d XP Es . Acknowledgement. T h i s research w as supp o rted b y the N at ion a lN atura lS c i-e n ce Fo u n dat ion o fCh in a ( Gra n t No. 60 77 3 22 1).

