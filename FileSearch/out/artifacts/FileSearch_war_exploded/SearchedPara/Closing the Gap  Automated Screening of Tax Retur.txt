 According to the most recent strategic plan for the United States Internal Revenue Service (IRS), high-income individuals are a primary contributor to the "tax gap, X  the difference between the amount of tax that should be coll ected and the amount of tax that actually is collected [1]. This case study addresses the use of machine learning and statistical analysis for the purpose of helping the IRS target high-in come individuals engaging in abusive tax shelters. Kernel-b ased analysis of known abuse allows targeting individual taxpaye rs, while associative analysis allows targeting groups of taxpayers who appear to be participating in a tax shelter being promoted by a common financial advisor. Unlike many KDD applications that focus on classification or density estimati on, this analysis task requires estimating risk, a weighted combination of both the likelihood of abuse and the potential revenue losses. Abusive Tax Shelter, Data Mini ng, Support Vector Machine, Link Analysis. This case study focuses on the use of data analysis techniques to identify egregious tax shelters provided by "pass-through" entities to high-income taxpayers. Trusts , partnerships and subchapter S corporations are referred to as "pass-through" entities because tax liabilities for their income are simply passed to their beneficiaries, partners or shareholders respectiv ely. The allocation of gains and losses from a pass-through entity is recorded for each payee using Schedule K-1 [2,3,4]. Here is a brief characterization of the data available for each type of entity:  X  For the purposes of this study, a high-income taxpayer is an  X  A trust is a financial entity esta blished to allow a trustee to  X  A partnership is a business in which partners share the gains  X  A subchapter S corporation, he reafter referred to simply as The IRS had stopped transcribing the schedule K-1 pass-through allocations in 1995, but this practice was resumed for tax year 2000 (calendar year 2001) [6]. The MITRE Corporation was asked to investigate possible analysis methods for exploiting the information about relationships between taxpayers and these pass-through entities. The major lines of investigation included visualization of the relationships and data mining to identify and rank possibly abusive tax avoidance transactions. The remainder of this paper is organized as follows. Section 2 discusses the use of visuali zation for reviewing taxpayer relationships. Section 3 addresse s targeting compliance issues for high-income individuals, while section 4 addresses targeting related compliance issues among groups of high-income individuals. Section 5 covers reduction of search complexity by pruning irrelevant links. Secti on 6 covers filtering groups by measuring compliance risk and me rging related groups. Section 7 discusses results, and section 8 pr esents conclusions and future work. The visualization of the relationshi ps between trusts , partnerships, S corporations and taxpayers included both direct payer to payee relationships and indirect paye r to payee relationships; e.g. linking a spouse to a primary filer, a sole proprietorship to an owner or a subsidiary to a parent corporation. Compared to having to repeatedly query a data base for linked entities or having to manually switch back and forth between paper returns, this was considered a big improvement. The IRS has subsequently instantiated a prototype visualization system for use by both researchers investigating trends and compliance staff reviewing tax returns. This system now has over 200 user accounts. Figure 1 illustrates an example of the relationships between a high-income taxpayer and his pass-through entities using a graph with directed edges. All sensitiv e labels have been removed from the graphs in this paper, but in use the nodes are labeled with name and Taxpayer Identification Number (TIN X  X ither an Employer Identification Number or a Social Security Number), and the edges are labeled with the dollar amounts for gains and losses. A diamond represents a trust, an oval represents a partnership and a rectangle represents an S corporation. The rounded rectangles in the bottom-left are the taxpayer (bold border) and his spouse. The parallelogram in the middle is the taxpayer's sole proprietorship. The octagons indicate the presence of additional payees for three of the partnerships. A user can click on nodes or links to review the transcribed line items for the associated entity or relationship. Colors are used to indicate the presence of various attributes; e.g. red links indicate a net loss and black links indicate a net gain for payer to payee links. The width of a link indicates the amount of money being allocated to a payee; i.e. a thicker link indicates a larger magnitude for money. Figure 2 illustrates an example of a prototypical tax shelter with all other relationships for the taxpa yer "hidden. X  This shelter is described in IRS Notice 2000-44 [7 ] and is commonly referred to as a "Son of BOSS (Bond and Option Sales Strategies) X  shelter. The following description sketches out the salient points of the Son-of-BOSS shelter; however, it is not intended to be a technically accurate description of all related shelter activities. The taxpayer uses a "straddle" to effectively shelter their income: 1. The taxpayer obtains a large $X million gain, often 2. A tax advisor tells the taxpayer he can avoid paying tax on 3. The promoter (tax advisor) sets up a partnership for financial 4. The taxpayer buys call options for $X million; i.e. the option 5. The taxpayer transfers these call options to the partnership. 6. The taxpayer then sells call options for $X million to 7. The taxpayer ignores the liability of the underwritten call 8. Upon sale of the call options, the taxpayer claims an $X The S corporation in figure 2 is being used to facilitate the loss for the taxpayer. While legitimate tax shelters do exist, such as depreciation claimed for investment in resi dential property that houses low-income tenants, a loss is generally not allowed unless it results in an actual loss for the taxpayer [8]. While electronic filing is becoming more popular, the majority of the tax forms submitted by those involved with abusive tax shelters are not filed electronically. Therefore, most are manually transcribed. If all line items for every return were accurately recorded and available electronically, it would make the job of identifying potentially abusive tr ansactions much easier. Unfortunately, only a subset of the line items are actually transcribed and available in electronic form; and the values that are available are sometimes questionable [9]. We began the modeling process by working with an IRS technical advisor to identify the type of behavior the IRS is interested in identifying. The two principal methods for abusively sheltering income from taxes include ma nufacturing offsetting losses [without any real loss for the taxpayer] and not reporting income. Identifying abusive offsetting losses is considered to be lower hanging fruit, however, because taxpayers are encouraged to actually record their transactions accurately. There is a three year statute of limitations for shelters that are reported, while there is no statute of limitations for income that goes unreported. Additionally, possible fines and penalties are much stronger for unreported income [10]. While MITRE has done some work in the area of identifying unreported income, here we report our work dealing with offsetting losses. The existing system used by the IRS for targeting compliance issues is constructed by analyzing audit results for a set of randomly selected tax returns. Unfortunately, since truly egregious tax shelters are relativ ely rare (currently believed to occur in about 1% of the high-income taxpayer population), random selection of audits is unlikely to capture egregious transactions. This explains wh y some truly egregious shelters may receive a low score. In the future, weighted sampling might be used to improve coverage in this relatively rare portion of the population; e.g. computing the selection probability based on the proportion of total positive income being reported as taxable income. For the majority of high-income taxpayers, this proportion is substantial. As illustrated in figure 3, the mode of the distribution occurs around the 88th percentile. In the mean time, we explored the use of kernel-based techniques as an alternative for initial ranking of tax returns for review by a compliance expert. Given a database with a few known examples of "abusive" transactions and no other "label s," we pursued constructing a single-class model to measure th e similarity of high-income taxpayer relationships to known exam ples of abuse. We started with a half-dozen examples of abuse provided by the technical advisor, but discovered there was no data connecting the pass-through entities to the high-income taxpayers. We compensated for the lack of training examples by asking the technical advisor to describe the behavior of inte rest and querying the database to find matching examples. More than 50 variables were being considered for each set of entities connected to a high-income taxpayer. The query output was pr ocessed slowly, as there was a significant learning curve for the data miners trying to understand how the subset of transcribed lin e items from different tax returns related to one another. Note: Because the IRS wants to encourage electronic filing, the IRS does not use untranscribed line items from electronic returns for targeting compliance issues. Our initial query involved searching for one to four high-income taxpayers receiving little income from an initial year partnership and large losses from an initial year S corporation. While the first couple of matches proved we need ed to refine the targeting criteria, later examples indicat ed the existence of multi-million dollar shelters that had been previously undiscovered. An existing compliance project was us ed to support initiating audits on the discovered shelters. After obtaining 30 examples, we c onstructed a single-class model using a Support Vector Machine (SVM) to produce a similarity measure for weighting the loss in question. Training the single-class SVM [11] was described to the IRS domain experts as being similar to how you might train a revenue agent. First, a few positive examples are provided in term s of the features relevant to identifying a potentially abusive trans action. The "trainee" is then asked to evaluate a new set of returns to identify similar behavior. In this case, the "trainee" is also expected to identify the source of the suspicious loss. Somewhat redundant features were used to provide robustness against transcription errors; e.g. using line items describing short term capital losses from both schedule K-1 of the pass-through entity and the high-income taxpayer's return. Instead of having the single-class SVM produce a TRUE/FALSE class label, however, we used the raw sum of the kernel (similarity) function output to compute a risk metric for ranking; i.e. we used a Gaussian kernel to compute the similarity between each transaction and the optimal pr ototypes from the known abusive transactions (training data). Th e "nu" parameter of the SVM was used to allow a small subset of examples to be declared to be outliers, while the "gamma" parameter of the kernel was used to allow selection of the optimal prototypes (support vectors) by favoring less complex models provi ding the best coverage of the known abusive examples. To fi nd the best hyper-parameter values, a hierarchical grid search was conducted over the range of feasible "nu" and "gamma" values using leave one out cross validation. It takes only a few minutes to c onstruct the model, and it takes only an hour to assess risk for a year of tax return data. The longest part of the process i nvolves preprocessing the data by deriving features from the line items of the returns and normalizing the feature vectors to unit length (so a $1 million dollar offset of a $1 million dollar income is given the same weight as a $100 million dollar offset of a $100 million dollar income, and the resulting weights are then multiplied by the magnitude of the sheltered income to assess overall risk). This model was successful for identifying and ranking a few specific types of transactions, revealing an estimated $200 million dollars of previously undiscovered shelters. This model was also useful for providing coverage of s ubstantially similar transactions. Nevertheless, while precision fo r this model was around 90%, the recall was suboptimal. Transacti ons were being missed due to transcription issues and the use of similar transactions with characterized as "ordinary loss" instead of stock option straddles characterized as "short term capital loss". Based on feedback from the domai n experts, we decided to generalize the targeting strategy by relaxing the targeting criteria to review a smaller, more genera l set of targeting features; e.g. total positive income, largest gain , largest loss, taxable income, etc. This simplistic model is known as the Shelter Risk Function (SRF). The values associated with a transaction for a high-income taxpayer are compared to an idealized shelter using a Gaussian kernel. The kernel widt h was selected using a jackknife procedure [13] to identify the value that produced the highest correlation to audit results from a prior tax year. For our initial evaluation, an ideali zed shelter is characterized as a single source of income being offset by a single source of loss, resulting in zero taxable income . Again, somewhat redundant features are employed to provide robustness against transcription errors. The similarity of data describing a taxpayer and an idealized shelter is used as a wei ght for the income that is being sheltered. The results of the risk assessments for this model are then fed to an associative analysis engine to identify groups of related shelter suspects. While SRF can provide a reasonable targeting metric for identifying potentially abusive shelter activity, it does not attempt to identify common links between shelters. Some shelters are customized for an individual and are not tightly linked to additional shelters. Other shelters, however, share a common structure and mode of operati on, which having been designed once can be sold to different c lients over and over by a shelter promoter [14]. Figure 4 illustrates an example of a group of approximately 40 related shelters. On the far left is the promoter that created the tax shelter, and on the far right is a pa ir of entities that "sell" this tax shelter to taxpayers. The outer ring of the picture is a set of high-income individuals who are sheltering their income. The ring in the middle is a set of partnerships manufacturing abusive tax shelters using straddles. The tw o entities in the center are foreign partners, tax indifferent parties claiming the allocation of gain from the straddles. This promotion was used to shelter hundreds of millions of dollars for high-income taxpayers. These  X  X ookie cutter X  shelter pr omotions are particularly interesting to the IRS because they make it necessary to argue only one instance of the shelter in court. If the IRS wins the case, or a few of these cases, it becomes more likely that the other instantiations will not go before the court, and further litigation costs are saved. When it is considered that some abusive shelters are worth tens of millions of dollars or more to their recipients, it is not surprising that they are defended vigorously. Detecting promotions rather than just singl e tax shelters can thus be highly advantageous for the IRS in terms of reduced cost of enforcement. We developed the Promoter Risk Function (PRF) to be used in conjunction with SRF with the goal of grouping SRFs and other high income individuals together with businesses and individuals potentially promoting abusive tax sh elters. PRF is a custom link analysis application that explor es the relationship between groups of SRF suspects and various identifiers of the potential promoter nodes, including their names, addresses and Taxpayer Identification Numbers (TINs). Preparer information is included in the attributes being examined. Promotions such as the one show n in figure 4 helped to suggest our approach. Each participant in this promotion receives his own shelter from an individual partners hip, but those partnerships are in turn all connected to just a handful of promoter entities. Given a subset of this shelter X  X  participan ts, it is possible to traverse their K-1 links to discover potential pr omoter entities. By reversing this process X  X xpanding the search outward from the newly discovered promoter suspects X  X ot only will the original suspects be reached, but the other individuals associated with the promotion as well. In this way we can group a set of suspects into various suspected shelter promoti ons and also discover previously unsuspected shelter participants. We generally use SRF as the starting point for promotion detection with PRF, although othe r targeting functions can be used as well. PRF starts with a specific target group (hereafter referred to as suspects), but as described above it also discovers other high income SSNs that are associated with suspected promoter attributes. This is be neficial in that not only does it yield better recall of promotion participants, but it also allows PRF to judge the likelihood of particular groupings of suspects and non-suspects, as discussed below. The most naive implementations of PRF will not run to completion in a reasonable amount of time, due to combinatorial explosion. Some nodes may ha ve as many as hundreds of thousands of connections to othe rs. Traversing these nodes even once is too much, and caching such results is not feasible with even 4 gigabytes of system memory available. In order to reduce the run time and storage require ments, we implemented some simple pruning heuristics. Connections between nodes were cut when the number of investors or investme nts was greater than threshold, unless the link represented more than 10% of the equity for that node. For the investments threshold, Chebys hev's inequality [15] was used with k = sqrt(20) to identify inbound links where the payee has an unusually large number of payers. For the investors threshold, a domain expert defined rule was used to identify outbound links in which the payer has more than 10 payees. This reduced the number of possible links to be analyzed from 24.7 million links to 16.8 million links. Additionally, we limit depth of search to  X  hops from the starting points, the input suspects. Unlike the pruning heuristics, this heavily affects the behavior of PRF in both positive and negative ways. The limited search could obscure more complicated shelter promotion schemes in which inva riant promoter attributes are always more than  X  hops away from the suspects. However, there is a hidden advantage here: by lim iting the search depth, spurious connections between suspects are encountered less often, helping to limit false positives. A final step was to restructure the database to reduce the number of disk reads required to process the links. These measures reduced the execution time by orders of magnitude so that the PRF tools can complete a search of a given tax year in approximately three to four hours on our hardware (a 2.8 gigahertz Intel Xeon processor with 4 gigabytes of memory). After the database has been search ed for links, we take additional steps to filter and group the data. The most important filtering stage is to threshold potential pr omoter identifiers based on their level of support in the input group. Those identifiers linked to smaller numbers of suspects are less likely to be part of a promotion. In the degenerate case, when there is only a single suspect linked to an identifier, the identifier has no resolving power in the discovery of a shelter promotion. If the support threshold is met for a given potential promoter, we generate the odds ratio of the number of suspects to non-suspects associated with the potential prom oter, compared to the ratio of the total number of other suspects to the total number of other non-suspects in the population. The greater the odds ratio, the less likely a group with the same number of suspects and non-suspects would be generated from a random sampling of the population. While a p-value from a Ch i-square or Fisher test [16] can be used to evaluate the hypothesis that P (Suspect = True | Link to X)  X  P(Suspect = True | No Link to X), a p-value is not so useful for measuring the degr ee of association between the conditions "Suspect = True" and "Link to X". Consider the contrast provided by contingency tables 1 and 2. The one-sided Fisher test p-value for table 1 is 5.7*10-183, while the p-value for table 2 is 0.1*10-183. Yet the odds ratio for table 1 is about 1868, while the odds ratio for table 2 is only 25. A smaller p-value indicates the null hypothesis is less likely to be true, but a larger odds ratio indicates a stronger association between the two factors. Intuitively, the odds ratio result makes more sense because 95% of the returns associated with preparer A are associated with shelter suspects, while less than 20% of the returns associated with preparer B are associated with shelter suspects. A final grouping stage is run to asso ciate promoter identifiers with other promoter identifiers by thresholding on the Jaccard similarity [17] between the iden tifiers X  suspect groups. When the similarity between the suspects is sufficiently high, we consider the two groups to be part of the same potential promotion and to form part of the same metagroup. With typical threshold paramete r settings, PRF finds on the order of 500 metagroups of potential promoters and SSNs for every year, which combine to total a few billion dollars of sheltered income. Around 50% of this total is associated with the top 20 metagroups, as ranked by a combination of the lower bound of a confidence interval for the odds ratio [16] of the metagroup and the amount of income suspected of being sheltered. When comparing these top 20 metagroups to a list of known shelter participants from the IRS, there is a substantial overlap between the taxpayers believed to ha ve participated in an abusive tax shelter. Examining the PRF results more closely, there appear to be several advantages PRF can provide in addition to its goal of appropriately grouping SRF suspects with potential promoters. First, it is able to use the initia l suspect list to discover other high income individuals that, while not passing the SRF threshold, do appear to be participating in abusiv e shelters. This is borne out in the high proportion of non-SRFs in the PRF output that overlap the IRS X  X  list of known shelter participants. Beyond that, PRF is also able to automatically discover shelter participants unknown to the IRS. PRF also maintains the links associating nodes in its output clusters, reducing the effort required to verify whether a suspected participant in a promotion really is taking the shelter. Perhaps the biggest advantage to PRF is its ease of use and relative efficiency. One of the largest promotions for tax year 2001 required roughly two weeks of work by multiple IRS agents to trace out. PRF is able to do much of that work in just a few hours, with no human intervention. Further it discovers participants that the IRS may not have otherwise found. Running PRF as soon as the data for each tax year is received has the potential to find the most egregious tax shelters efficiently and quickly, with minimal auditor labor. Recent efforts to combat abusive tax shelters have met with some success [18]. While MITRE is certainly not solely responsible for this outcome, we did play a role in helping to identify abusive shelters. After review of the out put by domain experts, audits for selected cases resulted in substa ntial assessments for additional tax collection by the IRS. Nevert heless, more work remains to be done, such as adjusting the risk values by accounting for differences in tax rates; e.g. th e most widely paid tax rate for capital gains is 15%, while the tax rate for ordinary income is often more than 30%. Further work is also needed in assessing risk for unreported income, as well as understanding how abusive promotions change over time. A number of people provided critical support for this work. The IRS compliance experts included: Mike Whalin, Susan Kerrick and Scott Emerson. The IRS re search experts included: Mark Mazur, Larry May, John Davidson, Kay Wolman, Maury Harwood, Jim Needham and Christine Smith. Our colleagues at MITRE included: Anne Cady, Dan Venese, Lowell Rosen and Sarah Piekut. This work wa s performed under IRS contract number TIRNO-99-D-00005. [1] IRS Publication 3744, "IRS Strategic Plan: 2005 -2009", [2] IRS Form 1041 Schedule K-1, "Beneficiary's Share of [3] IRS Form 1065 Schedule K-1, "Partner's Share of Income, [4] IRS Form 1120S Schedule K-1, "Shareholder's Share of [5] United States Code Title 26 Section 1362, "Subchapter S -[6] GAO Report GAO-02-618T, "Enhanced Efforts to Combat [7] IRS Notice 2000-44, "Infla ted Partnership Basis [8] "How can I recognize an abusive tax shelter?", Frequently [9] Government Accounting Office Report GAO-04-1040, "IRS [10] United States Code Title 26 Section 6663, "Imposition of [11] B. Scholkopf, J. Platt, J. Shawe-Taylor, A.J. Smola, and R.C. [12] IRS Notice 2002-65, "Passthrough Entity Straddle Shelters", [13] B. Efron and R.J. Tibshirani, "An Introduction to the [14] Senate Report 109-54, "The Role of Professional Firms in [15] S. Ghahramani, "Fundamentals of Probability", Prentice [16] A. Agresti, "Categorical Data Analysis", Wiley-Interscience, [17] D.J. Hand, H. Mannila, and P. Smyth, "Principles of Data [18] IRS Newswire IR-2004-87, "Strong Response to 'Son of Dave and Zach work for the Knowledge Discovery Group of the MITRE Corporation, a non-profit company that operates a Federally Funded Research and Development Center for the Internal Revenue Service. Zach earned his Master of Science Degree in Computer Science from the University of Massachusetts at Amherst. Dave earned his Master of Science Degree in Computer Science from George Mason University, where he is currently working on his PhD. 
