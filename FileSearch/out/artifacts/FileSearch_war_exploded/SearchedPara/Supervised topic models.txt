 There is a growing need to analyze large collections of electronic text. The complexity of document a topic represents an underlying semantic theme; a document consisting of a large number of words might be concisely modelled as deriving from a smaller number of topics. Such topic models provide useful descriptive statistics for a collection, which facilitates tasks like browsing, searching, and assessing document similarity.
 Most topic models, such as latent Dirichlet allocation (LDA) [4], are unsupervised: only the words in the documents are modelled. The goal is to infer topics that maximize the likelihood (or the pos-terior probability) of the collection. In this work, we develop supervised topic models, where each document is paired with a response. The goal is to infer latent topics predictive of the response. Given an unlabeled document, we infer its topic structure using a fitted model, then form its pre-diction. Note that the response is not limited to text categories. Other kinds of document-response corpora include essays with their grades, movie reviews with their numerical ratings, and web pages with counts of how many online community members liked them.
 Unsupervised LDA has previously been used to construct features for classification. The hope was that LDA topics would turn out to be useful for categorization, since they act to reduce data di-mension [4]. However, when the goal is prediction, fitting unsupervised topics may not be a good choice. Consider predicting a movie rating from the words in its review. Intuitively, good predictive topics will differentiate words like  X  X xcellent X ,  X  X errible X , and  X  X verage, X  without regard to genre. But topics estimated from an unsupervised model may correspond to genres, if that is the dominant structure in the corpus.
 The distinction between unsupervised and supervised topic models is mirrored in existing dimension-reduction techniques. For example, consider regression on unsupervised principal com-combinations most predictive of a response variable. These linear supervised methods have non-parametric analogs, such as an approach based on kernel ICA [6]. In text analysis, McCallum et al. developed a joint topic model for words and categories [8], and Blei and Jordan developed an LDA model to predict caption words from images [2]. In chemogenomic profiling, Flaherty et al. [5] proposed  X  X abelled LDA, X  which is also a joint topic model, but for genes and protein function categories. It differs fundamentally from the model proposed here.
 This paper is organized as follows. We first develop the supervised latent Dirichlet allocation model (sLDA) for document-response pairs. We derive parameter estimation and prediction algorithms for the real-valued response case. Then we extend these techniques to handle diverse response types, using generalized linear models. We demonstrate our approach on two real-world problems. First, we use sLDA to predict movie ratings based on the text of the reviews. Second, we use sLDA to predict the number of  X  X iggs X  that a web page will receive in the www.digg.com community, a forum for sharing web content of mutual interest. The digg count prediction for a page is based on the page X  X  description in the forum. In both settings, we find that sLDA provides much more predictive power than regression on unsupervised LDA features. The sLDA approach also improves on the lasso, a modern regularized regression technique. In topic models, we treat the words of a document as arising from a set of latent topics, that is, a set of unknown distributions over the vocabulary. Documents in a corpus share the same set of K topics, but each document uses a mix of topics unique to itself. Thus, topic models are a relaxation of classical document mixture models, which associate each document with a single unknown topic. Here we build on latent Dirichlet allocation (LDA) [4], a topic model that serves as the basis for many others. In LDA, we treat the topic proportions for a document as a draw from a Dirichlet distribution. We obtain the words in the document by repeatedly choosing a topic assignment from those proportions, then drawing a word from the corresponding topic.
 In supervised latent Dirichlet allocation (sLDA), we add to LDA a response variable associated with each document. As mentioned, this variable might be the number of stars given to a movie, a count of the users in an on-line community who marked an article interesting, or the category of a document. We jointly model the documents and the responses, in order to find latent topics that will best predict the response variables for future unlabeled documents.
 We emphasize that sLDA accommodates various types of response: unconstrained real values, real integers (e.g., count data), and other types. However, the machinery used to achieve this generality complicates the presentation. So we first give a complete derivation of sLDA for the special case of an unconstrained real-valued response. Then, in Section 2.3, we present the general version of sLDA, and explain how it handles diverse response types.
 Focus now on the case y  X  R . Fix for a moment the model parameters: the K topics  X  1: K (each  X  k a vector of term probabilities), the Dirichlet parameter Under the sLDA model, each document and response arises from the following generative process: generative process is depicted as a graphical model in Figure 1.
 Notice the response comes from a normal linear model. The covariates in this model are the (un-observed) empirical frequencies of the topics in the document. The regression coefficients on those frequencies constitute  X  . Note that a linear model usually includes an intercept term, which amounts to adding a covariate that always equals one. Here, such a term is redundant, because the compo-nents of  X  z always sum to one.  X  By regressing the response on the empirical topic frequencies, we treat the response as non-exchangeable with the words. The document (i.e., words and their topic assignments) is generated first, under full word exchangeability; then, based on the document, the response variable is gen-erated. In contrast, one could formulate a model in which y is regressed on the topic proportions  X  . This treats the response and all the words as jointly exchangeable. But as a practical matter, our chosen formulation seems more sensible: the response depends on the topic frequencies which actually occurred in the document, rather than on the mean of the distribution generating the topics. Moreover, estimating a fully exchangeable model with enough topics allows some topics to be used entirely to explain the response variables, and others to be used to explain the word occurrences. This degrades predictive performance, as demonstrated in [2].
 carry out approximate maximum-likelihood estimation using a variational expectation-maximization (EM) procedure, which is the approach taken in unsupervised LDA as well [4]. 2.1 Variational E-step Given a document and response, the posterior distribution of the latent variables is The normalizing value is the marginal probability of the observed data, i.e., the document w 1: N and efficiently computable. Thus, we appeal to variational methods to approximate the posterior. Variational objective function. We maximize the evidence lower bound (ELBO) L (  X  ) , which for a single document has the form log p w 1: N , y |  X , X  1: K , X , X  2  X  L ( X , X  1: N ;  X , X  1: K , X , X  2 ) = E[log p ( X  |  X ) ] + ized distribution, where  X  is a K-dimensional Dirichlet parameter vector and each  X  n parametrizes a categorical dis-tribution over K elements. Notice E[ Z n ] =  X  n .
 terms in the ELBO for unsupervised LDA [4]. The fourth term is the expected log probability of the response variable given the latent topic assignments,
E[log p ( y | Z 1: N , X , X  2 ) ] = = X  The first expectation is E  X  Z =  X   X  : = ( 1 / N ) P N n = 1  X  n , and the second expectation is is an indicator vector.
 For a single document-response pair, we maximize (2) with respect to  X  1: N and  X  to obtain an estimate of the posterior. We use block coordinate-ascent variational inference, maximizing with respect to each variational parameter vector in turn.
 Optimization with respect to  X  . The terms that involve the variational Dirichlet  X  are identical to those in unsupervised LDA, i.e., they do not involve the response variable y . Thus, the coordinate ascent update is as in [4], maximize the Lagrangian of the ELBO, which incorporates the constraint that the components of  X  j sum to one, and obtain the coordinate update Exponentiating a vector means forming the vector of exponentials. The proportionality symbol means the components of  X  new j are computed according to (7), then normalized to sum to one. Note that E[log  X  i |  X  ] = 9( X  i )  X  9( P  X  j ) , where 9(  X  ) is the digamma function. The central difference between LDA and sLDA lies in this update. As in LDA, the j th word X  X  variational distribution over topics depends on the word X  X  topic probabilities under the actual model probability of the response, through the expected residual sum of squares (RSS), which is the second term in (4). The end result is that the update (7) also encourages  X  j to decrease this expected RSS. The update (7) depends on the variational parameters  X   X  j of all other words. Thus, unlike LDA, the  X  j cannot be updated in parallel. Distinct occurrences of the same term are treated separately. 2.2 M-step and prediction The corpus-level ELBO lower bounds the joint log likelihood across documents, which is the sum of the per-document log-likelihoods. In the E-step, we estimate the approximate posterior distribution for each document-response pair using the variational inference algorithm described above. In the M-step, we maximize the corpus-level ELBO with respect to the model parameters  X  1: K ,  X  , and  X  2 . For our purposes, it suffices simply to fix  X  to 1 / K times the ones vector. In this section, we add document indexes to the previous section X  X  quantities, so y becomes y d and  X  Z becomes  X  Z d . Estimating the topics. The M-step updates of the topics  X  1: K are the same as for unsupervised LDA, where the probability of a word under a topic is proportional to the expected number of times that it was assigned to that topic [4], Here again, proportionality means that each  X   X  new k is normalized to sum to one. Estimating the regression parameters. The only terms of the corpus-level ELBO involving  X  and  X  2 come from the corpus-level analog of (4).
 Define y = y 1: D as the vector of response values across documents. Let A be the D  X  ( K + 1 ) matrix whose rows are the vectors  X  Z &gt; d . Then the corpus-level version of (4) is Here the expectation is over the matrix A , using the variational distribution parameters chosen in the previous E-step. Expanding the inner product, using linearity of expectation, and applying the first-order condition for  X  , we arrive at an expected-value version of the normal equations: as well, given by (5). We caution again: formulas in the previous section, such as (5), suppress the document indexes which appear here.
 Prediction. Our focus in applying sLDA is prediction. Specifically, we wish to compute the ex-pected response value, given a new document w 1: N and a fitted model {  X , X  1: K , X , X  2 } : the variational inference procedure of the previous section. But here, the terms depending on y are removed from the  X  j update in (7). Notice this is the same as variational inference for unsupervised LDA: since we averaged the response variable out of the right-hand side in (12), what remains is the standard unsupervised LDA model for Z 1: N and  X  .
 latent variables Z n . Then, we estimate the response with 2.3 Diverse response types via generalized linear models Up to this point, we have confined our attention to an unconstrained real-valued response variable. In many applications, however, we need to predict a categorical label, or a non-negative integral count, or a response with other kinds of constraints. Sometimes it is reasonable to apply a normal linear model to a suitably transformed version of such a response. When no transformation results in approximate normality, statisticians often make use of a generalized linear model , or GLM [9]. exposition with a GLM formulation. As we shall see, the result is a generic framework which can be specialized in a straightforward way to supervised topic models having a variety of response types. There are two main ingredients in a GLM: the  X  X andom component X  and the  X  X ystematic compo-nent. X  For the random component, one takes the distribution of the response to be an exponential dispersion family with natural parameter  X  and dispersion parameter  X  : and log-normalizer A ( X ) . The dispersion parameter provides additional flexibility in modeling the variance of y . Note that (14) need not be an exponential family jointly in ( X , X ) . In the systematic component of the GLM, we relate the exponential-family parameter  X  of the ran-dom component to a linear combination of covariates  X  the so-called linear predictor . For sLDA, the previous specification in step 3 of the generative process is replaced with so that The reader familiar with GLMs will recognize that our choice of systematic component means sLDA uses only canonical link functions. In future work, we will relax this constraint. We now have the flexibility to model any type of response variable whose distribution can be written in exponential dispersion form (14). As is well known, this includes many commonly used distribu-tions: the normal; the binomial (for binary response); the Poisson and negative binomial (for count data); the gamma, Weibull, and inverse Gaussian (for failure time data); and others. Each of these that the normal distribution corresponds to h ( y , X ) = ( 1 / In this case, the usual parameters  X  and  X  2 just equal  X  and  X  , respectively.
 Variational E-step. The distribution of y appears only in the cross-entropy term (4). Its form under the GLM is This changes the coordinate ascent step for each  X  j , but the variational optimization is otherwise unaffected. In particular, the gradient of the ELBO with respect to  X  j becomes  X  L  X  X  Thus, the key to variational inference in sLDA is obtaining the gradient of the expected GLM log-normalizer. Sometimes there is an exact expression, such as the normal case of Section 2. As another example, the Poisson GLM leads to an exact gradient, which we omit for brevity.
 Other times, no exact gradient is available. In a longer paper [3], we study two methods for this known exactly; then we maximize over the original variational parameters plus the parameter con-trolling the bound. Alternatively, an application of the multivariate delta method for moments [1], plus standard exponential family theory, shows Here, Var GLM denotes the response variance under the GLM, given a specified value of the natu-ral parameter X  X n all standard cases, this variance is a closed-form function of  X  j . The variance- X / X  X  tee that the ELBO lower bounds the marginal likelihood. We forgo details and further examples due to space constraints.
 The GLM contribution to the gradient determines whether the  X  j coordinate update itself has a closed form, as it does in the normal case (7) and the Poisson case (omitted). If the update is not closed-form, we use numerical optimization, supplying a gradient obtained from one of the methods described in the previous paragraph.
 Parameter estimation (M-step). The topic parameter estimates are given by (8), as before. For the corpus-level ELBO, the gradient with respect to  X  becomes The appearance of  X (  X  ) = E GLM [ Y |  X  = X  ] follows from exponential family properties. This GLM an exact solution only in some cases (e.g. normal, Poisson). In other cases, we approximate the expectation with methods similar to those applied for the  X  j coordinate update. Reference [3] has details, including estimation of  X  and prediction, where we encounter the same issues. The derivative with respect to  X  , evaluated at  X   X  new , is Given that the rightmost summation has been evaluated, exactly or approximately, during the  X  optimization, (21) has a closed form. Depending on h ( y , X ) and its partial with respect to  X  , we obtain  X   X  new either in closed form or via one-dimensional numerical optimization. Prediction. We form predictions just as in Section 2.2. The difference is that we now approximate the expected response value of a test document as Again, this follows from iterated expectation plus the variational approximation. When the varia-tional expectation cannot be computed exactly, we apply the approximation methods we relied on for the GLM E-step and M-step. We defer specifics to [3]. We evaluated sLDA on two prediction problems. First, we consider  X  X entiment analysis X  of news-paper movie reviews. We use the publicly available data introduced in [10], which contains movie reviews paired with the number of stars given. While Pang and Lee treat this as a classification problem, we treat it as a regression problem. With a 5000-term vocabulary chosen by tf-idf, the corpus contains 5006 documents and comprises 1.6M words.
 Second, we introduce the problem of predicting web page popularity on Digg.com. Digg is a com-munity of users who share links to pages by submitting them to the Digg homepage, with a short description. Once submitted, other users  X  X igg X  the links they like. Links are sorted on the Digg homepage by the number of diggs they have received. Our Digg data set contains a year of link descriptions, paired with the number of diggs each received during its first week on the homepage. technology category. After trimming the top ten outliers, and using a 4145-term vocabulary chosen by tf-idf, the Digg corpus contains 4078 documents and comprises 94K words.
 For both sets of response variables, we transformed to approximate normality by taking logs. This makes the data amenable to the continuous-response model of Section 2; for these two problems, until the relative change in the corpus-level likelihood bound was less than 0.01%. In the E-step, we ran coordinate-ascent variational inference for each document until the relative change in the per-document ELBO was less than 0.01%. For the movie review data set, we illustrate in Figure 1 a matching of the top words from each topic to the corresponding coefficient  X  k .
 we defined this quantity as the fraction of variability in the out-of-fold response values which is captured by the out-of-fold predictions: pR 2 : = 1  X  ( P ( y  X   X  y ) 2 )/( P ( y  X   X  y ) 2 ) . We compared sLDA to linear regression on the  X   X  d from unsupervised LDA. This is the regression equivalent of using LDA topics as classification features [4].Figure 2 (L) illustrates that sLDA pro-vides improved predictions on both data sets. Moreover, this improvement does not come at the cost of document model quality. The per-word hold-out likelihood comparison in Figure 2 (R) shows that sLDA fits the document data as well or better than LDA. Note that Digg prediction is significantly harder than the movie review sentiment prediction, and that the homogeneity of Digg technology content leads the model to favor a small number of topics.
 Finally, we compared sLDA to the lasso, which is L 1 -regularized least-squares regression. The lasso is a widely used prediction method for high-dimensional problems. We used each document X  X  5-fold CV. On Digg data, the lasso X  X  optimal model complexity yielded a CV pR 2 of 0 . 088. The best sLDA pR 2 was 0 . 095, an 8 . 0% relative improvement. On movie data, the best Lasso pR 2 was 0 . 457 versus 0 . 500 for sLDA, a 9 . 4% relative improvement. Note moreover that the Lasso provides only a prediction rule, whereas sLDA models latent structure useful for other purposes. We have developed sLDA, a statistical model of labelled documents. The model accommodates the different types of response variable commonly encountered in practice. We presented a variational procedure for approximate posterior inference, which we then incorporated in an EM algorithm for maximum-likelihood parameter estimation. We studied the model X  X  predictive performance on two real-world problems. In both cases, we found that sLDA moderately improved on the lasso, a state-of-the-art regularized regression method. Moreover, the topic structure recovered by sLDA had higher hold-out likelihood than LDA on one problem, and equivalent hold-out likelihood on the other. These results illustrate the benefits of supervised dimension reduction when prediction is the ultimate goal.
 David M. Blei is supported by grants from Google and the Microsoft Corporation.
 [1] P. Bickel and K. Doksum. Mathematical Statistics . Prentice Hall, 2000. [2] D. Blei and M. Jordan. Modeling annotated data. In SIGIR , pages 127 X 134. ACM Press, 2003. [3] D. Blei and J. McAuliffe. Supervised topic models. In preparation, 2007. [4] D. Blei, A. Ng, and M. Jordan. Latent Dirichlet allocation. JMLR , 3:993 X 1022, 2003. [5] P. Flaherty, G. Giaever, J. Kumm, M. Jordan, and A. Arkin. A latent variable model for [6] K. Fukumizu, F. Bach, and M. Jordan. Dimensionality reduction for supervised learning with [7] T. Hastie, R. Tibshirani, and J. Friedman. The Elements of Statistical Learning . 2001. [8] A. McCallum, C. Pal, G. Druck, and X. Wang. Multi-conditional learning: Genera-[9] P. McCullagh and J. A. Nelder. Generalized Linear Models . Chapman &amp; Hall, 1989. [10] B. Pang and L. Lee. Seeing stars: Exploiting class relationships for sentiment categorization
