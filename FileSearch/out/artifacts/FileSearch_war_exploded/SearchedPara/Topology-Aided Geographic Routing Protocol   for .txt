 Geographic routing protocol is one of the most important types of routing protocol for the wireless sensor networks [1,2,3]. The traditional geographic routing protocol routes a packet from the source to the destination only based on the local information of a node, which is not always optimal. In this paper, we propose a topology-aided routing protocol. the destination than that selected by the traditional geographic routing protocol. 
For example, Fig.1 shows a sensor network distributed in a rectangle area with a the destination is nearer than that of itself. The traditional geographic routing protocol then transmits the packet around the hole acco rding to some strategy such as the right-Obviously, it is not a good choice. As th e traditional geographic routing protocol routes a packet purely based on the local geographic information, it can only adopt a certain strategy (such as the right-hand rule) to bypass a hole. In our protocol, when a packet can X  X  be transmitted greedily, the intermediate node calculates an optimal path from itself to the destination according to the topology of the network. Based on the path just calculated, the intermediate node can choose a proper direction for the packet to bypass the hole. In this example, node C will choose the right direction for the packet to bypass the hole. network, which represents the topology of the network as a weighted graph. Based on the topology detected, a T opology-A ided G eographic R outing ( TAGR ) protocol is proposed to route the packet in a short path. Before giving details of the TAGR protocol, we propose some assumptions used in this paper. We assume that a homogeneous sensor network is distributed in a rectangular area with some holes in the area. According to [4], a hole is an empty area enclosed by a series of connected sensor nodes. Holes of considerable size (a percentage of the network diameter) break the isotropy of the network and may block the direct path of two nodes. We assume isotropy among the rest of the network excluding the holes. Each node knows its coordinate which can be estimated by the localization algorithms [5,6] and the area of the rectangle where the sensor network is distributed. 
The general idea of the paper is as follows. The rectangle area is divided into a lot neighbor grids are numbered from 0 to 7 clockwise beginning at the grid to the left of represents the connectivity of the center grid with its corresponding neighbor grid. girds in the network. After receiving the bit vector from all the other grids, the topology of the network can be constructed as a weighted graph. When the packet is transmitted to an intermediate node at the edge of a hole, the node can guide a packet to bypass the hole in a short path with the help of the topology information. 
The contribution of this paper is: First, we propose a topology-aided geographic routing protocol, which can select a shorte r path for a packet than that of the traditional geographic routing protocols. Second, we verify the performance of our routing protocol by extensive experiments. works. We briefly introduce a grid based topology detection algorithm used by our routing protocol in section 3. The T opology-A ided G eographic R outing ( TAGR ) protocol is proposed in section 4. Section 5 evaluates the performance of the TAGR protocol by extensive experiments. Finally, we draw a conclusion in section 6. Routing is one of the most important and fundamental problems for wireless sensor networks. A lot of routing protocols have been proposed to fit the particular requirement of wireless sensor networks [7], which can be classified into several classes, such as the hierarchy based protocol, the geographic routing protocol, the protocols and the Qos guaranteed protocols. 
The hierarchy based protocol [8] divides sensors in a sensor network into two types, the cluster heads and the ordinary nodes. The ordinary nodes can just communicate with its cluster head. Communication with other nodes in the same protocols, every node needs to know its physical coordinate. The basic idea of geographic routing protocol is that, when transmitting a packet, a node selects the neighbor that is nearest to the destination as the next hop. The virtual coordinate based protocols [9,10] works as the same as the geographic routing protocol, except that they do not need nodes know their physical coordinates. Each node is assigned some kind of virtual coordinate. Unlike the geographic routing in which the source node searches for a route to the destination node according some kind of coordinate, in data centric routing the source searches for a particular data stored on an unknown subset of nodes. Hence the routing problem is actually a query problem. The routing algorithm must search for the route to a node with the desired data. Then the data can be transmitted along the discovered route. Direct diffusion [11] floods a query around constructed. TAG [12] constructs a tree in the sensor network to answer the aggregate query. Such kind of query processing algorithm is suitable for continuous query for a certain type of data. The data can also be distributed in some particular nodes in the network according to the feature of the data [13]. Queries for the data can be suitable for ad hoc query processing. For exam ple, data are stored in different sensors selected by some kind of hash function [14] according to their types. A query only needs to visit the hashed location to acquire data of a given type. DIM [15] embeds a k-d tree like index in the network, which can fulfill the range query easily. Finally, the Qos guaranteed protocols include the fault tolerant, the real time and long lifetime routing protocols etc. Fault tolerant protocols [16,17] guarantee the reliability by transmitting a packet multiple times or through different neighbors. Real-time routing protocols [18] select the neighbor to the destination with the minimum transmission the energy of different nodes to optimize the lifetime of the network. The grid-based topology detection protocol is composed of two parts, which are the connectivity detection protocol for grids and the topology detection protocol for the network. The topology of the network detected by the protocol is represented as a weighed graph. 3.1 Connectivity Detection Protocol for Grids Suppose a sensor network is distributed within a rectangle area whose height and height and width are h g and w g respectively. A sensor node s i , whose communication range is r , knows its coordinate ( x i , y i ). 
Nodes in a grid can be classified into three types, which are the border nodes, the boundary nodes and the inner nodes. The nodes that can communicate with nodes in other grids are called the border nodes. A node p is a boundary node if there exists a location q outside p  X  X  transmission range so that none of the 1-hop neighbors of p is closer to q than p itself. The other nodes in a grid are called inner nodes. Note a node can be both a border node and a boundary node. At this time, the node is considered as a border node. 
A node can detect its type by using just the coordinates of its 1-hop neighbors. A node can determine whether it is a border node by checking the coordinates of its neighbors. [20] proposed a local algorithm named BOUNDHOLE to make a node neither a border node nor a boundary node, it is an inner node. 
If there is a communication path between two neighbor grids, we say that the two grids are connective. The Connectivity Detection Protocol is used by each grid to detect its connectivity to its 8 neighbor grids, which works as follows. h and w g . Then each node detects its neighbors in the network. According to the coordinates of the neighbors, a node can decide whether it can communicate with nodes in other grids. If so, the node is a border node and it sets the corresponding bit in the bit vector to 1. Recall that each grid has 8 neighbor grids, which are numbered according to their relative position to the cent er grid. After constructing the bit vector, the border node broadcasts a message containing the partial connectivity information to the other nodes in the grid. A pure boundary node broadcasts a bit vector with all its bit set to 0, which means the boundary node does not connect to any neighbor grids. If a boundary node is also a border node, the bit vector is set as a border node. Only when an inner node receives bit vectors from all its neighbor nodes, whose broadcasts the aggregated bit vector out. A node with no neighbor nearer to the center of a grid than that of itself is called a cluster head candidate. There may be multiple with their coordinates and IDs. If there is only one candidate nearest to the center of a grid among all candidates, it is selected as the cluster head. Otherwise, the candidate with the smallest ID is selected as the cluster head. After the execution of the cluster head. 3.2 Topology Detection Protocol for the Network There are holes in the sensor network, which can divide a grid into several parts. The holds the complete connectivity information of the part in a grid. 
The topology detection protocol spreads the connectivity information of each cluster head throughout the network. A cluster head broadcasts a message throughout the calculated by the cluster head. Based on the messages received from the cluster heads, a sensor node can construct the topology for the whole network, which is represented as a between two cluster heads. The weight for each edge is the distance between two cluster heads of the edge. In this way, our topology-aided geographic routing protocol does not consume more energy of the cluster head than that of the ordinary node. In this section, we propose a topology-aided geographic routing protocol, which utilizes the topology of the network to select a short path for a packet when bypassing a hole. Before giving details of the protocol, we introduce the next hop selection algorithm used by a node to transmit a packet around a hole. 4.1 The Next Hop Selection Algorithm To apply the geographic routing protocol, the boundary nodes in the network need to be planarized [1] as follows. An edge (u,v) exists between boundary node u and v if the distance between every other boundary node w, and whichever of u and v is farther from w. In equational form: We say that two boundary nodes are neighbors only when they satisfy the Eq.(1). Suppose a source node A transmits a packet to a destination node B in Fig.2. The packet is transmitted greedily in the same way as the traditional geographic routing protocol until it reaches a boundary node C, where the packet can X  X  be transmitted in greedy mode any more. Node C needs to determine a transmission strategy for the packet to bypass the hole. It has two choices, the left-hand rule or the right-hand rule. 
An intermediate node (node C in our example) adopts two steps to determine the transmission strategy for a packet to bypass a hole. First, it selects the next hop from all its neighbor boundary nodes. Second, it determines the proper transmission strategy based on the relationship among the intermediate node (node C), the previous hop of the intermediate node (node C') and the selected next hop (node R). In Fig.2, the intermediate node C first decides the next hop for the packet. As node C knows the topology of the network represented by a weighted graph, it can calculate the shortest path for the packet to bypass a hole. Node C lies in grid G 7 and the destination node B lies in grid G 11 . The nearest path from G 7 to G 11 is G  X  G 8  X  G 12  X  G 11 , which means node C needs to tran smit the packet to the direction towards G 8 . Suppose the node H be the cluster head of G 8 . The transmission direction can be determined by the vector CH vectors from itself to each of its neighbor boundary nodes ( CL compares the angles formed by the vectors and the direction vector ( HCL  X  , HCR  X  in Fig.2). The vector with the minimum angle to CH neighbor boundary node of the selected vector , so node R is selected as the next hop in Fig.2. 
The dot product between two vectors can be used to compare the size of different angles. According to the definition of dot product of two vectors, the angle HCL  X  between CL decreasing function from 0 to  X  , node C can find a smaller angle by selecting a larger the algorithm 1 is the direction vector and its output is the next hop. Algorithm 1: S1: Construct vectors to each neighbor boundary node S2: Calculate the cosine values of the angles between S3: Select the neighbor boundary node with the maximum 
After selecting the next hop, the intermediate node C needs to calculate the transmission strategy for the packet based on the next hop. In Fig.4, the packet reaches node C from node C', which forms a vector ' CC
The cross product between two vectors can be used by the intermediate node to determine the transmission strategy for a packet. According to the definition of the hand rule is selected. Otherwise, the right-hand rule is used. The transmission strategy selection algorithm is given in algorithm 2. The input of the algorithm 2 is two vectors originating from the current node and pointing to the previous hop and the next hop respectively, such as ' CC transmission strategy. Algorithm 2: S1: Calculate the cross product of the two vectors S2: if(the result is positive) S3: set the transmission strategy clockwise S4: else S5: set the transmission strategy counterclockwise 4.2 The Topology-Aided Geographic Routing Protocol The topology-aided geographic routing protocol works as follows. A packet in our protocol can be in one of two exclusive modes: the greedy mode or the perimeter checks whether it has a neighbor whose distance is nearer to the destination than packet to the neighbor nearest to destination. 
When an intermediate node receives a packet in the greedy mode, it repeats the above procedure until it finds that there is no neighbor whose distance to the destination is nearer than itself. In this case, the packet has reached a boundary node in the network. The current node changes the packet into the perimeter mode and does the following calculation: S1: Save the distance between the current node and the S2: Determine the destination cluster according to the S3: Calculate the shortest path from the cluster head of S4: Calculate the direction vector originating from the S5: Selects the next hop according to the algorithm 1 S6: Determine the transmission strategy for the packet S7: Store the strategy in a bit of the packet, where 0 S8: Transmit the packet to the selected next hop 
In step 2, the current node determines the cluster that the destination belongs to. If we assume that each grid contains only one cluster, it is easy for the current node to calculate node receives a packet in the perimeter mode, the node does the following operations: S1: Check the value of the bit representing transmission strategy S2: If the value is 0, the node selects the next hop S3: Otherwise, the node selects the next hop according to S4: Check whether the selected next hop is nearer to the S5: If so, the node changes the packet into the greedy S6: Transmit the packet to the selected next hop 
The left-hand rule in step 2 means the current node selects its last neighbor boundary node, except the previous hop, met by turning the vector formed from the current intermediate node to its previous hop clockwise. The right-hand rule turns the vector counterclockwise. Two experiments were done to test the performance of our protocol. In the first experiment, we compare the differences of routing path selected by our protocol and the traditional geographic routing protocol in different network condition. In the second experiments, we compare the average length of path between our protocol and the traditional protocol. The setting of our experiments is as follows. 4379 nodes are uniformly distributed in a rectangle area of 600*600. The rectangle area is divided into 64 grids. The transmission range of a node is set to 20. 5.1 Comparison of Selected Routin g Path for Different Protocols In this experiment, we compare the different paths from a source to a destination selected by our protocol and the traditional geographic protocol. There are four holes in the network. 
In Fig.3 (a) and (b), a source node transmits a packet downwards to a destination node. The routing path of the traditional geographic protocol is shown in Fig.3 (a). In rectangle hole. Then the traditional protocol adopts the perimeter mode. Based on the right-hand rule, the traditional protocol se lects the counterclockwise direction for the packet. After bypassing the rectangle hole, the traditional protocol adopts the protocol is shown in Fig.3 (b). Our protocol selects the same path for the packet as the traditional protocol until the packet can X  X  be transmitted greedily. As nodes in our protocol master the general topology of the network, they can calculate the shortest for the packet to bypass the hole. In Fig.3 (b), our protocol selects the right direction, which not only reduces the path length to bypass the rectangle hole but also avoids the packet meeting the big circle hole. In Fig.3(c) and (d), a source node transmits a packet upwards to a destination node. The path selected by the traditional protocol is shown in Fig.3(c), whose length is much longer than that of our protocol shown in Fig.3(d). With the help of the topology information, our protocol continues to transmit the packet in the left direction and shortens the path length. 5.2 Comparison of Selected Routin g Path for Different Protocols To test the performance of the topology-aided geographic routing protocol, we randomly select 100 pairs of nodes around the holes in the network as the source and destination, which means the path between a source and destination is blocked by holes. We compare the average path length of the two routing protocols. The results show that about 40% paths selected by our protocol are more than 2 hops shorter than that of the traditional protocol. The average path length of our protocol is about 14% shorter than that of the traditional geographic routing protocol. In this paper, we propose a topology-aided geographic routing protocol. Compared with the traditional geographic routing protocols for the sensor network, the TAGR when bypassing a hole, with the help of the topology information of the network. Acknowledgements. This work was supported by a grant from the National Natural Science Foundation of China (No.61100032), Basal Research Fund of Xiamen University (No.2010121072) and the Natural Science Foundation of Fujian Province (No.2010J01342). 
