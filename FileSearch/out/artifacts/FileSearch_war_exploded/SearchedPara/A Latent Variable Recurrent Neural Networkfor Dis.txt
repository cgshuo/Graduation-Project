 Natural language processing (NLP) has recently ex-perienced a neural network  X  X sunami X  (Manning, 2016). A key advantage of these neural architec-tures is that they employ discriminatively-trained distributed representations, which can capture the meaning of linguistic phenomena ranging from in-dividual words (Turian et al., 2010) to longer-range linguistic contexts at the sentence level (Socher et al., 2013) and beyond (Le and Mikolov, 2014). Be-cause they are discriminatively trained, these meth-ods can learn representations that yield very accurate predictive models (e.g., Dyer et al, 2015).

However, in comparison with the probabilistic graphical models that were previously the dominant machine learning approach for NLP, neural archi-tectures lack flexibility. By treating linguistic an-notations as random variables, probabilistic graphi-cal models can marginalize over annotations that are unavailable at test or training time, elegantly model-ing multiple linguistic phenomena in a joint frame-work (Finkel et al., 2006). But because these graph-ical models represent uncertainty for every element in the model, adding too many layers of latent vari-ables makes them difficult to train.

In this paper, we present a hybrid architecture that combines a recurrent neural network language model with a latent variable model over shallow discourse structure. In this way, the model learns a discriminatively-trained distributed representation of the local contextual features that drive word choice at the intra-sentence level, using techniques that are now state-of-the-art in language model-ing (Mikolov et al., 2010). However, the model treats shallow discourse structure  X  specifically, the relationships between pairs of adjacent sentences  X  as a latent variable. As a result, the model can act as both a discourse relation classifier and a language model. Specifically:  X  If trained to maximize the conditional like- X  If the model is trained to maximize the joint
In contrast to recent work on continuous latent variables in recurrent neural networks (Chung et al., 2015), which require complex variational autoen-coders to represent uncertainty over the latent vari-ables, our model is simple to implement and train, requiring only minimal modifications to existing re-current neural network architectures that are imple-mented in commonly-used toolkits such as Theano, Torch, and CNN.

We focus on a class of shallow discourse rela-tions , which hold between pairs of adjacent sen-tences (or utterances). These relations describe how the adjacent sentences are related: for example, they may be in CONTRAST , or the latter sentence may of-fer an answer to a question posed by the previous sentence. Shallow relations do not capture the full range of discourse phenomena (Webber et al., 2012), but they account for two well-known problems: im-plicit discourse relation classification in the Penn Discourse Treebank, which was the 2015 CoNLL shared task (Xue et al., 2015); and dialog act clas-sification, which characterizes the structure of in-terpersonal communication in the Switchboard cor-pus (Stolcke et al., 2000), and is a key component of contemporary dialog systems (Williams and Young, 2007). Our model outperforms state-of-the-art alter-natives for implicit discourse relation classification in the Penn Discourse Treebank, and for dialog act classification in the Switchboard corpus. Our model scaffolds on recurrent neural network (RNN) language models (Mikolov et al., 2010), and recent variants that exploit multiple levels of linguis-tic detail (Ji et al., 2015; Lin et al., 2015). RNN Language Models Let us denote token n in a sentence t by y t,n  X  { 1 ...V } , and write y t = { y sentence t . In an RNN language model, the proba-bility of the sentence is decomposed as, where the probability of each word y t,n is condi-tioned on the entire preceding sequence of words y t,&lt;n through the summary vector h t,n  X  1 . This vec-tor is computed recurrently from h t,n  X  2 and from the embedding of the current word, X y embeddings. The language model can then be sum-marized as, where the matrix W o  X  R V  X  K defines the output embeddings , and b o  X  R V is an offset. The function f (  X  ) is a deterministic non-linear transition function. It typically takes an element-wise non-linear trans-formation (e.g., tanh ) of a vector resulting from the sum of the word embedding and a linear transforma-tion of the previous hidden state.

The model as described thus far is identical to the recurrent neural network language model (RNNLM) of Mikolov et al. (2010). In this paper, we replace the above simple hidden state units with the more complex Long Short-Term Memory units (Hochre-iter and Schmidhuber, 1997), which have consis-tently been shown to yield much stronger perfor-mance in language modeling (Pham et al., 2014). For simplicity, we still use the term RNNLM in re-ferring to this model.
 Document Context Language Model One draw-back of the RNNLM is that it cannot propagate long-range information between the sentences. Even if we remove sentence boundaries, long-range infor-mation will be attenuated by repeated application of the non-linear transition function. Ji et al. (2015) propose the Document Context Language Model (DCLM) to address this issue. The core idea is to represent context with two vectors: h t,n , represent-ing intra -sentence word-level context, and c t , rep-resenting inter -sentence context. These two vectors z are then linearly combined in the generation func-tion for word y t,n , where c t  X  1 is set to the last hidden state of the pre-vious sentence. Ji et al. (2015) show that this model can improve language model perplexity. We now present a probabilistic neural model over sequences of words and shallow discourse relations. Discourse relations z t are treated as latent variables, which are linked with a recurrent neural network over words in a latent variable recurrent neural net-work (Chung et al., 2015). 3.1 The Model Our model (see Figure 1) is formulated as a two-step generative story. In the first step, context informa-tion from the sentence ( t  X  1) is used to generate the discourse relation between sentences ( t  X  1) and t , where z t is a random variable capturing the dis-course relation between the two sentences, and c t  X  1 is a vector summary of the contextual information from sentence ( t  X  1) , just as in the DCLM (Equa-tion 5). The model maintains a default context vec-tor c 0 for the first sentences of documents, and treats it as a parameter learned with other model parame-ters during training.

In the second step, the sentence y t is generated, conditioning on the preceding sentence y t  X  1 and the discourse relation z t : The generative probability for the sentence y t de-composes across tokens as usual (Equation 7). The per-token probabilities are shown in Equation 4, in Figure 2. Discourse relations are incorporated by pa-rameterizing the output matrices W ( z t ) o and W ( z t ) depending on the discourse relation that holds be-tween ( t  X  1) and t , these matrices will favor dif-ferent parts of the embedding space. The bias term b o is also parametrized by the discourse relation, so that each relation can favor specific words.
Overall, the joint probability of the text and dis-course relations is,
If the discourse relations z t are not observed, then our model is a form of latent variable recurrent neu-ral network (LVRNN). Connections to recent work on LVRNNs are discussed in  X  6; the key difference is that the latent variables here correspond to linguis-tically meaningful elements, which we may wish to predict or marginalize, depending on the situation. Parameter Tying As proposed, the Discourse Re-lation Language Model has a large number of pa-rameters. Let K , H and V be the input dimension, hidden dimension and the size of vocabulary in lan-guage modeling. The size of each prediction matrix W ( z ) o and W ( z ) c is V  X  H ; there are two such matri-ces for each possible discourse relation. We reduce the number of parameters by factoring each of these matrices into two components: nents for intra-sentential and inter-sentential con-texts; the size of these matrices is H  X  H , with H V . The larger V  X  H matrices W o and W c are shared across all relations. 3.2 Inference There are two possible inference scenarios: in-ference over discourse relations, conditioning on words; and inference over words, marginalizing over discourse relations.
 Inference over Discourse Relations The prob-ability of discourse relations given the sentences p ( z 1: T | y 1: T ) is decomposed into the product of probabilities of individual discourse relations condi-tioned on the adjacent sentences These probabilities are computed by Bayes X  rule:
The terms in each product are given in Equations 6 and 7. Normalizing involves only a sum over a small finite number of discourse relations. Note that infer-ence is easy in our case because all words are ob-served and there is no probabilistic coupling of the discourse relations.
 Inference over Words In discourse-informed lan-guage modeling, we marginalize over discourse re-lations to compute the probability of a sequence of sentence y 1: T , which can be written as, because the word sequences are observed, decou-pling each z t from its neighbors z t +1 and z t  X  1 . This decoupling ensures that we can compute the overall marginal likelihood as a product over local marginals. 3.3 Learning The model can be trained in two ways: to maximize the joint probability p ( y 1: T , z 1: T ) , or to maximize the conditional probability p ( z 1: T | y 1: T ) . The joint training objective is more suitable for language mod-eling scenarios, and the conditional objective is bet-ter for discourse relation prediction. We now de-scribe each objective in detail.
 Joint likelihood objective The joint likelihood objective function is directly adopted from the joint probability defined in Equation 8. The objective function for a single document with T sentences or utterances is, where  X  represents the collection of all model pa-rameters, including the parameters in the LSTM units and the word embeddings.

Maximizing the objective function ` (  X  ) will jointly optimize the model on both language lan-guage and discourse relation prediction. As such, it can be viewed as a form of multi-task learn-ing (Caruana, 1997), where we learn a shared rep-resentation that works well for discourse relation prediction and for language modeling. However, in practice, the large vocabulary size and number of to-kens means that the language modeling part of the objective function tends to dominate.
 Conditional objective This training objective is specific to the discourse relation prediction task, and based on Equation 10 can be written as:
The first line in Equation 13 is the same as ` (  X  ) , but the second line reflects the normalization over all possible values of z t . This forces the objective func-tion to attend specifically to the problem of maxi-mizing the conditional likelihood of the discourse relations and treat language modeling as an auxil-iary task (Collobert et al., 2011). 3.4 Modeling limitations The discourse relation language model is carefully designed to decouple the discourse relations from each other, after conditioning on the words. It is clear that text documents and spoken dialogues have sequential discourse structures, and it seems likely that modeling this structure could improve performance. In a traditional hidden Markov model (HMM) generative approach (Stolcke et al., 2000), modeling sequential dependencies is not difficult, because training reduces to relative frequency es-timation. However, in the hybrid probabilistic-neural architecture proposed here, training is al-ready expensive, due to the large number of param-eters that must be estimated. Adding probabilis-tic couplings between adjacent discourse relations  X  z t  X  1 ,z t  X  would require the use of dynamic pro-gramming for both training and inference, increas-ing time complexity by a factor that is quadratic in the number of discourse relations. We did not at-tempt this in this paper; we do compare against a conventional HMM on the dialogue act prediction task in  X  5.

Ji et al. (2015) propose an alternative form of the document context language model, in which the contextual information c t impacts the hidden state h t +1 , rather than going directly to the outputs y t +1 . They obtain slightly better perplexity with this ap-proach, which has fewer trainable parameters. How-ever, this model would couple z t with all subsequent sentences y &gt;t , making prediction and marginaliza-tion of discourse relations considerably more chal-lenging. Sequential Monte Carlo algorithms offer a possible solution (de Freitas et al., ; Gu et al., 2015), which may be considered in future work. We evaluate our model on two benchmark datasets: (1) the Penn Discourse Treebank (Prasad et al., 2008, PDTB), which is annotated on a corpus of Wall Street Journal acticles; (2) the Switchboard di-alogue act corpus (Stolcke et al., 2000, SWDA), which is annotated on a collections of phone con-versations. Both corpora contain annotations of dis-course relations and dialogue relations that hold be-tween adjacent spans of text.
 The Penn Discourse Treebank (PDTB) provides a low-level discourse annotation on written texts. In the PDTB, each discourse relation is annotated be-tween two argument spans, Arg1 and Arg2 . There are two types of relations: explicit and implicit. Explicit relations are signalled by discourse mark-ers (e.g.,  X  however  X ,  X  moreover  X ), and the span of Arg1 is almost totally unconstrained: it can range from a single clause to an entire paragraph, and need not be adjacent to either Arg2 nor the dis-course marker. However, automatically classifying these relations is considered to be relatively easy, due to the constraints from the discourse marker it-self (Pitler et al., 2008). In addition, explicit rela-tions are difficult to incorporate into language mod-els which must generate each word exactly once. On the contrary, implicit discourse relations are anno-tated only between adjacent sentences, based on a semantic understanding of the discourse arguments. Automatically classifying these discourse relations is a challenging task (Lin et al., 2009; Pitler et al., 2009; Rutherford and Xue, 2015; Ji and Eisenstein, 2015). We therefore focus on implicit discourse re-lations, leaving to the future work the question of how to apply our modeling framework to explicit discourse relations. During training, we collapse all relation types other than implicit (explicit, E NT R EL , and N O R EL ) into a single dummy relation type, which holds between all adjacent sentence pairs that do not share an implicit relation.

As in the prior work on first-level discourse re-lation identification (e.g., Park and Cardie, 2012), we use sections 2-20 of the PDTB as the training set, sections 0-1 as the development set for param-eter tuning, and sections 21-22 for testing. For pre-processing, we lower-cased all tokens, and substi-tuted all numbers with a special token  X  NUM  X . To build the vocabulary, we kept the 10,000 most fre-quent words from the training set, and replaced low-frequency words with a special token  X  UNK  X . In prior work that focuses on detecting individual rela-tions, balanced training sets are constructed so that there are an equal number of instances with and without each relation type (Park and Cardie, ; Biran and McKeown, 2013; Rutherford and Xue, 2014). In this paper, we target the more challenging multi-way classification problem, so this strategy is not ap-plicable; in any case, since our method deals with entire documents, it is not possible to balance the training set in this way.
 The Switchboard Dialog Act Corpus (SWDA) is annotated on the Switchboard Corpus of human-human conversational telephone speech (Godfrey et al., 1992). The annotations label each utterance with one of 42 possible speech acts, such as AGREE , HEDGE , and WH -QUESTION . Because these speech acts form the structure of the dialogue, most of them pertain to both the preceding and succeeding utter-ances (e.g., AGREE ). The SWDA corpus includes 1155 five-minute conversations. We adopted the standard split from Stolcke et al. (2000), using 1,115 conversations for training and nineteen conversa-tions for test. For parameter tuning, we randomly select nineteen conversations from the training set as the development set. After parameter tuning, we train the model on the full training set with the se-lected configuration. We use the same preprocessing techniques here as in the PDTB. 4.1 Implementation We use a single-layer LSTM to build the recur-rent architecture of our models, which we im-plement in the CNN package. 1 Our implemen-tation is available on https://github.com/ jiyfeng/drlm . Some additional details follow. Initialization Following prior work on RNN ini-tialization (Bengio, 2012), all parameters except the relation prediction parameters U and b are ini-tialized with random values drawn from the range [  X  p are the input and output dimensions of the parame-ter matrix respectively. The matrix U is initialized with random numbers from [  X  10  X  5 , 10  X  5 ] and b is initialized to 0 .
 Learning Online learning was performed using AdaGrad (Duchi et al., 2011) with initial learning rate  X  = 0 . 1 . To avoid the exploding gradient prob-lem, we used norm clipping trick with a threshold of  X  = 5 . 0 (Pascanu et al., 2012). In addition, we used value dropout (Srivastava et al., 2014) with rate 0 . 5 , on the input X , context vector c and hidden state h , similar to the architecture proposed by Pham et al. (2014). The training procedure is monitored by the performance on the development set. In our experi-ments, 4 to 5 epochs were enough.
 Hyper-parameters Our model includes two tun-able hyper-parameters: the dimension of word rep-resentation K , the hidden dimension of LSTM unit H . We consider the values { 32 , 48 , 64 , 96 , 128 } for both K and H . For each corpus in experiments, the best combination of K and H is selected via grid search on the development set. Our main evaluation is discourse relation prediction, using the PDTB and SWDA corpora. We also eval-uate on language modeling, to determine whether incorporating discourse annotations at training time and then marginalizing them at test time can im-prove performance. 5.1 Implicit discourse relation prediction on We first evaluate our model with implicit discourse relation prediction on the PDTB dataset. Most of the prior work on first-level discourse relation predic-tion focuses on the  X  X ne-versus-all X  binary classifi-cation setting, but we attack the more general four-way classification problem, as performed by Ruther-ford and Xue (2015). We compare against the fol-lowing methods: Rutherford and Xue (2015) build a set of feature-rich classifiers on the PDTB, and then augment these classifiers with additional automatically-labeled training instances. We compare against their published results, which are state-of-the-art. Ji and Eisenstein (2015) employ a recursive neural network architecture. Their experimental setting is different, so we re-run their system using the same setting as described in  X  4. Results As shown in Table 1, the conditionally-trained discourse relation language models (D R LM) outperforms all alternatives, on both metrics. While the jointly-trained D R LM is at the same level as the previous state-of-the-art, conditional training on the same model provides a significant additional advan-tage, indicated by a binomial test. 5.2 Dialogue Act tagging Dialogue act tagging has been widely studied in both NLP and speech communities. We follow the setup used by Stolcke et al. (2000) to conduct experiments, and adopt the following systems for comparison: Stolcke et al. (2000) employ a hidden Markov model, with each HMM state corresponding to a dialogue act.
 Kalchbrenner and Blunsom (2013) employ a complex neural architecture, with a convolutional network at each utterance and a recurrent net-work over the length of the dialog. To our knowl-edge, this model attains state-of-the-art accuracy on this task, outperforming other prior work such as (Webb et al., 2005; Milajevs and Purver, 2014). Results As shown in Table 2, the conditionally-trained discourse relation language model (D R LM) outperforms all competitive systems on this task. A binomial test shows the result in line 6 is signifi-cantly better than the previous state-of-the-art (line 4). All comparisons are against published results, and Macro-F 1 scores are not available. Accuracy 1. Model Accuracy
Baseline 2. Most common class 31.5
Prior work 3. (Stolcke et al., 2000) 71.0 4. (Kalchbrenner and Blunsom, 2013)
Our work -D R LM 5. Joint training 74.0 is more reliable on this evaluation, since no single class dominates, unlike the PDTB task. 5.3 Discourse-aware language modeling As a joint model for discourse and language model-ing, D R LM can also function as a language model, assigning probabilities to sequences of words while marginalizing over discourse relations. To deter-mine whether discourse-aware language modeling can improve performance, we compare against the following systems: RNNLM+LSTM This is the same basic architec-ture as the RNNLM proposed by (Mikolov et al., 2010), which was shown to outperform a Kneser-Ney smoothed 5-gram model on modeling Wall
Street Journal text. Following Pham et al. (2014), we replace the Sigmoid nonlinearity with a long short-term memory (LSTM).
 DCLM We compare against the Document Context
Language Model (DCLM) of Ji et al. (2015). We use the  X  X ontext-to-output X  variant, which is iden-tical to the current modeling approach, except that it is not parametrized by discourse relations. This model achieves strong results on language model-ing for small and medium-sized corpora, outper-forming RNNLM+LSTM.
 Results The perplexities of language modeling on the PDTB and the SWDA are summarized in Ta-ble 3. The comparison between line 1 and line 2 shows the benefit of considering multi-sentence context information on language modeling. Line 3 shows that adding discourse relation information yields further improvements for both datasets. We emphasize that discourse relations in the test doc-uments are marginalized out, so no annotations are required for the test set; the improvements are due to the disambiguating power of discourse relations in the training set.

Because our training procedure requires discourse annotations, this approach does not scale to the large datasets typically used in language modeling. As a consequence, the results obtained here are somewhat academic, from the perspective of practical language modeling. Nonetheless, the positive results here mo-tivate the investigation of training procedures that are also capable of marginalizing over discourse re-lations at training time. This paper draws on previous work in both discourse modeling and language modeling.
 Discourse and dialog modeling Early work on discourse relation classification utilizes rich, hand-crafted feature sets (Joty et al., 2012; Lin et al., 2009; Sagae, 2009). Recent representation learn-ing approaches attempt to learn good representations jointly with discourse relation classifiers and dis-course parsers (Ji and Eisenstein, 2014; Li et al., 2014). Of particular relevance are applications of neural architectures to PDTB implicit discourse re-lation classification (Ji and Eisenstein, 2015; Zhang et al., 2015; Braud and Denis, 2015). All of these approaches are essentially classifiers, and take su-pervision only from the 16,000 annotated discourse relations in the PDTB training set. In contrast, our approach is a probabilistic model over the entire text.
Probabilistic models are frequently used in dia-log act tagging, where hidden Markov models have been a dominant approach (Stolcke et al., 2000). In this work, the emission distribution is an n -gram language model for each dialogue act; we use a conditionally-trained recurrent neural network lan-guage model. An alternative neural approach for di-alogue act tagging is the combined convolutional-recurrent architecture of Kalchbrenner and Blunsom (2013). Our modeling framework is simpler, rely-ing on a latent variable parametrization of a purely recurrent architecture.
 Language modeling There are an increasing number of attempts to incorporate document-level context information into language modeling. For ex-ample, Mikolov and Zweig (2012) introduce LDA-style topics into RNN based language modeling. Sordoni et al. (2015) use a convolutional structure to summarize the context from previous two utter-ances as context vector for RNN based language modeling. Our models in this paper provide a uni-fied framework to model the context and current sen-tence. Wang and Cho (2015) and Lin et al. (2015) construct bag-of-words representations of previous sentences, which are then used to inform the RNN language model that generates the current sentence. The most relevant work is the Document Context Language Model (Ji et al., 2015, DCLM); we de-scribe the connection to this model in  X  2. By adding discourse information as a latent variable, we attain better perplexity on held-out data.
 Latent variable neural networks Introducing la-tent variables to a neural network model increases its representational capacity, which is the main goal of prior efforts in this space (Kingma and Welling, 2014; Chung et al., 2015). From this perspective, our model with discourse relations as latent vari-ables shares the same merit. Unlike this prior work, in our approach, the latent variables carry a lin-guistic interpretation, and are at least partially ob-served. Also, these prior models employ continuous latent variables, requiring complex inference tech-niques such as variational autoencoders (Kingma and Welling, 2014; Burda et al., 2016; Chung et al., 2015). In contrast, the discrete latent variables in our model are easy to sum and maximize over. We have presented a probabilistic neural model over sequences of words and shallow discourse re-lations between adjacent sequences. This model combines positive aspects of neural network ar-chitectures with probabilistic graphical models: it can learn discriminatively-trained vector representa-tions, while maintaining a probabilistic representa-tion of the targeted linguistic element: in this case, shallow discourse relations. This method outper-forms state-of-the-art systems in two discourse rela-tion detection tasks, and can also be applied as a lan-guage model, marginalizing over discourse relations on the test data. Future work will investigate the possibility of learning from partially-labeled train-ing data, which would have at least two potential ad-vantages. First, it would enable the model to scale up to the large datasets needed for competitive language modeling. Second, by training on more data, the resulting vector representations might support even more accurate discourse relation prediction. Thanks to Trevor Cohn, Chris Dyer, Lingpeng Kong, and Quoc V. Le for helpful discussions, and to the anonymous reviewers for their feedback. This work was supported by a Google Faculty Research award to the third author. It was partially performed dur-ing the 2015 Jelinek Memorial Summer Workshop on Speech and Language Technologies at the Uni-versity of Washington, Seattle, and was supported by Johns Hopkins University via NSF Grant No IIS 1005411, DARPA LORELEI Contract No HR0011-15-2-0027, and gifts from Google, Microsoft Re-search, Amazon and Mitsubishi Electric Research Laboratory.

