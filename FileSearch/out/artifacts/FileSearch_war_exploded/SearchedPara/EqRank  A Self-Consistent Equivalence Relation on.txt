 A new method of hierarchical clustering of graph vertexes is suggested. The method is motivated by applications to searches of scientific papers in electronic libraries (in these applications, the clustered graph is the citation graph). In the method, the graph partition is determined with an equiv-alence relation. Iterative application of the partitioning yields a hierarchical clustering of graph vertexes. The method is applied to the citation graph of hep-th , which is an elec-tronic archive of papers on theoretical high energy physics at http://xxx.lanl.gov . The outcome is a two-level clas-sification scheme for the subject field presented in hep-th , and indexing of the papers from hep-th in this scheme. A number of tests show that the classification obtained is ad-equate. With the advent of the Internet, scientific literature comes closer to realizing the notion of Knowledge Network [6], with the papers as the information units, and the references to other papers as the links of the network. An important feature in the organization of scientific knowledge is its rep-resentation as a hierarchy of developing and transforming scientific themes. The search for algorithms that would be able to reveal this hidden hierarchy analyzing the network structure had been initiated in the seventies [12; 5], and continued until now [10; 4; 1]. Most of the present day clustering algorithms involve a number of free parameters (e.g., number of clusters, number of hierarchy levels, citation threshold, etc.). The values of the free parameters are fixed from external considerations. There is normally a strong de-pendence of the clustering results on the values of the free parameters. As a result, variation of the parameters yields a too broad set of clusterings ranging from the trivial clus-tering (with a single cluster) to the maximally refined one. We formulate the question: Do there exist nontrivial hierar-chical graph clusterings that would be uniquely determined by the graph structure, or, otherwise, would be weakly de-pendent in a certain sense on the free parameters of the clustering procedure, if the latter are present? Practically, the weak dependnece can be defined as a weak dependence of the characterizations like the number of clusters, the num-ber of hierarchy levels, etc. We answer the question formu-lated above in the affirmative, and suggest a new algorithm, EqRank that performs a hierarchical clustering solving the problem. The problem is considered for the case of directed graphs. The algorithm is applied to the hep-th citation graph. As a result, we obtain a classification scheme of the subject field presented in hep-th , and indexing of papers in this classification scheme.
 The reminder of this paper is organized as follows. In section 2, we give an informal explanation of the EqRank algorithm, formalize the intuitive presentation. We end this section with a crude estimate of the time compexity of EqRank . In section 3, we present the results yielded by EqRank applied to the hep-th citation graph. Section 4 contains a discussion of the results obtained, and lists some unaswered questions. In this section we describe the EqRank algorithm. It can be applied to any directed graph. Small modifications may be needed to fine-tune it to a particular setting. The setting that have been motivating us in the development of EqRank is the setting of a citation graph. We explain the idea behind the EqRank algorithm using the terms natural for a citation graph. Assume that we have learned somehow the way to compute the local hub paper LH ( p ) for each paper p . LH ( p ) cites p and is the most rep-resentative paper among the papers developing the ideas of p . The existence of the mapping LH generates the trajec-tory ( p, LH ( p ) , LH ( LH ( p )) , ... ) consisting of the sequence of papers where every next paper is the local hub of the previous paper. The trajectory starts at the paper p , and ends at the paper RH ( p ), which has no citations. We call the end point of the trajectory the root hub of the paper p . Let us introduce an equivalence relation on the set of papers: p  X  p 0 if RH ( p ) = RH ( p 0 ). The corresponding equivalence classes are called the modern themes . A mod-ern theme is formed with the papers that share a common resulting paper, the root hub, which is the paper underscor-ing the present state of the root theme. In complete analogy, starting with existence of the local authority LA ( p ) that is the paper cited by p , and is the most representative paper among the papers on which p is based, we determine the partition of the set of papers into classic themes . Each pa-per in a classic theme has one and the same paper as its root authority . Frequently, a root authority is a seminal pa-per initiating a new direction of research. We call simply the themes the elements of the partition yielded by intersec-tion of the hub partition and the authority partition. All the papers of a theme have one and the same root hub and authority papers. A modern theme considered as a graph whose vertexes are the papers of the theme, and the links are the links of the citation graph of the form ( p , LH ( p )) is an out-tree [2] whose root coincides with the root hub of the theme. Similarly, a classic theme is an in-tree whose root coincides with root authority of the theme.
 Restriciting consideration to a citation graph, it is natural to define the mapping value LH ( p ) as the paper on which a weight function W ( p, P ) reaches its maximum: Here W ( p, P ) is a nonnegative function defining the weight (relevance) of the link from P to p . We can use as W the co-citation [12], the bibliographic coupling [7], or other link-based measures of proximity [8]. In the actual experiment we performed over the hep-th citation graph, we used as W a linear combination of the first two of the measures of proximity mentioned above (more precisely, the reduction of this function onto the links of the citation graph under consideration). In the informal description of the algorithm, it was implicitly implied that there is a unique local hub (authority) for each paper, and that the graph is acyclic. In applications, both conditions are violated. The following formal description is valid without these simplifying assumptions.
 Let G  X  G ( V, E, W ) be a weighted directed graph, where V is the set of the graph vertexes, E is the binary relation on V that defines the links, W is the nonnegative function on E that defines the weight of the links. Let P S ( V ) be the power set, i.e., the set of all subsets of V , and F S ( V ) be the final set, i.e., the subset of V singled out by the absence of the links outgoing from its elements. SCR denotes the strong connectivity relation on the vertexes of the graph. Operation 1. The result of factoring of G ( V, E, W ), is the factor graph of G taken by the equivalence relation R . Here V/R is the set of the equivalence classes with respect to R , E/R is the binary relation on V/R induced by E , i.e., X ( E/R ) Y if there exist such representatives of these classes x and y that xEy . (We write xEy if ( x, y )  X  E .) The function W  X  is defined as the sum of the weights of all the links joining the elements belonging to the different equivalence classes.
 Operation 2. The result of inversion of G ( V, E, W ), is the same graph as G , but with the directions of the links inverted; W 0 ( p, p 0 )  X  W ( p 0 , p ).

Operation 3. The result of retaining in G ( V, E, W ) only the maximally weighted links, is the graph whose set of links E max is the subset of the maximally weighted links, E max  X  E , W 0 is the restriction of the function W on E max . Operation 4. Graph G can be transformed to a function Root ( G ) : V  X  P S ( V ), This subset is singled out in F S ( V ) by the property that each of its points is reachable from p along the links. We define the following three equivalence relations on V , HubR ( G ), AuthR ( G ), and EqRank ( G ). x  X  y with respect to the partition HubR ( G ) if Root ( Max ( In ( G )) /SCR )( x ) = Root ( Max ( In ( G )) /SCR )( y ); x  X  y with respect to the partition AuthR ( G ) if The desired EqRank partition is defined as follows: Some notes are in order. The operation (or Max ( In ( G ))) keeps in the graph only the maximal out-going (or ingoing) links, which link the papers to their local authorities (hubs). We do not assume anymore that local authorities and hubs are unique. Becuase of this, a clas-sical (modern) theme has as its root not a single paper, but a set of papers reachable from each paper of the theme along the maximal links. Let us comment on the presence of the factoring with respect to SCR in the above definitions. Without it, going along the links could be jammed on the cycles of the graph.
 With the above definitions, the algorithm Eqrank we suggest for hierarchical clustering is defined as follows. The sequence terminates when G i  X  G i  X  1 , i.e., the number of vertexes of G i coincides with the number of vertexes of G The algorithm consists of the operations 1 X 4. Thus, we have to estimate the time complexity of these operations. Evidently, T o 1  X  E + V , where E is the number of links; T o 2  X  E ; T o 3  X  E . Most time consuming is the operation 4, because it requires computation of the transitive closure on the graph. Its time complexity is V ( E + V ).
 We point out that we observed linear dependence of the time complexity on the number of vertexes up to the scale of 10 4 for the number of vertexes. This may be related to a considerable simplification of the graph after the apllication of the Max operation (see subsection 2.2.1 ). About 76% (91%) of the vertexes of the graph Max ( G ) ( Max ( In ( G ))) had the unit out-degree in our experiments.
 As mentioned above, application of EqRank in a concrete setting may require a fine-tuning. Here we specify the mod-ification of EqRank that was applied to the hep-th citation graph, and present the results obtained.
 The graph under consideration consists of 27,240 vertexes, and 342,437 links. It contains a number of weakly connected components. The largest component has 26,870 vertexes. The rest of 370 papers fragments into 229 of small (less than 5 papers) weakly connected components. A consid-eration of the reference lists of the papers from the small components reveals the reason behind the presence of these small components: most of the papers cited from the small components do not belong to hep-th , and, therefore, escape from the citation graph under consideration.
 The weight of a link was taken to be a linear combination of the co-citation and bibliographic coupling, where A is the adjacency matrix of the graph. We set a = 0 . 9 The closeness of a to unit reflects that we consider co-citations as a more adequate measure of the importance of a link (we do not set a = 1 to avoid degeneracy of the weight fucntion).
 Evidently, the clustering of the weakly connected compo-nents can be performed independently for each component. The results we present below have been obtained by ap-plying EqRank to the largest weakly connected component. Processing of hep-th had taken about half an hour on a Pentium 200 PC. Applying literally EqRank to hep-th yielded a too refined clustering. The total number of clusters turned out to be 11,299. The reason for the existence of such a large number of small clusters is as follows. The themes are singled out by their root hubs and authorities in our approach. The root hubs are characterized by the absence of links pointing to them (they are recent papers with no papers citing them). The total number of such papers is too high to keep them all as representatives of relevant themes. A similar consid-eration can be applied to root authorities after inversion of the links.
 To obtain a meaningful reduction of the number of themes, we considered as  X  X ctual X  themes the themes whose num-ber of papers was exceeding a cutoff value. In the present experiment the cutoff value was taken to be 20 papers. See below for an analysis of the dependence of the classification on the cutoff. For the above value of the cutoff, the num-ber of actual themes turned out to be 136. The rest of the themes were glued to the subset of actual themes, each small theme, to the  X  X losest X  large theme. The closeness between the themes A and B was computed as the sum of weights of the links between the themes regardless of the direction of a link. Ultimately, the largest theme turned out to contain 3586 papers, and the smallest, 26 papers. The themes formed after the first stage clustering of the hep-th citation graph form the vertexes of the factor graph (see subsection 2.2.1 ). This factor graph was clustered with EqRank . It yielded 19 themes of the second hierarchy level. At this level, the largest theme contnins 15,410 papers, and the smallest, 65. One more application of EqRank yielded the trivial clustering. All the papers merged to a single cluster. We point out that the cutoff was used only to generate the first level of the hierarchy. Let us consider the hierarchy that would appear without the cutoff. Without the cutoff, a star-like graph would appear at the third level of the hierar-chy instead of the trivial graph consisting of a single vertex. There would be a single super-cluster of 7228 papers, and a multitude of small themes each of which would be con-nected to the super-cluster either by ingoing or outgoing links. Further application of EqRank would shrink the star-like graph by absorbing a number of the small themes into the super-cluster. Starting from the third hierarchy level, the exponential reduction of the number of vertexes in the factor graph would switch over to linear reduction. Based on the above we claim that EqRank allows computing the number of hierarchy levels implied by the structure of a graph. For the hep-th citation graph, there are two levels in the hierarchy.
 In conclusion, we discuss in more detailes the dependence of the classification obtained for hep-th papers on the cut-off, which is essentially the only parameter involved in the procedure. The experiments performed have demonstrated that the characteristic most stable against changes in the cutoff is the number of hierarchy levels. It stays invariable as soon as the cutoff exceeds a critical value. (This sets an interesting mathematical problem of understanding the number of hierarchy levels as an invariant characteristic of a directed graph.) Next in stabitlity is the number of clusters on the first hierarchy level. Reduction of the cutoff simply adds new small clusters without changing the upper part of the list of clusters. The most involved is the dependence on the cutoff of the higher hierarchy levels. Not only new small themes may appear, but there may be also merging and splitting of clusters in the upper part of the cluster list at a reduction of the cutoff.
 We summarise the above discussion as follows. We obtained a set of classifications depending on a single parameter F the minimal number of papers in a theme of the first level. Each classification C is a finite sequence of graphs, The sequence terminates on a trivial graph (more generally, on a graph invariant with respect to application of EqRank ). The length of the sequence is characterised by the number n , the number of the levels in the hierarchy. The latter also depends on F cut . The dependence is as follows: and where f is a function growing fast at F cut decreasing. In the case of hep-th , const = 2, and F min = 8. The qualitative change of the dependence of the number of hierarchy levles on F cut taking place at F min suggests that it is natural to A stydy of time dynamics of the themes is a part of our experiment with hep-th . Specifically, time dependence of the size of the themes at different levels of the hierarchy was considered. A brief account of the results is given in Table 1. There is an overall increase of the number of papers posted to hep-th each year. It is distributed unevenly between the themes. Analysing this distribution allowed us to classify the clusters into four groups depending on the character of the evolution trend. The trend was computed for the period 1992 X 2002. The data is presented on the plots at http://hepstructure.inr.ac.ru/hep-th/Theme dyn.htm . The first group of the clusters (the  X + X  trend clusters) in-cludes  X  X rowing X  themes. There are 10 themes in this group. The second group (the  X   X   X  trend clusters) includes  X  X ading X  themes. There are 5 themes of this sort. The third group (the  X 0 X  trend clusters) includes 2 themes characterized by a stable number of the papers appearing per year. The fourth group (the  X ++ X  trend clusters) includes 2 themes. They are  X  X mergent X  themes characterized by explosive growth of the number of papers appeared in 2002.
 Let us make a comment on the emergent themes (the fourth group). Based on the appearance of the plots of time de-pendence we speculate that if we would cluster the hep-th citation graph based on the data restricted to the period 1992 X 2001 (we plan to make this exercise), the clusters cor-responding to the emergent themes would not appear at all. In other words, we speculate that the themes of the fourth group were born namely in 2002. The quality of the classification obtained for hep-th can be safely estimated only with an analysis performed by experts in this subject field (see however the Appendix). In this section, we give a formal estimate based on the analysis of the citation graph itself. In [3], in the context of web clus-tering, the notion of  X  X deal community X  was introduced. It is a subset of vertexes with the following property: the sum of weights of the inner outgoing links is bigger than the sum of weights of the outer outgoing links. Here the inner links join the vertexes of the  X  X deal community X  subset, and the outer links are the links starting at the subset, and going out of it. In line with this definition, we computed the so-called  X  X ommunity index X , which is the ratio of the sum of weights of the inner links of a cluster to the sum of weights of the inner and outer links. If the community index ex-ceeds 0.5, the community is ideal; the larger the community index, the more ideal is the community. As an overall char-acterisitc, a weighted mean value of the community index over all the clusters was computed. Table 2 gives the values of the community index for the themes of the second level of the hierarchy. As seen, 18 of the 19 themes comply with the formal defintion of the ideal community. The weighted mean value of the community index is 0.88 for the themes of the second level. The situation is less satisfactory for the themes of the first hierarchy level. About half of the themes of the first level comply with the definition of the ideal community. Despite this, the weighted mean value of the communtiy index exceeds 0.5 at this level also. It is 0.58. The problem of presenting a theme was not a central one for this experiment. Despite this, we gave the themes a num-ber of attributes helping to grasp the content of a theme, and recognize it. The list of themes with their attributes is available at http://hepstructure.inr.ac.ru/hep-th/ . Specifically, the following attributes were determined for each theme: To summarize, we suggested a new method of hierarchical clustering of directed graphs. There is a free parameter in the method, the minimal acceptable number of vertexes in a cluster. Qualitative features of the dependence of the re-sulting number of hierarchy levels on this parameter allows setting it to a certain interval of natural values. The time complexity of the algorithm is at worst quadratic in the number of vertexes in the graph.
 We applied the method to the hep-th citation graph. In this application the weight of the links was defined as a linear combination of the co-citation and bibliographic coupling. The outcome is a two-level hierarchy of themes present in hep-th .
 We list below a number of problems for the future. It would be interesting to study the dependence of the clus-tering on the weight function. (We assume here that the weight function is a function of the graph.) We performed a preliminary study of the clustering dependence on the pa-rameter a involved in the weight function W (see section 3). We observed that for an interval of values of a , factor graph obtained by the clustering is independent of a . How-ever, some of the papers travel from cluster to cluster when a changes.
 Another interesting issue is the hierarchical clustering for random graphs that are popular among physicists [9]. In this case, the distribution of the papers among the clusters, the number of levels in the hierarchy, and other characteristics of the clustering would be random quantities depending on the parameters of the random graph model. For example, we ask what is the difference between the clustering by EqRank of a graph generated by the classical (Poisson) graph models and more realistic models of  X  X mall world X .
 In conclusion, EqRank opens up interesting possibilities in hierarchical clustering of directed graphs. Its use for clus-tering of the hep-th citation graph resulted in a meaninful classification of the papers from hep-th . [1] J.-P. Eckmann and E. Moses. Curvature of co-links un-[2] K. Efe, V. Raghavan, C. H. Chu, A. L. Broadwater, [3] G. Flake, S. Lawrence, and C. L. Giles. Efficient iden-[4] G. W. Flake, K. Tsioutsiouliklis, and R. E. Tarjan. [5] E. Garfield, M. V. Malin, and H. Small. A system for [6] P. Ginsparg. Creating a global knowledge network. [7] M. M. Kessler. Bibliographic coupling between scientific [8] W. Lu, J. Janssen, E. Milios, and N. Japkowicz. Node [9] M. E. J. Newman. The stucture and function of com-[10] A. Popescul, G. Flake, S. Lawrence, L. Ungar, and C. L. [11] A. Popescul and L. H. Ungar. Automatic labeling of [12] H. Small and A. Griffith. The structure of science lit-Seeking for an imitation of an expert estimate of our cluster-ing we selected arbitrarily a theme of the second level, the  X  X tring cosmology X  theme. Google helped to find the home page http://www.ba.infn.it/  X  gasperin/ of M. Gasperini, whose name is among the three top authority authors of the theme. At his page, M. Gasperini says that his page is de-voted to  X  X tring cosmology X . There is a list of more than 100 papers on the subject at the site. We selected the papers from this list that are present in hep-th , and compared the resulting list with the list of papers of the  X  X tring cosmol-ogy X  theme generated by EqRank . It turned out that 84% of the papers selected by M. Gasperini are also selected by EqRank .
 We did the same for a theme of the first level. It was the  X  X wo-time physics X  theme. There is a brief review of this theme on the personal page of Itzhak Bars ( http://physics.usc.edu/  X  bars/twoTph.htm ) who keeps the first position in the list of Authority Authors of the theme. There is a list of 19 papers in the review. All of them were selected by EqRank .
 These facts support our opinion that EqRank generates an adequate classification of hep-th .

