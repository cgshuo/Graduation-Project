 1 In tro duction matc hes. Second, the ratings can b e made a v ailable to the pla y ers and to the in terested of qualication for tournamen ts. With the adv en t of online gaming, the in terest in rating systems has increased dramatically b ecause the qualit y of the online exp erience of millions of pla y ers eac h da y are at stak e.
 In 1959, Arpad Elo dev elop ed a statistical rating system for Chess, whic h w as adopted b y the W orld Chess F ederation FIDE in 1970 [4]. The k ey idea b ehind the Elo system [2] is to where denotes the cum ulativ e densit y of a zero-mean unit-v ariance Gaussian. After the 2 wins and y = 0 if a dra w o ccurs. Then the resulting (linearised) Elo up date is giv en b y s 1 s 1 + y , s 2 s 2 y and where 0 &lt; &lt; 1 determines the w eigh ting of the new evidence v ersus the old estimate. Most curren tly used Elo v arian ts use a logistic distribution instead of a Gaussian b ecause Elo system addresses the problem of estimating from paired comparison data [1] with the Gaussian v arian t corresp onding to the Thurstone Case V mo del and the logistic v arian t to the Br ad ley-T erry mo del.
 than a xed n um b er of, sa y , 20 games. This problem w as addressed b y Mark Glic kman's An imp ortan t new application of skill rating systems are m ultipla y er online games that online games pro vide the follo wing c hallenges: in a principled Ba y esian framew ork. W e express the mo del as a factor graph (Section 2) and use appro ximate message passing (Section 3) to infer the marginal b elief distribution on our exp erience with the rating system running in the Xb o x Liv e service. 2 F actor Graphs for Ranking sp ecied b y a rank r j for eac h team j , with r = 1 indicating the winner and with the the p osterior distribution W e assume a factorising Gaussian prior distribution, p ( s ) := skill s i with xed v ariance 2 . The p erformance t j of team j is mo deled as the sum of the p erformances of its mem b ers, t j := of rank, r (1) r (2) r ( k ) . Disregarding dra ws, the probabilit y of a game outcome r is mo deled as that is, the order of p erformances generates the order in the game outcome. If dra ws are r from the assumed probabilit y of dra w. 1 learning sc heme referred to as Gaussian density ltering [8 ]. The p osterior distribution is appro ximated to b e Gaussian and is used as the prior distribution for the next game. If the the three teams despite the p ossibilit y that j t 1 t 3 j &gt; " . Figure 1: An example T rueSkill factor graph. There are four t yp es of v ariables: s i for game outcome T eam 1 &gt; T eam 2 = T eam 3. The arro ws indicate the optimal message passing sc hedule: First, all ligh t arro w messages are up dated from top to b ottom. In the follo wing, the sc hedule o v er the team p erformance (dierence) no des are iterated in the dark arro w messages from b ottom to top. in tro duced whic h leads to an additiv e v ariance comp onen t of 2 in the subsequen t prior. Let us consider a game with k = 3 teams with team assignmen ts A 1 = f 1 g , A 2 = f 2 ; 3 g and A 3 = f 4 g . Let us further assume that team 1 is the winner and that teams 2 and 3 the factor graph depicted in Figure 1.
 functions asso ciated with eac h factor. The structure of the factor graph giv es information the team p erformances f t i g , Figure 2: Up date rules for the the appro ximate marginals for dieren t v alues of the dra w margin ": F or a t w o-team game, the parameter t represen ts the dierence of team p erfor-mances b et w een winner and loser. Hence, in the win column (left) negativ e v alues of t indicate a surprise outcome leading to a large up date. In the dra w column (righ t) an y stark deviation of team p erformances is surprising and leads to a large up date. 3 Appro ximate Message P assing The sum-pro duct algorithm in its form ulation for factor graphs [7] exploits the sparse con-nection structure of the graph to p erform ecien t inference of single-v ariable marginals b y message passing. The message passing for con tin uous v ariables is c haracterised b y the follo wing equations (these follo w directly from the distributiv e la w): can b e calculated and represen ted exactly then eac h message needs to b e calculated only once and the marginals p ( v k ) can b e calculated from the messages b y virtue of (3). of messages can b e represen ted compactly as 1dimensional Gaussians. Ho w ev er, (4) sho ws dierences d i in Figure 1 are non Gaussianin fact, the true message w ould b e the (non-Gaussian) factor itself.
 F ollo wing the Exp e ctation Pr op agation algorithm [8], w e appro ximate these messages as their canonical parameters: precision, := 2 , and precision adjusted mean, := . The missing up date equation for the message or the marginal follo w from (6). momen t matc hing is kno wn to minimise the Kullbac kLeibler div ergence. Then, w e exploit the fact that from (3) and (5) w e ha v e factor graph. The top four ro ws result from standard Gaussian in tegrals. The b ottom rule is the result of the momen t matc hing pro cedure describ ed ab o v e. The four functions are the additiv e and m ultiplicativ e correction term for the mean and v ariance of a (doubly) truncated Gaussian and are giv en b y (see also Figure 2): Since the messages 2 and 5 are appro ximate, w e need to iterate o v er all messages that are marginals do not c hange an ymore. The resulting optimal message passing sc hedule can b e found in Figure 1 (arro ws and caption). 4 Exp erimen ts and Online Service 4.1 Halo 2 Beta T est In order to assess the p erformance of the T rueSkill algorithm w e p erformed exp erimen ts on the game outcome data set generated b y Bungie Studios during the b eta testing of the Xb o x title Halo 2 2 . The data set consists of thousands of game outcomes for four dieren t teams (empirical dra w probabilit y) and relate the dra w margin " to the c hance of dra wing b y or I ( j j " ) no de (see Figure 1). The p erformance v ariance 2 and the dynamics v ariance 2 w ere set to the standard v alues (see next section). W e compared the T rueSkill algorithm to Elo with a Gaussian p erformance distribution (1) and = 0 : 07 ; this corresp onds to a K factor of 24 on the Elo scale whic h is considered a go o d and stable dynamics (see [4]). When w e had to pro cess a team game or a game with more than t w o teams w e used the so-called duel ling heuristic: F or eac h pla y er, compute the 's in comparison to all other pla y ers based on the team outcome of the pla y er and ev ery other pla y er and p erform an up date with the a v erage of the 's. The appro ximate message passing algorithm describ ed in the last section is extremely ecien t; in all our exp erimen ts the run time of the ranking algorithm w as within t wice the run time of the simple Elo up date.
 Predictiv e P erformance The follo wing table presen ts the prediction error (fraction of teams that w ere predicted in the wrong order b efore the game) for b oth algorithms (column 2 and 3). This measure is dicult to in terpret b ecause of the in terpla y of ranking and prediction error could b e as big as 50%. In order to comp ensate for this laten t, unkno wn whic h games it considered most tigh tly matc hed and presen ted them to the other algorithm. The algorithm that predicts more game outcomes correctly has a b etter abilit y to iden tify tigh t matc hes. F or T rueSkill w e used the matc hmaking criterion (7) and for Elo w e used the dierence in Elo scores, s 1 s 2 .
 F ree for All 32.14% 30.82% 38.30% 35.64% Small T eams 34.92% 35.23% 42.55% 37.17% Head to Head 33.24% 32.44% 40.57% 30.83% Large T eams 39.49% 38.15% 44.12% 29.94% It can b e seen from column 4 and 5 of this table that T rueSkill is signican tly b etter at predicting the tigh t matc hes (the c hallenge set w as alw a ys 20% of the total n um b er of games in eac h game mo de). Matc h Qualit y One of the main applications of a rating system is to b e able to matc h pla y ers of similar skill. In order to com-pare the abilit y of Elo and T rueSkill on this task, w e sorted the games based on the matc h qualit y assigned b y b oth systems to eac h game. If the matc h w as truly tigh t then it w ould b e v ery lik ely to observ e a dra w.
 Th us, w e plot the fraction of dra ws (out of all p ossible dra ws) accum ulating o v er the matc h qualit y order as-signed b y eac h system. In the graph on the righ t w e see that T rueSkill is signican tly b etter than Elo for b oth the F ree for All and Head to Head game mo de but fails in Small T eams. This is p ossibly due to the vio-lation of the additiv e team p erformance mo del as most games in this mo de are Capture-the-Flag games. Win Probabilit y The p erceiv ed qualit y of a rating system for pla y ers is in terms of their winning ratio: if the winning ratio is high then pla y er w as erroneously assigned to o w eak opp osi-tion b y the ranking system (and vice v ersa). In a sec-ond exp erimen t w e pro cessed the Halo 2 dataset but re-jected games that did not meet a certain matc h qualit y threshold. F or the games th us selected, w e computed the winning ratio of eac h pla y er and, dep ending on the minimal n um b er of games pla y ed b y eac h pla y er, mea-sured the a v erage deviation of the winning probabilit y from 50% (the optimal winning ratio). The resulting plot on the righ t (for the Head to Head game mo de) sho ws that with T rueSkill ev er pla y ers with v ery few games got mostly fair matc hes (with a winning proba-bilit y within 35% to 65%). Con v ergence Prop erties Finally , w e plotted t w o exemplary con v ergence tra jec-tories for t w o of the highest rated pla y ers in the F ree for All game mo de (Solid line: T rueSkill; Dashed line: Elo). As can b e seen, T rueSkill automatically c ho oses the correct learning rate whereas Elo only slo wly con-v erges to the target skill. In fact, T rueSkill comes close to the information theoretic limit of n log( n ) bits to en-co de a ranking of n pla y ers. F or 8 pla y er games, the information theoretic limit is log( n ) = log(8) 5 games p er pla y er on a v erage and the observ ed con v ergence for these t w o pla y ers is 10 games! 4.2 T rueSkill in Xb o x 360 Liv e the w orld in h undreds of dieren t titles. As of Septem b er 2005 Xb o x Liv e had o v er 2 million subscrib ed users who had accrued o v er 1.3 billion hours on the service. The new and impro v ed Xb o x 360 Liv e service oers automatic pla y er rating and matc hmaking using the T rueSkill algorithm. The system pro cesses h undreds of thousands of games p er da y making it one of the largest applications of Ba y esian inference to date.
 pla y ers according to 3 ) are only p opulated b y pla y ers that are highly skilled with high highest p ossible dra w probabilit y in the limit " ! 0 , the goals of matc hmaking and nding the most informativ e matc hes are aligned! the v ast amoun t of resulting data, w e ha v e already made some in teresting observ ations. 5 Conclusion system and has b een demonstrated to w ork w ell in practice.
 While w e sp ecically fo cused on the T rueSkill algorithm, man y more in teresting mo dels can b e dev elop ed within the factor graph framew ork presen ted here. In particular, the factor graph form ulation is applicable to the family of constrain t classication mo dels [6] that encompass a wide range of m ulticlass and ranking problems. Also, instead of ranking represen ted as bags-of-w ords. Finally , w e are planning to run a full time-indep enden t EP analysis across c hess games to obtain T rueSkill ratings for c hess masters of all times. for in teresting discussions. W e also thank Bungie Studios for pro viding the data. References [3] V. V. F edoro v. The ory of optimal exp eriments . A cademic Press, New Y ork, 1972.
