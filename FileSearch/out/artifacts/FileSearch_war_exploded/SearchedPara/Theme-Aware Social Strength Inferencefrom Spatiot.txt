 A variety of geo-social networks such as Foursquare[8] have been emerged with ubiquity of smart mobile devices and popularity of location based services such as check-in service. As rich spatiotemporal data, which consists of people X  X  record with location tag and timestamp are bein g produced, behaviors of human beings associated with them make it possible to i nvestigate social strength, which is the likelihood to be friends, between a pair of persons. The knowledge of social strength among people can be used to a wide range of applications such as friend recommendation in social networks or target advertisement for Internet companies[10].

There has been much efforts devoting to inferring social strength from spa-tiotemporal data. The general idea is that visiting locations together contributes to strong social strength and especially in the state-of-the-art method, visiting public locations together contributes less to social strength and visiting non-public locations implies strong social strength. In Figure 1(a), two persons vis-ited two public locations together and thus are regarded as owning weak social strength. In fact, they are good friends and first played together in amusement park in the morning and spent evening hours in cafe as Figure 1(b) illustrated. From this example, we can see existing me thods make wrong estimation because (1)they ignore not only non-public locations implies strong social strength. Pub-lic locations also indicate strong social strength in this example. (2)they ignore the visiting time implies social strength. For example, co-occurrence at cafe at morning may mean that persons are co-workers and own weak social strength. On the other hand, at night, visiting cafe together implies strong social strength. These two drawbacks yield the wrong estimation in the example above.
In this paper, we proposed a Theme Aw are social strength Inference ap-proach(TAI) to overcome drawbacks in the previous approaches. In TAI, we first define co-occurrence as visiting in the same SW. Judging co-occurrence by SW rather than exact location and timestamp can avoid judging mistakes at persons who actually co-occurred but repo rted their location at different time. For each pair of persons, their co-occurrence behavior indicates the probability for them to co-occur at SWs. The core of TAI approach is identifying that if a few themes take different proportion, they can generate various co-occurrence behav-iors. Here, each theme has different te ndencies to co-occur at certain SWs. We use topic model[18] to mine themes by regarding themes as topics, co-occurrence behaviors as documents and SWs as words. Further, we exploit social connec-tion graph to train each theme with its contribution to social strength. In this way, we can infer social strength by first decompose co-occurrence behavior into themes with different proportion and sum the weighted contribution of themes. For example, there are two themes like  X  X laying X  and  X  X ating X , both strongly contribute to social strength. The former tends to visit amusement park and the latter tends to visit cafe at night. Co-occurrence behavior in the example above can be considered to be generated by th ese two themes uniformly and the in-ferred social strength is the average of contribution of these two themes to social strength and thus leads to correct strong social strength. Therefore, TAI ap-proach determines location X  X  contribution in context of co-occurrence behavior, and visiting time is considered in SW and thus drawbacks are overcome.
Naturally, a critical issue in mining themes is to detect spatiotemporal win-dow(SW). For each location, we define SW by assigning them with several dis-joint time windows. The time window in each SW can neither be too long or too short. To find proper SWs, we adopt the concept of tf-idf of time window[15] and propose a novel dynamic programming algorithm. Extensive experiments are conducted on real dataset including both location data and social connection graphs. Our method to find optimal spatiotemporal points is shown to improve effectiveness of social strength infer ence; that is about 10% more precise than the state-of-the-art approach.

Our contributions are as follows:  X  For the first time, we introduce themes to generate co-occurrence behaviors  X  We mine themes via topic model and train their contributions to infer social  X  Tf-idf concept is integrated into tim e window to detect SWs and we propose  X  Extensive experiments are conducted on real dataset and accuracy of our
The rest of this paper is organized as follows. Section 2 presents problem definition and related works. Section 3 describes our TAI approach. Section 4 shows how to detect SWs. Section 5 conducts extensive experiments. At last, we conclude this paper in Section 6. In this section, we first present formal definition of social strength inference problem and then provide a brief summary of existing methods. 2.1 Problem Statement Location data reported by check-in service is a triplet User,Location, Timestamp , which contains person identifier, location identifier 1 and a times-tamp. After obtaining SWs that are describ ed in Section 4, we obtain co-occurrence behavior between a pair of persons by counting co-occurrence at every SW and dividing them by the total count. For example, for persons in Figure 1, their co-occurrence behavior is ( 1 2 , 1 2 )=(0 . 5 , 0 . 5).

Assume there are N SWs and we denote probability to co-occur at SW i as p i , the formal definition of social strength inference problem from spatiotemporal data is as follows: Definition 1. Given co-occurrence behavior of a pair of persons ( p 1 , ..., p n ) ,the problem is to infer a value to tell the likelihood for this pair of persons to be friends. 2.2 Related Works Previous studies can be categorized into trajectory based methods and location based methods. The common idea among them is to exploit co-occurrence. trajectory Based Methods. Trajectory based methods[1][2][3] relax the con-cept of co-occurrence and use similarity in trajectory to measure likelihood of friendship of a pair of persons. [1] predicts friendship between a pair of persons by measuring similarity of their location sequence pattern. It su mmarizes each person X  X  location sequence pattern into several stay points, each of which stands for a set of record referring to the same person within a given size of region and a time interval. Then, each person X  X  stay points are clustered into several hierarchies and similarity is measured based on this hierarchical clu ster structure. [2] a ssociates each stay point with a pre-defined tags and similarity are measured based on these tags. [3] assigns each stay point to different tags with different weights.
These methods reveal that similarity in trajectory indicates people X  X  friend-ship. However, similarity in trajectory d oes not necessarily mean co-occurrence and such methods suffer from mistakes in detecting stay points.
 Location Based Methods. Location based methods[6][4][5] utilize exact co-occurrence behavior. [6] confirms co-occurrence contributes positively to social ties by conduct-ing experiments over 38 million geo-tagge d photos from a geo-social network Flickr[7]. [4] therefore seeks for features of co-occurrence to infer friendship. It finds that the number of distinct locations and duration length of co-occurrence are useful features. Furthermore, [4] finds that frequent co-occurrence at public location may come from coincidence and features above suffers from data sparse-ness. To tackle these issues, location entro py is introduced. That is, each location is assigned a weight, which is less if more people visit this location. [5] further infers social strength rather than just classifying a pair of people as friends or not. [9] considers different location weights by introducing manually categorized tags for each location.

Location based methods have been show n to improve accuracy of social rela-tionship estimation than trajectory based methods because of exploitation fea-tures of co-occurrence and characteristic s of locations. However, effectiveness of existing methods suffers from determining location X  X  contribution simply by its popularity and ignoring effect of time in co-occurrence. In contrast, our ap-proach determines location X  X  contribution in themes and visiting time is taken into consideration and th erefore overcomes the drawbacks in previous works. In this section, we first introduce an overview for social strength inference. Next, details about mining themes are presented. Finally, we discuss how to infer social strength between a given pair of persons. 3.1 Overview As Figure 2 illustrates, the inference of social strength consists of four phases: (1)detect SWs; (2)extract themes; (3)train each theme with its contribution to social strength and (4)given co-occurrence behavior of a pair of persons, calculate their social strength.

We discuss SW detection in section 4 and the following paragraphs assume we have obtained proper SWs and can deter mine co-occurrence behaviors among persons. Next, we extract themes that ca n generate the set of all co-occurrence behaviors. This routine will be discussed in detail in Section 3 . 2 and briefly, each theme has its own flavor to co-occur at cer tain SWs. Then, for training contri-bution for each theme, co-occurrence beh aviors of persons in training data are decomposed into themes with different pr oportion. Themes X  X ontribution to so-cial strength are obtained from social strength calculated from social connection graph of persons in training data as Section 5 . 3 discusses. Finally, as presented in Section 3 . 3, social strength is inferred given a pair of persons X  co-occurrence behavior.

In the example above, suppose there are only 2 SWs such as sw 1 = amusement park,[8:00 , 9:00] and sw 2 = cafe,[20:00 , 21:00] and only two themes are ex-behavior between person 1 and 2 can be represented by { 0 . 5 , 0 . 5 } and can be viewed as generated by two themes with 50% proportion each respectively. If the former theme contributes 0 . 7 to social strength and the latter contributes 0 . 9, we can estimate the social strength by 50%  X  0 . 7 + 50%  X  0 . 9=0 . 8, which is a relative strong indication for both person to be friends.

So far, we have introduced the TAI approach and in the next sections, we will describe the four routines outlined in the framework in detail. 3.2 Mining Themes In this section, we describe the generat ion of co-occurrence behaviors by themes and show the topic model used to mine themes.

We formally define theme, co-occurrenc e behavior and the generation phase by notations listed in Table 1. Themes are different probabilistic distributions overallSWs.Assumethereare K themes and N SWs, we represent themes in a K  X  N matrix  X  ,where  X  k represents the k th theme and  X  k,n indicates the probability for theme k to generate a co-occurrence at SW n .Ifthereare D co-occurrence behaviors, we represent them in a D  X  N matrix w ,where w d is d th pair of persons X  co-occurrence behavior and w d,n stands for the probability for them to co-occur at SW n . We mention co-occurrence behavior is generated by themes with different proportion, and it can be represented by a D  X  K matrix  X  , where  X  d is the theme proportion that generates the w d and  X  d,k is the proportion the theme k takes in the d th co-occurrence behavior. In addition, SWs in co-occurrence behaviors own a D  X  N matrix z ,where z d is theme assignment for co-occurrence behavior d  X  X  SWs, where z d,n is the theme assigned to the SW n in co-occurrence behavior d .

Given notations above, the following generative model describes how themes are used to generate co-occurrence behaviors.  X  For each theme k ,draw  X  k  X  Dir (  X  )  X  Given co-occurrence behavior d ,draw  X  d  X  Dir (  X  ).  X  For SW n in co-occurrence behavior d ,
The process is the same as the document generation in topic model, if we view themes as topics, co-occurrence behav iors as documents and SWs as words. In fact,  X  and  X  are parameters learnt by topic model, Dir (  X  ) is the Dirichlet distribution and Multi (  X  ) is the multinomial distribution. In this paper, we use Gibbs sampling[14] to implement the learning of LDA[13], a widely used variant of topic model.

After obtaining themes and their proportion on each pair of persons, we will describe how to train the themes with their contribution to social strength and use them to infer social strength in the next section. 3.3 Social Strength In this section, we first introduce how to assign a contribution to each theme and infer social strength then.
 Geo-social network provides both check-in records and social connection graph. In section 5 . 3, we will show several methods to obtain social strength based on purely the graph. Here, we just assume we have obtained a D -dimension vector ss ,where ss d is a calculated social strengt h for co-occurrence behavior d . Then, we simply use linear regression to calculate the K -dimension cont ribution vector ct ,where ct k is the contribution score of the theme k . That is, we use incremental gradient descent algorithm[17] to obtain such contribution vector ct 1 , ..., ct K
Given a pair of persons and their co-occurrence behavior w = w 1 , ..., w N ,we first decompose it into combination of th emes. Namely, we obtain theme X  X  pro-is minimized. Then, the corresponding social strength is inferred as K i =1 tp i ct i . In this section, we introduce tf-idf concept to determine proper SWs and prove there exists a optimal substructure for finding proper SWs and thus propose a dynamic programming algorithm to implement the detection. 4.1 Tf-idf for Time Window For each location, we use several disjoint SW to cover all timestamps on it. Naturally, the time window in each SW should not be too large so to contain all timestamps and too small to contain no timestamp. A tf-idf weight for time window is used to measure how many timestamps a time windows contained in unit length[15]. We partition the time line into several disjoint time windows for each location and thus define SW correspondingly. The goal is to maximize the should be larger than any other possible time window partitions. Therefore, the problem of detecting SWs reduces to th e problem of Time Window Determina-tion. 4.2 Time Window Determination In this section, we first show that the Time Window Determine problem exists an optimal substructure. Thus, we propose a dynamic programming algorithm to find the time windows that maximize the sum of tf-idf weighting.
 Theorem 1. For a set of timestamps { t 0 , ..., t m } , if time windows { [ t 0 ,t k ] , [ t ,t m ] } maximize the sum of tf-idf weighting over all possible time windows, [ t ,t k ] and [ t k ,t m ] maximize tf-idf weighting over all possible time windows on { t 0 , ..., t k [ t ,t k ] .tf idf +[ t k ,t m ] .tf idf , which conflicts with assumption.
Theorem 1 shows the problem of finding optimal time windows has an op-timal substructure and therefore allows us to propose a dynamic programming algorithm to find the optimal partition as Algorithm 1 shows.
 Algorithm 1. Time Windows Finding Algorithm
Though the algorithm above, we obtain a binary tree rooted by t[0, m]. The mid-order traversal started from t[0, m] can obtain the final time windows at leaf node. In this section, we first describe the dataset and measurement of social strength inference approaches. Next, details of calculating social strength from purely so-cial connection graph and the phase for model training are discussed. Finally, we compare TAI approach with several existing promising methods to demonstrate its effectiveness. 5.1 Settings We conduct our experiments on a real dataset collected from Foursqaures[16], a location based social network, where us ers report their location and timestamp by check-in service. This dataset contains more than 200 million check-in records of over 180 thousands people in the form of UserId, Location Id, latitude, longi-tude, timestamp . Besides, this dataset contains social connection graph among these users. 5.2 Methodology Given social connecting graph, we pick up a person and his friends to test whether approaches can estimate the frie ndship among him and his real friends. We use three metrics to measure effectiv eness of our approach. They are pre-cision, recall and friendship percent age. Since our method only produce a so-cial strength score, we set a threshold S such that when the estimated social strength score is larger than S , the corresponding pair of persons is estimated to be friends. The threshold S is determined by varying from 0 to 1 with a step of 0 . 001. The value that results in optimal accuracy in training dataset is picked up as S . The third metric, friendship percent age is used to measure effectiveness of social strength. Since larger social st rength score means larger likelihood to be friends, we check the friendship percentage over each social strength score and evaluate effectiveness of social strength score. 5.3 Social Strength in Training Data In this part, we present how to calculate social strength to assign contribution scores to themes in Section 3 . 3. Jaccard X  X  index, Adamic/Adar similarity and Katz score are used to calculate social strength by the graph. Jaccard X  X  In-dex measures social strength by the ratio of common friends over total friends. Adamic/Adar similarity further considers the popularity of common friends. Katz score calculate social strength b etween persons without direct common friends. 5.4 Model Training Model training consists of two phases:(1)Gibbs sampling is used to obtain the themes and their proportion over co-o ccurrence behaviors;(2)Pick one of the three social strength scores calculated i n previous section to a ssign contribution to themes.
 Gibbs Sampling. Gibbs sampling[14] is a robust and widely used technique to train topic model. We just need to specify a proper value as the number of themes. In this paper, we vary the number of themes, from 5 with a step of 5. For each value, we train a model for 1000 iterations.

Figure 3 illustrates that 25 is an appropriate value for the number of themes in our dataset. It can be seen that all 6 curves peak with 25 to be the number of themes. In fact, this indicates people X  s co-occurrence behaviors consists of 25 different themes. When we use less than 25 themes to train the model, different themes that contributes differently to so cial strength will be merged and error will happen. When the number is larger than 25, precision and recall suffers from training model without sufficient data. Effect of SW. In this section, we show regarding people visiting locations in the same SW as co-occurrence improves eff ectiveness than judging co-occurrence by exact timestamp in check-in record s. Figure 4 shows that without SW, both precision and recall are much lower than experiment results in Figure 3 and the number of themes where the precision gets peak also increases. Figure 4 shows, without SW, more themes are min ed because the number of themes where precision gets peak increases. Howeve r, the consequence is that data become insufficient to train such model and thus both precision and recall deteriorate. Social Strength Score. In this part, we measure effect iveness of social strength score. The criteria is that higher social s trength score should yield more percent-age of actual friends. The experiment results show social strength score obtained by Katz score outperforms other two methods.

Figure 5 illustrates the experiment results. First, we can see that social strength is consistent with actual friendship. That is, in all three methods, higher social strength score yields higher friendship percentage. On the other hand, because Kazt score is better than the other two methods in terms of social strength es-timation, curves in Figure 5(c) are more smooth and estimation by the model trained by it is more accurate. Because Jaccard X  X  Index is the worst approach, its curves are most fluctuated. 5.5 Comparison Using precision and recall metrics, we compare the effectiveness of our TAI ap-proach with two representative promising m odels, which are the-state-of-the-art location based entropy based model(EBM )[5] and trajectory based trajectory model(TR)[1]. Experiment results show our TAI model outperforms other meth-ods by 5% to 15% in precision under the same recall.

In figure 6, we can see TAI approach outperforms the existing methods in terms of both precision and recall. Unde r the same recall, TAI is 5% to 15% more precise than others. This is because it considers the contribution of location in context of themes and visiting ti me is considered in inference. In this paper, we propose a Theme-aware s ocial strength Infer ence (TAI)approach to infer social strength. TAI approach min es themes that generate co-occurrence behaviors by different proportion and train each theme with its contribution to social strength, which fits intuition and overcomes drawbacks in previous works. TAI approach employs tf-idf concept for time window and proposes a novel dy-namic programming algorithm to obtain optimal SWs for a location. Extensive experiments are conducted to show TAI approach outperforms other represen-tative methods by 5% to 15% in precision under the same recall.

In the future, we will investigate further in detecting SWs with overlapping time window rather than disjoint time window in this paper. In addition, we will try other topic models such as probabilistic latent semantic indexing. Acknowledgments. We thank Jialong Han for his helpful discussions. This work was partially supported by the Fundamental Research Funds for the Cen-tral Universities, and the Research Funds of Renmin University of China under grant No. 14XNH115, the National Key Basic Research Program (973 Program) of China under grant No. 2014CB340403 an d the Fundamental Research Funds for the Central Universities, and the Research Funds of Renmin University of China (10XNI018).

