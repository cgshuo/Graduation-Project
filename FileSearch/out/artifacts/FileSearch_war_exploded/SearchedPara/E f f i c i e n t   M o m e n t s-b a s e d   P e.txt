 University of Illinois at Urbana -Champaign No rth Carolina State University Permutation tests are flexible nonparametric alternatives to parametric tests in small samples, or when the distribution of a test statistic is unknown or mathematically intractable. In permutatio n tests, except exchangeability, no other statistical assumptions are required. The p -values can be obtained by using the permutation distribution. Permutation tests are appealing in many biomedical studies, which often have limited observations with unkno wn functional MR image analysis [4] , and in 3D face analysis [5].
 There are three common approaches to construct the permutation distribution [6, 7, 8] : (1) exact permutation enumerating all possible arrangements; (2) approximate permutation based on random sampling from all possible permutations; (3) approximate permutation using the analytical moments of the exact permutation distribution under the null hypothesi s. The main disadvantage of the exact permutation is the computational cost, due to the factorial increase in the number of permutations with the increasing number of subjects. The second technique often gives inflated type I errors caused by random sampli ng. When a large computational ly expensive to achieve satisfactory accuracy. Regarding the third approach, the exact permutation distribution may not have moments or moments with tractability. In approach. To the best of our knowledge, there is no systematic and efficient way to derive the moments of the permutation distribution. Recentl y, Zhou [3] proposed a solution by converting the permutation of data to that of the statistic coefficients that are symmetric to the permutation. Since the test statistic coefficients usually have simple presentations, it is easier to track the permutatio n of the test statistic coefficients than that of data. However, this method requires practical users.
 In this paper, we propose a novel strategy by employing a general theoretical method to derive the moments of the permutation distribution of any weighted v -statistics, for both univariate and multivariate data. We note that any moments of the permutation distribution for weighted v -statistics [9] can be consider ed as a summation of the product of data function term and index function term over a high dimensional index set and all possible permutations. Our key idea is to divide the whole index set into several permutation equivalent (see D efinition 2) index subse ts such that the summation of the data /index function term over all permutations is invariant within each subset and can be calculated without conducting any permutation. Then we can obtain the moments by summing up several subtotals. The proposed method c an be extended to equivalent weighted v -statistics by replacing them with monotonic weighted v -statistics. This is due to the fact that only the monotonic weighted v -statistics shares the same p -value with the original test statistic . Given the first four moments, the permutation distribution can be well fitted by Pearson distribution series. The p -values are then obtained without conducting any real permutation. Fo r multiple comparison of two -group difference, given the sample size n 1 = 21 and n 2 = 21, permutations for the exact permutation test. Even for 20,000 random permutations per test, we still need m  X 20 , 000  X  4 X 10 7 permutations. Alternatively, our moments -based permutation method using Pear son distribution approximation only involves th e calculation of the first four analytically -derived moments of exact permutation distributions to achieve high permutation, our moments -based permutation only r equires computation of polynomial order. For example, the computational cost for univariate mean difference test statistic and n = n 1 + n 2 . In th is section, we shall mainly discuss how to calculate the moments of the permutation replace them with their equivalent weighted v -statistics by monotonic transfor ms. The detailed discuss ion about equivalent test statistics can be found in [7, 8, 10]. 2 . 1 C o m p u t a t i o n a l c h a l l e n g e x x x x x + + = L L , where the first n 1 elements are in group A and the rest , n 2 , are 
H m m = vs. : a A B H m m  X  , where , A B m m are the population means of the groups A and B, respectively. Define 1 1 groups , where n = n 1 + n 2 . We choose the univariate group mean difference as the test statistic, i.e., distributio n, 
E T x w i x w i w i w i w i x x x x where  X  is the permutation operator and the symmetric group S n [11] includes all distinct permutations. The above example shows that the moment calculation can be considered as a summation over all possible permutations and a large index set. It is notice able th at the computational challenge here is to go through the factorial level permutations and polynomial level indices. 2 . 2 P a r t i t i o n t h e i n d e x s e t In this paper, we assume that the test statistic T can be expressed as a weighted v -statistic of degree d [9] , that is, for our method, it helps reduce the computational cost. Here, each observation k x can be either univariate or multivariate. In the above toy example, d =1 and h is the identity function. Therefore, the r -th moment of the test statistic from the permutated data is: Then we can exchange the summation order of permutations and that of indices, Thus any moment of permutation distribution can be cons idered as a summation of the product of data function term and index function term over a high dimensional index set and all possible permutations. Since all possible permutations map any index value between 1 and n to all possible index data function over all permutations is only related to the equal/unequal relationship among is invariant .
 are said to be equivalent if t hey are the same up to the order. For example, for d = 3, (1, 4, 5) = (1,5,4) = (4,1,5) = (4,5,1) = (5,1,4) = (5,4,1).
 p p p p = L L L L L L . Here "=" means they (  X  (2),  X  (3))} = {(1, 4), (4, 2)}= {(2, 4), (1, 4)}. As a result, the whole index set for d = 2, r = where [ ] denotes the equivalence class. Note that the number of the permutation equivalent subsets is only related to the order of weighted v -test statistic d and the order of moment r , (small r ) with low order test statistics (small d ) .
 Using the permutation equivalent relationship defined in D efinition 2, the whole index se t U can be partitioned into several permutation equivalent index subsets. Then we can calculate the r -th moment by summing up subtotals of all index subsets. This procedure can be done without any real permutations based on Proposition 1 and Proposition 2 below.
 Proposition 1 . We claim that the data function sum ( ) ( ) within each equivalent index subset, and
E h x x permutation equivalent index subset (1) (1) ( ) ( ) 1 1 [{( , , ), , ( , , )}] r r d d i i i i L L L . Proof sketch : Since all indices in the same permutation equivalent subset are equivalent with respect to the symmetric group S n , Proposition 2 . Thus we can obtain the r -th moment by sum ming up the production of the data partition sum w l and the index partition sum h l over all permutation equivalent subsets , i.e.,
E T x w h equivalent classes of U . The data partition sum is h w w x x Proof sketch : subset , therefore, Since both data partition sum w l and the index partition sum h l can be calculated by summation over all distinct indices within each permutation equivalent index subset, no an y real permutation is needed for computing the moments. 2 . 3 R e c u r s i v e c a l c u l a t i o n Direc t calculation of the data partition sum and index partition sum leads to travers ing shall discuss how to reduce the cost by a recursive calculation algorithm .
 l and n are two different permutation equivalent subsets of the whole index set U . W e say by merg ing two or more index elements. For instance, [(1,1), (2, 3)] [(1, 2), (3, 4)] , n l = = p since by merging 1 and 2 , l is converted to [{(1, 1), (3, 4)}] = [{(1, 1), (2, 3)}]. [{(1, 1), (3, 4)}] and [{(1, 1), (2, 3)}] are the same permutation equivalent index subset s because we can operation may not be unique, for example, n can also be converted to l by merg ing 3 and r =2 in figure 1 . The partition order of a permutation equivalent subset n is said to be lower than that of another permutation equivalent subset l if there is a directed path from l to n . The difficulty for computing data partition sum and index partition sum comes from two constraints ; equal constraint and unequal constrain t. For example, in the permutation equivalent subset [{(1, 1), (2, 2)}] , the equal constraint is that the first and the second index number are equal and the third and fourth index are also equal. On the other hand, the last two. Due to the difficulties mentioned, we solve this problem by first relaxing the unequal constraint and then applying the principle of inclusion and exclusion. Thus, the calculation of a part ition sum can be separated into two parts: the relaxed partition sum without unequal constraint, and lower order partition sums. For example, w w i i w j j w w = -= - X   X   X   X  , as the relaxed index partition w w w permutation equivalent subset s . Fo r example, there are 2!2!2!/2!/2! = 2 order -sensitive index merging a higher order permutation equivalent subset l to a low order permutation equivalent subset n .
 The calculation of the data index partition sum is similar. Therefore, the computational cost mainly depends on the calculation of relaxed partition sum and the lowest order partition sum. Since the computational cost of the lowest order term is O ( n ) , w e mainly discuss the calculation of relaxed partition sums in the following paragraphs.
 To reduce the computational cost, we develop a greedy graph search algorithm. For demonstration, we use the following example. w w i i w i j w i j w i k w j k w i l l l = =  X  . T he permuta tion equivalent index subset is represent ed by an undirected graph. Every node denotes an index denotes that the pair ( i, j ) is used t wice. The self -connected node is also allowed. We assume there is no isolated subgraph in the following discussion. If any isolated subgraph exists, we only need to repeat the same procedure fo r all isolated subgraphs. the weights o f edges and self -connections , i.e., = ( , ) ( , ) ( , ) c i j w i k w j k =  X  . Finally, we clear t he whole graph and obtain the relaxed index partition sum. connected. Hence, the computatio nal cost of * c l is determined by the subtotal that has the largest symmetric subgraph in its graph representation. For example, the most expensive relaxed index representation.
 partition sum is O(n) .
 Specifically, the computational cost of the 3rd and 4th moments for a second order test statistic is O(n 3 ). The computational cost for the 1st and 2nd moments is O(n 2 ) . 2 . 4 F i t t i n g including normal, beta, gamma, log -normal , and etc., where d istribution shape parameters  X  1,  X  2 are the square of standardized skewness and kurtosis measurements, respectively. Given the first four moments, the Pearson distribution series can be utilized to approximate the permutation distribution of the test stati stic without conducting real permutation . To evaluate the accuracy and efficiency of our moments -based permutation tests, we generate con sider six simulated cases in the first experiment for testing the difference between two groups , independently from Normal(0,1) in Cases 1 -2, from Gamma(3,3) in Cas es 3 -4, and from Beta(0.8, 0.8) in Cases 5 -6. For group B, n 2 independent observations are generated from Normal(1, 0.5) in = 18. comparing with exact permutation or random 10,000 permutations, the moments -based permutati on tests reduce more than 99.8% of the computation cost, and this efficiency gain increases with sample size. Table 1 shows the computation time and p -values of three permutation methods from one simulation. In order to demonstrate the robustness of our me thod, we repeated less biased and more stable than random permutation (Table 2), which demonstrates the robustness and accuracy of our method.
 Table 1: Comparison of computation costs and p -values of three permutation methods: Mome nts -based permutation (MP), random permutation (RP) , and exact permutation (EP). The t _MP, t _RP , and t _EP denote the computation time (in seconds), and p _MP, p _RP , and p _EP are the p -values of the three permutation methods.
 We consider three simulated cases in the second experiment for testing the difference among three generated independently from Normal(0,1) in Case 7, from Gamma(3,2) in Case 8, and from Beta(0.8, 0.8) in Case 9. For group E, n 2 independent observations are generated from Normal(0,1) in Case 7, from Gamma(3,2) in Case 8, and from Beta(0.8, 0.8) in Case 9. For group F, n 3 independent observations are generated from Normal(0.1,1) in Case 7, from Gamma(3,1) in Case permutations (EP) as gold standard. Our methods are more than one hundred times faster than 2,000 random permutation (RP) and also more accurate and robust (Table 3).
 We applied the method to the MRI hi ppocampi belonging to 2 groups , with 21 subjects in group A and 15 in group B. The surface shapes of different objects are represented by the same number of location vectors (with each location vector consisting of the spatial x , y , and z coordinates of th e corresponding vertex) for our subsequent statistical shape analysis. mean between two groups. Evaluation of the hypothesis test using our moments -based permutati on with the modified Hotelling  X  s T 2 test statistics [8] is shown in Fig . 3(a) and 3 (b). It can be seen that the Pearson distribution approximation leads to ignorable discrepancy with the raw p -value map from real permutation. The false positive error contr ol results are shown in Fig . 3(c).
 Table 2: Robustness and accuracy comparison of moments -based permutation and random permutation across 10 simulations, considering the p -values of exact permutation as gold standard. Mean_ABias_MP and VAR_MP are the mean of the absolute biases and the variance of the biases of p -values of moments -based permutation; Mean_ABias_RP and VAR_RP are the mean of the absolute biases and the variance of the biases of p -values of random permutation. Mean difference statistic is used .
 Table 3: Computation cost, robustness , and accuracy comparison of moments -based permutation and random permutation across 10 simulations. Modified F statistic is used.
 Figure 3. (a) and (b): Comparison of techniques in raw p -value measurement at 10,000) and using the present moments -based permutation (b). (c) p -map after BH  X  s FDR correction of (b) . (e) Facial differences between Asian male and white male. Locations in red on the 3D surface denote significant face shape differences (significance level  X  = 0.01 with false discover y rate contr ol).
 We also applied our method to the 3D face comparison between Asian males and white males. We choose 10 Asian males and 10 white males out of the USF face database to is represented by 4,000 voxels. All surfaces are well aligned. Results from our algorithm in They are consistent with anthropology findings and suggest the discriminant surface regions for ethnic group recognition. We present and develop novel moments -based permutation tests where the permutation distributions are accurately approximated through Pearson distributions for considerably reduce d computation cost. Comparing with regular random permutation, t he proposed method considerably reduces computation cost without loss of accuracy. General and analytical formulations for the moments of permutation distribution are derived for weighted v -test statistics. The proposed strategy takes advantage of nonparametric permutation tests and parametric Pearson distribution approximation to achieve both accuracy/flexibility and efficiency. R e f e r e n c e s [1] Nichols, T. E., and A. P. Holmes (2001), Nonp arametric permutation tests for [2] Zhou, C., D. C. Park, M. Styner, and Y. M. Wang (2007), ROI constrained statistical [3] Zhou, C., and Y. M. Wang (2008), Hybrid permutation test with application to [4] Pantazis, D., R. M. Leahy, T. E. Nichols, and M. Styner (2004), Statistical surface -[5] Zhou, C., Y. Hu, Y. Fu., H. Wang, Y. M. Wang, and T. S. Huang (2008), 3D face [6] Hubert, L. (1987), Assignment Methods in Combinatorial Data Analysis , Mar cel [7] Miel ke, P. W., and K. J. Berry (2001), Permutation Methods: A Distance Function [8] Good, P. (2005), Permutation, Parametric and Bootstrap Tests of Hypotheses , 3rd [9] Serfling, R. J. (1980), Approximatio n Theorems of Mathematical Statistics , Wiley, [10 ] Edgington, E., and P. Onghena (2007), Randomization Tests , 4th ed., Chapman &amp; [11] Nicholson, W. K. (2006), Introduction to Abstract Algebra , 3rd ed., Wiley, New [12 ] Hahn, G. J., and S. S. Shapiro (1967), Statistical Models in Engineering , John Wiley 
