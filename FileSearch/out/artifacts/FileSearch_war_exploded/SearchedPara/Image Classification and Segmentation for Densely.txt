 The size, shape and texture of aggregates are very important characteristics of the physical properties for the geology research and aggregate production industry and mining industry. In mining, the size and shape distributions of fragments affect not only rock blasting, but also the whole mining production sequence. In the quarry manufacture, the size, shape and texture of aggregate must fit the requirements of customers, such as high-way and rail way construction companies, the different com-panies in the building industries, etc. In geology, the size, shape and texture of gravel and sedimentary deposits are often used for analyzing and describing local geological properties in a certain region. Hence, aggregate size, shape and texture are widely applied and studied in both industries and research organizations. 
The traditional way of determining size distributions of aggregate material is by sieving. Sieving has some problems. Think of elongated particles that may pass a image analysis gives better information on the true size (and shape!) grading of ag-gregate. In industry and the lab image analysis is increasingly used to measure size and shape of aggregate transported on container belts. The method is accurate, be-cause many particles are being processed by the images (&gt; 10.000 data are needed to obtain sufficient accuracy). 
Image interpretation is especially helpful when dealing with large size aggregates or rock blocks, those are not always easy to weigh or sieve. Image analysis is cur-rently used to assess rock aggregates by blasting. Therefore, this research subject systems have been developed for measuring aggregates in different application environments (Fig. 1) such as aggregates on/in gravitational flows, conveyor belts, muckpiles, and laboratories. The research and development has been and is being carried out in many countries, the detailed information can be found in [2-5]. 
The common problem for the research and development is to delineate every rock aggregate, but in most industrial cases, rock aggregate images are difficult to segment due to rough surface, overlapping, and size variat ion etc. Hence, it is crucial to extract qualitative information about a rock aggregate image to characterize images before starting segmentation. In this paper, characterization of rock aggregate images have been thoroughly investigated by extensive tests on hundreds of images, using several packages of commercial software for image segmentation, and some previous image segmentation algorithms [6-10] coded by the author. 
Image classification was essential in segmen tation of rock aggregates. Therefore, it was started by developing procedures for crude determination of number of rock aggregates in an image, the basic idea being that  X  X dge density X  is a rough measure of average size in images of densely packed aggregates. This work is an essential com-ponent in the current segmentation process. The studied segmentation algorithm is based on grey value valleys which is a grey-value structure occurring more frequently than traditional step edges. However, without knowledge of scale (approximate size this goes for any segmentation technique which normally  X  X andles X  the problem by adjustment of various smoothing parameters, thresholds etc. Since it needs an auto-matic image segmentation process to perform  X  X mage classification X  first, and to avoid making  X  X moothing parameters X  crucial for good results. When an image analysis system is used for automatic monitoring of a fast moving conveyor belt, one important issue is the automatic grabbing of aggregate images. The quality of the image affects the result of the analysis. The automatic system should avoid interaction performed by an operator. Hence, when the system grabs one image frame, the system should judge if the image can be processed. If the image quality is poor, it is not possible or desirable to conduct analysis, and therefore the image should be omitted and the system should wait for the next image frame. So, the classi-fication of aggregate images should be a first step of development. 
Aggregate images taken from a fast moving conveyor belt vary so much that the quality of any two successive images are not the same, i.e. some images might include about 80% fine materials which is difficult to recognize by the system; some images consist of only a few rocks which is of less interest to analyze; some images are very dark or very light with a poor contrast of gray values, which may be due to the illumi-nation condition suddenly changed, in which case the wrong image information are obtained, the result of image analysis will be affected seriously; some images are can also be difficult to processing, etc. For an inspection task, the classification should be done in real time, and complex and time consuming texture analysis can not be used. Thus we exclude features for texture segmentation. 
If a frame of image is of a good quality, the edges of the aggregates are sharp, the contrast between the aggregate and background is acceptable and the number of the aggregates is in a certain level, In such a situation, the image is easy to process by the existing system. Based on the above discussion, we define classes of images as follows: Class 1: when contrast between edges and no-edges is lower than a specified value class 1. with a lower average gray-value, i.e. less than a specified value include only few visual particles together with an empty conveyor belt, the image belongs in class 2. with a average gray-value, i.e. greater than a specified value include only few visual particles together with fine material, the image belongs in class 3. Class 4: when contrast between edges and no-edges is greater than a specified value cepted aggregate image. There is certain relationship between the density of edges and average size of aggregate or number of aggregate in a image. The class 4 can be sub-classified based on the average size of aggregate in an image. 
The question is how to determine the contrast and density, as usual, we see that gradient magnitude image includes some different noise, all these noises will affect the contrast and density, in order to minimum the noises and process in real time, image pre-processing has be applied. The most important, and the hard part of computer vision for aggregates, is segmenta-tion. Segmentation can be divided into two steps, one is segmentation based on gray levels (called image binarization, sometimes) in which a gray level image is processed and converted into a binary image. Another is segmentation based on particle shapes in a binary image, in which overlapping and touching particles will be split, and over-segmented particles will be merged based on some prior knowledge such as shape and size etc. 
Segmentation algorithms for monochrome (gray level) images generally are based on one of two basic properties of gray-level values: similarity and discontinuity. The principal approaches in the first category are based on thresholding, region growing, and region splitting and merging. In the second category, the approach is to partition an image based on abrupt changes in gray level. The principal areas of interest within image. 
The choice of segmentation of aggregate images based on similarity or discontinuity of the gray-level values depends on both developed sub-algorithms and applications. Aggregate images have their own characteris tics compared to other particle images. Generally speaking, under the front-lighting illumination condition which is common case, aggregate images have the characteristics: (1) uneven background and fore-ground for which a simple thresholding algorithm cannot be applied to segment the images; (2) each aggregate particle may po ssess a textured surface and multiple faces, which often causes an over-segmentation problem; (3) particles overlapping each other, which hides parts of a particle, or causes breaks of the boundaries of particles; making aggregate images clump together. 
Aggregates may be densely packed or be separated mostly on a background. The most systems for aggregate images were developed based on simple thresholding algorithms (some of them combined with morphological segmentation algorithm) and boundary detection algorithms. The segmentation algorithm designing is application (here, the type of aggregate images) dependent. In this section, I summarize my own segmentation approaches for aggregate images, they are: (1) an algorithm based on edge detection; (2) an algorithm based on region split-and-merge; (3) an adaptive thresholding algorithm; and (4) an algorithm for splitting touching particles in a bi-nary image. 
The whole segmentation procedure consists of the two parts in this study: image classification, and aggregate delineation. Since the delineation algorithm needs thin edges of aggregates, the classification algorithm first classify image into different certain scale size, provided for aggregate particle delineation. After the delineation, the delineated image is converted to the original image size, re-mapping the contours of aggregates. The rock aggregate image classification algorithm was developed for gen-eral-purpose of rock aggregate image segmentation. The algorithm evaluates image quality and produces image class labels, useful in subsequent image segmentation. Because of the large variation of rock aggregate patterns and quality, the image classi-size; (4) images with mixed aggregates of different sizes; and (5) images with many void spaces. If most aggregates in an image are very small, the fine-detail information in the image is very important for image segmentation, and the segmentation algorithm necessary to remove the detailed information on the rock aggregate surface, because it may cause image over-segmentation. If most aggregates are of relative large size (e.g. medium size), the segmentation algorithm should include a special image enhancement routine that can eliminate noise of rock aggregate surface, while keeping real edges from being destroyed. Since the delineation algorithm was developed for densely packed aggregates, the void spaces have to be removal. 
Assume that P is surrounded by strong negative and positive differences in the di-agonal directions: 0 grid coordinates are used, which are much more sparse than the pixel grid n x  X   X  0 , 0 . f is the original grey value image after weak smoothing.

What should be stressed about the valley edge detector are: (a) It uses four instead of two directions; (b) It studies value differences of well separated points: the sparse i corresponds to L x  X  and 1  X  j corresponds to L y  X  , where 1 &gt;&gt; L , in our with average size estimation, which can guide choice of L; (c) It is nonlinear: only the slight modification whereby weighted averages of ()  X   X   X   X   X  -expressions are points in a section. For example, 2 need for further thresholding; (e) Since each edge point is detected through four dif-particle area is greater than 200 pixels, a thinning operation follows boundary detec-tion operation); and (f) It is not sensitive to illumination variations. 
Without image classification, there is a substantial difficulty choosing an appropri-ate L, the spacing between sampled points. Let L refer to spacing in an image of given resolution, where the given resolution may be a down sampling of the original image resolution. Since the image classification described earlier leads to an automatic down-sampling, the choice of L is not critical. 
After valley edge point detection, there are pieces of valley edges, and a valley edge tracing subroutine, filling gaps is needed (Some thinning is also needed). As a background process, there is a simple gray value thresholding sub-routine, which before classification creates a binary image with quite dark regions as the bellow-threshold class. If this dark space covers more than a certain percentage of the image, and has few holes, background is separated from aggregates by a Canny edge detector along the between-class boundaries. To test the segmentation algorithm, we have taken a number of different aggregate particle images from a laboratory, a muckpile, and a moving conveyor belt. It is often that there is a lot of noise on the surface of fragments, which gives problems for im-age segmentation, over-segmentation and under-segmentation. Since surface noise and 3D geometry of rock fragments create step edges in most cases, and our new algorithm is studied based valley edge detec tion, it disregards step edges. Therefore it works not only for less surface noise image, and also works for the images of serious surface noise. Figs. 3-4 illustrated image segmentation results. 
The image in Fig. 4(a) was taken from a laboratory with bad illumination; the sur-faces of the fragments include a lot of texture and noise. The existing algorithms have been used for the segmentation of rock fragments; all of them produce over-segmentation. By using the new segmentation algorithm, this image is classified into the class of medium fragment size (class 2): the segmentation algorithm reduces the scale of image two times, then delineates fragments, finally uses the original image to re-map delineation results. The resulting segmentation is satisfactory (Fig. 4(b)). 
When one acquires (or takes) rock fragment images in the field, the lightning is un-controlled; therefore, it cannot be avoided having uneven illumination images. Un-even illumination is a serious problem for image processing and image segmentation not only for rock fragments and also for other object. Uneven illumination correction is a hot topic in the research of image processing. In general, the regular shadows can be removed by using some standard filters, but for the random shadows, there is no standard filter or algorithm can be used for uneven illumination correction. 
Rock fragments are in field, lightning is from the natural sun (light strength varies from time to time), some natural objects (e.g. clouds, forest, mountains) and large man-made objects (e.g. trucks, trans) maybe nearby the area one wants to take im-ages, which may create uneven illumination (i.e. shadows) on the images. Some make image segmentation extremely difficult. It is not possible to use the segmenta-tion algorithms based on grey level similarity. In the newly studied fragment delinea fected by uneven illumination much. In this paper, a methodology for image segmentation of densely packed aggregate particles is presented, studied and tested; Image classification is very important for aggregate particle delineation. The classification algorithm produces image class labels, useful in subsequent image segmentation. The aggregate delineation algorithm studied is actually based on both valley-edge detection and valley-edge tracing. The presented rock aggregate delineation algorithm seems robust for densely packed com-plicated particles; it is also suitable for other similar applications in the areas of biol-ogy, medicine and metal surface etc. 
