 1. Introduction
For an appropriate power and range prediction in hybrid electric vehicles (HEVs) and electric vehicles (EVs), the degrada-tion of a battery during lifetime has to be considered. The main effect of cell deterioration in HEVs is a rising internal cell resistance. For this reason, the associated power loss yields to higher fuel consumption and the possible absence of typical hybrid functions like boosting, recuperating or cranking. More-over, an online tracking of the resistance change is indispensable to prevent failures of the electric system and accordingly the vehicle too. Besides, it can provide further advantages such as the recognition of an on-going or abrupt deterioration; or a residual value determination of the battery in case of a vehicle repair or resale.

In general, three methods are conceivable to determine battery resistances. First, the utilization of impedance spectroscopy or
DC pulse tests ( Andre et al., 2011 ; Yinjiao et al., 2011 ). However, these methods are hard to realize in vehicle applications, since no laboratory conditions such as a defined and constant temperature or current can be assured. Second, a computation of the actual
SOH through aging equations based on recorded load spectrums as proposed by Bitsche et al. (2004) . This method requires memory capacity for the recorded load spectrums and a precise knowledge of the ageing impact of all input parameters. Espe-cially, the second request is difficult to fulfill, since ageing tests require long testing times and are hard to scale from cell to battery level. The idea of the third method is to use signals which are measured anyway like current and voltage to get the cell resistance. This approach is preferred, because of just low required computational effort for a successful implementation.
Accordingly, an implementation on the vehicle control unit and an online estimation seems possible.
 accomplish the task of SOC and SOH estimation including a wide range from fuzzy logic ( Malkhandi, 2006 ), the Bayesian learning particle filters ( Saha et al., 2009 ) to support vector machines ( Hansen and Wang, 2005 ). Excellent overviews of possible techniques for these tasks are given by Sikorska et al. (2011) as well as by Zhang and Lee (2011) . State of the art approaches are the Kalman filters and the neural networks. Two modifications of them, the extended Kalman filter (EKF) and the structured neural network (SNN), are introduced in this study and their feasibility for resistance estimation is investigated.

Both identification methods require a modeling approach of the cell, which is realized by an electrical equivalent circuit (EC).
This model contains internal parameters, e.g. the ohmic resis-tance, which change over lifetime due to battery deterioration and have to be determined. 2. Battery degradation over lifetime
Due to irreversible physical and chemical processes, the performance of a battery drops significantly over lifetime. This process, called degradation, affects many measureable battery parameters (e.g. power, capacity, open circuit voltage (OCV), cell pressure, heat loss) and makes it quiet difficult to give a state-ment about the actual battery condition. A common quantifica-tion is given by the state of health (SOH), defined as the ratio of the actual value z act to the value at begin of life (BOL) z proposed by Widodo et al. (2011) .
 SOH  X  x act x
The main characteristic global parameters to describe the ability of a battery are capacity and resistance, which are directly related to range and power of a vehicle. In HEVs, the battery capacity plays a minor role since the respective state of charge (SOC) deviations are just small and only a minor range of the entire capacity is charged or discharged. In EVs the capacity change is more critical, but the SOH can be determined properly during the charging process by using the slope of the OCV curve.
Yet, the SOH of the battery resistance is critical in HEVs, since power losses are directly noticeable for the driver in less accel-eration and higher fuel consumption.

In a battery pack, the measured resistance is the sum of several components: internal resistances of the cells, resistance due to conductors and binders between cells as well as resistance through electrical components like the battery management system or switches. Also the internal resistance of the cell can be divided into further parts: an ohmic, a polarization and a diffusion resistance. Various degradation processes take effect in a battery. In general two different types can be distinguished, first wearing of mechanical or electrical components and second electrochemical processes inside lithium-ion cells.

Examples for the first type are breakdowns or spontaneous failures of single components like the management system, the cooling system, leaking sealings or defect fuses, switches, relays or sensors. Usually a gradual degradation takes effect till certain requests are not fulfilled anymore (e.g. insufficient cooling due to a soiling in the cooling system) or safety issues arise like for instance corrosion/rust at the battery case. These fatigues of the components are often predicted by S X  X  (stress numbers) curves, also known as the W  X  ohler curves, based on the corresponding
Weibull distributions. These distributions can be measured through endurance tests in laboratories. Thereby, it is assumed that the fatigue depends not on external factors except battery age or mileage. Most of these components are known in auto-motive applications and an appropriate know-how exists. In the case of using new components, it is often possible to transfer knowledge from similar components to predict the lifetime.
Moreover, it is in general possible to achieve no noticeable deterioration over battery lifetime through an appropriate design and high-quality components or if more profitable through re-placements.

The second type of degradation is called cell ageing. These phenomena are very complex, but obey physical processes. Thus, a SOH can be determined and at best even predicted. The main effects on cell level are caused by degradations in the active material and the decomposition of the electrolyte. An excellent detailed analysis of the ageing processes in lithium-ion cells is given in Vetter et al. (2005) . Two kinds of ageing take effect: ageing during cycling and ageing during storage, called the calendar ageing. At begin of usage, a strong increase of the internal cell resistance is observable. The reason for this is the formation of a thin resistive layer, named solid electrolyte interface (SEI), on the cell electrode surfaces. Studies by Ramadass et al. (2004) give more information about the reaction mechanism of the SEI formation and indicated by simulations that the main sources of capacity fade are side reactions on the anode surface. Besides, the abrasion of the porosities and the associated reduction of the active surface are responsible for an increase of the resistance, too. Furthermore, the initial reaction between the electrodes and the organic electrolyte involves absorption of electrolyte. Results are on the one hand less lithium-ions for the charge transport and on the other hand depositions in the graphite, supporting the exfoliation of the anode. Due to the strong initial degradation at begin of life and the complex interaction of several processes, ageing is a highly non-linear process. In contrast to the mechanical components, cells show, especially in the case of EVs, a strong dependency regarding several external factors like ambient temperature, charging power and operation strategy. Moreover, a battery is a serial connection of a high number of cells. In consequence, lifetime depends strongly on the production quality since  X  X  X very chain is only as strong as its weakest link X  X . In addition, just little know-how exists in automotive applications about battery ageing and very different ageing behaviors can be observed for cells with different chemistry or design. Although ageing is reducible through an optimal chemistry and operation; it is not avoidable by any chance. In consequence of these reasons, a SOH prediction should use all available measurement data as well as all informa-tion about the process or system.

Usually passenger cars are driven less than one hour per day and the major proportion of degradation occurs from parking. However, the data used in this investigation were measured in cars during continuous operation. As a result, the battery is mainly aged by cycling. Thus, the induced effects will be more kinetically based like variations in volume, continuous reforma-tion of the SEI and concentration gradients than an electroche-mical instability of the materials which is more common in calendar ageing as demonstrated in Broussely et al. (2005) . 3. Principle of battery model
An adequate battery model is required for carrying out the estimation of internal battery parameters by identification tech-niques. Several possibilities exist in literature either based on the electrochemical theory or on an electrical EC. Whilst the electro-chemical approach tends to be complex and contains parameters, that require a deep understanding of the internal processes and are hard to measure as described in Sauer and Wenzl (2009) . A model based on an EC is easier to handle and provides a sufficient physical representation for automotive applications. For this reason, ECs are state of the art in industry and more intuitive for identification approaches like the Kalman filters or neural networks. On that account, a modified Randle battery model as proposed by Remmlinger et al. (2011) and Lasia (1999) is used in this work and is illustrated in Fig. 1 .

An EC consists in the simplest way of an ohmic resistance and two further parallel connections of an ohmic resistance with a capacitor working as RC-elements. The first element summarizes different ohmic resistances and corresponds to the voltage drop that occurs immediately after an excitation current in electrodes, electrolyte and separator. In addition, the RC-elements represent the time-dependent capacitive behavior of the cell caused by polarization and diffusion effects. All described parameters of the
EC are time-variant and depend on the particular operating point like temperature, SOC, power demand and furthermore on the SOH of the battery.

The estimation of the impact of ageing on the internal resistance is a challenging task due to the significant effect of the other input variables. Especially, the impact of temperature superposes mostly any changes caused by battery ageing. That is why; special attention has to be paid in the selection of the measured data by isolating all other influences. In HEVs the majority of power demands are in the range of a few seconds and consequently ohmic resistance domi-nated. Therefore, the proposed identification techniques focus on the estimation of this internal parameter, but are analogous trans-ferable to all parameters. 4. Estimation by neural networks 4.1. Theory of internal parameter estimation with neural networks
Due to complex electrochemical processes, a battery has to be considered as a highly non-linear system. Since the correlation between voltage and current under different temperatures, states of charge and states of health is still unknown; estimation is a difficult and challenging task to accomplish. Inspired by the biological attitude of human neurons, artificial neural networks (ANN) represent an effective technique to approximate such non-linear systems in their input/output behavior. A well-structured general introduction of ANNs is given by Rojas (1996) . ANNs consist of one or more layers of fundamental building blocks called neurons with weighted interconnections between each other. Multi-layer networks contain always an input layer, one or more hidden layers and an output layer. If just a direct connection to the next layer is possible, the networks are called feed-forward. In contrast, recurrent networks allow a feedback within one layer (direct feedback) or even between multiple layers (indirect feedback). In this work just feed-forwarded net-works will be discussed. One particular characteristic of neural networks is their ability to learn during a special training process without former knowledge of the system. In a supervised training process as drawn in Fig. 2 , the weights are adjusted through a learning algorithm in such a way that a desired output is obtained by given input data. During this learning process the network tries to establish the relationships, probably highly non-linear, between input and output data. Different learn algorithms exist for this task and can be divided into classes using reinforcement or error correction ( Rojas, 1996 ). All algorithms are based on an error function E p : E p  X  1 2 where the quadratic error between the target and real output of the neural network is used as an evaluation criterion with t the target and o pj is the output of the neuron j for a given input and output data set p for every time step k . By using a gradient method, a global optimum can be searched. This can be achieved by the optimal configuration of the weights till a minimum error is obtained. The components of the gradients are the partial derivatives of the error function according to the corresponding weights w i . grad E p  X  w 1 , w 2 ... w n  X  X  r E p  X  W  X  X  vector W are verified by a small fraction in the direction of the negative gradient.
 D W  X  Z r E p  X  W  X  X  4  X  size. The learn algorithm can be further divided in methods of first order and second order. Second order methods are numerical methods requiring the Jacobi and Hess matrix, but are not applied in this work. One of the most common learn algorithm for the weights is the Delta rule, a special case of the error backpropaga-tion for a one-layer network like used in this work. Hereby, the weight variation for a neuron is given by the expression: 1. Input: number of iterations k max 2. Parameter: learning rate Z 3. Initialization of the start weights w ij  X  k  X  0  X  4. k  X  1 5. Iteration k 6. Output: saving of the weights adjustment of the weights. Once the network has learned  X  X  X he job X  X , the weights remain constant and the network is ready to be applied.
 given by Prokhorov (2008) , who already showed the potential for usage for HEVs in general ( Prokhorov, 2007 ). Also in the field of batteries, numerous applications of ANN can be found. For example Shen et al. (2000) demonstrated the utilization of ANNs for the determination of capacity on a lead acid battery. Moreover, several studies investigated the possibility of a SOC estimation ( Bo et al., 2008 ; Charkhgard and Farrokhi 2010 ; Weigert et al., 2011 ) and even the application for control tasks was demon-strated ( Moreno et al., 2006 ). Even though the number of pub-lications on the application of ANNs on batteries increases, especially in the last years, surprisingly no study was found dealing with internal parameters of a system, which are either inaccessible to measure or just by hard efforts.

In this work, the system of Fig. 2 is the battery with measured values of SOC, temperature and current as input values u of the network and voltage as the desired output y . An application of the introduced general form of multi-layer networks for the internal parameter estimation has the disadvantage of a missing physical meaning of the neurons in the hidden layers. Therefore, the neurons would contain no accessible information and just the output signal voltage would be obtained, which can be measured with a high precision anyway. Thus, a special network structure is used in order to reflect the physical characteristics of the battery and get access to internal states. For this task, a structured neural network (SNN) will be introduced in the next chapter. 4.2. Application of structured neural networks
Knowledge about the physical characteristics of a system can support the design of neural networks. An existing mathematical description of the input/output behavior of a system displays a model, which defines the number of neurons and possible layers.
As a result, the physical meaning is assigned to the neurons and their weights are adapted to the related process parameters. The advantage of such a SNN and reason of this investigation is the possibility to combine a high number of measured data/informa-tion and expert knowledge or even an existing model of the system in a smart way. An idea already described in its basics by
Feldman et al. (1987) more than twenty years ago. By choosing an issue specific network structure, the model predefines the num-ber of neurons and layers which is in most cases lower than for conventional networks. Thus, an increase of the convergence speed and significant reduction of computation time can be achieved ( Garc X   X  a et al., 2007 ). Moreover, a SNN makes it possible to gain access to internal parameters, instead of a pure reproduc-tion of the system behavior. Since the weights have a physical meaning, it exists in addition the possibility to initialize the weights with measured data or by expert knowledge in a way that the start values are already nearby the global minimum and local minima are avoided. Interesting cases of application are for example test phases of new vehicles, where a lot of measurement data are obtained which are not used in most cases. By using these data for the training of a neuronal network and combing the network with an existing model to a SNN, it is possible to gain access to the internal parameters and to use them. For a high number of available data, the weights of the network will be very robust and reliable after the training. In the case of basic arithmetic operations of this structure, even an online implemen-tation with small computational efforts seems possible after the completed training. Surprisingly, no publication of SNN can be found for batteries or even vehicles, whereas first works can be found in other engineering areas ( Evans et al., 2000 ; Garc X   X  a et al., 2007 ; Matsui et al., 2009 ). This section will present how the approach of a SNN can be used for the SOH estimation of a lithium-ion battery.
 In the present study, the mathematical description of the el.
EC from chapter 3 is used as the model for a SNN. The following equation is deduced from the EC and describes the voltage behavior of a battery cell. u cell  X  t  X  u ocv  X  t  X  X  i  X  t  X  X  R ohm  X  R 1  X  1 e t = t 1  X  X  R
Hereby, voltage can be considered as the system output, current as the system input and R O , R 1 , t 1 , R 2 and t system parameters, which have to be identified. Instead of identifying all four parameters, it is also possible to merge the RC-parameters into the over voltages u 1 and u 2 as displayed in Fig. 3 . In a SNN, these red color marked parameters represent the network weights and cell voltage the output. As mentioned before, this work concentrates on the ohmic part. The existence of less signal variables than requested parameters leads to an under-determined system. Though, more input values than cur-rent are required and have to be considered for an accurate identification.

Consequently, a SNN is set up for the estimation of the ohmic resistance R ohm by considering temperature and SOC as further input signals. These dependencies can simplified assumed to be independent from each other and can be described by the subsequent expression.
 R ohm  X  T , SOC  X  X  f  X  T  X  U f  X  SOC  X  X  7  X 
For the investigated hybrid lithium-ion cell VL6P, the depen-dency of T can be approximated by a linear function for elevated temperatures ( T 4 23 1 C) as the left picture of Fig. 4 evidences. The SOC on the other hand, normalized on 100% SOC, can be approximated well by a polynomial function of fourth degree as the right picture shows for different temperatures. In this study just ambient temperatures or higher are applied, but also low temperatures would be possible by using an exponential function with also only two parameters. f  X  T  X  X  kT  X  n  X  8  X  f  X  SOC  X  X  p 4 SOC 4  X  p 3 SOC 3  X  p 2 SOC 2  X  p 1 SOC  X  p
Based on these equations, it can be seen that a one-layer network structure is sufficient to represent the model of R More layers would be possible, but are not necessary to describe the dependencies in consequence of the model structure itself. Now, the SNN is adjusting the parameters in such a way that the functions yield to the target values. An important assumption of this approach is that the functional correlations of Eqs. (8) and (9) are still valid for aged batteries and just the parameters are shifted and can be analyzed. As shown later in chapter 6, this approach is permitted and delivers correct values. In Fig. 5 , the graphic realization of Eqs. (8) and (9) is provided by the neural network SNN 1 . As described, inputs are T , i meas , SOC and output is u . The temperature dependency is modeled through the para-meters k , n , while the SOC influence is represented by the parameters p 0  X  p 4 .The physical relationship between input and output data is established through the weight adaptation of the parameters k , n as well as p 0  X  p 4 during the training of Eq. (5) .
In the same way, further networks like SNN 2 and SNN 3 would be conceivable in order to model the remaining internal parameters u 1 and u 2 . As stated before, scope of this study is the pure ohmic resistance in consequence of the ohmic dominated processes in HEVs. 5. Estimation by the Kalman filter 5.1. Theory of internal parameter estimation with the Kalman filter identification tasks as for instance by Hu and Yurkovich (2010) ,
Lee et al. (2007) and Zhang et al. (2008) . Moreover, the chance to be implemented in batteries soon is high as several patents indicate ( Burgess, 2009 ; Schoch, 2010 ). Since a detailed KF theory is beyond the scope of this paper, just a short summary is given. Further information can be found in literature like for instance
Adamy (2009) . The first essential step of a KF is the expression of the given system in state space form like Eqs. (10) and (11) . _ x  X  t  X  X  A U x  X  t  X  X  B U u  X  t  X  X  10  X  y 0  X  t  X  X  C U x  X  t  X  X  D U u  X  t  X  X  11  X  the internal states of the process (e.g. x 1 , x 2 ). For the filter algorithm two steps can be distinguished, the prediction and the correction step. By using the Kalman gain K the difference between measured and predicted output y  X  y 0 is used recursively to correct the predicted internal states. Hereby, the error of estimation e ( t ) is defined by e  X  t  X  X  x  X  t  X  ^ x  X  t  X  X  12  X  where ^ x  X  t  X  is the predicted state vector. The corresponding covariance of the estimation error is
P  X  t  X  X  E f e  X  t  X  e  X  t  X  T g X  13  X  and is minimized every time step. 5.2. Application of the extended Kalman filters on a battery the battery cell ( Fig. 3 ) leads to the over voltages u 1 du 1  X  t  X  du 2  X  t  X  u cell  X  t  X  u ocv  X  t  X  X  i  X  t  X  U R ohm  X  u 1  X  t  X  X  u 2 are written as "# |fflfflffl{zfflfflffl}  X  u cell u ocv |fflfflfflfflfflffl{zfflfflfflfflfflffl}
R ohm and has to be extended by this parameter as done in Wang et al. (2010) . Moreover, in HEVs the measurements are time discrete and for that reason a time discretization of the state
R space model has to be performed (sampling rate T ) similar to Plett (2004) . f  X  x , u  X  X  g  X  x , u  X  X  X  u cell  X  k  X  u ocv  X  k  X  X  0  X  110 U x  X  R ohm In general KFs are limited in their application on linear systems.
However, batteries are highly non-linear systems. This issue can be accomplished by the use of an extended Kalman filter (EKF).
An excellent continuative description of EKFs is given by Welch and Bishop (2006) . The essential linearization in the operating point for this special form is carried out by the Jacobi Matrix. ^
A  X  @ f  X  x , u  X  ^
B  X  @ f  X  x , u  X  ^
C  X  @ g  X  x , u  X 
A necessary condition to apply a KF is the observability of the system. This is given, if the observer matrix S B has a rank of n , in this case three, or the value of the determinant is unequal to zero. S  X  0
B @ det  X  S B  X  a 0  X  25  X 
Calculating the determinate, indicates that a value of zero is just possible in case of i ( k )  X  0or T  X  0. The sample rate is greater than zero by definition and an unobservable system in case of no input signal i is expected and feasible. Finally, the gained EKF is given in Fig. 6 and the internal states are identifiable. 6. Results 6.1. Identification by SNN
As introduced in Section 2 , the data used in this investigation were measured in vehicles during continuous operation. Battery data recorded in endurance tests of the Mercedes Benz S400 Hybrid at begin of life (BOL), after 174,000 driven kilometers, in this work defined as end of life (EOL), as well as in between were investigated and applied. The used hybrid battery of the Mercedes Benz S400 contains 35 lithium-ion cells with a nominal capacity of 6.5 Ah each ( Lamm et al., 2009 ). More information about the cell was published previously in Bourlot et al. (2010) . All data were measured directly in the vehicle and contain all required signals like current, voltage and temperature. Most of the sets have a length of about five to seven hours and are therefore very suitable for a training or validation. A total number of 33 data sets in a wide mileage range were available. In order to ensure a proper training as well as a proper validation, the applied data were separated in two data sets. Two third of the available data sets were used for training and the remaining one third for the validation. An impression of a typical applied HEV driving profile for training and validation is given in Fig. 7 . Short high current pulses up to 150 A, alternate with power requirements below 50 A. It can be seen clearly, that the battery voltage responds without a time delay in respect to the excitation.

Since it is possible, that the ohmic resistance R ohm for a given driving profile is more influenced by temperature than by ageing itself, special attention has to be paid on the selection of the training and validation data sets. Therefore, almost identical temperature sequences over drive time were extracted from the recorded data at BOL at 0 km (blue) and after 174,000 km (black) as shown in Fig. 8 . A similar approach was found in Brill (2010) .
Afterwards, the following steps were carried out in order to investigate the influence of mileage on R ohm : 6.1.1. Training of the network
Aim of the training is to gain favorable start values and an optimized learning rate as well as to adopt the weights. The measured voltages of the training data sets for BOL and EOL were compared, as shown in Fig. 2 , with the obtained ones from the
SNN, while the learning algorithm adjusts the weights as described detailed in Section 4.1 . As mentioned before the delta-or rather Widrow X  X off-rule was used for the learning algorithm and a learning rate of Z  X  0.002 was found to minimize the error e between the voltages best. To ensure a proper training and to gain favorable start values, a comparison with simulated reference data for the functions from Eq. (8) and (9) was accomplished.
These values are stored in look-up tables of a battery model and were measured by the means of the electrochemical impedance spectroscopy (EIS). More information about the EIS technique in general can be found in Barsoukov and Macdonald (2005) and an application on lithium-ion batteries is given in Andre et al. (2011) .
Accordingly, these values are directly from experiments and suitable for a verification and validation of the identification.
The training was first accomplished at BOL with the aim to check if the chosen start values and learning rate are reasonably. After the successful training, the training was extended to EOL data in order to test if the obtained vales are also able to achieve proper results for an aged battery. An example of the training progress for the BOL data set is given in Fig. 9 .

Starting with appropriate values, a successful function is determined over the drive cycle for temperature as well as SOC.
Whereas, the temperature influence is adjusted quite fast, the SOC reproduction shows the correct trend but needs about two hours for a proper learning. A comprehensible procedure in conse-quence of a higher impact of temperature than SOC and thus primarily adaption of the temperature weights and to a lesser extent of the SOC weights. In addition, the impact of SOC is low for high and medium SOCs as seen in Fig. 4 and only a longer drive distance and thus lower SOC stimulates the network in a suffi-cient way. Moreover, the strong impact of temperature on the resistance is visible in Fig. 9 in form of a mirrored behavior of temperature and resistance. Nevertheless, the correct values and trends are reached by the SNN for both functions at the end of the training data set. 6.1.2. Validation Now, the trained SNN is validated by the output value u for MOL data sets at 13,000 km and 80,000 km, chosen as values near
BOL and between BOL and EOL to represent a normal lifecycle, in Figs. 10 and 11 , respectively.

Both figures evidence clearly the ability of the SNN, trained at the borders (BOL and EOL), to reproduce the voltage also between
BOL and EOL correctly. In order to assess the performance of the training, the voltage deviation between recorded and estimated value over time is given in both figures too. Average deviations of 10 X 20 mV are in the range of the measurement accuracy in vehicles. In combination with maximum deviations of 50 X 120 mV for high dynamics in Table 1 , a successful training for unused as well as aged batteries is proven. 6.1.3. Parameter estimation by SNN
Finally, the trained SNN is applied on a second data set with BOL and EOL data in order to investigate the influence of mileage on the increase of the ohmic resistance R ohm . Again, reference data gained by EIS are used for validation at BOL. In order to obtain suitable and comparable curves, the data were filtered by a first order Butter-worth algorithm. In Fig. 12 the results of the smoothed SNN obtained R ohm and the reference data are displayed.

The curve of R ohm is predicted quite sufficient and only small deviations are detectable. By getting such matching curves, the successful and proper identification is demonstrated. Identical to the identification at BOL, the network is now applied on data after a cycling degradation of 170,000 km and the internal state R estimated again.

In order to have an opportunity to evaluate the increase of resistance and thus determine the SOH by Eq. (1) , the obtained R ohm is compared with the results at BOL by Fig. 13 . It is obviously, that the resistance obtains a significant higher level for the aged battery and a degradation effect is detectable clearly by the SNN for the entire cycle. Since both temperature profiles are similar but not identical as demonstrated in Fig. 8 , the curves are slightly different. However, a continuously elevated resistance is esti-mated in average for the aged battery over drive time as evidenced in Fig. 13 by displaying also the mean values. 6.2. Identification by EKF
Similar to the training of the SNN, the measured current i and voltage response u of the battery at begin, middle and end of life were used to estimate the internal states by an EKF. In conse-quence of the straightforward and fast implementation of the EKF for u ohm , also u 1 and u 2 of Eq. (19) were identified in addition to R ohm or respectively u ohm . Afterwards, these values were again compared with data from an electrical model of the battery, based on parameterization using EIS. In Fig. 14 the result for the over voltage u ohm is presented. Again, the estimation is very precisely and matches the general trend of the reference properly.
The ohmic over voltage is estimated accurately and a signifi-cant improvement of the estimation quality is visible over time. During the first 4000 s slightly incorrect values are given by the EKF for high dynamics but vanish afterwards and the estimation converges to the correct values. A reasonable trend in conse-quence of the use of non-optimal initial values and a required settling time for filter adaptation, resulting into a decreasing covariance and a more accurate filtering over time.
 Once more, the estimation is carried out for an aged battery at MOL as well as at EOL and matched with the obtained parameters at BOL. All three resistance trends are drawn in Fig. 15 over time. Comparably to Fig. 13 , the resistance trends are similar, but are shifted to higher levels for batteries with higher mileage. Again, a period of about 2000 X 4000 s is required till proper values are obtained. Afterwards, a clear differentiation of the three SOHs can be 0 1000 2000 3000 4000 5000 6000 7000 8000 9000
R 0 2000 4000 6000 8000 10000
R seen by plotting also the mean values. Consequently, the influence of driven mileage can be detected not just at BOL and EOL, but also at
MOL, and a statement about the actual SOH is diagnosable as expected also by the EKF.

Finally, a comparison of the obtained curves for the aged battery by SNN and EKF is possible in Fig. 16 by drawing the increased ohmic resistances of Figs. 13 and 15 again. Noticeable is the more noisy output in case of the SNN in comparison to the smooth EKF. This is on the one hand a consequence of the stronger slope of the SNN functions (Eqs. (8) and (9) ), which are more sensitive to input noise than the EKF and on the other hand due to the Butterworth filter. Both, the levels as well as the trends are very similar. This indicates a correct SOH estimation by SNN and thus provides an alternative to the well-known EKF.
Also for the further states, the over voltages u 1 and u 2 successful detection is proven by matching the EIS reference data in Fig. 17 . The trend of u 1 is reproduced with a high accuracy throughout the cycle, whereas u 2 shows small inaccuracies but represents the general trend of u 2 correctly too. Thus, all three over voltages are estimated and usable. 6.3. Comparison of algorithm accuracy and complexity
Two points need a close attention, the required time for a successful training and the computation time for a given drive cycle.
The first one can be evaluated by looking at Figs. 9 and 14 .Whereas, the SNN requires almost 8500 s to train the given functions, the EKF reaches satisfying values already after just half the time. However, in general the training time plays a minor role and especially for SNNs the training can be executed easily offline before an implementation on the management system. In applications even the opposite will be seen. Whereas the EKF requires always a certain adaption time, a correctly trained SNN will deliver immediately proper results. SNN, consisting of two basic arithm etic functions, with the extended
Kalman filter (EKF) design. It is obviously, that the SOH estimator design by SNN has a lower computational complexity. To calculate the Kalman gain for a n th order state space model, a covariance matrix of n n must be solved at every sample step. This can be evidenced by simulating the 8700 s of the drive profile from Fig. 10 on a commercial computer and meas uring the required computation time. Whereas the SNN takes 4.7 s, applying the EKF on the same profile requires 13.5 s for computation. Both numbers point out a calculation significant faster than real-time by a factor of 600 and almost 2000. Therefore, the ability of an online SOH estimation seems possible also on small CPUs. A successive solving of the covariance matrix corresponds approximately to n single iterations of the system model at every time step and in the case of SNN just of two functions f ( T )and f (SOC). Thus, it is expectable that the usage of an EKF is n times more time consuming than the application of a SNN. A number 2000 3000 4000 5000 6000 7000 8000 9000
R
R matched very well by a factor of 2.8 for the ratio of the computation times in our simulations. 7. Results and discussion
Two algorithms to identify the internal states of a battery model were implemented, tested and compared in this study. A structured neural network and an extended Kalman filter were developed and applied on the equivalent circuit model of a HEV battery. Whereas the first algorithm is a new approach on the field of SOH identification, the second one is a well-established method with the aim to verify the SNN. After a successful training with recorded current and voltage data from a vehicle, the estimated internal parameter of both methods, the ohmic resis-tance, was validated by measured data based on the electroche-mical impedance spectroscopy. This validation indicated a successful identification for both methods and a proper estima-tion of the internal states. Moreover, data from a battery aged by driving were applied and the internal states identified again. In comparison with the estimated states for an unused battery, a constantly higher ohmic resistance is indicated by both methods.
Also the comparison of both results showed almost identical trends and values for both algorithms. Thus, it could be concluded that besides the already known Kalman filter, also the SNN is able to determine the SOH of a battery correctly.

Comparing both estimation methods, the EKF was simpler to implement, required less input values and required no functions of the dependencies to the operating conditions. In contrast, the
SNN required known correlations between the input variables and internal states. However, especially the existence of these basic and already offline trainable functions in case of the SNN makes an application on a control unit of battery possible. In particular, if a high number of vehicle data is achievable and can be used for offline training, the SNN indicates its advantages compared to an EKF in terms of computation speed and memory and should be preferred. In contrast, the EKF requires high computational efforts like matrix inversion and is therefore not purposive for an online estimation, but can be the right choice for tasks with just a low number of training data in consequence of the fast adaption of the filter. For this reason, an application of the
SNN is more promising and recommendable for this case. In a next step, the algorithm should be applied on measurement data at different and exactly known SOHs, in order to investigate the accuracy of the estimation. Moreover, the online ability of the algorithm regarding computational effort is worth to be verified and if feasible, a power prediction for the battery adapted over lifetime is recommended.
 References
