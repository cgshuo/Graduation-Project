 ORIGINAL PAPER Huijie Fan  X  Linlin Zhu  X  Yandong Tang Abstract The digitalization processes of documents pro-duce frequently images with small rotation angles. The skew angles in document images degrade the performance of optical character recognition (OCR) tools. Therefore, skew detection of document images plays an important role in auto-matic document analysis systems. In this paper, we propose a Rectangular Active Contour Model (RAC Model) for con-tent region detection and skew angle calculation by imposing a rectangular shape constraint on the zero-level set in Chan X  Vese Model (C-V Model) according to the rectangular feature of content regions in document images. Our algorithm differs from other skew detection methods in that it does not rely on local image features. Instead, it uses global image features and shape constraint to obtain a strong robustness in detect-ing skew angles of document images. We experimented on different types of document images. Comparing the results with other skew detection algorithms, our algorithm is more accurate in detecting the skews of the complex document images with different fonts, tables, illustrations, and layouts. We do not need to pre-process the original image, even if it is noisy, and at the same time the rectangular content region of a document image is also detected.
 Keywords Skew detection  X  Active Contour Model  X  Level set  X  Shape constraint  X  Content region detection 1 Introduction With the development of digital technology, the conversion of paper documents to electronic format is routinely done for record management, automatic document delivery, doc-ument archiving, journal distribution, etc. Compared with paper documents, electronic documents have advantages on verting paper documents into document images by scanning equipment or photography is an important prerequisite to get electronic documents. Due to the misalignment in dig-itization process, the text lines in the resultant images usu-ally deviate from their original orientation by certain degree, which is referred to as skew angles. Even the smallest skew angle existing in a given document image may lead to the failure of segmentation of complete characters from words or text lines, when the distance between character is reduced. Most of the OCRs (optical character recognition) and doc-ument retrieval/display systems are very sensitive to skew in document images. Therefore, skew detection in document images is necessary in document digitalization.

Many methods of the skew detection in document images have been proposed. The majority of them are based on and nearest neighbor clustering (NNC) algorithms [ 6 , 7 ]. A comprehensive survey of skew detection methods refers to Ref. [ 8 ].

The method based on projection profile (PP) was pro-posed by Baird (1987) [ 1 ]. This method starts by mark-mulator array, and a chosen premium function is evaluated on the accumulator array. If the accumulator array is suc-cessively rotated by a fixed interval in a range, a series of premiums are obtained. The premium function reaches its tations. Usually, detection is carried out in multiple rounds to achieve good speed and accuracy, either from coarse to fine accumulator rotation interval or from sub-sampled to full resolution image. The accuracy of PP method depends on the angular resolution of the projection profile, and it is easily affected by the noise and the character fragments in an images. The method based on Hough transform (HT) was proposed by Srihari et al. (1989) [ 3 ] and Hinds et al. (1990) [ 4 ]. After mapping each point from the original plane to all points in the Hough space, the maximum number of colinear pixels in Hough space is on lines that are coincident with the baseline of the text. However, it has to extract the text regions in the document images before the Hough transform is applied, which is a non-trivial task for document images with complex layouts. Moreover, HT method is computa-tionally expensive. A bottom-up technique based on NNC, described by Hashizume et al. (1986) [ 6 ], obtains the skew angle by accumulating the direction vector for all the nearest neighbors of all connected components, and then finds the histogram peak. It would be upside-down when the number of descending strokes is more than the ascending one, so it works poorly for the document images with many illustra-each component extracted from connected component rep-resents a straight line corrupted by Gaussian noise, and then the skew angle is estimated with EM algorithm. Makridis et al. [ 10 ] improved NNC method to deal with global and local skew detection and correction in binary document images. Cross-correlation (CC) [ 11 ] and mathematical morphology [ 12 ] are also used for document image skew detection. We propose the Rectangular Active Contour Model (RAC Model) by assuming the boundary of a document image X  X  content area as a rectangle represented by a five-tuple ( a , b , x document images, such as journals, magazines, and newspa-per. In the model, a rectangular shape constraint is imposed on the zero-level set of a scalar Lipschitz continuous function in Chan X  X ese Model (C-V Model). The variational method is applied to minimize the energy functional to get the param-eters of the rectangle close to the boundary of the content ing in all the previous skew detection methods because they more or less use the image X  X  local features, which are very sensitive to noise. Our algorithm estimates the skew angle with a global shape feature of content on a document image, so it is robust to noise and does not require any de-noising pre-processing.

The rest of the paper is organized as follows. In Sect. 2 , the research background, the proposed RAC Model and its energy functional are presented. Section 3 presents the exper-imental protocol and discusses the results obtained, followed by the conclusions and our future work in Sect. 4 . 2 Skew detection based on active contour In this section, we introduce the concerned level set method and C-V Model briefly, and then the RAC-based skew-detect-ing algorithm. We propose an energy functional using a continuous rectangular curve (represented by zero-level set function) to describe the boundary of the content region in a document image. The evolution equation of the energy func-tional is deduced according to the Euler X  X agrange equation to obtain the optimal fitting boundary curve. 2.1 Rectangle Constraint Active Contour Model 2.1.1 Level set methods The level set method, first proposed by Osher and Sethian [ 15 , 16 ], is a computational technique for tracking a propa-gating interface over time. It has been widely used in image processing, computer vision, computer graphics, and scien-tific visualization. It is proven that the level set method has the ability to deal with topological change such as corners and cusps and to handle complexities in the evolving interface.
Let be a bounded open subset of R 2 and C be an evolv-ing curve denoting the boundary of the open subset  X  of (i.e. C =  X  X ) .Letu 0 :  X  R be a given image. In the level set method, the curve C is represented implicitly by the zero-level set of a Lipschitz function  X  :  X  (called level set function):  X   X   X 
C =  X  X  = { ( x , y ) |  X ( x , y ) = 0 } inside ( C ) =  X  = { ( x , y ) |  X ( x , y )&gt; 0 } outside ( C ) = \ = { ( x , y ) |  X ( x , y )&lt; 0 } where x and y are image coordinates. The final zero-level region and marginal region. Although the level set method increases the dimensionality of the function to a higher one, it has an advantage of handling topological changes of the closed curves. 2.1.2 Chan X  X ese Active Contour Model In [ 17 ], Tony Chan and Luminita Vese proposed an Active Contour Model to detect objects in an image, based on tech-niques of curve evolution, Mumford-Shah function [ 18 ]for image segmentation. Unlike the classic active contour based on the gradient information, the C-V Model can detect the contours with or without gradient. In addition, the model has a level set formulation, interior contours are automatically detected, and the initial curve can be anywhere in the image. C-V Model has stronger anti-noise performance and weaker dependence on the initial curve.

Assume that the image u 0 consists of two regions, which are approximatively piecewise constant intensities, and the object to be detected is one of these two regions. The basic segmentation model based on C-V Model [ 17 ]isformulated by the minimizing of the  X  X itting energy X  functional E : inf where  X  1 , X  2 and  X  in Eq. ( 2 ) are non-negative weighting parameters, and H (  X  ) denotes the Heaviside function. c c , update with the evolution of the level set function  X  ,are the mean of the region inside and outside of the zero-level set function, respectively.

The first two items of E are called fitting terms, which measure the degree of the piecewise constant function u = c
H ( X ) + c 2 (1  X  H  X  ) close to the original image u 0 .The last term is called the regularization term, which measures the smoothness of required curve.

With the level set formulation, the energy functional E can be minimized using the associated Euler-Lagrange equation:  X  X   X  t Then, the zero-level curve of its steady solution is the contour of the object to be detected. Practically, the smooth approx-imation of Heaviside function and Dirac function is used in computing: where  X  is an extremely small positive number. 2.2 Rectangular Active Contour Model Shape Constraint Active Contour Model [ 19 ] takes the shape of the target as prior knowledge to fix the evolving curve to certain type of shape. It directly embeds the prior shape infor-mation in level set function. Since the boundary shape of doc-ument content in magazines, journals, or newspapers usually appears to be a rectangle, we assume that there exists a mini-mum rectangle that contains the complete content region of a given document image. Rectangular Active Contour Model (RAC Model) is proposed to detect content regions and to calculate skew angles according to the rectangular feature of content regions by adding a rectangular (shown in Fig. 1 ) constraint represented by a five-tuple ( a , b , x 0 , y 0
We utilize level set function to control the evolution of the curve:  X  =| ( x  X  x where a and b denote two lengths of the rectangle, ( x 0 , denotes the center coordinate, and  X  is the rotation angle (  X  is negative when the document image rotates clockwise or positive when it rotates counterclockwise. e.g.,  X  in Fig. 1 has a positive value).
 Give the following denotations: A= ( x  X  x 0 ) ( b cos  X   X  a sin  X )  X  ( y  X  y 0 ) ( b sin B= ( x  X  x 0 ) ( b cos  X  + a sin  X )  X  ( y  X  y 0 ) ( b sin The derivatives of parameters in level set function  X  are pre-sented below: where sign( x )= shape constraint into the level set function, the RAC Model based on C-V Model can be written as: subject to where the non-negative weighting parameters  X  1 and  X  2 are fixed as 1 in all experiments. Compared with C-V Model [ 17 ], our model adds a shape constraint to keep the curve rectangular in curve evolution. For more details about C-V Model, we recommend the readers to refer to Ref. [ 17 ].
Let p = ( p 1 , p 2 , p 3 , p 4 , p 5 ) T denote the five-tuple x , y problem in Eq. ( 7 ), the energy functional E can get a mini-mum at  X  and each parameters must satisfy:  X 
E RCV [  X ( a , b , x 0 , y 0 , X ) ] Denote M ( t ) =  X  1 ( u 0  X  c 1 ( t )) 2  X   X  2 ( u 0  X  c eterizing ( a , b , x 0 , y 0 , X ) T with an artificial time t following differential equations are deduced from Eq. ( 8 ):  X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X   X  It is a continuous function, and we have to discretize it into a discrete function for computing. The derivative of each parameter is discretized by the finite difference method with respect to t: d p i ( t ) dt where t is the step time. It is fixed as 0.05 in all experiments.
The initial contour is defined as: a ( t ) | t = 0 = 2 3 w, b ( t ) | t = 0 = 2 3 h , x ( t ) | where h and w are the height and the width of the input doc-ument image, respectively.

The curve evolution will stop when the steady solution of the discrete function is acquired at the time T: ( a (T), b (T), x (T), y 0 (T),  X  (T)) T . These parameters determine the con-tent region and the skew angle of the document image. 3 Experiments To illustrate the validity of our proposed algorithm on skew and content region detection, the experiments on differ-ent kinds of document images and different skew angles are shown as follows. In the experiments, we tested more than 750 document images consisting of text, illustra-tions, tables, diagrams, and mathematic formulas. Among them, 521 document images are selected from the Oulu English Document Image Database ( http://www.mediateam. oulu.f-i/downloads/MTDB/ ). Another more than 200 real-istic scanned images are from the Tobacco800 Docu-ment Image Database ( http://www.umiacs.umd.edu/~zhugy/ Tobacco800.html ). Both Oulu and Tobacco800 databases contain only English document images. We have scanned 30 documents from Chinese research papers with a resolu-tion of 300 dpi. These scanned images contain some tables, illustrations, and noise. Shown in Figs. 1 , 2 , 3 and 4 are some samples of the tested images. All experiments are done in MATLAB environment on the PC with 1 GByte RAM and 2.8 GHZ CPU.

In the skew detection, we compared the experiment results gotten by our proposed algorithm with those by the Hough transform (HT) method [ 5 ], the expectation maximization (EM)-based method [ 9 ], and the global and local (GL) skew detection method [ 10 ]. The HT method obtains a more pre-cise result by applying the least squares formula to deter-mine the slope of the line that best fits the points used. It reduces the amount of data used in the Hough transform by grouping the pixels into connected components. These components generally represent characters. In the EM-based method, its model parameters are estimated using maxi-mum likelihood estimation [ 20 ]. The skew angle estima-tion is extracted from the histogram of the slope angles of the estimated lines. The GL method performs a con-on detecting a sequence of other consecutive connected components at certain directions within a specified neigh-borhood. The document has global skew distortion only if the histogram constructed by all local skew angles has one peak. Otherwise, it is assumed that the document has sev-eral local skews and no global skew. In the content region detection, we compared with Shafait X  X  method [ 21 ]. Like most of the previous content region detection methods, the method of Shafait describes the document structure as a hier-sent a particular level of information, like zones, text lines, or connected components. In order to extract the docu-ment structure at different levels of the hierarchy, the page frame detection system uses a different algorithm at each built for the page frame of a scanned document. Then, a geometric matching method is used to find the globally optimal content region with respect to a defined quality function.

We compare the algorithms on skew detection in average computing time, average absolute error between the rotation angle and the detected angle, and percentage of images whose skew detection errors were within 1  X  .
 experiments are defined in Eq. ( 11 ). We can assign the posi-tion and the size of the initial rectangle randomly in the image in our algorithm. 3.1 Document image with text only We test 100 document images with text-only document images. The average computing time, absolute error, and detection rate of each algorithm are tabulated in Table 1 .All the algorithms are accurate in detecting the skew angle of text-only images. Our algorithm is a little slower than others. The EM-based method is the fastest, but it requires know-ing the total lines of the test image, otherwise the estimated the detected skew angle is very different from the real one. An example of our method for text-only document image isshowninFig. 2 . To verify our algorithm X  X  robustness to variable initialization, three different initial curves (shown with different colors of blue, red, and magenta) for the image whose size is 783  X  448 pixels, and the real skew angle is have been given in Fig. 2 a. In Fig. 2 b, we calculated skew angles are, respectively,  X  3 . 1760  X  ,  X  3 . 1222  X  and (the rectangular curve indicates the content area). The com-puting time is, respectively, 3.32, 2.91 and 3.05 s. We can see means that our algorithm is robust to variable initialization. The skew-corrected image is shown in Fig. 2 c. 3.2 Document image with complex layout and figures Since the real skew angles of document images are difficult to obtain, we adopt the following testing method: we rotate them with an arbitrary angle  X  0 ranging from  X  45  X  to + using Adobe Photoshop, and then detect their skew angles before and after rotation. The accuracy of the method can be measured by comparing the angle difference between the two detected skew angles with the real rotation angle  X  0
Figure 3 shows some skew detection results by our algo-rithm. The top row is the process of skew detection on a com-plex image. We rotate the image with 15  X  anti-clockwise. The skew angles before and after rotation are, respectively, esti-matedtobe0 . 223  X  and 15 . 346  X  by our method. The angle the corrected image before rotation.

To test the performance of our algorithm on complex document images, we tested 350 complex document images containing text, tables, figures, and multi-layouts, and then discuss the comparison results with those by HT method, EM-method, and GL method on the following statistical parameters: the average computing time, absolute error, and detection rate. The comparative results are tabulated in Table 2 .

From Table 2 , it is obvious that our method works well in dealing with the complex document images. The HT method can detect the skew angle in documents with a little graphics or pictures, but its accuracy seriously declines when the text lines in images are not parallel. The EM-based method has poor performances when there are too many figures in the document images. Both the GL method and the EM-based method use the connected component analysis to extract fea-tures from document images, which is greatly influenced by illustrations in an image. Their accuracy is severely under-mined because of the layouts and figures in document images. Because our algorithm dose not relies on local image features and it applies global image features to drive the rectangular curve close to the boundary of content region, it can detect the skew angles accurately in those complex images that are processed unsuccessfully by other methods. 3.2.1 Noisy document images Noise, the residual components from photographic objects or scan artifacts in document images affect all skew detection methods in different ways. PP methods can deal with noise only when the noise is uniformly distributed on the whole page so that the peak evaluation on the projection profiles is not compromised. HT methods are also able to deal with moderate amount of noise of irregular distribution. However, the presence of excessive amount of noise may produce false maxima, which are the results of noise points that happen to be collinear. This severely undermines peak searching for the already fussy and weak signals in the 2D accumulator array. NN methods are weak in dealing with excessive amount of noise because the buildup of neighborhoods is easily cor-rupted by noise. Figure 4 depicts a skew detection example corrected image.

To testify the robustness of our algorithm to noisy docu-ment images, we tested about 300 document images con-taining synthetic noise or crude noise and discussed the comparison results with the other referred methods. Other referred methods cannot handle the document image with much noise. We show an example in Fig. 5 that the result of our algorithm is much better than EM-based method on different kinds of noisy document images (Fig. 5 a contains some irregular noise; Fig. 5 b has two interfering lines caused by the folded corner during the scanning process; Fig. 5 cis added salt and pepper noise artificially). Table 3 just shows the good performance of our methods on the noisy document images. 3.3 Content region detection The content region detection has been presented in Sects. 3.1  X  3.3 with the rectangle drawn on images. The rectangle, which contains the content of a document image, is a curve repre-tion of Equation 9. We compare the results with Shafait X  X  to show the advantages of our algorithm on content region detection. The method of Shafait needs to provide the sets of connected components, text lines, and zones before maximiz-ing the quality function. It cannot detect document images correctly if they consist only of complex images or graphic at the side of the page, while we can detect it accurately (as shown in Fig. 6 ). It also cannot detect the content region of music images and street map images (as shown in Fig. 3 )for text lines, and zones cannot be detected in these images cor-rectly. In [ 21 ], Shafait X  X  method only takes skew-corrected document images as input, and we are not sure if it works well on skewed document images. However, our algorithm uses global feature and does not need to detect each level whose sets may be very large in noise images. It works effectively on document images with isolate specks and black bars (as shown in Figs. 4 and 5 ). 4 Conclusions In this paper, we propose the RAC Model for skew detec-tion in the document images. Different from other algorithms based on the pixel points or the centrals of the connected com-ponents, our algorithm utilizes the global image features to mance in dealing with text-only, complex, and noisy docu-ment images. Without any pre-processing, our algorithm can accurately calculate the skew angles of both gray images and binary images, detect their content regions, remove the noise in the marginal region, and finally get the de-skewed doc-ument images. The computing speed of our algorithm is a little slower than others, but we can reduce it by rewriting the MATLAB code into C language or reducing the image size if only the skew angle of the document image is needed. When the image size is half of the original, the time will be reduced to one-third.

However, when a document image contains a large area of black bars close to the content region, they may be wrongly detected as the content regions since the current algorithm is based on the global feature. One possible way to solve the problem is to adopt two rectangles represented by different level set functions. They are kept in a constant distance in curve evolution, and one function detects the content part, while another detects the remaining non-pixel marginal part of the image.
 References
