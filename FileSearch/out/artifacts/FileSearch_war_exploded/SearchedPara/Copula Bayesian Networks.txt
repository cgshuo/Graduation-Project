 Multivariate real-valued distributions are of paramount importance in a variety of fields ranging from computational biology and neuro-science to economics to climatology. Choosing and estimating a useful form for the marginal distribution of each variable in the domain is often a straightforward task. In contrast, aside from the normal representation, few univariate distributions have a conve-nient multivariate generalization. Indeed, modeling and estimation of flexible (skewed, multi-modal, heavy tailed) high-dimensional distributions is still a formidable challenge.
 Copulas [23] offer a general framework for constructing multivariate distributions using any given (or estimated) univariate marginals and a copula function C that links these marginals. The impor-tance of copulas is rooted in Sklar X  X  theorem [29] that states that any multivariate distribution can be represented as a copula function of its marginals. The constructive converse is important from a modeling perspective as it allows us to separate the choice of the marginals and that of the depen-dence structure which is expressed in C . We can, for example, robustly estimate marginals using a non-parametric approach, and then use only few parameters to capture the dependence structure. This can result in a model that is easier to estimate and less prone to over-fitting than a fully non-parametric one, while at the same time avoiding the limitations of a fully parameterized distribution. In practice, copula constructions often lead to significant improvement in density estimation. Ac-cordingly, there has been a dramatic growth of academic and practical interest in copulas in recent years, with applications ranging from mainstream financial risk assessment and actuarial analysis (e.g., Embrechts et al. [7]) to off-shore engineering (e.g., Accioly and Chiyoshi [2]). Despite the generality of the framework, constructing high-dimensional copulas is difficult, and much of the research involves only the bivariate case. Several works have attempted to overcome this difficulty by suggesting innovative ways in which bivariate copulas can be combined to form workable copulas of higher dimensions. These attempts, however, are either limited to hierarchical [26] or mixture of trees [14] compositions, or rely on a recursive construction of conditional bivariate almost always limited to a modest ( &lt; 10 ) number of variables (see Section 6 for further discussion). Bayesian networks (BNs) [25] offer a markedly different approach for representing multivariate distributions. In this widely used framework, a graph structure encodes independencies which imply a decomposition of the joint density into local terms (the density of each variable conditioned on its parents). This decomposition in turn facilitates efficient probabilistic computation and estimation, making the framework amenable to high-dimensional domains. However, the expressiveness of these models is hampered by practical considerations that almost always lead to the the reliance on simple parametric forms. Specifically, non-parametric variants of BNs (e.g., [9, 27]) typically involve elaborate training setups with a running time that grows unfavorably with the number of samples and local graph connectivity. Furthermore, aside from the case of the normal distribution, the form of the univariate marginal is neither under control nor is it typically known. Our goal is to construct flexible multivariate continuous distributions that maintain desired marginals while accommodating tens and hundreds of variables, or more. We present Copula Bayesian Net-works (CBNs), an elegant marriage between the copula and the Bayesian network frameworks. 1 As in BNs, we make use of a graph to encode independencies that are assumed to hold. Differently, we rely on local copula functions and an explicit globally shared parameterization of the univariate densities. This allows us to retain the flexibility of BNs, while offering control over the form of the marginals, resulting in substantially improved multivariate densities (see Section 7 for a discussion of the related works of Kirshner [14] and Liu et al. [20]).
 At the heart of our approach is a novel reparameterization of a conditional density using a copula quotient. With this construction, we prove a parallel to the BN factorization theorem: a decomposi-tion of the joint density according to the structure of the graph implies a decomposition of the joint copula. Conversely, a product of local copula-based quotient terms is a valid multivariate copula. This result provides us with a flexible modeling tool where joint densities are constructed via a com-position of local copulas and marginal densities. Importantly, the construction also allows us to use standard BN machinery for estimation and structure learning. Thus, our model opens the door for flexible explorative learning of high-dimensional models that retain desired marginal characteristics. We learn the structure and parameters of a CBN for three varied real-life domains that are of a significantly higher dimension than typically reported in the copula literature. Using standard copula functions, we show that in all cases our approach leads to consistent and significant improvement in generalization when compared to standard BN models as well as a tree-structured copula model. Let X = { X 1 ,...,X N } be a finite set of real-valued random variables and let F X ( x )  X  P ( X 1  X  x ,...,X n  X  x N ) be a (cumulative) distribution function over X , with lower case letters denoting assignment to variables. By slight abuse of notation, we use F ( x i )  X  F ( X i  X  x i ,X X /X links marginal distributions to form a multivariate one. Formally, Definition 2.1: Let U 1 ,...,U N be real random variables marginally uniformly distributed on [0 , 1] . A copula function C : [0 , 1] N  X  [0 , 1] is a joint distribution function Copulas are important because of the following seminal result Theorem 2.2: [ Sklar 1959 ] Let F ( x 1 ,...,x N ) be any multivariate distribution over real-valued random variables, then there exists a copula function such that Furthermore, if each F ( x i ) is continuous then C is unique.
 The constructive converse which is of central interest from a modeling perspective is also true: since for any random variable the cumulative distribution F ( x i ) is uniformly distributed on [0 , 1] , any copula function taking the marginal distributions { F ( x i ) } as its arguments, defines a valid joint distribution with marginals F ( x i ) . Thus, copulas are  X  X istribution-generating X  functions that allow us to separate the choice of the univariate marginals and that of the dependence structure expressed in the copula function C , often resulting in an effective real-valued construction. 2 . To derive the joint density f ( x ) =  X  N F ( x )  X  X  partial derivatives (true almost everywhere when F is continuous), and using the chain rule, we have this paper as we will directly model joint densities.
 Example 2.3: A simple copula widely explored in the financial community is the Gaussian copula constructed directly by inverting Sklar X  X  theorem [7] where  X  is the standard normal distribution and  X   X  is the zero mean normal distribution with cor-relation matrix  X  . To get a sense of the power of copulas, Figure 1 shows samples generated from this copula using two different families of univariate marginals. More generally and without added computational difficulty, we can also mix and match marginals of different forms. As in the copula framework, our goal is to model real-valued multivariate distributions while taking advantage of the relative ease of one dimensional estimation. To cope with high-dimensional do-mains, as in BNs, we would also like to utilize independence assumptions encoded by a graph. To achieve this goal, we will construct multivariate copulas that are a composition of local copulas that follow the structure of the graph. We start with the building block of our construction. 3.1 Copula Parameterization of The Conditional Density As in the BN framework, the building block of our model will be a local conditional density. We start with a parameterization of such a density using copulas: Lemma 3.1: Let f ( x | y ) , with y = { y 1 ,...,y K } , be a conditional density function and let f ( x ) be such that where R c is the ratio R ( F ( x ) ,F ( y 1 ) ,...,F ( y K ))  X  and where R c is defined to be 1 when y =  X  . The converse is also true, for any copula density function c , R c ( F ( x ) ,F ( y 1 ) ,...,F ( y K )) f ( x ) defines a valid conditional density function. denominator (right-most term) is more useful than the standard normalization integral R ula function so computing our denominator is no more difficult than computing c () . Indeed, for the majority of existing copula functions, both have an explicit form. In contrast, the integral term depends both on the copula form and the univariate marginal, and is generally difficult to compute. Proof: From the basic properties of cumulative distribution functions, we have that for any copula function C (1 ,F ( y 1 ) ,...,F ( y K )) = F ( y 1 ,...,y k ) and thus, using the derivative chain rule, From Eq. (1) we have that there exists a copula density for which f ( x,y 1 ,...,y K ) = As in Sklar X  X  theorem and Eq. (1) , the converse follows easily by reversing the arguments. The implications of this result will underlie our construction: any copula density function 3.2 Decomposition of The Joint Copula Let G be a directed acyclic graph whose nodes correspond to the random variables X , and let Pa i = { Pa i 1 ,..., Pa ik { ( X i  X  NonDescendants i | Pa i ) } , where NonDescendants i are nodes that are non-descendants of X i in G . We say that f X ( x ) decomposes according to G if it can be written as a product of conditional densities f X ( x ) = Q i f ( X i | Pa i ) . It can be shown that if f decomposes according decomposes according to G (see [16], theorems 3.1 and 3.2). These results form the basis for the BN model [25] where a joint density is constructed via a composition of local conditional densities. We now show that similar results hold for a multivariate copula. This in turn will provide the basis for our construction of the CBN model.
 Theorem 3.2 : Decomposition . Let G be a directed acyclic graph over X , and let f X ( x ) be strictly positive for all values of X . If f X ( x ) decomposes according to G then the copula density c ( F ( x 1 ) ,...,F ( x N )) also decomposes according to G where c i is a local copula that depends only on the value of X i and its parents in G . Proof: Using the positivity assumption, we can rearrange Eq. (1) to get c ( F ( x 1 ) ,...,F ( x N )) = The constructive converse that is of central interest here is also true: Theorem 3.3 : Composition . Let G be a directed acyclic graph over X . In addition, let { c the nodes of G that have at least one parent. If I ( G ) hold then the function is a valid copula density c ( F ( x 1 ) ,...,F ( x N )) over X . This above theorem can be proved directly via induction or using our reparameterization lemma and standard BN results. It is important to note that the local copulas do not need to agree on the non-univariate marginals of overlapping variables. This is a result of the fact that each copula c i only appears as part of a quotient term which is used to parameterize a conditional density. This gives us the freedom to mix and match local copulas of different types. Equally important is the fact that aside from the univariate densities, we do not need to concern ourselves with any marginal constraints when estimating the parameters of these local copulas functions. 3.3 A Multivariate Copula Model We are now ready to construct a joint density given univariate marginals by properly composing local terms and without worrying about global coherence: Definition 3.4: A Copula Bayesian Network (CBN) is a triplet C = ( G ,  X  C ,  X  f ) that encodes the associated with the nodes of G that have at least one parent.  X  f is the set of parameters representing the marginal densities f ( x i ) . f X ( x ) is parameterized as Using our previous developments and applying Eq. (1) to f X ( x ) , we have: Corollary 3.5 : A Copula Bayesian Network defines a valid joint density f X ( x ) whose marginal distributions are parameterized by  X  f and where the independence statements I ( G ) hold. The main difference between the CBN model and a regular BN, aside from a novel choice for the local conditional parameterization, is in the shared global component that has the explicit semantics of the univariate marginals. Concretely, the CBN model allows us to decompose the problem of representing a multivariate distribution with given (or estimated) univariate marginals into many local problems that, depending on the structure of G , can be substantially smaller in dimension. For each family of X i and its parents we are still faced with the problem of choosing an appropriate local copula. In this work we simply limit ourselves to copulas that have convenient multivariate form, but any of the recently suggested methods for constructing multivariate copulas functions (see Section 6) can also be used. In either case, limiting ourselves to a smaller number of variables construction of the full copula over X . Importantly, as in the case of BNs, our construction of a joint copula density that decomposes over the graph structure G also facilitates efficient parameter estimation and model selection (structure learning), as we briefly discuss in the next section. As in the case of BNs, the product form of our CBN facilitates relatively efficient estimation and model selection. The machinery is standard and only briefly described below.
 Parameter Estimation Given a complete dataset D of M instances where all of the variables X are observed in each instance, the log-likelihood of the data given a CBN model C is While this objective appears to fully decompose according to the structure of G , each marginal distribution F ( x i ) actually appears in several local copula terms (of X i and its children in G ). To facilitate efficient estimation, we adopt the common approach where the marginals are estimated first [13]. Given F ( x i ) , we can then estimate the parameters of each local copula independently of the others. We estimate the univariate densities using a standard normal kernel-based approach [24]. In this work we consider two of the simplest and most commonly used copula functions. For Frank X  X  the Gaussian copula (see Section 2) with a uniform correlation parameter, we find the maximum likelihood parameters using a standard conjugate gradient algorithm. For the Gaussian copula with a full covariance matrix, a reasonably effective and substantially more efficient method is based on the relationship between the copula function and Kendall X  X  Tau dependence measure [19]. For lack of space, further details for both of these copulas are provided in the supplementary material. Model Selection Very briefly, to learn the structure of G , we use a standard score-based approach that starts with the empty network, and greedily advances via local modifications to the current structure (add/delete/reverse edge). The search is guided by the Bayesian information criterion [28] that bal-where  X   X  are the maximum-likelihood parameters, and |  X  G | is the number of free parameters asso-ciated with the graph structure G . During the search, we also use a TABU list and random restarts [10] to mitigate the problem of local maxima. See Koller and Friedman [16] for more details. We assess the effectiveness of our approach for density estimation by comparing CBNs and BNs learned from training data in terms of log-probability performance on test data. For BNs, we use a linear Gaussian conditional density and a non-linear Sigmoid one (see Koller and Friedman [16]). For CBNs, to demonstrate the flexibility of our framework, we consider the three local copula func-tions discussed in Section 4: fully parametrized Normal copula; the same copula with a single cor-relation parameter and unit diagonal ( UnifCorr ); Frank X  X  single parameter Archimedean copula. We use standard normal kernel density estimation for the univariate densities. The structure of both the BN and CBN models was learned using the same greedy structure search procedure described in Section 4. We consider three datasets of a markedly different nature and dimensionality:  X  Wine Quality (UCI repository). 11 physiochemical properties and a sensory quality variable for the red Portuguese  X  X inho Verde X  wine [4]. Included are measurements from 1599 tastings.  X  Dow Jones . 2001-2005 (1508 trading days) daily adjusted changes of the 30 index stocks. To avoid arbitrary imputation, two stocks not traded in all of these days were excluded (KFT,TRV).  X  Crime (UCI repository). 100 observed variables relating to crime ranging from household size to fraction of children born outside of a marriage, for 1994 communities across the U.S.
 Figure 2 compares average log-probability (y-axis) for 10 random equal train/test splits as a function of the maximal number of parents allowed in the network (x-axis). Results for the linear Gaussian BN were almost identical to those of the sigmoid BN for the Wine and Dow Jones datasets and inferior for the Crime dataset, and are omitted for clarity. For all datasets, the copula based models Remarkably, the single parameter (for each local density) UnifCorr model is superior to the BN model even when the latter utilizes up to 8 local parameters (with 4 parents). In fact, even Frank X  X  single parameter Archimedean copula which is constrained by the fact that all of its K -marginals are equal [23], is superior to the BN model. Importantly, the advantage of the CBN model is significant as the units of improvement are in bits/instance. That is, an improvement of 2 bits/instance translates into each test instance being, on average, four times as likely. 3 It is also important to note the benefit that comes with structures that are richer than a tree. As the number of allowed parents (x-axis) is increased, gains are relatively small when the dimensionality of the domain is limited (12 variables); The gains are, however, quite substantial for the more complex domains.
 To understand the role of the univariate marginals, we start with the no dependency network (0 on x-axis), where the advantage of CBNs is solely due to the use of flexible univariate marginals. Surprisingly, even with single parameter copulas, although much simpler than the Sigmoid form used for the BN model, we are able to maintain much of that advantage as the model becomes more complex. As expected, this is not the case when we constrain the CBN model to have normal marginals ( Normal-UnifCorr ) and when the domain is sufficiently complex ( Crime ).
 To get a sense of the overall dependency structure, Figure 3 shows the number of edges learned for the different models. For the Wine dataset, the linear BN attempts to compensate for its constrained form by using substantially more edges than the non-linear Sigmoid BN. The Kernel-UnifCorr Normal-UnifCorr CBN model, despite the forced normal marginals, does not lead to overly com-plex structures as it is constrained by the simplicity of the copula function (single parameter). For the challenging Crime dataset, the differences are more pronounced: both the linear and non-linear BN models almost saturate the limit of 4 parents per variable, while the Kernel-UnifCorr copula model requires, on average, less than half the number of parents to achieve superior performance. Finally, in Figure 4, we demonstrate the qualitative advantage of CBNs by comparing empirical values from the test data (left) with samples generated from the different models. For the  X  X hysical density X  and  X  X lcohol X  variables (top), the CBN samples (middle) are better than the BN ones (right), but not dramatically so. However, for the  X  X esidual sugar X  and  X  X hysical density X  pair (bottom), where the empirical dependence is far from normal, the advantage of the CBN representation is clear. We recall that the CBN model uses a simple normal copula so that the advantage is solely rooted in the distortion of the input to the copula created by the kernel-based univariate representation. With more expressive copulas we can expect further qualitative and quantitative advantages. For lack of space we do not discuss direct multivariate copula constructions (e.g., [8, 15, 18, 22]) that are typically effective only for few dimensions, and focus on composite constructions that build on smaller (bivariate) copulas. The Vine model [3] relies on a recursive construction of bivariate copulas to parameterize a multivariate one. Although it uses a graphical representation, the framework is inherently different from ours: conditional independence is replaced with a conditional dependence whose parameters depend on the conditioning variable(s). Kurwicka and Cooke [17] reveal a direct connection between vines and belief networks, but that is limited to the scenario of elliptical bivariate copulas. Relying on the same representation, Aas et al. [1] suggest an alternative construction methodology. While the vine representation is certainly general, the need to condition on many variables using a somewhat elaborate construction limits practical applications to a modest number of variables. Aas et al. [1] do note the simplification that can result from making independence assumptions, but do not provide a general framework for doing so. Savu and Trede [26] suggest an alternative model that is limited to a hierarchical tree structure of bivariate Archimedean copulas. Kirshner [14] uses the copula product operator of Darsow et al. [5] to suggest a mixture of trees model that is directly motivated by the field of graphical models. The relationship between our model to theirs is the same as that of a general BN to a mixture of trees model [21]. Most recently, Liu et al. [20] consider a general sparse undirected copula-based model that is focused on the semi and non-parametric aspect of modeling, and is specific to the case of the normal copula. Finally, it is important to put the dimension of the domains we consider in this work (up to 100 small number ( &lt; 10 ) of variables. Heinen and Alfonso [11] are unique in that they consider 95 variables, but using an approach that is tailored to the specific details of the GARCH model. We presented Copula Bayesian Networks, a marriage between the Bayesian network and copula frameworks. Building on a novel reparameterization of the conditional density, our model offers great flexibility in modeling high-dimensional continuous distribution while offering control over the form of the univariate marginals. We applied our approach to three markedly different real-life datasets and, in all cases, demonstrated a consistent and significant generalization advantage. Our contribution is threefold. First, our framework allows us to flexibly  X  X ix and match X  local copulas and univariate densities of any form. Second, like BNs, we allow for independence as-sumptions that are more expressive than those possible with tree-based constructions, leading to generalization advantages. Third, we leverage on existing machinery to perform model selection in significantly higher dimensions than typically considered in the copula literature. Thus, our work opens the door for numerous applications where the flexibility of copulas is needed but could not be previously utilized. In a companion paper [6], we also show that CBNs give rise to an efficient inference procedure.
 The gap between train and test performance for CBNs motivates the development of model selection scores tailored to the copula framework (e.g., based on rank correlation). It would also be interesting to see if our framework can be adapted to the cumulative scenario, while allowing for independencies quite different from the recently introduced cumulative network model [12]. I am grateful to Ariel Jaimovich, Amir Globerson, Nir Friedman and Fabio Spizzichino for their comments on earlier drafts of this manuscript. G. Elidan was supported by the Alon fellowship.
