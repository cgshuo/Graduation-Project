 The problem of modeling topics on user behavior data in social networks has been widely studied in social marketing and social emotion analysis, where latent topic models are commonly used as the solutions. The user behavior data are highly related in time and space, which demands new latent topic models that consider both temporal and spa-tial distances. However, existing topic models either fail to model these two factors simultaneously, or cannot han-dle the high order dependence among user behaviors. In this paper we present a new nonparametric Bayesian mod-el Time and Space Dependent Chinese Restaurant Processes (TSD-CRP for short). TSD-CRP can auto-select the num-ber of topics and model high-order temporal and spatial de-pendence behind user behavior data. Empirical results on real-world data sets demonstrate the effectiveness of the pro-posed method.
 Topic models, social networks, nonparametric Bayesian mod-els, temporal and spatial dependence
Topic modeling plays an important role in social network applications, such as social marketing, user behavior model-ing, and emotion analysis [1, 2, 3]. In this paper, we study a challenging problem of modeling time and space dependent user behavior data in social networks.

Latent topic models are widely used in modeling user be-havior data in social network [1, 2]. The basic assumption behind these models is that a user X  X  behavior is determined by a set of latent variables. By learning the latent variables, c  X  we can learn user behavior patterns. To date, existing laten-t topic models mainly consider text content extracted from behavior data. However, in reality, user behavior data in social networks are highly correlated w.r.t. time and space.
The temporal and spatial factors inspire us to model us-er behavior data beyond just text data in social networks. Although recent work on topic models such as the regres-sion based latent factor models [1] consider both tempo-ral and spatial factors, these models are not designed to handle long distance/term dependence. However, long dis-tance/term dependence is common for users 1 .

To model the spatio-temporal topic in social networks, we present a new Bayesian nonparametric model Time and Space Dependent Chinese Restaurant Processes (TSD-CRP for short) that can auto-select a proper number of topics. As TSD-CRP combines both spatial and temporal distances into a unified distance measure, where the temporal-spatial distance serves as a prior knowledge of two behavior records belonging to the same topic. So it can naturally model high order of dependence. Empirical results on real-world data sets demonstrate the effectiveness of the TSD-CRP.
To model time-dependent topics, a line of topic models have been proposed to extend the original LDA on temporal data [2, 4, 5]. However, these works were constructed un-
From the perspective of time, some topics may merge peri-odically with long intervals. From the perspective of space, some users (especially celebrities) may influence users with indirect relations. der a strict Markov assumption and thus require to set the number of topics in advance. However, the topic number cannot be predefined and high-order dependence between user behavior records need to be considered. To model space dependent topics, existing work [3, 6] uses various types of regularization terms to enable users falling in the same space cluster to be classified together. However, the regularization terms are restricted to neighbors due to the expensive time cost and many parameters to tune. In fact, user behavior records from high-order neighbors are also correlated. Re-cently, a number of work combines both temporal and spa-tial factors in a single model [1, 7]. However, most of these models directly combine the previous mentioned technolo-gies for modeling temporal and spatial dependence. With temporal and spatial factors involved, these models would become drastically complex.
 Based on the above observations, we proposed a novel TSD-CRP model to address this problem. Our model differs from existing temporal and spatial topics models in that our model describe long term-distance dependence through a unified temporal-spatial distance measurement, and our model can auto-select proper number of topics based on data at hand.
We first briefly introduce the problem setting. The be-havior data of user u at time t location l is denoted as x = ( w,u,t,l ), where w is the text content determined by both the latent topic z and the parameter of the topic  X  z i.e., w  X  F (  X  z ).

Our goal is to discover the time and space dependent la-tent topics under the observed user behavior data. We wish to have solutions with two properties. First, behavior da-ta assigned to the same topic are concentrated with respect to both time and space. Second, the number of topics are auto-selected.

As a generative model, we first introduce the generative process of TSD-CRP, then we present the method to mea-sure the temporal and spatial distance between user behav-ior data records.
In TSD-CRP, data records are generated sequentially. For each record i , a link c i is generated from i to one of its previ-ous records. The probability of c i = j is determined by the distance d i,j between i and j . A record can also link to itself (e.g., a new topic is created) with a probability proportional to a scaling parameter  X  . The topic assignment can be de-rived from these links, i.e., two data records share the same topic if they are mutually reachable, as depicted in Figure 1. Once the topic assignments are determined, the observed content are generated based on the parameters of the top-ics. The general procedure of TSD-CRP is summarized in Eq. (1). where  X  is the scaling factor, d ij is a distance between cus-tomer i and j , f (  X  ) is the decay function which mediates how distance affects the probability of customer assignments, H Figure 1: Top: an illustration of the data assign-ments of TSD-CRP in a social network with five users. The color of the circles indicates the laten-t topics of user behavior data (gray circles indicate the absence). Each arrow denotes a data assignmen-t. Bottom: The corresponding topic assignments of user behavior data. is the base measure of topics,  X  k is the parameter of the topic, and z ( c ) is the topic assignments inferred from c
Based on the generation procedure of TSD-CRP, the de-pendence between records are determined by the distance d i,j and the decay function f (  X  ). Then, two problems need to be settled: Behavior distance measure. The temporal distance of behavior data is measured by their time difference. As be-havior data records are obtained sequentially, a record only depends on previous records. So we have the following defi-nition, Definition 1. Temporal distance T i,j for user behavior data x i = ( u i ,t i ,l i ,w i ) and x j = ( u j ,t j ,l sured as
We consider both online and offline distances to measure the spatial distance between behavior data records. The on-line distance can be measured by the number of hops of the shortest path from u i to u j , which is denoted by  X  on u u tance, we assume that if two users are at the same location, i.e., l i = l j , the off-line distance is defined as  X  off erwise  X  off u i ,u j =  X  . Note that we do not use the Euclidean distance between users, as it is hard to calculate and often bring noise [7]. To sum up, we have the following definition, Definition 2. The spatial distance S i,j between x i = ( u i ,t i ,l i ,w i ) and x j = ( u j ,t j ,l j ,w j ) is defined as u i to u j .  X  off u i ,u j = 1 if locations l i = l j ; otherwise  X   X  . Algorithm 1 Fully Bayesian TSD-CRP.
 Input: A social network G = { U,E } , Time span T ; Output: User behavior data records X . 1: Initialization as  X   X  Gamma ( k  X  , X   X  ), i  X  0, X =  X  2: for t = 0 : T,u  X  U do 3: if u is active in t then 4: i  X  i + 1; 5: Calculate { d i,j | j = 0 : i  X  1 } with Eqs.(2 3 4); 6: Generate c i as in Eq.(1); 7: if c i = i then 8: Assign to a new cluster,  X  new  X  H , z i  X  i ; 9: else 10: Assign to an existing cluster, z i  X  z c i ; 11: end if 12: Generate content, w i  X  F (  X  z i ); 13: Append x i = { u,t,l i =  X  ,w i } to X ; 14: end if 15: end for 16: return X
Intuitively, influential time span of a behavior data record decays rapidly along the social connections, so we use a non-linear combination of S i,j and T i,j to define the unified dis-tance measure between behavior records.
 Definition 3. The temporal-spatial distance d i,j between x Decay function. The decay function f ( d i,j ) defines the re-lationship between the probability of c i = j and the distance d i,j . Intuitively, the shorter the distance is, the more likely that the two behavior data records are assigned to the same topic. To model a high-order dependence, we set f ( d i,j even for large d i,j . So we use the exponential decay function with parameter  X  , i.e, f ( d ) = e  X   X d .

Determining the parameter  X  is difficult. We add a prior distribution to  X  and make TSD-CRP to be a fully Bayesian model. So the parameter  X  will be inferred from the data. As  X  is limited to be positive, we use the Gamma prior for  X  with vague parameters ( k  X  , X   X  ),
The generation procedure of the fully Bayesian TSD-CRP is summarized in Algorithm 1.
Model learning is to compute the posterior distribution of the latent variables, i.e., the customer assignments c the global parameters  X  conditioned on the observed user behavior data x 1: N , the hyper-parameters { k  X  , X   X  ,H, X  } and the behavior distance matrix D = { d i,j | i,j = 1 : N } . As the direct evaluation, we use Expectation-Maximization (EM) algorithm. In the E-step, we estimate the expectation of customer assignments c 1: N with  X  fixed. In the M-step, we maximize the expectation of data likelihood w.r.t.  X  . E-step. In the E-step, we use Gibbs sampling to iteratively sample c i with the remaining data links c  X  i fixed, p ( c i | c  X  i ,x 1: N ,D, X , X ,H )  X  p ( c i | D, X , X  ) p ( x The first term is the prior given in Eq.(1). The second term describes the likelihood of observations which can be decom-posed as follows: p ( x 1: N | z ( c 1: N ) ,H ) = c
Sampling from Eq. (6) takes two stages. First, we remove the customer assignment c i from the current configuration. Second, we consider the probability of each possible value of c and how it changes the likelihood term by moving from pled with Eq. (8), M-step. In the M-step, we update  X  by maximizing the expectation of the data likelihood, which is equivalent to finding its posterior with c 1: N fixed. p (  X  | c 1: N ,k  X  , X   X  )  X  L (  X  | c 1: N )  X  Gamma (  X  | k updated by Eq.(10):
The inference procedure iterates the E-step and M-step until convergence.
 Time Complexity. At each iteration, the E-step needs to sample customer assignment of all behavior data c For each c i , the complexity is determined by the sample to be a const value for a given data set. So the time cost of the E-step is O ( NS ). The M-step needs to update the global parameter, whose time cost is O ( N ). Thus, the time complexity of one iteration of the EM procedure is O ( NS ). Data sets. The statistics of the data sets are summarized in Table 1. We mainly use location in user profile to calculate spatial distance between records.
 Benchmarks. We compare TSD-CRP with CRP [8] , Re-current CRP (RCRP) [2], Dynamic Topic Models (DTM) [4], and Topic-link LDA (TL-LDA) [6] 2 .
 Measures. TSD-CRP defines a probability distribution over unseen data. Models that give higher probability to the unseen records better capture the topic distributions. We randomly select 5% records in the data set as the test
Some previously mentioned user behavior models, such as [1, 7], belong to collaborative filtering models, which cannot model user topics. Datasets # Users # links # Behaviors Time span Weibo 3 14K 344K 1.81M 3 months Douban 4 10K 189K 0.87M 4 months Table 2: Comparisons w.r.t. log-likelihood (  X  10 7 ). Weibo -14.92 -15.22 -15.08 -15.62 -15.42
Douban -4.474 -4.629 -4.504 -4.781 -4.843 data to calculate the likelihood, and use the rest of the data as training set. Comparisons w.r.t. log-likelihood. In this test, we com-pare the results on behavior data records w.r.t. the log like-lihood. The results are given in Table 2. We can observe the following results. First, TDS-CRP outperforms other meth-ods in the data sets, which demonstrates that temporal and spatial information can help improve model accuracy. Sec-ond, parametric Bayesian models, e.g., DTM and TL-LDA, performs worse than nonparametric Bayesian models. This is because nonparametric models can auto-select the number of topics and thus more robust on the user behavior data in social networks.
 Exploring temporal dependences. The topics recovered by TDS-CRP are concentrated in the temporal dimension. We visualize the temporal dependence by plotting the topic distribution over time in Figure 2 (a,b). As the total number of topics is huge, we only plot the top-20 topics. We observe that topics are highly concentrated w.r.t. time. The result is more obvious on the data set Weibo than on Douban. More-over, TSD-CRP can model periodic topics which cannot be modeled by previous methods.
 Correlation between spatial and temporal depen-dences. We also test the relationship between the temporal and spatial distances for records falling into the same top-ic. The results are depicted in Figure 2(c). We can observe that the closer the spatial distance the larger time span two records are correlated.
In this paper, we study a challenging problem of modeling time and space dependent user behavior data in social net-works. We present a new Bayesian nonparametric model, http:\\www.weibo.com , the twitter-like SN in China. http:\\www.douban.com .
 TSD-CRP, to model the temporal and spatial factors hid-den behind user behavior data. We briefly summarize our contributions as follows: 1) As a nonparametric Bayesian model, TSD-CRP can auto-select the number of topics; 2) TSD-CRP can handle high-order dependence among user behaviors; 3) TSD-CRP uses a unified measure to describe spatial and temporal distances without using any complicat-ed regularization terms that have many parameters; 4) In experiments, we validate that TSD-CRP outperforms the state-of-the-art social behavior topic models on real-world data sets.
This work was supported by the NSFC (No. 61370025), and the Strategic Leading Science and Technology Projects of CAS (No.XDA06030200), 973 project (No. 2013CB329605) and Australia ARC Discovery Project (DP140102206). C. Zhou is corresponding author. [1] D. Agarwal and B.-C. Chen. Regression-based latent [2] A. Ahmed and E. P. Xing. Dynamic non-parametric [3] A. Anagnostopoulos, R. Kumar, and M. Mahdian. [4] D. M. Blei and J. D. Lafferty. Dynamic topic models. [5] N. Du, M. Farajtabar, A. Ahmed, A. Smola, and [6] Y. Liu, A. Niculescu-Mizil, and W. Gryc. Topic-link [7] Z. Lu, D. Agarwal, and I. S. Dhillon. A spatio-temporal [8] J. Pitman. Exchangeable and partially exchangeable
