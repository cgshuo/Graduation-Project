 Avraham Ruderman AVRAHAM.RUDERMAN@NICTA.COM.AU Mark D. Reid MARK.REID@ANU.EDU.AU Dar X o Garc X a-Garc X a DARIO.GARCIA@ANU.EDU.AU James Petterson JAMES.PETTERSON@NICTA.COM.AU NICTA, Canberra, Australia An important class of discrepancy measures between probability distributions is the family of f -divergences divergences (Csisz X r, 1967)). These include the vari-ational divergence, the Hellinger distance, and the well-known Kullback-Leibler (KL) divergence. Esti-mates of these measures from two i.i.d. samples can be used to test whether or not those samples come from similar distributions. Due to the convexity of the eponymous f function defining them, f -divergences can be expressed variationally as the maximum of an optimisation problem. This variational represen-tation has been recently used for f -divergence estima-tion (Nguyen et al., 2010; 2007; Kanamori et al., 2011) homogeneity testing (Kanamori et al., 2011) and pa-rameter estimation (Broniatowski &amp; Keziou, 2009). This paper stems from a simple observation: the vari-ational representation currently being used in the lit-erature fails to take into account the fact that di-vergences are defined between probability distribu-tions. In an analysis similar to that of Altun and Smola X  X  (Altun &amp; Smola, 2006), we present a deriva-tion of a quantifiably tighter variational representation of f -divergences. Our derivation restricts the convex dual used in the variational representation of an f -divergence to the space of probability distributions. This generalises similar observations for the specific case of the KL divergence, such as Banerjee X  X  com-pression lemma (Banerjee, 2006). These results are given in the remainder of this section.
 Clearly, use of this tighter variational representation in any algorithm relying on the previous bounds would be advantageous. Thus, we suspect this tighter bound will find broad applicability as the weaker variational form is already widely used. As an example of this, in section 2. we derive a general dual program for an RKHS estimator which has a simple closed form for any f -divergence. We show this dual program has a natural interpretation as a trade off between the min-imisation of the f -divergence in question and the mini-mum mean discrepancy (MMD) (Gretton et al., 2008) between the empirical distributions. Experiments in section 3 confirm that the tighter variational form un-derlying our approach leads to better KL divergence estimates than the well known estimator of (Nguyen et al., 2010; 2007) which is based on the looser rep-resentation. We also provide an empirical comparison to other state of the art methods for f -divergence es-timation. 1.1. Convex Duality We briefly introduce some key ideas from convex du-ality. The reader is referred to (Barbu &amp; Precupanu, 1986) for details. For functions f : X  X  R defined over a Banach space X the (Fenchel or convex) dual f ? : X ?  X  R of a function is defined over the dual space X ? by f ? ( x ? ) := sup  X  X  ,  X  X  is the dual pairing of X and X ? . In finite di-mensional spaces such as R d the dual space is also R d and  X  X  ,  X  X  is the usual inner product. The bidual f ?? : X  X  R of f is just the dual of f ? (restricted to X ), that is, f ?? ( x ) = sup convex, lower semi-continuous (l.s.c.) functions f the bidual is the identity transformation, that is, f ?? = f . As seen below, this fact forms the basis of many vari-ational representations of operators defined by convex functions. 1 We make use of a few specific, one-dimensional in-stances of duals. Specifically, when f ( t ) = | t  X  1 | we have f ? ( t ? ) = t ? for t ?  X  [  X  1 , 1] ; and when for t ? &lt; 0 . Further details and properties of convex duals can be found in texts on convex analysis, e.g., (Hiriart-Urruty &amp; Lemar X chal, 2001).
 One obvious but important property we make use of is that the restriction of a supremum leads to smaller optima. Specifically, if X 0  X  X then sup sup x  X  X  X  ( x ) . When applied to convex duals, this means if R  X  X ? is a restriction of the dual space then f ( x )  X  f R ( x ) := sup 1.2. Variational Approximations of An f -divergence is defined via a convex function f : [0 ,  X  )  X  R satisfying f (1) = 0 . Given such a func-tion, the f -divergence from a finite measure P to a distribution Q defined on a common space X is de-fined 2 as
I f ( P,Q ) := E Q f if
P Q and +  X  otherwise. We will refer to the definition above as the general (or unrestricted) f -divergence in contrast to the restricted f -divergence that is only defined when P and Q are both prob-ability distributions. When necessary, the restricted f -divergence will be distinguished by a superscript R : I R show how a tighter variational representation can be obtained from explicitly taking into account the re-striction. Several common divergences are members of this class: the variational divergence is obtained by choosing f ( t ) = | t  X  1 | , Hellinger divergence via f ( t ) = (see, e.g., (Reid &amp; Williamson, 2011)). For technical reasons we also require f to be lower semi-continuous. All f -divergences discussed above and used in practice satisfy this condition.
 As in (Altun &amp; Smola, 2006; Barbu &amp; Precu-panu, 1986; Broniatowski &amp; Keziou, 2009), we now wish to consider f -divergences as acting over spaces of functions. Given a measure  X  over X (with some  X  -algebra), the norms k g k k g k  X  := inf { K  X  0 : | g ( x ) | X  K for  X  -almost all can be used to define the space of absolutely in-tegrable functions L 1 (  X  ) := { g : X  X  R : k g k and its dual space L  X  (  X  ) := { g : X  X  R : k g k of functions with bounded essential supremum. The space of probability densities w.r.t.  X  will be denoted mains X = { x denoted  X  n . A general f -divergence can be seen as acting on L 1 ( Q ) by defining I I f,Q ( r ) := I f,Q ( r ) As shown below, these functions are convex and lower semi-continuous and therefore admit dual representa-tions. As explored in (Nguyen et al., 2010; Altun &amp; Smola, 2006) and in section 2 below, variational repre-sentations such as these readily admit approximation techniques via a restriction of the optimisation for I to functions from F  X  L  X  ( Q ) (e.g., an RKHS). Our main result is that the restricted variational form guar-antees tighter lower bounds on f -divergences than the unrestricted form for any choice of function class. Theorem 1. For any distributions P and Q such that P Q we have and for any choice of function class F  X  L  X  ( Q ) We illustrate the result of Theorem 1 in Figure 1. While our new expression and that of (Nguyen et al., 2010) have the same supremum, our expression is closer to the supremum at every point  X   X  L  X  ( Q ) . In particular, if one restricts  X  to vary over a subset will yield a better estimate of I Proof. We first establish that I f,Q is a convex func-cupanu, 1986) which states that for any finite mea-sure Q over X and any proper convex l.s.c. function f : [0 ,  X  )  X  R  X  X  +  X  X  the function F : L q ( Q )  X 
X f ( u ) dQ I f,Q ( r ) = the proposition, we have that I The variational representation for I by using Lemma 4.5.8 of (Dembo &amp; Zeitouni, 2009). This states that for any Banach space X with dual X ? , if
F : X  X  R  X  X  +  X  X  is convex and l.s.c. then F ( x ) = l.s.c. on L 1 ( Q ) we see that I f,Q ( r ) = sup for all r  X  L 1 ( Q ) since L  X  ( Q ) is the dual space to L ( Q ) . In particular, we can conclude that for all r  X  L ( Q ) and all  X   X  L  X  ( Q ) Now, since I R on the rest of L This implies that for all  X   X  L  X  ( Q ) and for all p  X   X ( Q ) we have I R f,Q rearranged and optimised over  X   X  L  X  ( Q ) yields (2). We now observe that (5) is just a constrained version of the optimisation defining ( I must have I R (4) we see that for any p  X   X  ( Q ) , X   X  L  X  ( Q ) I Taking supremums over these inequalities for  X   X  X   X  L  X  ( Q ) yields (3), as required.
 For the particular case of KL divergence estimation the above theorem specialises to show that for any choice of  X   X  L  X  ( Q ) KL ( P,Q )  X  E P [  X  ]  X  ln E Q e  X   X  E P [  X  ]  X  E Q e  X  The first inequality is the well-known representation of the KL divergence in the large deviations literature (Donsker &amp; Varadhan, 1983) which has been rediscov-ered in the PAC-Bayes community as the compression lemma (Banerjee, 2006). Although the second inequal-ity can be obtained immediately from the fact that  X  log ( y )  X   X  y + 1 for all y &gt; 0 , Theorem (1) shows that a similar result holds for general f -divergences. Given two samples 3 X { y 1 ,...,y n } the empirical measures P no longer have P required. We make use of the restricted dual varia-tional representation of the f -divergence and choose a sufficiently constrained function class over which the supremum is taken when computing the dual. Specifi-cally, we let H X  L ing kernel K and corresponding feature map  X  and choose some convex regularizer  X  : H  X  R  X  X  +  X  X  , for example, some function of the RKHS norm k X k As in (Nguyen et al., 2010), our estimator is then de-fined via the dual representation of I R into account the regulariser  X  , i.e.,
E ( P n ,Q n ) := sup The following result gives an explicit dual optimisation program for computing E in the RKHS H .
 Theorem 2. Let H be an RKHS of functions over X with associated feature map  X  . Then the estimator E ( P n ,Q n ) satisfies, for all P n and Q n
E ( P n ,Q n ) = min where the minimisation is over the n -simplex  X  n . Proof. The proof techniques here are based on those in (Nguyen et al., 2007). Since H is a RKHS, we can represent each function h  X  H by h ( x ) =  X  w,  X  ( x )  X  for x  X  X where  X  is the feature map corresponding to K . In this case, the estimator in (6) is given by sup Letting  X  ( w ) :=  X  1 I expression gives sup by the definition of a dual. By the infimal convolution theorem (Rockafellar, 1997) we therefore have
E ( P n ,Q n ) = min Now, since  X  is linear in w its dual is simply To compute the dual of  X  we observe that I R only depends on the values of h at y write  X  ? ( r ) = sup by the introduction of Lagrange multipliers  X  ( y the constraints h ( y since the first inner supremum is the bidual of I R and the second supplies the constraint. Furthermore, since  X ( y determines  X  at y stituting  X  ? ,  X  ? , and the corresponding constraints on s and r back into the minimisation (8) and noting that I result: E ( P n ,Q n ) = min We note that E ( P I ( P,Q ) due to the inclusion of the regularisation term  X ( h ) . However,  X  ? ( r ) = I R f,Q can be used as an empirical estimate of I the values of  X  as an estimate of dP/dQ . Thus, the theorem above gives an easily implementable algorithm for estimating f -divergences.
 Computing  X  ? for particular choices of  X  in equation (7) immediately gives the following corollary which de-fines two concrete estimators.
 Corollary 3. For  X ( g ) =  X  n 2 k g k 2 H E ( P n ,Q n ) = min and for  X ( g ) = E ( P n ,Q n ) = min . The minimisation in (10) is similar to the one discussed in (Altun &amp; Smola, 2006) which is concerned with den-sity estimation from a single sample. Our estimator can be seen as an extension of that procedure to the two sample setting. The estimator M2 proposed in (Nguyen et al., 2010) uses square norm regularisation in a two sample setting and is therefore directly com-parable to (9). The key difference is that we restrict the minimisation to  X  n whereas the M2 minimisation is over  X   X  0 . 2.1. Connections with Maximum Mean The relation of the optimisation program in (9) to the original f -divergence is compelling. The first term f divergence of the likelihood ratio dP to be uniform over y imising this term alone would force the  X  i . In this sense, the first term can be seen as a kind of generalised MaxEnt regularisation.
 The second term can be seen as a term that forces the  X  vectors  X ( x 2008), we can formalise the observation regarding the second term by considering the mean map  X  from distributions R over X to functions in an RKHS H defined by R 7 X   X  [ R ] := E mum mean discrepancy (MMD) between distributions P and Q is then defined to be the distance between their respective images under  X  , that is, MMD ( P,Q ) = k  X  [ P ]  X   X  [ Q ] k H . The second term in our estimator discrepancy between the distributions corresponding to the densities dP that term alone corresponds to an unregularised es-timation of the density ratio dP/dQ . Similarly, for other choices of regularisation  X  which are a function of k  X  k function of MMD ( P This analysis also leads to an intuitive explanation why we should use the regularisation schedule  X  (Gretton et al., 2008) that the MMD estimator converges to a normal distribution with constant vari-ance. If  X  is suitably bounded away from infinity, the same holds for the second term in (9) as long as  X  MMD term will eventually dominate the general Max-Ent term which converges to a positive constant if P 6 = Q . On the other hand if  X  n diminishes more slowly, then the MMD term will go to zero even for an incorrect density ratio. Theorem 1 shows the restricted variational bound de-rived here is strictly tighter than the one proposed by (Nguyen et al., 2010) (henceforth NWJ) for ev-ery function r  X  L 1 ( Q ) except when r = dP/dQ in which case they coincide and attain the optimum. This suggests that the optimisation problem derived using our tighter bound should result in an estimator with a smaller bias. This section presents some em-pirical results demonstrating this improvement. We also conducted experiments to compare our method and Nguyen et al X  X  method to others methods in the literature which are not based on variational represen-tations of f -divergence. While these non variational methods are not the focus of the experiments, we in-clude them here as they may be of interest to oth-ers. In the context of the current work however, we emphasise the superior performance of our estimator compared to that of NWJ illustrating the utility of the tighter variational representation. We include the following recent estimators for comparison:  X  Wang et al (Wang et al., 2009): This estimator is  X  Kanamori et al (Kanamori et al., 2009): This  X  Garc X a et al (Garc X a-Garc X a et al., 2011): This 3.1. Method Both our estimator based on (9) and the M2 estimator of NWJ were implemented using the nonlinear convex optimisation routine from the python package Cvx-opt to perform the optimization. The implementa-tion of the Wang et al. (Wang et al., 2009) estimator (henceforth WKV) was based on the cKDTree nearest neighbour routine from the SciPy library. Kanamori et al 4 . (uLSIF) and Garc X a et al 5 ( ( f,l ) ) algorithms were implemented using code provided by the respec-tive authors 6 . The method for choosing the parame-ters  X  in (Nguyen et al., 2010). For both NWJ and our es-timator, we therefore set  X  and set  X  to the sample variance over X invariance with respect to rescaling of the data. In every experiment, the distributions P and Q were set to beta distributions B (  X , X  ) for some choice of parameters  X , X  &gt; 0 . Beta distributions were chosen as they cover a wide variety of shapes and have a KL divergence with the following analytic form where d function. For each choice of P and Q , a 1-dimensional and a 10-dimensional experiment was performed. In the 1-d experiment , samples of n = 100 values, X and Y tively. In the 10-d experiment , each x  X  X and y  X  Y spective product distributions P  X  Q 9 tributions embedded in a 10-dimensional space where all but one of the dimensions is zero mean Gaussian noise. The KL divergences for the 10-d product distri-butions for each choice of P and Q are the same as for the 1-d case, that is, KL ( P,Q ) . The specific P and Q in the experiments were chosen to give a range of dif-ferent KL divergence values and explore a few different pairings of distributional shapes. 3.2. Results Table 1 summarises the application of all five esti-mators over 250 runs of the 1-d (odd rows) and 10-d experiments (even rows) for various choices of P and Q shown in the first column. The pairs of rows are ordered in increasing value of true KL divergence (shown in the second column) and is the same for both rows. The table lists the divergence estimates averaged over the different runs as well as the empirical Mean Squared Error (MSE). The bold values for the MSE correspond to the lowest amongst the different esti-mators. Where the MSE of our estimator or that of NWJ is strictly lower than the other, we have italicised the MSE. The last three columns are in grey as they are not the main point of the experiments. 3.3. Discussion For the most part our estimator performs better in terms of MSE than that of the NWJ. When the true divergence is large, the difference is especially pro-nounced. This is unsurprising as our estimator is based on a tighter bound for the divergence as The-orem 1 shows. For small divergences the difference is smaller since roughly speaking, 0  X  NWJ  X  Ours  X  KL ( P,Q ) . Thus, for small divergences the estimators must necessarily return similar values.
 In contrast, the nearest neighbour-based methods (WKV and ( f,l ) ) behave very differently to variational estimators. In general, their bias is significantly lower than both variational methods when the real diver-gence is large. This is a natural conclusion, since the variational methods presented here are intrinsi-cally lower bounds of the real divergence. Finally, we note that uLSIF does not perform as well as the other methods. This is to be expected as uLSIF is primar-ily designed for density ratio estimation while the rest of the methods are derived specifically for divergence estimation.
 On the 10-d experiments, the MSE performance of the WKV estimator is typically much worse than the rest of methods. It consistently over-estimates the true KL shoots it, resulting in an order of magnitude larger MSE than the other estimators. One likely explana-tion of this poor performance of WKV on the higher dimensional problems is that its estimated values scale with the dimension of the data. This scaling occurs even if the two distributions differ only on a low di-mensional manifold, as they do in the 10-d experi-ments. The success of this estimator in the B (1 , 1) vs B (10 , 10) experiment is likely a coincidence. All the estimators underestimate this divergence in the 1-d case and we expect that the scaling of WKV with the dimension has pushed its estimate up to the true KL. The ( f,l ) estimator, although also based on nearest neighbour techniques, does not suffer from this prob-lem since it does not present a explicit dependance of the estimated divergence with respect to the ambient dimension.
 In light of these observations, we offer some guide-lines as to which estimator to use if one has some prior knowledge or suspicion about the data. Use our method when suspecting a low divergence; use ( f,l ) for high divergence. We also recommend using varia-tional methods over nearest neighbour estimators for hypothesis testing if false positives are a concern since the variational methods are much more likely to con-sistently underestimate the true divergence. It is im-portant however to note that if running time is an issue then WKV becomes a very attractive option. There are many fast approximate nearest neighbour algorithms resulting in fast estimation of the WKV statistic. We have shown how tighter variational representations for f -divergences can be derived by restricting the ef-fective domain of the divergence functional to the set of probability measures. Since many works in the lit-erature are based on variational representations, this tighter version presents many potential applications. As an example of this, a dual program for f -divergence estimators based on this tighter representation was de-rived for density ratios within an RKHS H and ar-bitrary convex regularizers. This tightened and ex-tended the M2 estimator proposed in (Nguyen et al., 2010) and we demonstrated empirically the benefits of our analysis. We also gave a novel interpretation of the dual program in terms of MMD which showed that our estimator can be seen to find an approximation  X  r  X  X  of the density ratio that attempts to simultaneously minimises MMD between P cal f -divergence E can be seen as a generalised maximum entropy regular-isation. We have also provided a comparison to other state of the art estimators. We concluded that vari-ational methods are good for settings in which a low divergence is suspected or in scenarios where overesti-mation is detrimental.
 As future work we intend to investigate the impact of this tightened representation on other divergence es-timators based on the looser representation such as (Kanamori et al., 2011), as well as to areas other than f -divergence estimation (hypothesis testing and sta-tistical inference). We also plan to find general con-ditions under which consistency of our family of esti-mators holds. The work of (Nguyen et al., 2010) has already paved the way for this investigation. Failing that, the very general consistency results of (Altun &amp; Smola, 2006) for single sample divergence estimation may also be amenable to the analysis of our estimator. The performance of our estimator on distributions on low dimensional manifolds suggests that it would be worth testing on domains involving audio or images. It would also be interesting to apply our method for estimating divergences other than KL. For instance we could study  X  -divergence estimation as in (Poczos &amp; Schneider, 2011).

