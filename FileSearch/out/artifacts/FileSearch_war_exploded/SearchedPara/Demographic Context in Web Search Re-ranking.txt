 In this paper we study usefulness of user X  X  demographical context for improving ranking of ambiguous queries. Context-aware relevance model is learnt from implicit user behaviour by using a simple yet general modification of a state-of-art click model which is capable to catch dependences from the search context. After that the machine learned click model is used in an offline re-ranking experiment and it is demon-strated that the demographical context ranking features pro-vide improvements in ranking quality. Further, we perform a study to investigate the impact of different facets of de-mographical features (gender, age, and income) on search ranking performance and manually analyse queries which exhibit strong context dependences to get an additional un-derstanding of the model behaviour.
 H.3.3 [ Information Search and Retrieval ]: Information Search and Retrieval Algorithms, Measurement web search, context-aware ranking, personalization, click models
A considerable part of search queries are short and not specified enough to determine a user X  X  goal. However, some-times a search engine can use additional information known about the user to narrow the spectrum of possible inten-tions. The idea to go beyond the query-only retrieval and enrich the search session with the context information re-ceived a lot of attention in the scientific community. The notion of search context is a very general and one can con-sider various facets or dimensions of the context what can be taken into account in the search interaction. We can think of geographical, social, demographical, temporal, and user his-tory dimensions of the search context. For instance, a user X  X  geographical location can help to determine a set of results relevant to a query [pizza delivery], since most probably only local sites are of interest for the user.

Several studies (e.g, [7, 8]) previously showed that inter-ests of users from various demographical groups can differ and that enriching the search context with such information has potential to improve search ranking quality. However, little attention was paid to quantitatively assess usefulness of demographical context in term of ranking improvements. The main contribution of this paper is to fill this gap in.
The usefulness of the geographical context was thoroughly discussed in a paper by Bennett et al. [1]. The authors showed how to infer location-dependent interest models for documents and demonstrated considerable improvements in the ranking performance.

Collins-Thompson et al. [4] proposed a method to provide users with results personalized by their reading proficiency.
Weber et al. [7] performed a detailed study of the web search users demographics and noted that some demographic differences between groups of people cause changes in search behaviour: for instance, for younger users the query  X  X crap-booking X  has considerably higher entropy, probably due to higher level of interest to the topic. Also, the authors demon-strated that ranking web search results according to CTR calculated with respect to a specific demographic group lead to improvements in precision of the first result in comparison to overall CTR. The main differences from our work are the following: we do not restrict ourselves to the case of the pre-cision of the first result and study and compare usefulness of various demographic features in terms of improvements of web-search ranking quality; we describe a general approach which can be used to leverage context features of different nature to improve ranking performance.

Teevan et al. [6] studied several possible approaches to split experiment participants into groups and leverage group interests in the ranking process. Among other possibilities, groups based on socio-demographical features (gender, age, occupation) were considered.

These results suggest that enriching the search context with the user X  X  demographic information can be used to im-prove search experience and provide a user with results more suitable for his or her demographic group.

We incorporate the search context by means of learning document X  X  context-dependent click model from a search en-gine X  X  click log. The problem of estimating a document X  X  relevance from a search log is widely discussed in the liter-ature. Most relevant to our work is Cheng et al. [3] which introduces context, including demographic features, to the problem of click prediction in the sponsored search domain.
In contrast to our work, the paper do not compare differ-ent feature subsets in terms of quality impact. Also, it is restricted to click prediction only what limits its applicabil-ity to the web search setting: an irrelevant document might have an attractive snippet.

To summarize, our paper extends previous studies into the following ways:
The context-aware re-ranking pipeline consists of two ma-jor steps. The first step is the offline one: we calculate the parameters of the context-dependent relevance models. The resultant models and features are stored and used during the second, online re-ranking step.

Further we describe how the context-aware click models are built. In this work we follow approach described in [1]: using the users X  implicit feedback we learn a document X  X  context-aware interest profile. In order to infer these pro-files we adapt a simplification of a state-of-art click model, named Simplified DBN and described by Chapelle et al. [2] and modify it to support context features.

For simplicity, we assume that the query is fixed and con-sider only top 10 results. The Simplified DBN model as-sumes that user consequently examines results on a search result page from top to bottom. A user clicks on a document if and only if he or she examines it and finds it attractive. If the user is satisfied with a document visited he or she stops search or continues otherwise. The probabilities of being at-tracted ( a d ) and satisfied ( s d ) by the document depends only on the document itself. The document X  X  relevance is defined as a probability of the user being satisfied given that he or she has seen the document and equals to r d = a d s d . Doc-uments with attractive snippet but irrelevant content will receive low r d due to low s d term.

In order to make the model capable of catching context dependences, we assume that probability of attracting user a d and satisfying him s d depend not only on document but on search context feature vector u as well 1 . Further, we assume that these dependences have a specific form of a logistic function: a ( u ) = 1 with w d,a and w d,s determining context dependences of doc-ument d .

The target of the offline learning step is to infer model parameters w d,a and w d,s for each document. These param-eters will be used with a current user X  X  context during the re-ranking step.

It can be shown that the model parameters that maximize the log-likelihood of click logs can be learned by means of a regular logistic regression routine with an algorithm repre-sented on Algorithm 1. We impose L1 regularization on the model parameters since sparsity of the models reduces stor-age expenses. Also, it should be noticed that the context-dependent click model can be reduced to the original one by setting the regularization terms to infinity.

Finally, the model is extremely easily parallelizable, since model parameters for each query-document pair are inde-pendent from each other.

Input : S q,d : a set of sessions with a query q asked and
Initialize Pos a = {} , Neg a = {} , Pos s = {} , Neg s = {} to be sets of positive and negative learning examples used to learn w d,a and w d,s foreach session  X  S q,d do end
Algorithm 1: Learning w d,a and w d,s for query q and document d
The user-related context we consider in this paper con-tains information about the user X  X  gender, age and income. This information is represented as a vector with non-negative components u  X  R 11 + . The value of the first dimension is set to 1, so w 0 a,d and w 0 s,d correspond to bias terms. Two di-mensions represent probabilities of the user being male and female. The user X  X  age is encoded as the probability distri-bution over the following age groups: below 18, from 18 to
To leave the notion uncluttered we assume that u 1  X  1, so w d,a and w 1 d,s correspond to bias terms 24, from 25 to 34, from 35 to 45, and above 45. Income is represented as probability a distribution over three income groups: the groups of users having bottom 20% (a), medium 60% (b), and top 20% income (c).

In other words, with each user we associate a context vec-tor Within each context facet probabilities are normalized to sum up to 1 (for instance, P a + P b + P c = 1).
 These probabilities are results of a proprietary classifier. This classifier was trained using information and full names (often gender-specific) specified in personal accounts at the search engine or in accounts at popular social networks out-linked from the search engine account. The classifier was calibrated so its output at a particular cut-off level has ac-tual precision very close to the cut-off level.
The offline evaluation scenario was adopted from [1] and [4]. Since labelling contextualized relevance judgements seems impractical, we use users X  click behaviour instead. With each session we consider only top 10 results and assign a positive judgement a result if it corresponds to the last satisfied click in the session 2 . All other documents from the top-10 results are considered as irrelevant, even if they were not examined. Labelling non-examined documents as irrelevant provides us with a lower bound on the re-ranking performance.

Given a session with click-derived relevance labels, ses-sion context and query-document click model parameters, we calculate context-dependent probability of being relevant for each document and arrange them according to it. After documents are re-ranked, we measure ranking quality by the inverse of the rank of the relevant document (mean recipro-cal rank, MRR). Reciprocal ranks of relevant documents of all sessions are averaged to represent overall ranking quality.
Parameters of the document models were trained using 31 days of click logs. Click data from the consequent four days was used to evaluate the proposed algorithm. We used liblin-ear [5] as a logistic regression library. The logistic regression regularization parameters were tuned on a 20% subset of the training data.

Following [1] we removed all sessions which start from one of the 15 most frequent queries or have no positive judge-ment derived from clicks. Also, we removed queries that do no have associated relevance models for at least one result.
As a result we have the test dataset with 13.7mln sessions with 110k unique queries asked by 9mln unique users.
We do not report absolute values of quality metrics due to proprietary nature of the system, but report relative im-provements over the baseline (non-contextual DBN model) instead.
 Results can be found in Table 1. We use click entropy H ( U | Q ) to sample subsets of queries with different levels of ambiguity: higher values of entropy are believed to corre-spond to more ambiguous queries (for instance, in [1]). We demonstrate re-ranking performance for 4 models, trained on different subsets of features: gender-related features, age-
A click is referred to as satisfied if it is either the last click in the session or has dwell time not less that 30 seconds Table 1: Re-ranking results for subsets of the test data. Queries with higher values of click entropy H = H ( U | Q ) are of higher level of ambiguity H  X  2 +1.1 +0.6 +1.1 +0.6 42% H  X  1 +1.0 +0.4 +0.6 +0.7 68%
H  X  0 +0.4 +0.1 +0.01 +0.3 100% related features, income-related features and a model, trained on all the demographic features.

The last column represent a total share of sessions with the specified level of click entropy among all sessions in the test dataset.

All improvements reported are statistically significant at the p &lt; 0 . 01 level according to Wilcoxon paired signed-rank test.

The next observation is that context, associated with es-timated age of a user is the most useful on the high-entropy queries. We discuss the observation in the next section.
As we can see, relative improvements for all subsets of features grow as query entropy threshold grows. This ob-servation supports the hypothesis that the context can be useful in case of ambiguous queries and is able to resolve ambiguity to some extent. The next observation is it seems hard to name the most useful context facet: all facets exhibit comparable performance on their own.
Since experiments demonstrate the ability of the search context to resolve natural query ambiguity to some extent it is interesting to support this observation with manual anal-ysis of queries with the most context-dependent documents. Firstly let us remind two types of ambiguity in queries. The first type is connected with concept or object ambigu-ity: the query have different interpretations with different objects associated. The second type suggest that if even a query have only one interpretation, a user can be interested in various aspects of it. Often users who submit a query are likely to be interested in one of several major interpre-tations and a variety of aspects for each. So, both types of ambiguity are presented for these queries.

In order to get an additional insight into the result, we sampled all context-query-document triplets from the test dataset and calculated variance of the context-dependent document relevance, observed in the test dataset.

After that we selected 217 query-url pairs which have stan-dard deviation of relevance due to context dependences not less than 0 . 2 (relevance is modelled within [0; 1] interval). The average length of unique queries is equal to 1.2 words, entropy -1.84. Thus we can conclude that the queries are potentially highly ambiguous.

Further, we manually examined these pairs and found that they fall into two classes.

A pair of the first class typically represents ambiguous query which have several different interpretations and a doc-ument is highly relevant to one of them. Often these queries have navigational results for each possible interpretation.
An illustrative example of this category is a navigational query [top shop] 3 . There are at least two top highly relevant documents: d 1 , [topshop.com] and d 2 , [top-shop.ru]. Both
All queries are adapted to English type # pairs #queries query length click entropy I 157 144 1.18 1.77
II 60 56 1.33 2.01 are websites of two different shops. The first one is an online clothes and accessories store focused on young female audi-ence. The second is a general-purpose online store, targeted on general audience, selling a variety of goods including a wide spectrum of consumer electronics.

The two sites have the following attractiveness profiles w
This suggests that d 1 is more attractive for young and female users and less interesting to adult users (since there is redundancy in our context description, we setted u u 8 = u 11 = 0).

The pairs of the second type help to resolve ambiguity of another type. A user X  X  intention is not navigational, but informational one. In this case one of the possible interpre-tations of the query is a broad concept and users of a specific demographic group are specifically interested in one possible aspect of the query. For instance, for queries with technical computer-related terms both youngest and oldest groups of users are more interested in [what is it] aspect than general population of users. This seems natural, since on average these users are less familiar with the technology.

For instance, let us consider the query of this type [host-ing]. One can think of several interpretations: from learn-ing what term means to reading user reviews of hosting providers. The document d 3 , representing a Wikipedia page on the term is a document which explains that the term means. And, as it can be seen from the document attrac-tiveness model it seems to be more attractive for users which are close to 45-54 age group in comparison with users ten years younger. We suppose that this observation explains the fact that age-related features have the highest impact on high entropy queries: the pairs of the second type tend have higher en-tropy and digital divide is a possible reason to shift user X  X  preferences from one aspect to another.

We provide such descriptive statistics as number of query-url pairs, mean unique query length and click entropy for both groups of pairs in Table 2.
Re-ranking experiments and manual analysis demonstrate that search context is useful for ranking extremely short, am-biguous and underspecified queries with high level of click entropy. Detailed examination revealed that the most nu-merous part of heavily context-dependent queries are am-biguous queries with several possible navigational intents. A considerably smaller part of context-dependent queries fall into category which can employ context to promote a specific aspect of informational intent.

All the three discussed facets of demographical context showed valuable contribution to the retrieval quality in the series of offline re-ranking experiments and it is impossible to name the only one most useful for ranking demographic context facet. However, for the queries of high entropy, age-related context features provide enough information to pro-vide contextualized ranking comparable with ranking built on all the features discussed.
As we can see from the experimental part demographical context was proven to be useful in the search ranking setting. It has demonstrated ability to resolve query ambiguity in several cases.

The manual analysis showed that the largest part of queries having heavy context dependences are ambiguous queries with several different concepts as interpretations and sepa-rate navigational results for each of these intentions. The most relevant navigational result depends on a demographic group user belongs to; often these groups are determined by age and gender.

The proposed modification of the click model introduced by Chapelle et al. [2] proved itself to be able to generalize context dependences from implicit user behaviour data.
As a direction of the future work we consider extending the search context to include more user attributes (e.g., inter-est profile, language preferences). Furthermore, it is tempt-ing to learn user latent attributes automatically from their search behaviour.

Since we have shown that demographic context some-times heavily influences intents a user prefer in underspec-ified or ambiguous queries, as another possible direction of future work we consider models that explicitly re-weight en-tire query intents depending on the context. On the other hand, difference in behavioural patterns of users with differ-ent search contexts can help to derive query interpretations. We believe that a sophisticated machine learning framework can exploit these inner dependences to improve ranking for the ambigious queries. [1] P. N. Bennett, F. Radlinski, R. W. White, and [2] O. Chapelle and Y. Zhang. A dynamic bayesian [3] H. Cheng and E. Cant  X u-Paz. Personalized click [4] K. Collins-Thompson, P. N. Bennett, R. W. White, [5] R.-E. Fan, K.-W. Chang, C.-J. Hsieh, X.-R. Wang, and [6] J. Teevan, M. R. Morris, and S. Bush. Discovering and [7] I. Weber and C. Castillo. The demographics of web [8] I. Weber and A. Jaimes. Who uses web search for what:
