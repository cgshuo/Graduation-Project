 Wireless Sensor Network (WSN) has gained widespread attention in recent years. They can be used for testing, sensing, collecting and processing information of monitored objects and transferring the processed information to users[1]. The network has a wide range applications including health, military, and security. 
Since Wireless Sensor Network works in a shared-medium, medium access control (MAC) is an important technique that enables the successful operation of the network. One fundamental task of the MAC protocol is how to avoid collisions among a large number of neighbor nodes which communicate each other at the same time in a share-medium. There are many MAC protocols that have been developed for wireless voice and data communication networks like IEEE802.11[2]. However, sensor nodes are constrained in energy supply and bandwidth[3]. Since feasible and necessary. Therefore, how to maximize the node X  X  battery lifetime is very important in WSN. Many research works have been finished to solve energy problem in [4][5][6][7][8].These works are mainly focused on MAC layer. Of course, we must know challenges necessitate energy-awareness at all layers of networking protocol stack. For example, Network layer protocol, energy aware routing protocol [9], consumption of nodes. Many solutions to the problem of idle listening have been proposed utilizing the technique of duty cycling [10][11]. into the wireless sensor network. By utilizing a variation fair scheduling algorithm of Start time Fair Queuing (STFQ) [12]based on the S-MAC protocol, we propose a fairness scheduling model based on the residual energy to realize a balanced consumption of node energy in WSN and eventually to ensure the longest lifetime of WSN. Specifically, we make the following work: In the event-driven WSN, the number of nodes responding to an event and the event-related neighbor nodes nodes that have more residual energy have the priority to contending the channel and transmit the information. The priority is based on the distributed Coordination time when conflicts occur and thus get the priority to transmit the report. In addition, period sleep and collision handling in order to ensure a balanced energy consumption, prolong the lifetime of WSN and prevent the network island. 
Meanwhile, in order to ensure the redundancy and reliability, in the sensor report of it . Only R of N [11]need to repo rt and N-R nodes come into the sleep state and give up transmission to save the energy so that the energy consumption is balanced. Finally, the protocol of this paper is introduced on the basis of S-MAC and the efficiency is tested through experiments. 
The rest of the paper is organized as follows. Section Two introduces related work on wireless fair scheduling in Wireless Packet Switch Network and sensor networks X  contention-based MAC protocol, their requirements and our ongoing research project. simulations and results are presented in Section Four, and concluding in Section Five. Packet Switch Network with the MAC protocol of WSN in order to establish a node energy in WSN. 2.1 Fair Scheduling in Wireless Packet Switch Network The Fair Scheduling in Wireless Packet Switch Network aims to solve the conflicts of achieving the fairness. As we know, the locality of wireless transmission implies that collisions, and hence contention for the shared medium, are location dependent. When the location-dependent contention and multi-hop nature of network, any two flows that are not interfering with each other ca n potentially transmit data packets over the how to assign a minimum channel allocation to each flow proportional to its weight, and maximize the aggregate channel utilization is the goal of the fair scheduling fluid model[13]. assigned a weight. Intuitively, allocation of link bandwidth is fair if equal bandwidth weighted fairness in which the bandwidth must be allocated in proportion to the weights associated with the flows. infinitesimally divisible units. The earliest known fair scheduling algorithm is Weighted Fair Queuing (WFQ)[14]. WFQ was designed to emulate a hypothetical bit-by-bit weighted round-robin server in which the number of bits of a flow served in a round is proportional to the weight of the flow. Since packets cannot be serviced a bit at a time, WFQ emulates bit-by-bit round-robin by scheduling packets in the increasing order of their departure times in the hypothetical server. To compute this de parture order, WFQ associates two tags X  X  packet are defined as: Where V(t) is defined as tags or start tags to ensure the fairness of the flow. 2.2 MAC Protocol in WSN Since this paper focuses on a distributed protocol, we X  X  like to introduce some typical distributed MAC protocols for WSN. 
The MAC protocol for WSN is often divided into Contention-based MAC and contention-free MAC. The contention-based MAC protocol is also known as random access protocol. Typically, some nodes co mmunicate with each other in a shared-medium, and only one node can use the channel to communicate with others. Colliding nodes back off for a random duration and try to compete the channel again. Distributed coordination function (DCF) is an example of the contention-based protocol in the standardized IEEE 802.11. 
The contention-free MAC is based on reservation and scheduling, such as TDMA-Access (TDMA); Frequency Division Multiple Access (FDMA); Code Division Multiple Access (CDMA). 
S-MAC protocol is based on IEEE802.11 MAC protocol. It is a MAC protocol aiming at reducing energy consumption and support self-configuration. S-MAC The nodes coordinate to communication and the network can tolerate some additional message latency. 
The idea of T-MAC[16] protocol is to reduce the idle listening time by transmitting all messages in burst of variable length m and sleeping between bursts. There are two solutions for the early sleeping problems: future request-to-send, FRTS and full buffer priority. But they are not very effective. 
Sift MAC[11] protocol use a fixed-sized contention window and a carefully-chose, presents a new way of fair scheduling based on the residual energy. 
In above-mentioned MAC layer protocols, in order to reduce the energy listening and sleeping, to avoid overhearing and to reduce bit numbers of MAC address of the communication data packet. Bu t none of them has considered the issue important to the lifetime of WSN. If the energy of some node is nearly exhausted , It can X  X  be chosen as working node and needs to be replaced by its neighbor node which has more residual energy in case that the network island would appear. how to balance the energy consumption among the network neighbor nodes at MAC layer, and how to reduce the channel competition collision, ensure the effective communication and save energy are the problems that this paper tries to tackle. 
The current MAC protocol use traditional binary exponential back off algorithm to which can achieve the fair scheduling of all nodes. same time, not all nodes need to transmit report of it. Only R of N need to report and the rest can give up transmission. When the first R nodes of N are chosen to transmit balanced energy consumption of each node in WSN. 3.1 Preliminary Conditions and Assumption event and the event-related neighbor nodes. 
Every node needs a neighboring node information table (see table 1) including neighboring Nodes ID, Residual Energy and the Hops of nodes. One-hop indicates the neighboring hop and two-hop indicates that the node is the next node of its neighboring node which can be picked up by the transmission of RTS-CTS packet. The condition of two-hop is taken consideration in our paper. The proposed protocol is derived from the distributed Coordination Function in the IEEE802.11 stand, which adopts RTS-CTS-DATA-ACK communication mechanism. Such mechanism can solve the problem of Hidden-station and overhearing. The following two conditions are necessary. The RTS packet needs to carry Residual Energy, Event-ID and residual Time of channel usage. The CTS packet needs to carry Node-ID, Residual Energy and residual Time of channel usage. 
The proposed protocol is based on S-MAC. The nodes are put into periodic listen and sleep. Because of the residual time field of RTS-CTS-DATA-ACK packet, the When the sleep time is up, the nodes re-listen the channel. In order to reduce energy multi-nodes in one event and balance the energy consumption of networks. 
Next, the MAC protocol Design is discussed in Section 3.2 3.2 REBFS-MAC Protocol Design 3.2.1 Energy and Neighbor Information Transmission Mechanism The transmission of the node X  X  residual energy information among neighboring nodes is very important for the realization of the proposed protocol. 
In this paper, the node X  X  residual energy is picked up by RTS-CTS-DATA-ACK packets. For example, when node X acquires the channel, it X  X l pass RTS packet which picks up the node X  X  residual energy, and X X  X  neighboring nodes can sense and receive this information. When the target node Y has received the RTS packet passed by X, it nodes receive the information of Y X  X  residual energy. Every node having received the information chart. It will modify the residual energy information of the existed node and append new information if it doesn X  X  exist in the chart. 
As we know, the periodic SYNC packet based on S-MAC Protocol also carries the following mechanism. 3.2.2 Node X  X  Resident Energy Scheduling Model To every sensor node, a tag value E  X  is attached which indicates residual energy. The energy consumption is shown in Neighboring Node Information Table from which we contending the share channel. whose hop is 1 in Neighboring Node Information Table. When N neighboring nodes sense an event at the same time, not all node s need to transmit report of it. When the energy of node E  X  is R+1 in the energy queue, only R of N need to report and the rest finish transmitting the report. Every node responding to the event maintains two variables, namely, the start tag and the finish tag. The former refers that the node has already got the channel service, while the latter means that new event occurs and new service is applied for. This means the finish tag includes the start tag. into the wireless sensor network. By utilizing a variation fair scheduling algorithm of Start Time Fair Queuing (STFQ) [11] based on the S-MAC protocol, we propose a fairness scheduling model based on the residual energy to realize a balanced consumption of node energy in WSN and eventually to ensure the longest lifetime of WSN. The specific process is as follows. 1. The initialization of the nodes. Every node has a quantifying number of its 2. When node I starts responding to event k, the start tag and the finish tag have to be 3. The formula of the start tag and the finish tag is as follows: 4. When an event occurs at time t, the neighboring nodes in Neighboring Node 3.2.3 Contention Window and Collision Handling 1. Contention Window We assume that N neighboring nodes in one area sense an event simultaneously. But only R nodes need to pass the data(R/N) b ecause of the redundant nodes. To ensure a balanced consumption of network energy, R nodes which have more residual energy has been discussed in Sift protocol. But here we propose a different solution. 
Our solution is that we assume when one node and all it X  X  neighboring nodes sense information. Meanwhile, we choose different back off intervals for nodes with different residual energy when they sense the channel. The nodes that have more Hence a balanced energy consumption of network nodes is ensured. 
Based on the above assumption, we can see the fair scheduling is achieved by combining the back-off interval with the service tags of the nodes. So we have a new formula of the start tag and the finish tag for E  X  : In the formula, scaling_factor[15] is a proportion parameter, and it allows for a certain have high B  X  . For each node, It has a E  X  and a back-off interval B  X  . Because of the reciprocal relation between E  X  and B  X  , We define a Qi with: Q can be same. In order to solve the problem, random number X  X  is generated in decreased. 2. Collision Handling Transmitting collision is unavoidable. For example when a node moves to the cause the data collision due to the failure to sensing the signal. 
Traditional IEEE802.1 uses binary exponential back off algorithm to tackle the collision problem. The mechanism is as the following: 
If a collision occurs, then the following procedure is used. Let node i be one of the nodes whose transmission has collided with some other node(s). Node i chooses a Window is a constant parameter. 
From above we can see, when collision occurs, contention window will double the the same process: The decrease of B i can increase the throughout of the system. 3.2.4 Message Passing When an event occurs in WSN, N neighboring nodes sense it simultaneously, but we are interested in the first R of N potential reports because of the redundant nodes. The neighboring nodes also sense the event and prepare to transmit. node senses the Event-ID carried by the RTS packet, the number of the nodes responding to the event is added 1 to its counting of the same Event-ID. And the node will go through the periodic listen and sleep. Whenever the node senses the available channel and prepare to transmit the information, it X  X l check the counting machine first. If the result exceeds R, The node will give up the transmission, and delete the event information. It can also transmit by RTS-CTS-DATA-ACK packets and delete the information from the information chart when the result exceeds R. numbers of a node X  X  neighboring nodes. 3.2.5 Further Discussion In the model of fair scheduling based on the residual energy, every node has its back-off interval according to the residual energy. Suppose node A and B are neighboring nodes within one hop, and B and C are neighboring nodes within one hop which means node A and C have two-hop distance. If we only put the residual energy of the own shared channel. This is the issue of the hidden station. The conflicting nodes will back off and enlarge the contending window which eventually causes the unbalance of the energy. This problem will be tackled in this section. 
The fair scheduling of all nodes energy within two hops of the node i is the energy of the node which has sent the RTS packet. At the initializing stage, the node i communication, by utilizing the shakehand mechanism of RTS-CTS-DATA-ACK, the node i can acquire the node in two hops. We use set B X  X ,t X  to indicate the set of all nodes with two hops of node i and fair scheduling is applied within this set. formula: Q and X  X  is the same with 3.2.3. In this way, the collision of every node within two hops will be decreased and according to the characteristics of the wireless sensor network, the communication conflicts in the global network will also be decreased largely. The Residual Energy-Based Fairness Scheduling Algorithm is describe as follows: 1. Start_tag  X  : X 0; /* start_tag of node i is set 0; */ 3. R: X  X   X  X  X  X  X  X  X   X  X   X  X  X  X  /* The value of R is set the numbers of node whose 4. /* When node I starts responding to event k */ 5.if Sort_location X  X   X  )&gt;=R+1 then 6. Node i give up this communication and not update its start stag. 7. Elseif E  X   X  X   X  and j X  X  X  X ,t X  then 9. Else Q  X  : X  X i  X  E  X   X  X  X B X  X  X  X   X  10. B  X  : X   X  B  X   X  X   X   X  X   X   X  11 ./* The node i choose B  X  backoff intervals. */ 12.IF( backoff time =0 ) then 13. Send a RTS packet with own residual energy. 14.Elseif receive a RTS packe t then 15. Update or append the energy of the sender in neighbor nodes tables and 16.Elseif receive a CTS packet and E R X  X  X  X  X  X  X  not in B X  X  X  and 17. The sender is inserted in neighbor nodes tables and his hops is set 2 hops. 18.ElseIf receive a CTS packet and E R X  X  X  X  X  X  X   X  X   X  then 19.If receive a ACK packet and E R X  X  X  X  X  X  X   X  X   X  then creating an arbitrary multi-hop network topology of a group of networked sensors. Each synchronizing them to perform bit time simulation. Since our main focus is media access environment. However, it preserves the event driven semantics. original energy is 80. The value of energy consumption is 1 for transmitting a RTS/CTS/ACK packet and the value of energy consumption is 5 for transmitting a DATA packet. 
From Figure 1, we can see REBFS-MAC shows good features on saving the network nodes energy. REBFS-MAC introduces the node X  X  residual energy based on S-MAC protocol and choose different back off intervals for nodes of different residual energy so that collisions are decreased and energy is saved. Figure 1 demonstrates through simulation the balanced the node X  X  energy by REBFS-MAC, S-MAC, Sift and IEEE802.11. 
Ten neighbor nodes are checked after the node transmits the information. Figure 2 shows the energy consumption of the neighbor nodes. REBFS-MAC has better performance on balancing neighbor nodes X  energy than others. Queuing (STFQ) based on the S-MAC protocol, we propose a fairness scheduling model based on the residual energy to realize a balanced consumption of node energy in WSN and eventually to ensure the longest lifetime of WSN. In this paper, the fluid fair model collision handling to enhanced the communication efficiency, ensure the balanced consumption of the node X  X  energy, and prevent the phenomenon of network island. The simulation test. 
The simulations showed that the distributed handling mechanism utilized in this future work. 
