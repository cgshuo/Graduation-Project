 1. Introduction
Advancements in ultrasound transducer design, improvements in image resolution, noninvasive nature, usefulness for medical diagnosis, portability as well as economy make segmentation of ultrasound images a motivating challenge; however, ultrasound data presents characteristics (such as speckle, non-homogeneities, shadowing, low contrast, and signal dropout) that make its seg-mentation a dif fi cult task. Noble and Boukerroui (2006) provide an extensive review of different ultrasound segmentation methods.
We consider the problem of segmenting the endocardium on short-axis echocardiographic images by dividing an image in patches ( Kumar and Hebert, 2006 ), and classifying an image patch as belong-ingtooneoftwoclassesorregions, myocardium tissue or blood pool . This problem is approached using the promising research fi eld of dictionary learning , early addressed by Olshausen and Field (1997) , with the motivation that there are no reports of echocardiographic image segmentation using the framework of dictionary learning. This research fi eld focuses on the development of algorithms to learn dictionaries with elements, called atoms ,sothatasignalofinterestcan be decomposed as a linear combina tion of a few atoms. The sparse representation of a signal possesses an implicit discriminative nature by choosing the subset of atoms that give the best compact recon-struction of the signal, and discarding other representations.
Modeling of signals by means of their sparse representation is a natural and fundamental concept so that it becomes a very useful tool for different applications. The solution to the problem of dictionary learning for sparse representation of images has proven to be successful in many other applications such as image denoising ( Aharon et al., 2006 ; Elad and Aharon, 2006 ), compression ( Marcellin et al., 2000 ), super-resolution ( Yang et al., 2010 ), hand-tion ( Wright et al., 2009 ), texture segmentation and classi fi cation and Roth, 2002 ), color restoration ( Mairal et al., 2008b ).
There are different research directions that could be taken to push the frontiers of knowledge in this research fi eld ( Elad, 2012 ). An opposite alternative to the previously mentioned synthesis-based sparse representation model for signals is the analysis-based model where an analysis dictionary is learned so that this dictionary multiplies a signal to provide the corresponding sparse code ( Rubinstein and Faktor Elad, 2012 ). Scale-Up of an image from a down-scaled noisy version with preservation of edges and small details has been accomplished by using sparse representa-tion models and regularization ( Zeyde et al., 2012 ). It has been shown that dictionary learning outperforms off-the-shelf fi xed dictionaries for the case of denoising of astronomical images ( Beckouche et al., 2013 ). An image has been separated into its texture and piecewise smooth components by modeling these components as sparse combination of atoms from dictionaries ( Starck et al., 2005 ). Algorithms for multi-scale dictionary learning combine characteristics from multi-scale representation models (wavelets) and single-scale dictionaries to sparsely represent signals ( Ophir et al., 2011 ). Atoms of learned dictionaries have been modeled as sparse representations over fi xed based diction-aries (double sparsity) ( Rubinstein et al., 2010 ). The Minimum
Length Description Principle is incorporated to the dictionary learning framework in Ram X rez and Sapiro (2012 ) to optimize not only the structure of atoms but also the number of atoms and to automatically tune the sparsity constraint.

Most computer vision problems, addressed with the framework of sparse representation , only use gray level information as features; however, spatial information, statistical parameters and other structures, such as contours, should be added to gray level informa-tion as entries in feature vectors (this has been done with penalized logistic models ( Yue and Tagare, 2009 )) to make dictionaries more suitable to handle nonhomogeneous spatial artifacts, such as con-trast and noise, which are characteristic in ultrasound images. For the case of echocardiographic images, the contrast across endocar-dium as well as the brightness of myocardium vary spatially due to the interaction between the propagation of ultrasound waves and the geometry of myocardium tissue ( Yue and Tagare, 2009 ; Holland et al., 1999 ).
 There are three categories of dictionary learning algorithms.
In this application, the algorithms follow the direction of the clustering methods ( Tosic and Frossard, 2011 ). We use dictionaries which are constructed in two ways, by (1) manual extraction of image patches to build untrained dictionaries or (2) by patch extraction followed by dictionary training which consists in mini-mizing an energy function through optimization methods like MOD ( Egan et al., 2000 )or K-SVD ( Aharon et al., 2006 ). In Wright et al. (2009) , the application of untrained dictionaries in classi fi cation tasks has been successful for face recognition (a method called
Sparse Representation Classi fi cation  X  SRC ) where (1) the whole image under low resolution is used as an atom, (2) multiple atoms correspond to different instances of the same face under different conditions of illumination and/or occlusion, and (3) one single dictionary is built by concatenating face dictionaries from different subjects. This method is useless for our application since this method was designed to work on atoms which are generative models of entire images and not for the modeling of isolated image patches.

During estimation of the sparse representation of a signal, there is a search for a linear combination of atoms to approximate the signal of interest. One way of estimating the sparse represen-tation of a signal consists in using greedy algorithms like Matching Pursuit ( MP )( Mallat and Zhang, 1993 ) and Orthogonal Matching
Pursuit ( OMP )( Pati et al., 1993 ) which consist in minimizing the l 0 norm of the sparse code of the signal under the constraint of an undetermined system of linear equations. Motivated by the fact that atoms from untrained dictionaries do not evolve, we propose the straight use of these manually extracted atoms to reconstruct a signal by (1) looking for the nearest atoms to the signal and then (2) using the sub-set of the nearest atoms to estimate the best linear approximation to the signal. We called this approach
Matching Pursuit over the L Nearest Atoms ( MPLNA ). Since atoms are l 2 normalized and might be extracted from overlapping image patches, image segmentation based on sparse representation can handle patch classi fi cation without previous registration.
During image segmentation, patch classi fi cation is accomplished by extraction of a feature vector from the patch, followed by a transformation of the feature vector into a residual feature vector, and fi nally a label is assigned to the patch by searching for the smallest residual feature inside the transformed vector ( Aharon et al., 2006 ; Mairal et al., 2008c , 2012 , 2008a ;Wrightetal.,2009, 2010; Rodr X guez and Sapiro, 2008). Residual features are residuals of the approximation of a feature vector over different classes. Instead of looking for the smallest residual to classify a patch, we propose to linearly combine residuals from multiple patches in a neighborhood and use these combinations as features for classi fi cation. This approach accounts for fi ltering and for spatial interaction of neigh-boring patches allowing the reduction of isolated misclassi fi ed patches or clusters of misclassi fi ed patches.

In Section 2, an overview of the framework on sparse repre-sentation and dictionary learning is presented, highlighting the theory suitable to the current application. Section 3 discusses how sparse representation is applied to the task of segmentation of the endocardium in ultrasound images as well as contributions in our application. Section 4 provides the experimental results obtained by following different strategies of dictionary learning and match-ing pursuit as well as comparisons. The conclusions are presented in Section 5. 2. An overview on sparse representation and dictionary learning
Sparse representation of signals has received considerable atten-tion as a tool to solve different problems in Computer Vision.
An extensive survey of the challenges, motivation, approaches and applications of the main algorithms in the fi eld of diction ary learning for sparse representation is presented by Tosic and Frossard (2011) and Elad (2010 ).

A dictionary is a collection of k elements stacked as column vectors in a matrix D  X  X  d 1 ; d 2 ; ... ; d k A R n k . Each element, called atom ,isan n-dimensional vector d i A R n in the hyper-sphere  X  d  X   X  1. The set of atoms f d i g k i  X  1 serves as an over-complete basis ( k 4 n ) for reconstruction of a signal x A R n . 2.1. Sparse coding
Given a dictionary D A R n k , a signal x A R n can be approxi-mated by a linear combination of its atoms, x  X   X  k i  X  1  X  i d i  X  D  X  , where  X  A R k is the sparse code of the signal. Since D is over-complete ( k  X  n ), there are many solutions to this undetermined system of equations. Thus, a constraint is imposed so that the objective is to fi nd a sparse code  X  with the smallest number of non-zero coef fi cients  X   X  arg min  X   X   X   X  0 3 x  X  D  X   X  1  X 
By allowing certain degree of noise, a bounded error  X  is imposed in the reconstruction of x ,  X   X  arg min  X   X   X   X  0 3  X  x D  X   X  2 2 o  X   X  2  X  where  X   X   X  0 is the l 0 norm that counts the number of nonzero components in  X  . The problem posed in (1) and (2) can be solved with greedy algorithms like Matching Pursuit ( MP )( Mallat and
Zhang, 1993 ) and Orthogonal Matching Pursuit ( OMP )( Pati et al., 1993 ). In the sparse coding literature, the l 0 norm has been replaced by the l 1 norm and the sparse coding becomes a convex problem which is solved by different algorithms ( Hale et al., 2007 ;
Malioutov Willsky; Gorodnitsky and Rao, 1997 ). 2.2. Reconstructive dictionary learning
The goal of dictionary learning is to compute the reconstructive dictionary D  X  X  d 1 d 2 ... d k A R n k that provides the optimum sparse reconstruction for a given set of m training signals, f x i  X  1 A R n , called observations or training samples , stacked as column vectors in a matrix X  X  X  x 1 x 2 ... x m A R n m . During a matrix A  X  X   X  1  X  2 ...  X  m A R k m , are simultaneously estimated according to the optimization problem. f D ; A g X  arg min where L , known as the sparsity constraint , bounds the maximum number of atoms for the sparse decomposition of each observation. Different learning dictionary methods exist such as the Method of Optimal Directions ( MOD )( Egan et al., 2000 )and K-SVD ( Aharon et al., 2006 ). 2.3. Classi fi cation based on sparse representation
Reconstructive Dictionary Learning has been applied to classi fi -cation tasks ( Aharon et al., 2006 ). Let us consider a set of p learned class i . To accomplish the goal of classifying a test signal x A R n , there is a transformation T: R n -R p of the signal of interest x into a of classes) with components given by the following transformation function r  X  x ; D i  X  X  min  X   X   X  x D i  X   X  2 2  X   X   X   X   X  0 ; i  X  1 ; ... ; p  X  4  X  where each residual feature r i  X  x ; D i  X  is the residual of the sparse approximation of x over the i th dictionary. Finally, a label is assig-ned to x according to the rule label  X  arg min
A geometric interpretation of the application of residual feature vector r for classi fi cation of a test observation x in a two-class problem is shown in Fig. 1 a. The feature space is entirely located in the fi rst quadrant and the hyper-plane for the separation of classes is r 1  X  x ; D 1  X  r 2  X  x ; D 2  X  X  0 : 2.4. Discriminative dictionary learning
Instead of learning dictionaries just for reconstruction of signals, a discriminative dictionary learning algorithm builds dictionaries which are good at reconstructing signals of their own class but bad at representing signals from other classes ( Mairal et al., 2008c , 2008a Rodr X guez and Sapiro 2008 ). Fig. 1 b shows a geometric interpretation of the improved performance of a discriminative dictionaries vs. that of a reconstructive ones during classi fi cation of an observation x which belongs to class 1. Discriminative diction-aries , D 1 and D 2 , are simultaneously learned to place the residual hyper-plane. This enhanced discriminative capability is possible with the introduction of the softmax term ln  X  1  X  e b  X  ( Mairal et al., 2008a ) during minimization of the reconstructive term r 1  X  x ; D 1  X  as it is shown in min Simultaneous minimization of both terms is accomplished in possible values, respectively. The fi rst term r 1  X  x ; D 1  X  stands for accounts for minimization of exponential term e b which is the same as maximization of the distance between residual fea-off between reconstruction and discrimination .In Fig. 1 c, discrimina-tive dictionary learning for a two-class problem is generalized to for class 2 . In this notation, the super-index identi fi es the class. Discriminative dictionaries D 1 and D 2 are learned simultaneously according to f D 1 ; D 2 g X  arg min D
Discriminative dictionary learning is extended to multiple classes according to the following energy minimization
D
Minimization of the summation of exponentials  X  e b i is equivalent to a simultaneous maximization of all exponents, where each exponent b i is the distance between residuals over dictionaries i and j. Discriminative Dictionary Learning has been extensively explored and different algorithms are available ( Mairal et al., 2008c , 2008a ). 3. Endocardium segmentation methodology 3.1. Features
The classical feature vector, which consists of gray label information, has proven useful for sparse representation in different computer vision applications ( Elad and Aharon 2006 ; Mairal et al., 2008c ; Mairal et al., 2008a; Wright et al., 2010 ); however, for the case of echocardiographic image segmentation, the introduction of the spatial location of the patch, a feature, enhances classi fi cation performance. Speci fi cally the polar radius is the feature that makes segmentation able to handle low contrast variation across endocardium, a variation which is revealed in echocardiographic images as a leakage from the blood pool region.

A feature vector f i A R N is associated to a pixel location s i .The N entries of the feature vector consist of (1) the gray level values of a ffiffiffi n p ffiffiffi as a column vector N  X  s i  X  A R n ,(2)the Cartesian coordinates of the and (6) a second same location s i ,butextractedfroma contour-enhanced version of the original image. Given all this information, a feature vector is computation of the polar coordinate r  X  s i  X  X   X  s i s o  X  2 2 requires knowledge of s 0 , the centroid of myocardium and blood pool and this parameter is obtained by averaging the Cartesian coordinates s i of all feature vectors from the same region, s 0  X   X  k i  X  1 s i . 3.2. Dictionary initialization and learning
A dictionary is initialized for each region, myocardium and blood pool. At this stage an atom is obtained by random extraction of an image patch followed by concatenation of additional features. During patchextractiontheremightbeanoverlapamongselectedpatcheson the same region, a situation which is natural for image representation. extraction of all atoms. One motivation for using untrained dictionaries is the straight use of spatial features in atoms, without changes introduced by training, since it has been found that these features play the most signi fi cant role in segmentation ( Yue and Tagare 2009 ).
The echocardiographic image sequences are periodic over time and there are 4  X  5 states (frames) per cardiac cycle. For each dictionary, a large number of atoms should be extracted from the same region, but from different frames corresponding to different cardiac states. Thus, initialization of a dictionary for representation of a particular region can be seen as a concatenation of multiple dictionaries where each sub-dictionary contains atoms extracted from the same frame and each atom corresponds to a particular location on the frame.

Given two training sets of observations from blood pool and myocardium and the initial version for dictionaries D 1 and D 2 , the dictionaries are trained using the K-SVD method, proposed by Elad and Aharon ( Aharon et al., 2006 ), which is an extension of the K-means algorithm to dictionary learning. The K-SVD method was chosen since it offers advantages over the MOD method ( Egan et al., 2000 ). K-SVD and MOD can work with any pursuit technique; however, MOD requires matrix inversion which makes it imprac-tical when the number of atoms is very large. 3.3. Echocardiographic image segmentation
Partition of an image into two regions is performed with a patch-by-patch classi fi cation process. Each patch is classi fi ed by (1) extracting a feature vector x from the patch, (2) transforming x into a residual feature vector r , and (3) assigning a label l A 1 ; 2 fg to the patch which is geometrically interpreted as fi nding out the side of the hyper-plane on which r is located, as it is illustrated in Fig. 1 a. The image segmentation process can also be executed in a pixel-by-pixel fashion, extracting a patch per pixel, but at the expense of increased computational time.

Patch classi fi cation depends on the type of dictionaries used which could be built by (1) manual extraction of atoms from image patches, or (2) application of K-SVD to manually extracted atoms, or (3) one running of the discriminative K-SVD algorithm on dictionaries previously trained just for reconstruction. In any case patch classi fi cation is performed by computing each residual in r  X  r 1 ; r 2 ; ... r p T with the application of matching pursuit . One variation for computation of entry r i , corresponding to dictionary
D , consists in fi nding the set S i of L nearest atoms to x on dictionary D i , according to the following pseudo-code Input : x ; D i  X f d i j g k j  X  1 Output : S i Initialization : S i  X fg Repeat L times : ~ d  X  arg min S  X  S i [ : ~ d where L stands for the sparsity factor. After fi nding S i ,a matching pursuit algorithm is used to compute feature r i which is the residual of x on S i . We call this method Matching Pursuit over L Nearest Atoms ( MPLNA ).

In our work, the number of misclassi fi ed patches is reduced by taking advantage of fi ltering and spatial interaction of neighboring patches. Assuming a patch l with a feature vector x l , instead of using Eq. (5) for label assignment, multiple residual features f r  X  x l  X  j ; D i  X g q = 2 j  X  q = 2 are extracted from a neighborhood of q  X  1 patches to be combined into a composite residual feature ~ r  X  x ;
D i  X  X   X  where the weights are values assigned according to a Gaussian distribution. Label assignment is accomplished according to the rule label  X  arg min 4. Experimental results
Experimental analyses were carried out to explore the discri-minative power of dictionaries in the segmentation of endocar-dium on echocardiographic images from rats. We used a data set with 12 2-D short-axis echocardiographic image sequences from 12 rats with each sequence having 22  X  52 frames. The echocardio-graphic image sequences are periodic over time and there are 4  X  5 states (frames) per cardiac cycle. Each frame has a size of 349 494 pixels. Fig. 2 shows a 4-frame cardiac cycle sequence extracted from the same subject.

Segmentation tests are performed using k  X  400 atoms per dictionary. For each region (blood pool and myocardium) there is a dictionary, and atoms are generated from 3 3 sized image patches. Atoms in trained and untrained dictionaries are l 2 normalized prior to image segmentation. The total number of entries per atom is N  X  23 which includes gray level information, spatial coordinates, statistical information and contour informa-tion. Endocardium segmentation is done with a patch-by-patch classi fi cation process and a patch size of 3 3. Different kinds of tests were conducted using (1) untrained dictionaries, (2) trained dictionaries, and (3) dictionaries along with spatial interaction for patch classi fi cation.

We use the rate of correctly classi fi ed patches (RCCP), which is de fi ned as the ratio of hits over the sum of hits and misses on the same region, to measure the performance of segmentation meth-ods. RCCP ratios are computed for blood pool and myocardium regions and also for each cardiac state (frame) in one cardiac cycle. RCCP values from different frames are combined to estimate the average RCCP for the entire cardiac cycle. RCCP values for different methods are shown in Table 1 with the best values shown in bold font.

In one set of experiments, segmentation is conducted using manually extracted dictionaries without subsequent training.
A patch is classi fi ed by applying a matching pursuit strategy ( MP and MPLNA ) to estimate its residual feature vector. Fig. 3 shows the results of segmenting the testing cardiac sequence along with a manually traced white contour which corresponds to endocar-dium. The manually traced endocardium serves as a guide during segmentation and during manual extraction of dictionaries and training sets. Patches classi fi ed as being part of blood pool region or myocardium are shown in black and gray, respectively. Thus, misclassi fi ed patches are those black patches outside the white contourandthosegraypatchesintheinside.Theresultsofsegmen-tation based on manually extracted dictionaries with MP are shown in top row and results with MPLNA are in the second row. Computa-tional time during segmentation is 39.5 s for MP and 159.74 s for MPLNA in a MATLAB implementation on an Intel Xenon processor.
Computational time varies upon the image to be segmented due to the extensive use of matching pursuit which has a variable computa-tional time. According to the RCCP values in the fi rst two rows of
Table 1 , both methods present similar performances. In addition, it is observed that untrained dictionaries can handle the spatial variation of the contrast between myocardium and blood pool.
 In a second set of experiments, segmentation is conducted using
K-SVD dictionaries. Each manually extracted dictionary is trained using a set with m  X  100 observations extracted from image sequences different from those used for dictionary extraction. Thirty iterations of the K-SVD algorithm are applied to train one dictionary with a sparsity factor L  X  3. The average computational time to learn one dictionary is 39 s for a MATLAB implementation.

After training, the reconstructive dictionaries are tested for segmentation of a cardiac sequence different from those sequences used for dictionary initialization and learning. The top row of Fig. 4 shows segmentation of endocardium over one cardiac sequence based on reconstructive K-SVD dictionaries. The average computational time for segmentation is 121 s. The number of training observations plays a signi fi cant role in the convergence of dictionary learning with serious impairments as the number of observations is increased.

The two formerly learned reconstructive dictionaries are simul-taneously adapted to become discriminative by using one running of the discriminative K-SVD algorithm in 12 iterations and 20 s. Results of segmentation based on discriminative dictionaries are shown in the second row of Fig. 4 .

According to Figs. 3 and 4 , the occurrence of misclassi fi ed patches is more serious in segmentation based on trained diction-aries than in the case of untrained dictionaries. By analyzing RCCP values in Table 1 , we also conclude that (1) performances of methods based on reconstructive and discriminative dictionaries are very similar (third and fourth rows in Table 1 ), and that (2) untrained dictionaries outperform K-SVD dictionaries ( fi rst and second rows in Table 1 ).

In the previously described experiments, one problem that arises during segmentation is the presence of clusters of misclas-si fi ed patches. So far label assignment of a patch has been done by only using its corresponding residual feature vector without exploiting information from neighboring patches. In order to further improve segmentation results, we propose to perform patch classi fi cation by accounting for interaction among neighbor-ing patches in the same way that low-pass fi ltering uses multiple neighboring pixels to compute one new pixel value. Label assign-ment is still based on fi nding the smallest feature, but now each feature is a linear combination of residuals from multiple patches in neighborhoods of 3 3 patches. Fig. 5 shows the results of patch classi fi cation based on composite residual features for the cases of reconstructive dictionaries (top row) and discriminative diction-aries (second row). Results shown in Figs. 4 and 5 and Table 1 , demonstrate that for the case of trained dictionaries the introduc-tion of composite residuals as features leads to a reduction in the number of misclassi fi ed patches; however, any scheme based on trained dictionaries still underachieves the performance of seg-mentation procedures based on untrained dictionaries.

We aim to demonstrate that by integrating the use of compo-site residuals into segmentation frameworks based on untrained dictionaries, the fi nal con fi gurations will provide the best perfor-mance for the case of segmentation of echocardiographic images. Fig. 6 shows the results of using this integrated framework for the cases of MP ( fi rst row) and MPLNA (second row). The inclusion of composite features improves performance. The best RCCP values are shown in bold font in Table 1 .

From analysis of results from different experimental setups, it is remarked that untrained dictionaries outperform trained ones. An additional advantage of untrained dictionaries versus trained ones is simplicity since the extraction of training sets and the dictionary training stage are not required. Among those methods based on untrained dictionaries and spatial interaction of patches, the one which uses MPLNA presents the best performance (RCCP value). 5. Conclusions
This paper shows important aspects of the application of sparse representation and dictionary learning to the problem of segmen-tation of endocardium in echocardiographic image sequences of rat subjects. The main key to handle the common challenge of spatial variation of contrast across endocardium is the introduc-tion of spatial information as entries in feature vectors, speci fi cally the polar radius feature. Choosing the dictionary learning algo-rithm is crucial to the way that dictionaries discriminate between the classes of blood pool and myocardium. Trained and untrained dictionaries were tested. Experiments show that the performance of dictionaries directly built with manually extracted atoms out-performs that of trained dictionaries (reconstructive and discrimi-native) with KSV-D methods. The interaction between the matching pursuit technique and the dictionary learning algo-rithms is also explored with the introduction of matching pursuit over the L nearest atoms (MPLNA) for the case of untrained and trained dictionaries. The patch classi fi cation process is modi fi ed to reduce the number of misclassi fi ed patches by introducing spatial interaction among multiple patches in a neighborhood (composite residual features). There is not alignment of the images before image segmentation since dictionaries somehow possess an implicit nature of invariability to scaling and shifting. Future work should be focused on the simultaneous extraction of endocardium and epicardium through the segmentation of three regions (blood pool, myocardium and external region), a segmentation task that has not been accomplished before. Besides, we believe that patch spatial interaction could be embedded in the dictionary learning algorithms by integrating the frameworks of dictionary learning and Markow Random Fields. The understanding of these problems could enrich the theory of sparse representation.
 Acknowledgements This research was possible through the support of a Fulbright Scholarship. Dr. Hemant Tagare, from the Department of Diagnostic Radiology at Yale University, provided sequences of echocardio-graphic images for experiments as well as advices for this research. References
