 Water pipe failures can cause significant economic and so-cial costs, hence have become the primary challenge to water utilities. In this paper, we propose a Bayesian nonparamet-ric approach, namely the Dirichlet process mixture of hierar-chical beta process model, for water pipe failure prediction. It can select high-risk pipes for physical condition assess-ment, thereby preventing disastrous failures proactively.
The proposed method is adaptable to the diversity of fail-ure patterns. Its model structure and complexity can au-tomatically adjust according to observed data. Addition-ally, the sparse failure data problem that often occurs in real-world data is tackled by the proposed method via flex-ible pipe grouping and failure data sharing. An approxi-mated yet computational efficient Metropolis-within-Gibbs sampling method is developed with the exploitation of the failure data sparsity for model parameter inference.
The proposed method has been applied to a metropolitan water supply network. The details of the application context are also presented for demonstrating its real-life impact. The comparison experiments conducted on the metropolitan wa-ter pipe data show that the proposed approach significantly outperforms the state-of-the-art prediction methods, and it is capable of bringing enormous economic and social savings to water utilities.
 I.5.1 [ Models ]: Statistical Water pipe failure prediction; Bayesian nonparametric ap-proach; beta process; Dirichlet process.

Water supply networks are valuable urban infrastructure assets that are responsible for reliable water resource dis-tributions. However, as urbanization trends continue and urban populations rise, water utilities find it increasingly difficult to meet growing water demand with aging and fail-ing water pipe networks. Water pipe failures, which can cause tremendous economic and social costs, as illustrated in Fig. 1, have become the primary challenge to water utilities. In order to tackle the problem in a financially viable way, preventative risk management strategies are widely adopted by water utilities to prevent disastrous failures. The basic idea of the strategies is to identify high-risk pipes proactively and renew them in time to avoid potential failures. Mean-while, it is also required to avert any replacements of pipes that are still in healthy condition. Therefore, the strategies consist of two main steps accordingly: (1) high-risk pipe pri-oritization, in which pipes are ranked based on their risks of failures, and (2) physical condition assessment, in which physical inspections are conducted on highly rated pipes to confirm their actual conditions for replacements. The pipes, which are not identified as high-risk pipes at the prioritiza-tion step, will only be renewed reactively. Hence, the success of the strategies heavily relies on the prioritization step. For making accurate selections of high-risk pipes, the prioritiza-tion step requires a failure prediction method that can give a precise estimation of pipe failure likelihood, based on which the estimated failure cost and renewal cost can be readily obtained.
The mechanisms of water pipe failures have been stud-ied for many decades, and two main research avenues exist for water pipe failure prediction, namely physical modeling and statistical modeling. For physical modeling, a variety of models has been proposed for explaining and predicting the deterioration processes of water pipes, such as pipe-soil interaction analysis, residual structural resistance, corrosion status index and hydraulic characteristics modeling. A com-prehensive review can be found in [14]. For statistical model-ing, it considers historical failure records, pipe attributes and environmental factors together for making predictions. It assumes that pipes with similar intrinsic attributes and en-vironmental factors share similar failure patterns, and that failure patterns which appeared before are likely to reappear in the future.

Although physical models can help understand the mech-anisms of water pipe failures, they have strong limitations when being applied to large-scale pipe networks for failure prediction due to the following reasons: (1) Physical models need a large amount of physical factor data to support their modeling and prediction. The data can only be obtained by intrusive investigations, which can cause water supply inter-ruptions. (2) Expensive equipment and manpower are re-quired for collecting physical factor data, which makes phys-ical models financially unviable. (3) Furthermore, physical factors usually interact with each other to make impacts on pipe failures. It is difficult for a single physical model to con-sider all the potential factors, whereas statistical modeling can readily take into account all the available factors. All these issues make physical models only suitable for inspect-ing a small number of pipes rather than making predictions for large-scale pipe networks. In contrast, statistical models require significantly fewer resources, which make themselves suitable for high-risk pipe prioritization on large-scale net-works. Moreover, because of the rapid development of in-formation technology, enormous water pipe failure data has been accumulated and becomes available, making advanced statistical modeling feasible.

In order to improve high-risk pipe prioritization for large-scale metropolitan pipe networks, we propose a Bayesian nonparametric statistical approach, namely the Dirichlet pro-cess mixture of hierarchical beta process model, for water pipe failure prediction. Unlike parametric approaches, the structure and complexity of the proposed model can grow as the amount of observed data increases. It makes the model invulnerable to faulty assumptions of model forms and adaptable to various failure patterns, thereby leading to more accurate predictions for different application sce-narios.

It is worth noting that water pipe failure data is extremely sparse in reality. Very few pipes have failure records during the observation period. Such sparsity makes traditional fail-ure prediction methods incompetent for accurate pipe failure prediction since most pipes do not have failure data for train-ing. The proposed approach deals with this issue by sharing failure data via a flexible hierarchical modeling of failure be-haviours. The key component of the hierarchical modeling is a flexible grouping scheme. It clusters similar pipes together for modeling so that failure data can be shared by similar pipes for training. Additionally, the failure data sparsity is exploited for developing an approximated yet computation-ally efficient Metropolis-within-Gibbs sampling method for model parameter inference.
 Figure 2: Water supply networks in the selected re-gions.

The proposed method has been applied to the water sup-ply network of an international metropolis that has a total population of near five million people. In this work, three representative regions are selected from the metropolis for comparison experiments. The regions and the networks are shown in Fig. 2. As we can see, the water supply network is constituted of two main categories of water pipes, critical water main (CWM) indicated by red lines and reticulation water main (RWM) indicated by blue lines. CWMs have larger diameters (300 millimeters and above), and RWMs have smaller diameters (smaller than 300 millimeters). Each water pipe is composed of a set of pipe segments connected in series. Failure records can be precisely matched with pipe segments, allowing the proposed method to model failure be-haviours of pipe segments.

Although CWM only takes a small portion of the network, it plays a more important role than RWM. The consequences caused by CWM failures are significantly more severe than RWM failures. Given the large scale of the network and the high cost of physical inspection, it is infeasible to inspect both types of pipes physically. Thus, the preventative risk management strategy just focuses on preventing CWM fail-ures in practice. Accordingly, in this work, the proposed approach is compared with other state-of-the-art prediction methods for predicting CWM failures, of which the data sparsity is even more significant. The experimental results obtained from the real-world pipe data demonstrate the su-periority of the proposed approach over the others.
The rest of the paper is organized as follows. Section 2 reviews the related work. Section 3 describes the details of the proposed method. Empirical studies are shown in Section 4, and the conclusions are drawn in Section 5.
In this section, we briefly review the related work on sta-tistical water pipe failure prediction methods and Bayesian nonparametric approaches.
In recent decades, many statistical models have been pro-posed for water pipe failure prediction. In the early stages, various of methods were developed for modeling the relation-ship between pipe age and pipe failure rate. For instance, the work in [15] proposed a time-exponential model, which formulates the number of failures per unit length per year as an exponential function of pipe age. Similarly, time-power model [12] and time-linear model [9] were developed with comparable performances. Later on, multivariate probabilistic models were suggested. They make predictions based on a variety of pipe attributes, such as age, material, length and diameter. One of the most popular multivariate approaches is the Cox propor-tional hazards model [3]. It is a semi-parametric method, in which the baseline hazard function has an arbitrary form and the pipe attributes alter the baseline hazard function via an exponential function multiplicatively. The Weibull model and its variants [2, 8] are also widely adopted in prac-tice. They utilize either a Weibull distribution or a Weibull process for modeling pipe failure behaviours.

Recently, a ranking-based method [18] was proposed for predicting water pipe failures. It treats failure prediction as a ranking problem. Pipes are ranked based on their failure risk. The method performs failure prediction via a real-valued ranking function rather than an estimation of failure probability.
All the aforementioned methods are parametric or semi-parametric, which means the forms of the methods are pre-defined and fixed during the training process. If the assump-tions made on the model form are not satisfied, accurate predictions cannot be achieved. In contrast, Bayesian non-parametric approaches do not make assumptions about the model structure. Instead, their model complexities grow as the amount of observed data increases, endowing Bayesian nonparametric approaches with flexibility for modeling com-plex real-world data.

Beta process [5] and Dirichlet process [4] are two Bayesian nonparametric approaches that were developed recently with tremendous success in a variety of domains. They have be-come the cornerstones for building more sophisticated Bayesian nonparametric models.

Beta process was originally developed for survival analysis on life history data. It was utilized as a prior distribution over the space of cumulative hazard function. Later, the work in [17] extended beta process to more general spaces for different applications, such as factor analysis [13], image reconstruction [20, 21], image interpolation and document analysis [17]. One of its variants was also applied to water pipe failure prediction [10, 11].

Dirichlet process [4] is a flexible Bayesian nonparametric prior for data clustering. It does not set any assumptions on the number of clusters. Instead, it allows the number of clusters to grow as the number of data points increases. It is the foundation of many nonparametric mixture models, and has been widely adopted in various applications, such as document analysis [16], musical similarity analysis [6] image annotation [19] and DNA sequence analysis [7].
The proposed Dirichlet process mixture of hierarchical beta process model consists of two main components work-ing with each other interactively: a hierarchical represen-tation of water pipe failure behaviours and a flexible pipe grouping scheme. The grouping scheme generates a set of groups, on each of which the hierarchical representation can be constructed. The hierarchical representation provides a precise modeling of each group X  X  failure behaviours, hence acts as the basis of grouping.

The two main components are described in Section 3.1 and Section 3.2 respectively. The details of the proposed model are given in Section 3.3. The inference algorithm is developed in Section 3.4.
The hierarchical beta process is adopted in this work as the hierarchical modeling of water pipe failure behaviours. We first briefly introduce the beta-Bernoulli process for mod-eling failure event and failure probability in Section 3.1.1 and Section 3.1.2. Then the details of the hierarchical modeling are given in Section 3.1.3.
On a measurable space  X , a beta process H is defined as a positive Levy process, a positive random measure whose masses on disjoint subsets of  X  are independent. It is param-eterized by a positive concentration function c and a base measure H 0 , which is also defined on space  X . In simplified cases, where function c (  X  i ) becomes a constant, we call c concentration parameter.

For disjoint infinitesimal partitions of  X , the beta process can be generated as: where B k indicates a partition, and k 2 { 1 ,  X  X  X  X  ,K } is the index. The process can be denoted as H v BP ( c,H 0 ).
When the base measure H 0 is discrete and has a set func-tion form of H 0 = same locations as H 0  X  X  and can be written in a set function form accordingly as: where  X   X  i (  X  ) = 1 when  X  =  X  i and 0 otherwise.
As defined in a general space  X , beta process provides us a flexible Bayesian nonparametric prior for water pipe failure events which themselves can be modeled by Bernoulli process.
For a Bernoulli process BeP ( H ), each of its draws X j is again a measure on space  X . j represents the draw index. H indicates a beta process on  X , as defined before. It acts as the prior of the Bernoulli process. A draw of the Bernoulli process can also be represented via a set function form as: where  X   X  i corresponds to the same atom location of H . The random variable x ij is generated from a Bernoulli distribu-tion parameterized by  X  i which is defined as Eq. 2. With x ij as its elements, an infinite binary column vector, also denoted by X j , can be used for representing a draw of the Bernoulli process. Then the draws of the Bernoulli process can form an infinite binary matrix X , with X j representing a column and j representing the column index. Each row of the matrix corresponds to an atom location  X   X  i . We can see that the beta process appears to be a proper Bayesian nonparametric prior for such infinite binary matrices. Figure 3: Binary failure matrices for pipes and pipe segments It is worth noting that beta process is a conjugate prior of Bernoulli process. Given a beta process prior H v BP ( c,H and a set of m observations drawn from a Bernoulli process X j v BeP ( H ), the posterior is again a beta process, with parameters updated as follow: The conjugacy significantly simplifies the inference proce-dure for parameter estimation.
With the aid of beta-Bernoulli process, a hierarchical rep-resentation can be developed for modeling water pipe fail-ure behaviours. Firstly, failure events can be modeled by a Bernoulli process BeP ( H ). Let an infinite binary matrix X , as illustrated in Fig. 3 (1), represent failure records of pipes. Each of its columns, X j , can be treated as a draw from the Bernoulli process BeP ( H ). It is an infinite bi-nary column vector with the i -th element x i,j generated from x i,j v Bernoulli (  X  i ). x i,j = 1 means pipe i failed in year j , and x i,j = 0 otherwise. Then the beta process, H v BP ( c,H 0 ), defined as a positive Levy process on pipe space  X , can be used as a prior of failure events, namely failure probability. Its set function form is defined as Eq. 3. With beta process H as a prior, each row of the matrix X corresponds to an atom location  X   X  i in the pipe space  X , which can be infinitely large. We assume that two pipes share the same failure patterns if they have the same intrin-sic attributes and environmental factors. Hence, we treat such two pipes as the same in the pipe space  X . Consid-ering all the possible combinations of pipe attributes and environmental factors, the number of  X  X nique X  pipes in the pipe space becomes infinite. Therefore, each column of the matrix X is an infinite binary vector that is drawn from a Bernoulli process. The beta process H is then a conjugate prior of the infinite binary matrix X . It models the failure probabilities of pipes via  X  i .

While beta-Bernoulli process is capable of modelling fail-ure behaviours as described above, there are two issues of adopting it in practice. Firstly, the number of failures is extremely small compared with the number of pipes, es-pecially for CWMs. Only a small portion of CWMs have failure records since most of CWMs did not fail during the observation period. Thus, the majority of CWMs have no failure data for model training. Secondly, in addition to pipe failure histories, pipe attributes and environmental factors are also crucial for estimating failure probabilities. However, they are not properly considered in beta-Bernoulli process. The fact that the pipes with similar intrinsic attributes and environmental factors often share similar failure patterns is ignored by beta-Bernoulli process.

In order to address these issues, the hierarchical beta pro-cess (HBP) model [11, 17] can be adopted as a hierarchical modeling of water pipe failure behaviours. Given a water pipe grouping, e.g. , grouping by intrinsic attributes, one more beta process can be added into the model hierarchy for modeling the failure behaviours of groups. The new beta process is on top of the existing beta process, serving as the prior of its mean parameter. The graphical model in Fig. 4 (1) illustrates the HBP model. It can also be described as the followings: where  X  i and x ij are defined as before, modeling the failure probability of pipe i and failure history of pipe i in year j respectively. q k and c k are the mean and concentration parameters for group k . q k can be regarded as modeling the failure rate of group k . q 0 and c 0 are the hyper parameters.
By adding one more hierarchy level, the HBP model es-timates failure probabilities through the inferences on both group level and pipe level. Group level inference estimates the group failure rate q k , and pipe level inference estimates the pipe failure probability  X  i . Failure data can be shared by the same group of pipes for estimating group failure rate q It helps to solve the failure data sparsity problem. The fail-ure patterns that are shared by similar pipes are captured at the group level since the pipes within the same group share the same q k . At the pipe level, the pipe failure probability  X  is estimated by considering not only the failure observa-tions x ij , but also the group similarity through the group failure rate q k .
Real world data is complicated and often demonstrates multi-modality property, which is the case for water pipe failures. Consequently, single-modality models become in-sufficient in such circumstances for modeling the whole data corpora. Mixture model is a widely adopted probabilistic ap-proach for modeling the data arising from different modal-ities. It assumes that the final model consists of a set of mixture components, each of which can accurately model a portion of data.

For conventional parametric mixture models, the number of mixture components is required to be known in advance, which is unrealistic for many real world applications, such as water pipe grouping. Therefore, we adopt Dirichlet pro-cess (DP), a nonparametric approach, for pipe grouping. It serves as a flexible prior for data partitioning and sets no assumptions on the number of partitions. Correspondingly, the Dirichlet process mixture model, which is built based on Dirichlet process, can comprise a countably infinite number of components and adjust itself for fitting observed data.
In order to adopt DP as the prior of pipe grouping, we use the Chinese restaurant process (CRP) [1] as the constructive representation of DP. It exhibits the clustering property of DP via the following metaphor. Suppose there is a Chines restaurant that has an infinite number of tables. A sequence of customers enter and select a table to sit. The first cus-tomer sits at the first table. The following customers sit at tables with a guide: z indicates a customer, z  X  l denotes all the customers that appeared before z l , r indicates a cluster index, and k rep-resents the current number of clusters. n r is the number of customers in cluster r and  X  is the concentration parame-ter for CRP, controlling the probability that a customer is assigned to an unoccupied table.

The CRP offers an exchangeable distribution over the ta-ble assignments z l . The joint distribution is invariant to the order of customers. The procedure of assigning a table for a customer can be performed as he or she is the last customer entering the restaurant. As described by Eq. 6, the i -th customer sits at an occupied table with a probability pro-portional to the number of customers who are already sitting at that table. He or she sits at an unoccupied table with a probability proportional to the concentration parameter  X  . In this metaphor, customers correspond to data points and tables correspond to clusters. Fig. 4 (2) shows the Dirich-let process mixture model with the CRP as the constructive definition. Each data point x i is drawn from a component of the mixture model. z i is the component indicator for x  X  represents the parameter for component k .

With the aid of the CRP, we can group pipes adaptively for fitting data observations. As a result, pipes with simi-lar failure behaviours are grouped together. Moreover, the CRP helps to integrate the grouping process and the failure modeling process for achieving accurate performance.
In this section, we give the detailed description of the pro-posed Dirichlet process mixture of hierarchical beta process (DPMHBP) model for water pipe failure prediction.

For the proposed DPMHBP model, a water pipe is treated as a set of pipe segments that are connected in series. The failure probability of a pipe segment is modeled by a beta process. It is different from the HBP model [11] where beta process is used for modeling failure probabilities of pipes.
Pipe length is an important attribute for estimating fail-ure probability. The intuition is that longer pipes tend to have higher failure probabilities if other attributes and ex-ternal factors are the same. However, the HBP model ig-nores the impact of the length attribute when estimating failure probabilities. It only focuses on pipe age attribute and failure histories. The significant variance of pipe lengths is neglected. In order to tackle the problem, the proposed approach suggests to model the failure probabilities of pipe segments whose lengths are relatively constant with a very small variance.
 Figure 4: Graphical models for (1) Hierarchical Beta process, (2) Dirichlet process mixture model (with Chinese restaurant process as the constructive defi-nition), (3) Dirichlet process mixture of hierarchical beta process.

Another difference between the HBP model and the pro-posed DPMHBP model is that the HBP model groups pipes based on heuristic domain information e.g. , pipe age. Its grouping is predefined and fixed during the inference pro-cess. The number of the groups is also required to be set beforehand, which can be heuristic. In contrast, for the pro-posed DPMHBP method, the grouping process is integrated with the inference process via the DP mixture model. They interact with each other for achieving an optimal model. The number of groups is not fixed and can grow as the size of the training data increases.

Considering all the issues mentioned above, the DPMHBP model can finally be given as follows: The failure probability estimation is conducted on three lev-els: segment group level, segment level and pipe level. The failure events are recorded for segments rather than pipes. The grouping is performed on segments via the CRP, as illustrated by Fig. 3 (2). At segment group level, q notes the failure rate of segment group k . z l represents the group index for segment l . At segment level,  X  l indicates the failure probability of segment l . Once the segment level estimation is obtained, pipe failure probability  X  i readily computed via the failure probability of a series of connected segments. Fig. 4 (3) shows the graphical model of the DPMHBP model.

It is worth noting that Bernoulli process is more suitable for modeling segment failures than modeling pipe failures because it is very rare for a segment to fail twice in a year.
In this section, we describe the inference algorithm for the proposed DPMHBP model. Suppose we are given: (1) a set of pipes, { u i } N i =1 , (2) the segment composition { v each pipe u i , and (3) m -year failure records for segments, { y pipe failure probabilities {  X  i } N i = 1 , which are required for both physical condition assessment and proactive replace-ment. In order to achieve the goal, we need to estimate the
S ince no analytical solution is available for the proposed model, we use Markov chain Monte Carlo (MCMC) sam-pling algorithm for inference. Gibbs sampling is the MCMC-based method that has been widely used for DP mixture models when conjugacy exists between prior and likelihood. However, for the DPMHBP model, such conjugacy is bro-ken by the extra hierarchy of the HBP model. Therefore, we choose to utilize Metropolis-within-Gibbs sampling method for inference.

For Metropolis-within-Gibbs sampling method, model vari-ables are updated one by one iteratively until convergence as Gibbs sampling does. However, for each update step, Metropolis-Hastings sampling is used if the conditional dis-tribution of a model variable is not available for sampling. It is the case for { q k } K k = 1 a nd { z l } L l = 1 .
I n order to use Metropolis-Hastings method for sampling a variable w , a proposal distribution q ( w | w ) is required for generating a candidate state w . The candidate state is accepted with the acceptance probability: where  X  ( w ) can be any unnormalized distribution measuring ratio.

Now we give the details of how to update model vari-ables. Because no conjugate prior exists, we use Metropolis-Hastings sampling method to update group index z l . The CRP conditional prior of z l , defined by Eq. 6, is used as the proposal distribution for generating a candidate z l result, we can find that this factor cancels when comput-ing the acceptance probability defined in Eq. 8 , leaving the acceptance ratio as:
For the CRP conditional prior of z l , defined in Eq. 6, k indicates the current number of segment groups, r denotes group index,  X  is the concentration parameter for CRP, n r i ndicates the number of segments in group r , and z  X  l r epre-sents all the z  X  X  with z l r emoved. Non-informative prior is used for c k  X  s.

The likelihood function in r z l c an be obtained by marginal-izing out  X  l :
Similar to z l , Metropolis-Hastings sampling can be used for updating q k . We use the normal distribution with the current value of q k a s mean for proposing a new candi-date q k . Hence, the Metropolis-Hastings sampling reduces to Metropolis sampling because of the symmetric proposal distribution. The acceptance ratio, r q k , can be calculated accordingly as: The likelihood function in r q k c an be computed by marginal-izing out {  X  l } z l = k a s:
Although the Metropolis sampling approach can sample new q k , it is much less efficient than Gibbs sampling. There-fore, we derive an approximated Gibbs sampling step for up-dating q k , in favour of the inference for large-scale datasets. The approximation made on the last step of Eq. 13 is based on the sparse nature of the pipe failure prediction problem. For water supply networks, most of the pipe segments never fail during the observation period. It is even more rare for a pipe segment to have more than one failures during the observation period. Therefore, the number of failures for a segment, s l = approximation in Eq. 13.

By applying Taylor expansion, the posterior distribution in Eq. 13 can be further approximated as: Based on Eq. 14, we can see that the posterior of q finally be approximated by a beta distribution: It dramatically improves the efficiency of the updates for q
For updating  X  l , we can directly sample a new value from its conditional distribution given the other variables: Once,  X  l is obtained, pipe failure probability  X  i can be read-ily calculated via  X  i = 1  X 
All the updating steps described above are performed it-eratively until convergence is reached. Then the estimations for the model variables can be obtained by taking means of the sampled variable values, with burn-in samples omitted.
In this section, we conduct comparison experiments on the metropolitan water supply network data to demonstrate the superiority of the proposed DPMHBP model. We first introduce the pipe network data and the failure data in Sec-tion 4.1. The features used in the experiments are explained in Section 4.2. Then the compared methods are listed in Sec-tion 4.3. Finally, we give the comparison results and discuss the impact of the proposed method in Section 4.4.
Three representative regions from the metropolis are se-lected to perform the experiments. Region A is a local gov-ernment area with a population around 210 , 000, which is one of the most populous local government areas in its state. Its population density is 629 people per km 2 . Region B is a local government area with a high population density of 2 , 374 people per km 2 . Its population is about 182 , 000. Re-gion C is a low density suburban local government area, which has a population of 205 , 000 and a population density of 300 people per km 2 .

For each region, both network data and failure data are collected. Network data consists of pipe IDs, pipe attributes, pipe locations and environmental factors. Pipe location is represented as a set of connected line segments, each of which corresponds to a pipe segment. Failure data contains pipe IDs, failure dates and failure locations.

Pipe amount, failure amount, laid year range and obser-vation period are summarized for different pipe types in Ta-ble 1. As we can see, CWMs only take a small portion of the network, 24 . 97% for region A, 20 . 76% for region B, and 28 . 00% for region C. The ratio between CWM failures and all the failures is even more smaller, 12 . 71% for region A, 11 . 70% for region B, and 12 . 74% for region C.

The observation period covers 12 years, spanning from 1998 to 2009. It is short compared with pipe life span which can be more than 100 years as shown in Table 1. The ma-jority of the pipes did not fail or just failed once during the observation period. If considering pipe segment failures, the failure events are even more sparse. Hence, the sparsity assumption holds for the proposed approximated sampling algorithm.

Failure locations are used for matching failures with pipe segments. It enables the proposed DPHBP model to work on pipe segment level for estimating failure probabilities.
As mentioned before, we focus on CWMs for compari-son experiments since both physical condition assessment and proactive replacement are conducted for CWMs. For comparing the performances of different approaches, we use the first 11 years X  failure records as training data and the last year X  X  failure records as testing data. All the compared methods have the same setting for fair comparison.
In this section, we describe the pipe attributes and the en-vironmental factors that we used in the experiments. There are five pipe attributes utilized in the experiments including protective coating, diameter, length, laid date, and mate-rial. Two types of environmental factors are considered in the experiments. One is the surrounding soil condition, and the other is the distance between pipe segment and its clos-est traffic intersection. These features are summarized in Table 2.

For pipe attributes, protective coating and material are categorical features indicating the type of coating and mate-rial. Typical protective coatings are polyethylene sleeve and tar coating. Typical materials are cast iron cement lined (CICL) and polyvinyl chloride (PVC). Diameter, length, and laid date are continuous features.

Surrounding soil condition is one of the most complex and important environmental factors for water pipe failure pre-diction. It puts direct impact on pipe degradation process. In the experiments, four different soil features are considered including soil corrosiveness, soil expansiveness, soil geology and soil map. They depict different perspectives of soil char-acteristics.

Soil corrosiveness describes the risk of pipe pitting (metal corrosion) which is essentially an electrical phenomenon and can be measured by linear polarization resistance test. Soil expansiveness describes the shrinking and swelling of ex-pansive clays in response to moisture content change. It is a phenomenon that affects clay soil and can be measured by shrink swell test. Soil geology depicts the information of rocks, e.g. , sandstone and shale. Soil map represents the landscape information, e.g. , fluvial, colluvial and erosional. It also include the information of the soil types that are associated with different landscapes.

Each soil factor is a categorical feature containing several distinct values. The selected local government areas are par-titioned into small regions according to the distinct values of soil factors. Pipe segments falling into the same region share the same soil factor value.
 A large portion of CWMs are buried underneath roads. It makes the change of road surface pressure another impor-tant environmental factor for estimating water pipe failures. It has been shown that frequent pressure changes can lead to high failure rate. One of the main sources causing road sur-face pressure change comes from traffic intersections due to the frequent vehicle starting and stopping. In order to mea-sure the impact of road surface pressure change, we calculate the distance between each pipe segment and its closest traf-fic intersection. The obtained continuous value is regarded as a feature of the pipe segment for predicting its failure probability.
In order to evaluate the proposed approach, four state-of-the-art methods are compared in the experiments including Cox proportional hazard model, Weibull model, HBP model and support vector machine (SVM) based ranking method. Additionally, different grouping methods are used with HBP Table 2: Pipe attributes and environmental factors model as comparisons for demonstrating the advantage of the grouping scheme of the proposed approach.

The Cox proportional hazard model [3] is one of the most popular approaches for survival analysis. It is a semi-parametric approach, in which the form of the baseline hazard function can be arbitrary, and the explanatory features put impacts on the baseline hazard function via an exponential func-tion multiplicatively. Formally, the Cox proportional hazard model can be described as: where h 0 indicates the baseline hazard function, z indicates the explanatory features of water pipe, and b is the param-eter vector that can be learned from training data via a partial likelihood maximization procedure.

For Weibull model [2, 8], water pipe failures are modeled as a set of stochastic events governed by a time dependent stochastic process, namely the Weibull process. It can be regarded as a nonhomogeneous Poisson process whose in-tensity varies as time changes. The intensity function can be formally given as: where t represents pipe age,  X  and  X  are parameters that need to be learned from training data. Similar to Cox pro-portional hazard model, the explanatory features can also be utilized via an exponential function multiplicatively.
Analogous to the method proposed in [18], an SVM-based ranking approach is compared. This approach formulates pipe failure prediction as a ranking problem. It ranks pipes according to their failure risks without estimating their ac-tual failure probability. It learns a real-valued ranking func-tion H that maximizes the objective function: where P and N represent the positive class dataset (fail-ure dataset) and negative class dataset respectively. I (  X  ) is the indicator function. | P | and | N | indicate the numbers of data points in the positive and negative class datasets respectively.

The HBP model proposed by [11] is also compared. In order to evaluate the grouping scheme of the proposed ap-proach, three different grouping methods are integrated with HBP model for comparisons. They group pipes based on pipe attributes according to domain expert suggestion. Specif-ically, pipes are grouped based on material, diameter and laid year.

For fair comparison, the features described in the previous section are used for all the compared methods. For HBP and DPMHBP, the features are applied multiplicatively similar to Cox proportional hazard model and Weibull model. A linear kernel is used for the SVM-based ranking approach.
In this section, we compare the prediction results to demon-strate the superiority of the proposed approach. As men-tioned before, the historical failure data from 1998 to 2008 is used for training and the failures occurred in 2009 are used for testing. Water pipes are ranked by different methods based on their estimated failure risks. The failure predic-tion results are shown in Fig. 5. The x -axis represents the cumulative percentage of the inspected water pipes, and the y -axis indicates the percentage of the detected pipe failures.
Besides, we calculate AUC for measuring the performances of different approaches. The results are shown in Table 3. Statistical significance tests, particularly the one-sided paired t-test at 5% level of significance, are performed on AUC to evaluate the significance of the performance differences. The results are shown in Table 4. For Table 3 and Table 4, only the results from the best groupings are shown for the HBP model.
 As we can see from Fig. 5 and Table 3, the proposed DPMHBP model consistently gives the most accurate pre-diction for all the three regions, whereas the other methods only perform accurately for some of the regions. It demon-strates the adaptability of the proposed approach to the diversity of failure patterns. The significance test results, listed in Table 4, show that the proposed model significantly outperforms the other methods.

In addition to the comparison studies shown above, we also demonstrate the real-life impact of the proposed method by showing its improvements in its real-world application. Different from the standard performance measurement, do-
Figure 7: Risk maps for the selected three regions main experts often adopt evaluation criteria that can reflect the constraints encountered in reality. In the context of wa-ter pipe failure prediction, as mentioned before, only a small portion of the pipes can be physically inspected each year. Specifically, due to budget constraint, only 1% of the total CWMs can be inspected every year. Therefore, we show the performance curves with 1% of CWMs inspected in Fig. 6. AUC and significance test results are also given in Table 3 and Table 4 for the situation of inspecting 1% of CWMs. As we can see, the proposed approach significantly outperforms the other methods for all the three regions. In region C, the proposed approach nearly doubles the number of detected failures compared with the second best method.

A risk map, as shown in Fig. 7, is another widely used method for visualizing real-life impact. As illustrated in the figure, the prioritization of pipes is coded by different colours. For instance, red lines indicate the top 10% high-risk pipes predicted by our method. Black stars in the figure denote the failures which occurred in the testing year. As we can see, many failures could be prevented and significant economic and social savings could be brought to the water utility if the proposed method were applied.
In this paper, we present the Dirichlet process mixture of hierarchical beta process model for water pipe failure prediction. The model demonstrates high adaptability to the diversity of failure patterns. Its structure and com-plexity can grow as the number of data points increases. It tackles the sparse failure data problem by sharing fail-ure data through pipe grouping. An efficient Metropolis-within-Gibbs sampling algorithm is also proposed for han-dling large-scale datasets. The empirical studies conducted on the real water pipe data verifies the superiority of the proposed approach.
National ICT Australia (NICTA) is funded by the Aus-tralian Government as represented by the Department of Broadband, Communications and the Digital Economy and the Australian Research Council through the ICT Centre of Excellence program. [1] D. J. Aldous. Exchangeability and related topics . [2] A. G. Constantine. Pipeline reliability: Stochastic [3] D. R. Cox. Regression models and life-tables. In [4] T. S. Ferguson. A bayesian analysis of some [5] N. L. Hjort. Nonparametric bayes estimators based on are inspected.
 [6] M. D. Hoffman, D. M. Blei, and P. R. Cook.
 [7] J. P. Huelsenbeck, S. Jain, S. W. Frost, and S. L. K. [8] J. G. Ibrahim, M.-H. Chen, and D. Sinha. Bayesian [9] A. Kettler and I. Goulter. An analysis of pipe breakage [10] B. Li, B. Zhang, Z. Li, Y. Wang, F. Chen, and [11] Z. Li, B. Zhang, Y. Wang, F. Chen, R. Taib, [12] K. Mavin. Predicting the failure performance of [13] J. Paisley and L. Carin. Nonparametric factor analysis [14] B. Rajani and Y. Kleiner. Comprehensive review of [15] U. Shamir and C. Howard. An analytic approach to [16] Y. W. Teh, M. I. Jordan, M. J. Beal, and D. M. Blei. [17] R. Thibaux and M. I. Jordan. Hierarchical beta [18] R. Wang, W. Dong, Y. Wang, K. Tang, and X. Yao. [19] O. Yakhnenko and V. Honavar. Annotating images [20] M. Zhou, H. Chen, L. Ren, G. Sapiro, L. Carin, and [21] M. Zhou, H. Yang, G. Sapiro, D. B. Dunson, and
