 of the brain are still rele vant for cogniti ve and motor function in each patient. netic resonance imaging (fMRI) and electromagnetic source imaging (ESI). Although fMRI is the that can only be directly measured with electromagnetic source imaging (ESI). ESI refers to imag-ing of neuronal acti vity using magnetoencephalograph y (MEG) and electroencephalograph y (EEG) data. MEG refers to measurement of tin y magnetic elds surrounding the head and EEG refers to measurement of voltage potentials using an electrode array placed on the scalp. The past decade has sho wn rapid development of whole-head MEG/EEG sensor arrays and of al-gorithms for reconstruction of brain source acti vity from MEG and EEG data. Source localization algorithms, which can be broadly classied as parametric or tomographic, mak e assumptions to overcome the ill-posed inverse problem. Parametric methods, including equi valent current dipole (ECD) tting techniques, assume kno wledge about the number of sources and their approximate lo-bias [1, 2].
 themselv es. Background room interference such as from powerlines and electronic equipment can sources of interest that have temporally overlapping acti vity .
 Noise in MEG and EEG data is typically reduced by a variety of preprocessing algorithms before being used by source localization algorithms. Simple forms of preprocessing include ltering out techniques have also recently been developed using graphical models for preprocessing prior to source localization [3, 4].
 This paper presents a probabilistic modeling frame work for MEG/EEG source localization that is Bayes Expectation-Maximization algorithm. The algorithm then creates a spatiotemporal image of and using them to compute the lik elihood of a dipole at each grid location in the brain. We also sho w that an established source localization method, the minimum variance adapti ve beamformer (MV AB), is an approximation of our frame work. This section describes the generati ve model for the data. We assume that the MEG/EEG data has covariance at the sensors (including brain, biological, or environmental sources), and (4) sensor x certain quantities (described in section 2.2) and infer the full model describing the remaining voxels.
 Let y (typically 200). Time ranges from N Figure 1: (Left) Graphical model for proposed algorithm. Variables are inside dotted box, param-eters outside dotted box. Values in circles unkno wn and learned from the model, and values in squares kno wn. (Right) Representation of factors inuencing the data recorded at the sensors. In sensor . of time samples in the pre-(post-)stimulus period. The generati ve model for data y The K 3 forw ard lead eld matrix F r represents the physical (and linear) relationship between a dipole source at voxel r for each orientation, and its inuence on sensor k = 1 : K [5]. The as well as the conducting medium in which the source lies: the human head is most commonly approximated as a single-shell sphere volume conductor . The source acti vity s r and the L 1 vector x respecti vely , corresponding to source type (2) discussed abo ve. The K M matrix B and the M 1 vector u vector v except for B;u x ed as the other quantities are learned for each voxel. Note howe ver the posterior update for u 2.1 Localization of evok ed sour ces lear ned from post-stimulus data data. The background mixing matrix B and sensor noise precision are x ed, after having been stant through the post-stimulus period and are independent of source location. We assume Gaussian of 3 orientations. All Normal distrib utions specied in this paper are dened by their mean and precision (in verse covariance). The interference and background factors are assumed to have identity precision. To complete spec-ication of this model, we need to specify prior distrib utions on the model parameters. We use a conjug ate prior for the interference mixing matrix A , where the column of A and inferred from the data through . We now specify the full model: is used: We learn the hidden variables and parameters from the post-stimulus data, iterating through each voxel in the brain, using a variational-Bayesian Expectation-Maximization (EM) algorithm. All variables, parameters and hyperparameters are hidden and are learned from the data. In place of maximizing the logp(y) , which would be mathematically intractable, we maximize a lower bound to logp(y) dened by F in the follo wing equation logp(y) when the approximation in Eq. 5 is true, thus making the KL -distance zero. We use a variational-Bayesian EM algorithm which alternately maximizes the function F with respect to the constant, and the suf cient statistics of the hidden variables are computed. In the M-step, F is given the data is computed: where we dene: posterior distrib ution of the interference mixing matrix A including its precision lead eld F is x ed based on the geometry of the sensors relati ve to the head, and B was learned and x ed from the pre-stimulus data. The sensor noise precision is also kept x ed from the pre-stimulus period. The MAP values of the hyperparameter and source factor precision are learned here from the post-stimulus data.
 The matrices, such as R denitions are omitted for space. In each iteration of EM, the mar ginal lik elihood is increased. follo ws: the brain can be displayed. Furthermore, we can also plot an image of the source power estimates and the time course of acti vity at each voxel. We note that the computational comple xity of the proposed algorithm is on the order O ( KLNS ) , roughly equi valent to a single dipole scan, which is of order O ( N ( K 2 + S )) . These are much smaller than the comple xity of a multi-dipole scan which is order O ( NS P ) where P is the number of dipoles, and if S represents roughly several thousand voxels. We fur -ther note that the number of hidden variables to be estimated is less than the number of data points observ ed, thus not pos-ing signicant problems for estimation accurac y. 2.2 Separation of backgr ound sour ces lear ned from pre-stimulus data We learn the background mixing matrix and sensor noise pre-cision from the pre-stimulus data using a variational-Bayes factor analysis model. We assume Gaussian prior distrib u-tions on the background factors and sensor noise, with zero mean and identity precision; we assume a at prior on the sensor precision. We again use a conjug ate prior for the back-ground mixing matrix B , where mixing matrix. All variables, parameters and hyperparameters are hidden and are learned from the pre-stimulus data. We mak e the variational-Bayesian approximation for the background mixing ma-ing its precision matrix , and the MAP estimates of the noise precision and the hyperparameter . We assume the noise precision is diagonal.
 2.3 Relationship to minimum-v ariance adapti ve beamf orming Minimum variance adapti ve beamforming (MV AB) is one of the best performing source local-ization techniques. MV AB estimates the dipole source time series by ^ s W this section, we deri ve that MV AB is an approximation to inference on our model. Figure 3: Example of algorithm and MV AB for correlated source simulation. See text for details We start by rewriting Eq. (1) as y by z Assuming we have estimated the model parameters A;B;; , the MAP estimate of the dipole source time series is s this expression is equi valent to Eq. 8.
 In the innite data limit, the data covariance satises R using the matrix inversion lemma, to be R 1 where the last step used the expression for . Ne xt, we approximate F T F . We then use Eq. (12) to obtain: 3.1 Simulations The proposed method was tested in a variety of real-istic source congurations reconstructed on a 5mm voxel grid. A single-shell spherical volume conduc-tor model was used to calculate the forw ard lead eld [5]. Simulated datasets were constructed by placing Gaussian-damped sinusoidal time courses at specic locations inside a voxel grid based on real-istic head geometry . Sources were assumed to be present in the post-stimulus period with 437 samples along with a pre-stimulus period of 263 samples.
 In the  X noise-alone (N A) X  cases, Gaussian noise only was added to all time points at the sensors. In the  X interference (IN) X  cases, Gaussian noise time courses occurring in both pre-and post-stimulus periods, representing simulated  X ongoing X  acti vity , were placed at 50 random locations throughout the brain voxel grid, and their acti vity was projected onto the sensors and added to both the sensor noise and source acti vity . Finally , in the  X real (RE) X  cases, 700 samples of real MEG sensor data averaged over Signal-to-Noise Ratio (SNR) and the corresponding Signal to Noise-plus-Interference Ratio (SNIR). noise plus interference. The rst performance gure (Fig. 2) sho ws the localization error of the proposed method relati ve to the MV AB. For this data, a single dipole was placed randomly within both the proposed method and MV AB performed perfectly (zero error). This gure clearly sho ws that the error in localization is smaller for the proposed method (black) than for MV AB (green). The next set of simulations examines the proposed method' s ability to estimate the source time course s scenario where the MV AB is kno wn to fail), while the time course of the third source was random top and middle plots correspond to the (square) correlated sources. While both methods estimate exhibits extra noise in the pre-stimulus period for the middle plot.
 The performance of the proposed model on the same set of simulations of correlated sources, com-pared to beamforming, are sho wn in Fig. 4. This gure sho ws the correlation of the estimated lated sources, as a function of SNIR. The proposed method consistently out-performs the MV AB simulation, with standard errors on the order of 0.05 (not sho wn). 3.2 Real data Stimulus-e voked data was collected in a 275-channel CTF System MEG device from a patient with temporal lobe tumor near auditory corte x. The stimulus was a noise burst presented binaurally in termed the M100 peak. Figure 5 sho ws the results of the proposed method applied to this dataset. voxel, the time course was extracted and plotted on the left, sho wing the clear M100 peak. This for pro viding kno wledge of the patient' s auditory processing abilities. in the same MEG device described abo ve. A Re gistered EEG/Ev oked Potential Technologist mark ed this location from the ECD t would normally be used clinically . The middle bottom gure sho ws the lik elihood map from the proposed model; the peak is in clear agreement with the standard ECD to sho w the low noise level and to sho w lack of cross-talk onto source estimates else where. to interference and demonstrated its superior performance over a standard method in a variety of are not occurring (such as in the pre-stimulus period of a evoked response paradigm). This model currently assumes averaged data from an evoked response paradigm, but could be extended to exam-such as structural or functional MRI, could be incorporated. Furthermore, one is not limited to s form.
 [2] K. Sekihara, S.S. Nag arajan, D. Poeppel, and A. Marantz,  X Performance of an MEG adapti ve-[5] J. Sarv as,  X Basic mathematical and electromagnetic concepts of the biomagnetic inverse prob-
