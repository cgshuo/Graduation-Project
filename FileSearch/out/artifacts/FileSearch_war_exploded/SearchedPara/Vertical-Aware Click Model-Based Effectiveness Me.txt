 Today X  X  web search systems present users with heterogeneous in-formation coming from sources of different types, also known as verticals. Evaluating such systems is an important but complex task, which is still far from being solved. In this paper we examine the hypothesis that the use of models that capture user search be-havior on heterogeneous result pages helps to improve the quality of offline metrics. We propose two vertical-aware metrics based on user click models for federated search and evaluate them using query logs of the Yandex search engine. We show that depending on the type of vertical, the proposed metrics have higher correlation with online user behavior than other state-of-the-art techniques. H.3.3 [ Information Storage and Retrieval ]: Information Search and Retrieval Click models; evaluation; aggregated search
When evaluating a web search system, it is commonly assumed that users are presented with ten result snippets, known as  X  X en blues links, X  and that these snippets are examined by users from top to bottom. However, current web search systems go beyond the  X  X en blue links X  paradigm and present users with heterogeneous information coming from multiple search engines, also known as verticals (e.g., images, news, maps, etc.). In this case user search behavior deviates significantly from that observed in standard web search [3, 10]. Although the changes in user behavior should be taken into account when evaluating heterogeneous search systems, still little is done in this direction [12].

The quality of web search results can be evaluated in two ways: online or offline. Online evaluation, such as A/B-testing or inter- X  R esearch mainly carried out while at Yandex, Moscow.
 leaving, gathers feedback directly from users. The feedback usu-ally includes clicks, page dwell times, mouse movements, etc. The quality of a system is then inferred from these signals. Alterna-tively, web search can be evaluated offline by gathering manual assessments of the quality of a whole search engine result page (SERP) and/or its parts. These assessments may be used directly or within offline effectiveness metrics. Recently, a mixed evalua-tion approach was proposed, where offline metrics are built based on models of user search behavior and their parameters are learned from query logs [4]. This way evaluation is done offline, produc-ing instant results. Still, it uses direct user feedback (in the form of clicks), thus considering the preferences of actual users.
In this paper we approach the problem of evaluating heteroge-neous web search systems by following the above idea. In partic-ular, we develop click model-based effectiveness metrics that ac-count for the presence of a vertical result on a SERP. The research question we address is the following: is it possible to improve the quality of offline effectiveness metrics for web search by consider-ing user behavior in the presence of a vertical result?
The contributions of this paper are twofold. First, we develop two vertical-aware effectiveness metrics based on click models for federated search [3, 10]. Second, we evaluate the proposed metrics using a large query log, considering search sessions with different types of vertical results, namely images, video, locations and news.
Effectiveness metrics in web search are intended to reflect the way users perceive the quality of search results. Increasingly, met-rics tend to rely on models of user behavior. Traditional metrics, such as Precision at k or Average Precision, assume that users are interested in relevant documents and, therefore, focus on topical relevance. In addition to relevance, more advanced metrics, e.g., nDCG [7] and RBP [8], assume that users scan results from top to bottom and so discount the relevance of a document by its rank.
Recently, a number of effectiveness metrics were proposed based on user click models. Such models estimate the probability of a click for each document presented to a user. Model-based effective-ness metrics, in turn, use these estimated probabilities to measure the quality of search results. The Expected Reciprocal Rank metric (ERR) [2] uses a simplified version of the DBN click model [1], where a user scans search results from top to bottom until she finds a relevant document or abandons the search. The Expected Brows-ing Utility (EBU) [11] is also based on the simplified DBN model but, as opposed to ERR, which uses predefined parameter values, EBU estimates parameters directly from click logs.

Chuklin et al. [4] proposed a general way of converting click models into model-based effectiveness metrics and applied t his idea to existing models for web search, such as DBN [1], DCM [6] and UBM [5]. As a result, a set of utility-and effort-based metrics were proposed, all of which showed higher correlation with online experiments than the baseline metrics that are not model-based.
The above metrics were shown to be effective in the standard web search scenario. However, existing offline metrics for web search do not consider the presence of vertical results on a SERP. Recent studies showed that user behavior changes considerably in this case [3, 10]. Several click models capturing these changes were proposed X  X he Federated Click Model (FCM) [3] and the Vertical-aware Click Model (VCM) [10] X  X howing higher likelihood and lower perplexity compared to click models for standard web search. However, no corresponding effectiveness metrics were developed. We fill this gap by converting the FCM and VCM models into cor-responding model-based offline effectiveness metrics. We hypothe-size that these metrics correlate better with online experiments than existing offline metrics when a vertical result is present on a SERP.
Both FCM and VCM extend the Utility Browsing Model (UBM) for web search [5] (although DCM-and DBN-based implementa-tions are also possible). Following [4], UBM can be converted into a utility-based metric, so we focus on such metrics in this paper.
A utility-based metric is defined a follows: where N is the number of documents on a result page, P ( C is the probability of the k -th document being clicked and r relevance of the k -th document.

In Eq. (1) the relevance r k is derived from relevance judgements created offline, while the click probability P ( C k = 1) is calculated based on a user click model. We follow the work on ERR [2] and define the relevance r based on a relevance grade R as follows: r = (2 R  X  1) / 2 R max .

According to the UBM click model, a document is clicked if and only if it is examined and attractive: where E and A are random variables denoting examination and attractiveness events. In UBM, attractiveness depends on a docu-ment u and query q and the examination probability depends on the position of the document and the distance from the last click.
During offline evaluation of web search, clicks are not available, so the distance d from the last-clicked document is not observed. Therefore, this distance has to be marginalized out in order to cal-culate the final click probabilities. Following [4], P UBM can be defined recursively as follows: P ( C 0 = 1) = 1 (2) P ( C k = 1) = where, for simplicity,  X  k =  X  u k q and  X  k ( k  X  i ) =  X 
Studies on user behavior in federated search show that the pres-ence of a vertical result affects examination probabilities of other documents on a SERP [3, 10]. To model this bias, FCM introduces an additional hidden variable F , which indicates whether user be-havior changes due to the presence of a vertical result. We will call it vertical attractiveness in this paper. The examination probability in FCM is then modeled as follows: where t is a type of a vertical result, v is its position and l is the distance between a vertical and other documents on a SERP, which can be both positive and negative. The total examination probabil-ity of the FCM model can be calculated as follows: In order to obtain the click probability P FCM ( C = 1) , the exam-ination probability P FCM ( E = 1) should be plugged into Eq. (2) instead of P UBM ( E = 1) =  X  kd . Then, the uFCM metric can be constructed by plugging P FCM ( C = 1) into Eq. (1).

Similarly to FCM, VCM assumes that examination probabili-ties change when an attractive vertical result is present on a SERP ( F = 1 ). Additionally, VCM assumes that in this case a user ex-amines the vertical result first and then continues examining other results in either a bottom-up or top-down direction. This is con-trolled by a hidden variable B . Overall, VCM models the exami-nation probability as follows: These equations define three possible examination trails for a SERP: (i) starting from the top document down to the bottom ( F = 0 ), (ii) starting from a vertical and then back to the top ( F = 1 , B = 1 ), and (iii) starting from a vertical down to the bottom ( F = 1 , B = 0 ). The total examination probability in VCM is the weight-ed average of examination probabilities over these trails: P where d , d  X  and d  X  X  are the distances from the last clicked document according to each trail.

The overall examination probability of the VCM model cannot be directly plugged into Eq. (2), because it uses different distances for different trails. Each distance should be marginalized separately by deriving a click probability for each trail. Then the overall click probability of the VCM model can be calculated as follows:
P VCM ( C = 1) = (1  X   X  tv ) P 1 ( C = 1) +  X  tv  X  tv P 2 where P i is the click probability for i -th trail. The uVCM metric is obtained by plugging P VCM ( C = 1) into Equation (1).
In order to evaluate the proposed vertical-aware effectiveness metrics, we collected user search sessions from click logs of a large commercial search engine, namely Yandex. Similarly to [3, 10], we use vertical results of three different types: images and video rep-resent multimedia verticals, news comprises a text-based vertical Table 1: Summary of user search sessions in training and test s ets for different verticals.
 and locations represent a vertical with composite results, c ontain-ing both textual and visual information. We sampled sessions, con-taining one of these vertical results, during November 2013. The top-10 documents in each session were judged by human assessors using the standard five-grade scale (perfect, excellent, good, fair, and poor). The collected sessions are split based on user ids into training and test sets of roughly the same size (see Table 1). The uneven distribution of the number of sessions between verticals is due to the difference in frequency with which vertical results were triggered in the sampled part of our click logs.

Following [2, 4], we evaluate the quality of the proposed met-rics based on their correlation with online metrics, such as UCTR and Max/Mean/MinRR. UCTR is a binary variable showing if there was a click in a session or not (opposite to abandonment). MeanRR is the mean reciprocal rank of clicks in a session, MaxRR is the re-ciprocal rank of the first click and MinRR is the reciprocal rank of the last click. For the above online metrics only clicks on web results are considered.

Since for the same query a SERP may vary depending on a user, her location, etc., we focus on configurations [2], which is a query with a fixed SERP (see Table 1 for statistics). Offline metrics pro-duce the same value for the same configurations, while the values of online metrics are averaged over all sessions with the same con-figuration. The weighted correlation between offline and online metrics is calculated over all configurations as in [2]: Corr = where N is the total number of configurations, n c is the number of occurrences of the configuration c , m i ( c ) is the value of the metric m i for the configuration c and  X  m i is the mean value of m
We compare our vertical-aware metrics against two types of base-line: (i) static offline metrics where parameters are fixed (DCG and ERR), and (ii) click model-based metrics for web search, where parameters are learned from click logs (EBU, uDCM, uDBN and uUBM). When learning model parameters, the attractiveness prob-ability P ( A = 1) (and the satisfaction probability P ( S = 1) for DBN) is assumed to be dependent only on the relevance grade of a document given a query as in [4].
The weighted correlation between offline and online metrics for different types of vertical results is shown in Tables 2 X 5, the best Table 2: Weighted correlation between offline and online met-rics when a news vertical result is present on a SERP.
 Table 3: Weighted correlation between offline and online met-r ics when an image vertical result is present on a SERP. values are given in bold. Table 2 presents results for the news ver-tical. News snippets contain mainly text and are, therefore, similar to standard web snippets. Due to this, most offline metrics (apart from DCG) have similar correlation with online metrics. Still, the proposed vertical-aware metrics, uFCM and uVCM, are slightly superior to others.

Tables 3 and 4 present results for multimedia verticals, namely images and video. In both cases, uFCM achieves much higher cor-relation values with all online metrics than the baselines. This result is intuitive considering that user behavior was reported to change considerably when a visually attractive vertical result (e.g., an image) is present on a SERP [3, 10]. The FCM model captures such changes, which, in turn, results in higher correlation values between uFCM and online metrics.

The uVCM metric is the second best among model-based metrics in terms of correlation values with online experiments, but it does not correlate as well as uFCM. This can be explained as follows. The FCM and VCM click models both use the vertical attractive-ness parameter  X  tv , which shows how much user behavior deviates from the standard web search scenario when a vertical result of type t is shown at rank v . The lower the value of  X  tv , the closer a vertical-aware model is to the underlying UBM model. After training FCM and VCM for the image and video verticals, we ob-served that FCM estimated  X  tv to be relatively high, which means that FCM deviates considerably from UBM; in contrast, VCM es-timated  X  tv to be quite low, thus being close to UBM. Indeed, Ta-bles 3 and 4 show that the correlation of uVCM with online metrics is somewhat close to that of uUBM.

Table 5 presents results for the location vertical, which consists of both textual and visual information. Interestingly, DCG has the highest correlation with RR-based online metrics, followed by uDCM (which has the highest correlation with UCTR) and EBU. In order to get insights into these results, we conducted an A/B-testing Table 4: Weighted correlation between offline and online met-r ics when a video vertical result is present on a SERP. Table 5: Weighted correlation between offline and online met-r ics when a location vertical result is present on a SERP. experiment on real users of the considered search engine, whe re the location vertical was suppressed for a period of one week. The ex-periment showed that the abandonment rate of the control (the ver-tical result is displayed) was significantly higher than for the treat-ment (the vertical result is suppressed). There might be two reasons for this: (i) users are satisfied with the information presented on a SERP (address, phone number, working hours, etc.) and leave the search without any click, which is known as good abandonment, or (ii) some users consider web results above the location verti-cal as a banner (especially for high positions of the vertical) and skip them, which is known as banner blindness. For navigational queries this results in no clicks on a SERP. In both cases, online metrics, like MeanRR and UCTR, do not fully capture the under-lying user behavior. Thus, the low correlation of offline metrics in Table 5 cannot be interpreted as a failure. Instead, other means of evaluating the quality of offline metrics must be used (e.g., classify-ing abandonments into  X  X ood X  and  X  X ad X  as in [9] and calculating correlation only for the latter), which we plan to do as future work.
Overall, our results show several important trends. First, they confirm the findings of previous studies on user behavior in feder-ated search, that is, user behavior depends on the type of a vertical result present on a SERP, where visually attractive verticals, e.g., video, affect this behavior more than text-based ones such as news. Mixed-content verticals, such as the location vertical, trigger more complex user behavior, which requires further investigation.
Second, in answer to the research question posed in Section 1, we showed that, depending on the type of vertical, the proposed vertical-aware click model-based metrics have higher correlation values with online user behavior than other offline metrics for web search. In particular, uFCM has the highest correlation when a visualy attractive vertical, i.e. image or video, is present on a SERP. The uVCM metric, on the other hand, is more conservative, being closer to the underlying UBM model.
In this paper we approached the problem of offline evaluation for heterogeneous web search environments, where standard web re-sults are augmented with results from vertical search engines. We investigated whether considering user behavior on such federated SERPs helps to improve the quality of offline metrics. To this end, we considered existing click models for federated search, namely FCM and VCM, and converted them into click model-based effec-tiveness metrics. Experimental results showed that, depending on the type of vertical, the proposed metrics have higher correlation values with online metrics, and especially so when visually attrac-tive vertical results, such as images or video, are present on a SERP.
As future work, we plan to extend the proposed metrics to evalu-ate not only web results, but a SERP as a whole, including vertical results, sponsored search and other components. We also plan to investigate user behavior when a location vertical result is present on a SERP in more detail. We first need to understand the cause of the high abandonment rate observed in this case and then we plan to learn to distinguish between good and bad abandonments for a more precise evaluation of the quality of offline metrics.
