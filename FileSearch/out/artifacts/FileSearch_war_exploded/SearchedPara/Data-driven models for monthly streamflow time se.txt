 C.L. Wu, K.W. Chau n 1. Introduction
Many data-driven models, including linear, nonparametric or AutoRegressive Moving Average (ARMA), AutoRegressive Integrated Moving Average (ARIMA), and Seasonal ARIMA (SARIMA) had made a 1985; Haltiner and Salas, 1988; Yu and Tseng, 1996; Kothyari and Singh, 1999; Huang et al., 2004; Mar X   X  aetal.,2004 ).
The second assumption is that a random-looking hydrologic time
In the past two decades, chaos-based streamflow prediction techniques have been increasingly obtaining interests of the hydrology community ( Jayawardena and Lai, 1994; Jayawardena and Gurung, 2000; Elshorbagy et al., 2002; Wang et al., 2006b ) algorithm, Artificial Neural Networks (ANN) and Support Vectors
Machine (SVM) are some typical forecast methods for dynamic et al., 1993 ).

Comparative studies on the abo ve prediction techniques have found that the performance of the K NN approach was consistently carriedoutacomparisonofKNNandANNforfloodpredictionsand proposed that KNN performed worse than ARIMA on the basis of more suitable for a streamflow forecast.
 process should be treated as an integration of stochastic (or random) and deterministic components. Describing it as either a chaos is not a practical approach ( Elshorbagy et al., 2002 ).
Therefore, the model based on either of two assumptions may model is worthy to further study with different real monthly streamflow data (Xiangjiaba, Cuntan, Manwan, and Danjiangkou).
ARMA, ANN, KNN, and ANN-PSR and develop an optimal model for monthly streamflow prediction. This paper is organized in the following manner. Section 2 presents the four sets of streamflow approach and the FNN approach. The implementation of the forecast models, including data preparation and selection of 2. Streamflow data i.e. Xiangjiaba, Manwan, Danjiangkou, and Yangtze River, were analyzed in this study.
 streamflow series were taken from the hydrological station near contributed to the streamflow series is around 45.88 10 4 The period of the data was from January 1940 to December 1997. The medium watershed, Manwan, is located in the Lancang
River which originates from the Qinghai X  X ibet Plateau. Monthly streamflow series were taken from the hydrological station near the Manwan Dam site located in Sichuan Province. The catchment (January 1974 X  X ecember 2003).
 The smallest watershed, Danjiangkou, lies at the upstream of
Han river with average yearly discharge of 1203 m 3 /s. Monthly streamflow data came from the hydrology station at the
Danjiangkou Dam site which is located in Hubei Province. The range was from January 1930 to December 1981.

China. The selected monthly streamflow data were from the hydrology station of Cuntan located in the middle stream of the river. The stream flow series spanned from January 1893 to December 2007.

Four monthly streamflow series are shown in Fig. 1 . Monthly streamflow data in Xiangjiaba, Manwan, and Cuntan are chara-cterized by a smooth process whereas monthly streamflow data in Danjiangkou exhibits complex oscillations. The linear fits works such as dams built during the data collection period, the streamflow process is fairly pristine in each case. 3. Reconstruction of dynamics 3.1. Phase space reconstruction
To describe the temporal evolution of a dynamic system in a multi-dimensional phase space with a scale time series, it is essential to employ some techniques to unfold the discharge (m /s) discharge (m /s) 2006a ). The most frequently used reconstruction method for a univariate or multivariate time series is the delay-time method ( Takens, 1981; Farmer and Sidorowich, 1987; Sauer et al., 1991; Jayawardena and Lai, 1994 ). A dynamic univariate time series f x period and m the embedding dimension. Under ideal conditions of time series of infinite length, all the reconstructions would be analogous and topologically equivalent to the real system. Owing of m and t ( Laio et al., 2003 ).

The time evolution of the dynamic system is given as a Y  X  t  X  T  X  at time t + T can be written as follows: Y  X  t  X  T  X  X  f  X  Y  X  t  X  X  X  e t  X  1  X  x et al., 2003 ). For more details and examples of phase space reconstruction, please refer to Laio et al. (2003) .
Both global and local methods can be applied to estimate the function of f ( ) in Eq. (2). The global approach depends on the observations at all points whereas the local approach depends on of estimate. The KNN algorithm is a widely used local method, which was originally developed by Farmer and Sidorowich (1987) . The basic idea behind KNN is that only nearby states are used to make predictions for the local approximation. This method is similar to the Nearest Neighbor Method (NNM) ( Yakowitz and to those methods for inference of geometrical and topological information about a dynamical attractor from observations. An attractor is the point where the dynamics are discontinuous, through which the minimum embedding dimension can be determined. For the purpose of comparison, a local approach of KNN algorithm ( Farmer and Sidorowich, 1987; Jayawardena and Lai, 1994 ) and a global approach of ANN were discussed in this study. 3.2. Determination of parameters ( t ,m)
Many methods, as mentioned in Section 1, are able to reconstruct the phase space by identifying the parameter pair ( t , m ). The correlation integral and FNN were employed to the 3.2.1. Correlation exponent
The correlation exponent method is commonly used to investigate the existence of chaos in hydrology community ( Jayawardena and Lai, 1994; Sivakumar et al., 1998; Sivakumar existence of chaotic dynamics using the saturation value of the correlation dimension. The diagnosis of the existence of chaos can begin if the phase space has been reconstructed. The
PSR requires two parameters ( t , m ), where m can be identified saturation value must be obtained prior the achievement of m .
However, m is subject to t (often called decorrelation time) and and m should not be determined separately. The length of the embedding window, t w  X  ( m 1) t ( Broomhead and King, 1986;
Mees et al., 1987; Martinerie et al., 1992 ) and optimizing the triplet ( m , t , k ) using Genetic Algorithm (GA) ( Liong and
Sivapragasam (2002) ) are typical examples of determining t and m together. In the present study, we tend to adopt a widely accepted method to obtain t .

Determination of t and m has been reported in numerous works ( Grassberger and Procaccia, 1983; Fraser and Swinney,
Kugiumtzis, 1996; Hegger et al., 1999; and Kantz and Schreiber, 2004 ). Generally, t can be defined when the AutoCorrelation the Average Mutual Information (AMI) reaches the first minimum.
The calculations of ACF and AMI are discussed in detail in the cases.

It is also suggested that a relationship of t  X  T / m (where T represents the dominant periodicity of the original series as therefore around 4 (i.e. m  X  12/3) with all the predominant periodicity of 12 months and t of 3. ( Fig. 3 )
After the primary determination of t , the correlation dimen-sion can be computed by the correlation integral according the formula of Grassberger X  X rocaccia algorithm ( Grassberger and
Procaccia, 1983 ). This original formula was modified by Theiler (1986) for the estimation of the correlation integral in a time series which poses serious problems of temporal correlations. phase space is defined as
C  X  r  X  X  2 N ing those points which are temporally correlated, Y i and N are
Y , H the Heaviside step function with H  X  u  X  X  1if u 4 0 and ( Y , Y ) whose distance, in a Euclidean sense, is smaller than r .In when m exceeds the correlation dimension of the chaos system. The correlation exponent n and the correlation dimension
D can be defined as  X  @ ln C  X  r  X  @ ln r  X  4  X 
D  X  lim convergence of the correlation dimension D 2 in m must be examined.
 ln r with a given m . Then, the potential scaling region is determined wherever the slope (i.e. the correlation exponent n ) of the curve for the given m is approximately constant. region is to produce another figure which demonstrates the slope plateau should be shown in the figure. This plateau provides an for the present m .If d 2 converges to a finite value D 2 0 1 2 3
AMI (bits) 0 1
AMI (bits) saturation value) after repeating the above procedure for successively higher m , a true attractor of dimension D 2 and the system may be considered as chaos. Meanwhile, m can be the saturation value D 2 in the plot of d 2 versus m . pairs of points (i.e. depopulation zone). Conversely, when r approaches the diameter of the cloud of points, the number of The scaling region would be found somewhere between the depopulation and the saturation zones. In view of C  X  r  X  Nevertheless, the scaling region over large r  X  X  should remain the scaling region may be completely masked if there are the depopulation and the saturation zones by increasing the m while the number of points remain in the same positions. Thus, an accurate estimation of d 2 requires a minimum number of points.

Many literatures focus on the quantity of data required to determine the reliable value of d 2 ( Abarbanel et al., 1993 and dimension used for estimating d 2 with an error less than 5%. For instance, the minimum data points for reliable d 2 is 10 ( Ruelle, 1990; Essex and Nerenberg, 1991 ), or Hong, 1994 ) and empirical results of dimension calculations are not substantially altered by going from 3000 or 6000 points to subsets of 500 points ( Abraham et al., 1986 ).

The ln C  X  r  X  versus ln r graphs and the correlation exponent n versus ln r for the four streamflow series are shown in region cannot be identified for any m ( m o 20) in Danjiangkou catchment whereas the scaling region can be determined in other three cases. Obviously, Danjiangkou series cannot be totally defined as non-chaotic or random process because its number of streamflow series is that the identified scaling regions become scales with the increase of m . If the number of data in the streamflow series decreases, the speed for the scaling region to narrow or  X  X  X ost X  X  with the increase of m will become faster. A ambiguous at m  X  8 for Manwan and Xiangjiaba whereas a narrow has 1380 points from data of 114 years. However, the length of data size in Danjiangkou, Cuntan, and Manwan is adequate in defining the scaling region when m r 4. Based on the results of
Fig. 5 , the relationship between correlation dimension d embedding dimension m is depicted in Fig. 7 . The saturation of 4 for the three series. A test for the robustness of m with variable t from 1 to 5 was performed, which implied that m is insensitive to t .
 With the potential values on D 2 or m , some criteria such as 10 can be satisfied whereas other criteria such as 10 2+0.4 m be assessed for m 4 5 attractors since as many as 10,000 points require 27 years of daily records or around 900 years of monthly records. Thus, the three monthly series of Danjiangkou, Cuntan, 2 4 6 8 10 12 -12 -9 -8 -3 0 lnC(r) 246810 -10 -8 -6 -4 -2 0 lnC(r) 12 15 12 15 12 15 12 15 and Manwan may be treated as chaotic with suggested variable spaces in the 3-dimensional maps are clearly unfolded for Xiangjiaba, Cuntan, and Manwan whereas no clear trajectory is revealed for Danjiangkou. 3.2.2. False nearest neighbors (FNN)
The correlation integral method appears to be data intensive and certainly subjective. For simplicity, the FNN method is commonly employed for the PSR of a hydrologic streamflow series ( Wang et al., 2006b ). The FNN algorithm was originally developed for determining the number of time-delay coordinates 0 2.5 5 5000 10000 needed to recreate autonomous dynamics directly from proper-
The following discussion outlines the basic concepts of the FNN algorithm. Suppose the point Y i  X f x i , x i  X  t , x i  X  2 t viewed as a false neighbor of Y i is where :: stands for the distance in a Euclidean sense, R tol threshold with the common range of 10 X 30 ( Wang et al., 2006b ). then the percentage of points which have FNNs is calculated. The algorithm is repeated for increasing m until the percentage of
FNNs drops to zero, or some acceptable small number such as 1%, where m is the target m ( Abarbanel et al., 1993 ).
Manwan and 5 for other three cases. Two random series with the same data size as Cuntan and Danjiakou were, respectively, generated by the random function. Their FNNPs with t of 3 and
R tol of 15 are demonstrated in Fig. 11 where a similar m was found. The FNN technique may not be able to distinguish random process from deterministic system. Therefore, the phase space reconstructed by the FNN may not reveal the true trajectory hidden in the dynamic system. In other words, the FNN technique is not concerned with a dynamic system being deterministic or unfolding a dynamical system. The preliminary parameter pair purpose of the symmetry in models comparison, the parameter parameters pair need to be checked further for their robustness when they are used in KNN model. 4. Implementation of prediction models 4.1. Data preparation
Streamflow series data were divided into three parts: model training, cross-validation, and validation. The last ten years X  streamflow data, called validation set, were set aside for development and training was finished completely. Of the remaining data, the first two-thirds called training set was for was for the purpose of confirming and validating the initial analysis. The ANN model has difficulties to extrapolate beyond the range of the data used for training. As a consequence, poor predictions can be expected when the validation data contains values outside the range of those used for training. It is also of the same population. Statistical properties (mean, deviation, range) from them are compared in order to measure the representative. Table 1 displays the statistical properties of streamflow series are close to the cross-validation sets and the testing sets. 4.2. Evaluation of model performances measures in hydrologic model evaluation by Legates and McCabe and forecasted means and variances. Legates and McCabe (1999) also suggested that a complete assessment of model performance should include at least one absolute error measure (e.g., root mean square error) as necessary supplement to a relative error 30 0 50 100 30 0 50 100 1980 ) is able to check the prediction lag effect.

Thus, three measures of evaluating model performance are used in the present paper comprising root mean square error (RMSE), the Nash X  X utcliffe Coefficient of Efficiency (CE) ( Nash are, respectively, formulated as: R MSE  X  CE  X  1 P N and
P I  X  1 P N number of observations, ^ T i the predicted streamflow, T observed streamflow, T the average observed streamflow, and
T the streamflow estimated from a so-called persistence model and PI values of 1 indicate perfect fits. m 4.3. Configurations of models and parameters optimization due to the similarity among Xiangjiaba, Cuntan, and Manwan.
Two cases, Cuntan and Danjiangkou, are therefore analyzed in the rest of this article.
 matical models of the persistence, or autocorrelation, in a time series. ARMA models can contribute to understanding the physical hydrological system by disclosing some information
Models of ARMA and ANN were used for the purpose of comparison with models based on PSR. The order of the ARMA autoregressive order and q the moving-average order. Parameters ( p , q ) in ARMA were estimated by trial and error with each of where both of them are simultaneously equal to 0, in view of the of ( p , q ) is associated with the minimal value of Akaike
Information Criterion (AIC), which is a commonly adopted
Goodness of fit might be expected to be measured by some function of the variance of the model residuals, i.e., the fit improves as the residuals become smaller.
 systems in a simplified computational form. They are constituted by highly interconnected simple elements (termed artificial neurons or sometimes termed nodes) which receive information, elaborate them through mathematical functions and pass them to edge through a learning process that involves finding an optimal set of weights for the connections and threshold values for the neurons. ANNs can be categorized as single layer, bilayer, and multilayer according to the number of layers, and as feed-
ANN model, the type of ANN and its architecture must be determined. The ANN type used in this study was the static multilayer feed-forward network. The static ANN is able to capture the dynamics of a system in the network model by using delay time inputs. The architecture design of the ANN comprises the number of hidden layers and the number of neurons in input layer, hidden layers, and output layer. ANNs with one hidden layer are commonly used in hydrologic modeling ( Dawson and considered to provide enough complexity to accurately simulate the dynamic and nonlinear-properties of the hydrologic process. Therefore, a three-layer static ANN was finally employed.
One output neuron was selected whilst the input neurons were determined by following the popular approach of examining the dependence between the input and output time series. The model inputs are originally considered to take the previous three sequential data because the ACF first attains zero and AMI three inputs by systematically increasing the number of inputs showed that the model with the 12-month data as input was optimal for Cuntan and Danjiangkou.

The ensuing task is to optimize the size of the hidden layer with the chosen three inputs and one output. The optimal size of the hidden layer was found by systematically increasing the number of hidden neurons from 1 to 20 until the network performance on the cross-validation set was no longer improved significantly. The optimal number of hidden neurons may be affected by the use of a training algorithm. The most popular supervised training algorithms are gradient descent techniques (e.g. BackPropagation (BP) algorithm) and Newton or quasi-
Newton optimization techniques (e.g., Levenberg X  X arquart (LM) algorithm, and Broyden X  X ltecher X  X oldfarb X  X hanno (BFGS) algo-to these methods are global optimization techniques such as the
Particle Swarm Optimization (PSO), the Genetic algorithm (GA), and the Shuffled Complex Evolution (SCE-UA). Generally, these local optimization methods have fast convergence but are methods, on the other hand, are able to overcome local minima and obtain more stable solutions but are slow convergence and tend to find out a relative optimal solution. As an attempt to combine their merits of the two optimization techniques, an integrated training algorithm combining LM with GA is adopted a further optimization via the LM algorithm. Consider Danjingkou performance statistics with 30 time runs in terms of RMSE, CE, PSO and integrated algorithm of LM and GA. As expected, the PSO whereas the LM has faster convergence but exhibits a weak range column (last column of Table 2 ). The hybrid algorithm indeed combines their merits with both fast convergence and good stability of performance. Thus, the LM X  X A algorithm was because the time-consumption in training is not too long. It was algorithms. Finally, a 12 X 5 X 1 configuration of the ANN model with the LM X  X A algorithm was designed for Danjiangkou. Similarly, a 12 X 13 X 1 configuration of ANN was applied to Cuntan. The hyperbolic tangent functions were used as a and output data were linearly scaled to the range of [ 1, 1] because the output of this transfer function is bounded in the range of [ 1, 1].

The KNN method is based on local approximation which makes ing to chosen criteria ( Mack and Rosenblatt, 1979; Aha et al., 1991 ). Amongst various non-parametric kernel methods, the K-NN method seems more intuitive, but nevertheless possesses Yakowitz (1987) and Karlsson and Yakowitz (1987a, b) did considerable work in extending the KNN method to time-series and forecasting problems, obtaining satisfactory results and refer to Karlsson and Yakowitz (1987a) for details. Two PSR-based models, KNN and ANN (hereafter referred to as
ANN-PSR), were applied to the following study. ANN-PSR is the phase space reconstruction-based artificial neural networks integrating the techniques of phase space reconstruction and
ANN. Both the above two models have the same inputs which were the m coordinates of PSR. The number of k was used as k  X  m +1 ( Sugihara and May, 1990 ), but k 4 m +1 ( Farmer and
Sidorowich, 1987 ) was applied to ensure the stability of the still have to be performed although the preliminary parameter values of them have been recommended previously. With all thirty-five combinations of t (1 X 5) and m (2 X 8), the identified
Cuntan and (5, 6) for Danjiangkou. Correspondingly, the fixed k  X  8 and k  X  7 were, respectively, adopted in Cuntan and
Danjiangkou. The ANN-PSR also employed the LM X  X A algorithm via the same method mentioned above. Finally, the architectures of the ANN-PSR are 5 X 9 X 1 for both Cuntan and Danjiangkou. A summary on relevant model parameters for one-step-ahead prediction were displayed in Table 3 . 5. Results and discussion 5.1. Main results
Table 3 shows the one-month-ahead forecast performance of various models in terms of the RMSE, CE, and PI for Cuntan and
Danjiangkou. The KNN outperformed other models in terms of the three performance indices. However, the advantage of KNN over
ARMA is very weak. The comparison between ANN and ARMA demonstrates that the ANN cannot perfectly capture the auto-correlation relationship in each streamflow series. ANN-PSR model displays worse performance than the KNN in each case, which suggests that the local approach may be more suitable for the performance indices from each model are very low for
Danjiangkou. Actually, Danjiangkou series was characterized by heavily contaminated by noises as an evidence of appearance of many high frequency signals ( Fig. 2 ).
 predicted validation data series, their errors (predicted X  observed), and relative errors (hereafter referred to REs) of forecasts from four prediction models for Cuntan. These models exhibit good overall match between the observed and predicted illustrate that each model underestimates or overestimates quite a number of peaks of streamflows although the grand mean of RE s is around 20%. The plots of RE s (bottom graphs of Figs. 12 and 13 ) suggest that the low streamflows are mostly well forecasted. This is due to the frequent occurrences of the low streamflow patterns which allow the trained model to have better generalization of these regions. these models is quite good. The results are consistent with the high PI in Table 3 .

Figs. 14 and 15 show the detail of the observed and predicted are mostly underestimated altho ughthesemodelscancapturethe whole trend of validation data series. The grand mean of RE sare about50%butthemaximum RE isupto300%asshownintheplots
Histograms of forecast errors of one-month-ahead prediction for Cuntan are presented in Fig. 16 , and corresponding Auto-Correlation Functions (ACFs) of forecast errors are depicted in satisfy random processes in terms of ACFs. The results suggest that employed four models were indeed trained fully and forecasts from them are reliable. Similar results also can be found for Dangjiangkou.
 5.2. Discussion
The parameter of k in KNN model poses a great impact on the performance of KNN. As mentioned previously, the choice of k should still ensure the stability of the solution although a preliminary value of k is based on k  X  m +1. The verification of original k was 8 and 7, respectively). The performance of KNN with new k is presented in Table 4 . Comparison of performance 1 2 3 4 -1 0 1 -50 0 100 200 -2000 between the new KNN and the original KNN ( Table 3 ) suggests that taking k  X  m +1 tends to be reasonable because the new k is nearby m +1 and there is only a small improvement of performance for the KNN with the new k .

The issue of lagged predictions in the ANN model has been mentioned by some researchers ( Dawson and Wilby, 1999 ; Jian and Srinivasulu, 2004; De Vos and Rientjes (2005); Muttil and
Chau, 2006 ). The work of De Vos and Rientjes (2005) in the discharge (m ) -3000 -2000 -1000 error (m )
RE (%) 4 20 40 60 frequency 4 20 40 60 frequency context of rainfall-runoff modeling investigated sources of the prediction lag effect and suggested two types of methods to previously observed streamflow data as ANN inputs. Thus, the ANN tends to give the most weight to the latest streamflow input ANN models underrate the information contained in other input the weight of streamflow components as model inputs by using a moving average time series of original streamflows as streamflow input components of the rainfall-runoff ANN.
 Fig. 19 investigates the existence of the forecast lag effect by
Cross-Correlation Functions (CCFs) between the predicted and -0.5 0 0.5 1 -0.5 0 0.5 1 650 775 900 1025 1150 previously, there is no lag effect for Cuntan whereas there is obvious lag effect in all models except for the KNN for
Danjiangkou. The moving average operation was used to generate new monthly streamflow time series to construct the model inputs of ANN. Based on trial and error method, the optimal memory lengths of three months and six months were, of Cuntan and Danjiangkou. With the same architecture as the original ANN, the new moving average ANN (hereafter referred to
MA-ANN) achieved a significant improvement in performance of predictions. Table 4 presents the forecast results using the MA-
ANN for Cuntan and Danjiangkou. The high PI (over 0.9) indicates the elimination of timing error. Fig. 20 depicts the detail of forecasts of MA-ANN for Cuntan and Danjiangkou. The observed
REs also significantly decreased. Fig. 21 compares the CCFs between inputs and outputs in the MA-ANN model and the ANN from the former are mostly larger than those from the latter, in particular for Danjiangkou. Therefore, the improved performance from MA-ANN is due to the increase of the correlation between inputs and outputs by moving average operation on original streamflow time series. This conclusion was different from the effect of the moving average method employed in the work of De
Vos and Rientjes (2005) . The moving average operation is, however, beneficial to the performance of ANN for one-step-ahead streamflow prediction indeed. 6. Conclusions
The purpose of this study attempts to determine a relative optimal forecast model for monthly streamflow data. Two methods of the PSR, the correlation dimension and the FNN, were employed. The results show that three cases, Xiangjiaba,
Cuntan, and Manwan, exhibit chaotic characteristics on the basis for the KNN and ANN-PSR models, and they need to be further 6) for Cuntan and Danjiangkou, respectively. Comparison of the performance for different models indicates that the KNN exhibited no obvious superiority to traditional ARMA. With respect to the PSR-based prediction model, the KNN outperformed the ANN-PSR. This implies that the local approximation technique is better than the global approximation technique for one-month-ahead discharge prediction (at least in the current cases). Additionally, the common three-layer-feed-forward ANN did not expose its powerful ability of mapping any complex function because its prediction performance was worse than ARMA. The CCFs between the observed and predicted data series show that the forecast lag effect exists for Danjiangkou. The operation of moving average on original streamflow series can significantly improve the performance of ANN and eliminate the timing error by increasing the correlation between inputs and in original ANN to 0.93 in MA-ANN and its corresponding CE is from 0.47 to 0.93. Based on the findings of this paper, the 2000 4000 6000 discharge (m ) -1000 -500 500 error (m ) -100 -50 50 100 150
RE (%) (1) (2) (3) (3)
MA-ANN can be proposed as the optimal model for one-month-ahead forecast.
 References
