 1. Introduction into the automotive market is expected to be significant in the years to come. Although the uncertainty related to competing business models for battery ownership, 1 manufacturing costs of batteries and lack of charging infrastructure makes projections difficult, the general expectation is favourable towards PEVs. For example, some analysts ( Hurst and Gartner, 2011 ) estimate that cumulative sales of plug-in hybrid vehicles (PHEV) and battery electric vehicles (BEV) will reach 5.2 million units by 2017. Some forecasts project that, under favourable circumstances, there will as many as 15 million PEVs on the US road by 2030 ( Duvall, 2010 ).
Increasing fuel costs, government purchase incentives, increasing fuel economy standards, and increased vehicle availability are the driving forces that will boost PEV adoption.
 functionality could be greatly affected by the use of PEVs ( Clement-
Nyns et al., 2010; Pieltain et al., 2011; Shao et al., 2009 ). Depending on when (and also where) the PEVs are plugged in, they could cause been designed for that kind of intensive loads. From the grid operator point of view, the simultaneous charging of many PEVs can cause power quality degradation, due to excursions from the system reference voltage, energy losses and overloads of the distribution substation, leading to overheating and ultimately equipment damage ( Rutherford and Yousefzadeh, 2011 ).

One way to avoid simultaneous charging is using time-of-use (TOU) pricing plans ( Shao et al., 2010 ) to dissuade PEV owners from charging at peak times, when the distribution grid where the PEV is plugged in is already close to its maximum capacity.
However, such an approach is inherently static and poses an additional burden on the human owners who must  X  X  X anually X  X  determine when to plug-in their PEVs to recharge.

For all these reasons, it has been acknowledged that the charging of PEVs has to be coordinated on the basis of automatic allocation mechanisms ( Chevaleyre et al., 2006 ). Given the limited amount of power that a distribution substation can safely provide to a set of charging spots, the problem is how to allocate this power among the PEVs by setting the power supply rate of each charging spot with a vehicle plugged in.

This paper is structured as follows: Section 2 provides a formalisation of the PEV charging problem, and a list of require-ments that an automatic allocation mechanism should fulfil.
Section 3 highlights the achievements and drawbacks of previous work in the field of automatic PEV charging. In Section 4 we define our proposed allocation policy, and we analyse it from a game X  X heoretical point of view in Section 5 . After experimentally evaluating the allocation policy in Section 6 ,in Section 7 we draw our conclusions and point to future work. 2. Problem formalisation
We set out from a typical situation in a residential area where the local distribution grid connects a number of individual homes to a substation, which converts medium voltage (MV) of the transport network to low voltage (LV) for domestic use (see Fig. 1 ). In our model, the households are equipped with charging spots where PEVs can be plugged in, which are all fed by the same substation. Furthermore, the substation is able to individually set the maximum power supply for each charging spot in a dynamic manner. We assume a situation where the substation and the PEVs are controlled by intelligent software agents. The PEV agent (or PEV for short) is able to communicate with the substation. It acts on behalf of the human user, but does not need to intensively interact with her (e.g., the human user may just be requested to initially provide the PEV agent with information concerning the basic characteristics of the vehicle such as battery size, engine efficiency, etc.). In the context of this paper, we suppose that there are sufficient charging spots available in the residential area for simultaneously charging the PEVs of the neighbourhood (e.g., each household has installed one charging spot for each PEV owned by it). Furthermore, we approach the situation from a short to medium term perspective, assuming that relevant attri-butes such the number of PEVs in the neighbourhood, as well as fuel and electricity prices remain stable. 2.1. Substation
Due to the physical limitation of the distribution grid, a substation is able to provide a certain amount P of power, which must be shared by the charging spots. The task of the substation agent is therefore allocating the available power P among the plugged PEVs by setting an appropriate power supply for each charging spot with a PEV plugged in.

We assume a model with discrete time steps t A T with fixed duration D t . Let V be the set of charging spots of the distribution grid, and let V t D V be the set of charging spots with a PEV plugged in at time slot t . For simplicity, we assume that all charging spots are of similar type and cannot be fed with more
The task of the substation agent is the implementation of an allocation policy Y that at each time slot t A T returns the vector constraints: X  X  t  X  r o max 8 i A V t  X  2  X  Constraint (1) ensures that the total power supplied to the charging spots does not exceed the available power capacity P . Constraint (2) ensures that the power provided by the substation cannot exceed the power limit of a charging spot. 2.2. PEV
Each PEV has a battery with a capacity of c i kWh, while b  X  t  X  r c i is the amount of electricity that is stored in the battery at time slot t . For each PEV, let a i A T be the arrival time slot at which it is plugged to the charging spot, and let d i A T be the departure time slot at which the PEV needs to be unplugged. A PEV has therefore d i a i time slots available to charge its battery.
As said before, at each time slot t the PEV is able to draw a certain quantity of power o i  X  t  X  from its charging spot, storing units of electricity. At the departure time, the total number of units of electricity stored by the PEV is given by b  X  d
 X  X  b i  X  a i  X  X  o i  X  a i  X  D t  X  o i  X  a i  X  1  X  D t  X  X  o
Finally, we assume that each PEV is characterised by a function u : R -R that returns the utility perceived by the PEV i for having stored in its battery a certain amount b i of electricity. Utility is comparable among PEVs (e.g., monetary), but individually differ-ent among PEVs (e.g., their engines may have different degrees of energy efficiency). 2.3. Definitions
We are now in the position to define some key characteristics and requirements of the policy Y employed by the substation to allocate the available power among the competing PEVs. Definition 1 ( Allocative efficiency ). Let Y be an allocation policy, slot d i . We define the allocative efficiency f of the policy Y as f  X 
X
Allocative efficiency is maximised when the disputed resource is assigned to the agents that value it the most (e.g., if the power is assigned to the PEVs with the most energy efficient engines).
However, in this case it may happen that some agents (e.g., the ones with older, less energy efficient engines) are never chosen for recharging, which does not appear to be fair.

Definition 2 ( Fairness ). Let u  X  f = 9 V 9 be the average utility perceived by the PEVs. We define the fairness s of the policy Y as  X  s
The fairness metric we consider here is the standard deviation of the utilities perceived by the PEVs. This implies that the less dispersion there is from the egalitarian allocation, the higher the fairness of the allocation.

In general, efficiency and fairness are working in opposite directions. Allocation with high efficiency tends to be show higher inequality and lower fairness. 2.4. Requirements
In what follows, we will define a number of requirements that a policy that computes the allocation should comply with.
Requirement 1: private information. An allocation policy Y should not assume that PEV  X  s private information , such as arrival power P ), therefore, it is likely that a PEV may misreport information in order to  X  X  X ame the system X  X  and receive prefer-ential treatment from the allocation policy. Therefore, the alloca-tion policy must provide incentives to PEVs for providing truthful information.

Requirement 2: regulation. An allocation policy Y should be applicable in regulated power systems , where electricity is priced according to a fixed , per-unit , price plan .
 every country. Consumers typically pay electricity according to fixed price plans with one or two (e.g., day and night) rates throughout the day. Although the benefits of applying dynamic pricing to power system have been intensively studied ( Faruqui et al., 2009 ), there is the possibility that regulators will never allow the application of dynamic pricing. For this reason, it is desirable that an allocation policy could work adequately in regulated power systems.

Requirement 3: efficiency-fairness trade-off. An allocation policy Y should honour both efficiency and fairness , providing a means to determine the right trade-off between them .
 maximising the former often implies minimising the latter. For this reason, it would be desirable for the allocation policy to offer the possibility of adjusting the degrees of fairness and efficiency depending on specific circumstances. 3. Related work distribution grid is well known by the scientific community. If the charging of several PEVs connected to the same distribution substation is not coordinated (i.e., they are allowed to charge at the highest power rate whenever they want), PEVs X  demand of power can lead to undesirable peaks, voltage excursions and power losses. In this section, we perform an analysis of some relevant work that addresses the problem of coordinating the charging of several PEV X  X  in order to preserve the distribution grid functionality. 3.1. Centralised approaches making is performed in a centralised way, typically by some infrastructure component such as the distribution substation. The contribution of PEVs to the allocation process is simply providing information such as arrival and departure times, or desired state of charge. 3.1.1. Clement-Nyns et al. (2010) that the expected increase of Belgium X  X  PEVs fleet will have on the distribution grid for the period 2003 X 2050. For PEV penetration of more than 10%, voltage deviations and power losses are so big that the power quality would not be allowed according to the established norms. Therefore, they propose a quadratic optimisa-tion model to minimise power losses and fully charge PEVs X  battery. Provided with the data about PEV X  X  arrival time, depar-ture time, and desired state of charge at the departure time, a centralised solver defines the charging schedule (i.e., the power rate o i  X  t  X  that feeds each PEV X  X  charging spot for all future time slots). 3.1.2. Waraich et al. (2009) A similar approach is undertaken by Waraich et al. (2009) .
The authors propose a smart charging algorithm that extends ( Clement-Nyns et al., 2010 ) as it takes into consideration available data about PEV routes and personal schedules and feedback about grid violations from the power system management infrastruc-ture. The algorithm optimises the charging schedule iteratively while trying to fulfil the PEV demand constraints and avoiding grid constraint violations. 3.2. Decentralised approaches
In decentralised approaches, each PEV participates in the allocation process by making some decisions that affect the final outcome, such as deciding how much to bid for the available units present (e.g., an auctioneer). To the best of our knowledge, no pure decentralised allocation mechanism has been proposed so far, and it is indeed a promising future line of research. 3.2.1. Vandael et al. (2011)
Vandael et al. (2011) present a distributed optimisation model for the automatic scheduling of PEV charging. The authors con-sider a network of distribution substations, not only the last substation that feeds the charging spots. Similarly to Waraich et al. (2009) , this work allows PEV owners to specify the time at which the PEV will be available for charging, the quantity of electricity that is needed, as well as the time at which the PEV needs to have that quantity stored in the battery. The PEV communicates this information to the optimisation solvers that reside on the local substations, which collaboratively compute the charging scheduling while satisfying the constraints of the dis-tribution grid. The distributed structure permits to decompose the optimisation problem in several sub-problems, which helps the system to scale up better than a centralised optimisation solver. 3.2.2. Fan (2011)
In this work, the author proposes a congestion pricing mechanism, as those used in network traffic control, which regulates user demand to balance the grid load. The unique information available in the system is the current electricity price, which is a exponential function of the overall PEVs X  power demand. Based on this information, PEVs adapt their charging demand so as to maximise their own utility. User preference is modelled as a willingness-to-pay parameter that determines the price of electricity and the charging rate o i  X  t  X  that the PEV is granted. 3.2.3. Gerding et al. (2011)
In Gerding et al. (2011) , a market clearing mechanism is presented. At each time step, one unit of electricity is allocated through an incentive compatible auction to the PEV that sub-mitted the highest bid. This mechanism aims at providing PEV owners with the monetary incentives to truthfully report their demand vector and the vehicle arrival and departure times, regardless of the others X  reports. To keep the incentive compat-ibility property, the proposed mechanism occasionally requires the discharge (or  X  X  X urning X  X ) of units of electricity that have been previously stored in the PEV X  X  battery, either at the time of allocation or on PEV X  X  departure. The former way is somewhat more practical to implement, but it makes the computation of the allocation harder. The latter is easier to compute, but requires the battery to be discharged on departure, which may not always be feasible in practice, since discharging is not instantaneous. 3.3. Discussion
Table 1 summarises the related work. It is possible to appreci-ate how none of the proposed allocation mechanisms satisfies all the characteristics that we argue are desirable.
 The approaches proposed in Clement-Nyns et al. (2010) , Waraich et al. (2009) , and Vandael et al. (2011) are all applicable in the current regulated power systems. In fact, they do not need marked-based mechanisms to allocate the available power. How-ever, the greatest limitations are that they rely on the assumption that the information provided by the PEV owner is accurate and truthful. In a more realistic scenario, the PEV owners may need to be modelled as selfish agents with private preferences (e.g., the preferred time to charge, the quantity of electricity that is needed, etc.) that compete for a limited resource (i.e., the distribution grid capacity). Approaches that rely on truthful behaviour are unable to keep owners from misreporting information. For instance, an owner may indicate an earlier departure time in order to receive preferential charging from the optimiser that computes the allocation. Furthermore, all PEVs are treated in a fair manner, without taking into consideration the fact that some PEVs may value electricity more than others. For this reason, maximising allocative efficiency is not considered as one of the objective of the approaches proposed in Clement-Nyns et al. (2010) , Waraich et al. (2009) , and Vandael et al. (2011) .

The work proposed in Fan (2011) is able to define a specific trade-off between efficiency and fairness, because a certain share of the available power P is granted to the PEVs according to their willingness-to-pay. However, the author does not evaluate the sensitivity of the mechanism to malicious users that, trying to obtain an economic advantage, report a willingness-to-pay that is lower than their real preferences. For this reason, it also relies on truthful revelation of information by the PEVs. Furthermore, being a market-based allocation mechanism, it is strictly dependent on the possibility of applying dynamic pricing, while nowadays power systems are highly regulated and consumers typically pay electricity according to fixed per unit price plans.
Finally, the work proposed in Gerding et al. (2011) is also based on dynamic pricing, which may limit its applicability if power systems are not going to be deregulated. Another practical limitation of this work is the need of occasionally  X  X  X urning X  X  units of electricity. Furthermore, being an auction-based allocation mechanism, where only one bidder is allowed to get power at each time step, it maximises allocative efficiency at the expense of the fairness of the allocation. This fact may limit the accept-ability of the proposed method from the broad public. 4. Allocation policy
In this section we present the allocation policy Y L to be used by the substation agent to allocate the available power among the charging PEVs. The policy is inspired by lottery scheduling ,a randomised resource allocation mechanism that has been developed for operating systems ( Waldspurger and Weihl, 1994 ). In lottery scheduling resource rights are represented by lottery tickets of equal unitary value. Lottery tickets are denomi-nated in different currencies , and each currency is backed by a base commodity . An allocation of an indivisible resource (e.g., the access to an I/O device) to a process is determined by holding a lottery. The process with the winning ticket is granted the resource. Thus the amount of lottery tickets held by a process determines the probability of winning the lottery and therefore being granted the resource. Lotteries take place in a continuous fashion, since tickets are not consumed by the lottery manager and are valid for all the subsequent lotteries. Usually the system designer pre-assigns different quantities of tickets according to the priority of the different processes. For instance, to prioritise a kernel process over a user process, the system designer assigns more tickets to the former, so as to increase its probability of winning the lottery and being granted access to a particular resource. The processes can also exchange tickets among them in order to adjust the priorities at run-time. Furthermore, ticket currencies use an exchange rate that expresses all currencies in terms of a base commodity. The exchange rate is another way to adjust priorities among processes with different currencies, by inflating or deflating the currency.

Lottery scheduling has several properties that make it an interesting starting point for an allocation policy for PEV charging.
First, it has been proven to be probabilistically fair in the long run ( Waldspurger and Weihl, 1994 ), since resources are allocated in proportion to the number of tickets that are held by each process.
Therefore, it offers the possibility to enforce the desired level of fairness of the allocations. Second, the inflation of the tickets through an exchange rate can facilitate the allocation of non-equal shares of the resource to different PEVs with different needs. This second aspect may be exploited to maximise the efficiency of the allocations, by giving the possibility to inflate to those PEVs that most value one unit of electricity. However, differently from the processes of an operating system, PEVs cannot be assumed to be benevolent and mutually trusted, thus the inflation of the currency must be carefully mediated.
In this section, we first show how an allocation policy inspired by lottery scheduling can be instantiated so as to make it applicable to the problem of PEV charging. We then discuss a key point of our approach, the determination of exchange rates for lottery tickets, in further detail. 4.1. General policy
Recall that at each time slot t an allocation policy determines a spot during time slot t . This is because in the PEV charging problem the resource to be granted (i.e., the available power P provided by the substation) is infinitely divisible, and therefore the outcome of the allocation is determining how to share the disputed resource among the PEVs. Applying the key idea of lottery scheduling, this share should be proportional to the resource rights (i.e., tickets) held by each PEV.

Since the substation agent, as a coordinator of the system, cannot have a priori preferences over the PEVs, it is impossible to pre-assign different priorities (i.e., different quantities of tickets) to the PEVs. Given that every PEV initially has the same amount of tickets, the outcome of the allocation policy would always be an equal share of the available power P assigned to each PEV.
However, since different PEVs have different preferences (i.e., different valuations of one unit of electricity), a mechanism to give the PEVs the possibility of increasing the number of tickets they hold (and therefore the share of available power P they get) is needed.
 commodity that backs the different currencies. When a PEV is plugged in a charging spot for the first time ever, the substation stores an identifier of the PEV and initialises the quantity g i  X  G = 9 V 9 as the commodity that backs the amount x i tickets issued by the PEV. The tickets issued by a PEV and the base commodity the PEV holds are related through an exchange rate r i ( t ), according to the equation x i  X  t  X  X  r i  X  t  X  g i  X  5  X  determined by the exchange rate. When the PEV appears in the and therefore the initial amount of tickets x i ( t ) is equal to g lottery ticket is worth one unit of base commodity). Once the PEV has registered with the substation, it is allowed to participate in the current allocation (at time slot t ), and in all future allocations (at time slots t 0 4 t ), until it decides to disconnect and move again.
We remark that while G and g i are constant, the amount of issued tickets x i ( t ) and the exchange rate r i ( t ) is set before every allocation by the PEV and the substation respectively. We also
PEV that can be plugged in one of the charging spots of the local distribution grid.
 implement the policy Y L is outlined in Algorithm 1 . At the beginning of each time step, the substation communicates to the PEVs the number of potential participants in the allocation, i.e., the number of plugged PEVs ( notifyNumberOfPartici-pants() ). Then the substation requests each PEV to report the amount of tickets they issued for the allocation that is going to take place at time slot t ( requestNumberOfIssuedTickets()
The PEV controls the issuance of its tickets, therefore, it may report an amount that differs from the initial amount x i provided by the substation. After having updated the amount of tickets for the current time slot, the substation proceeds to set the exchange rate of each PEV in order to proceed with the allocation ( setExchangeRate() ). How the exchange rate is set is detailed in Section 4.2 .

Algorithm 1. Lottery-based allocation algorithm. has set the exchange rates, the substation uses the amount of tickets and the exchange rate to compute for each PEV the share o i  X  t  X  of the total power P that will feed their charging spots for the time slot t ( setPowerSupply() ). The computation of the power supply o i  X  t  X  is detailed in Section 4.2 . Then the charging spot is activated ( activateChargingSpot() ), and the PEV charges its battery for the entire duration of the time slot, drawing o i  X  t  X  D t kWh of electricity from the grid. Finally, the substation resets the exchange rate to the value that determines ( notifyExchangeRate() ). 4.2. Setting exchange rate and power supply
Similarly to lottery scheduling ( Waldspurger and Weihl, 1994 ), the power supply that is provided to a charging spot with a plugged PEV is proportional to the worth of the amount of tickets issued by the PEV, and inversely proportional to the overall worth of the tickets issued by all the PEVs.

The worth of a certain amount x i ( t ) of tickets issued by a PEV is the substation computes before the allocation takes place. When the PEV appears in the system for the first time, x i  X  t  X  X  g therefore one ticket is worth one unit of base commodity. When a
PEV is requested to report its amount of issued tickets at time slot ment of the exchange rate were instantaneous, inflating the amount of issued tickets would not have any positive effect on the granted power supply: if x i ( t ) is doubled and r i equal to g i . For this reason, we define a scheme for a delayed update of the exchange rate r i ( t ) (see Eq. (6) ) r  X  t  X  X  r i  X  t 1  X  X  a  X  x i  X  t  X  X 
In particular, even though the update function has an immediate effect on the exchange rate r i ( t ), it delays its convergence to the  X  X  X rue X  X  exchange rate x i  X  t  X  = g i by means of a differentiable and strictly monotonically increasing step function a  X  x i  X  t  X  X  to compute the allocation in the previous time step, and x the corresponding amount of tickets in the previous time step.
The lower the step value a , the longer it takes for the exchange rate r i ( t ) to reach its  X  X  X rue X  X  value x i  X  t  X  = g i value close to 1 makes an expansion of the amount of issued tickets almost useless, since the exchange rate is immediately adjusted to a value very close to x i  X  t  X  = g i .

Assuming that the PEVs behave rationally, all of them would report an inflated amount of tickets. 3 Given that the power supply allocated to each agent is inversely proportional to the overall worth of all the tickets, if all the PEVs inflate the amount of issued tickets, the outcome would be that none of them would actually be able to increase its power supply . For this reason, we define a mechanism to limit the overall inflation, which penalises all the
PEVs that are participating in the allocation when  X  X  X oo many X  X  of them inflated their tickets.

Let N  X  q 9 V t 9 be the maximum number of PEVs that are allowed to inflate the issued tickets, where q A  X  0 , 1 is an arbitrary value, set by the substation, and 9 V t 9 is the number of participat-ing PEVs. Let P j A V that reported an inflated amount of tickets. 4 The computation of the power supply Y L  X  X  o 1  X  t  X  o 2  X  t  X  ... o 9 V t according to Eq. (7) , where Z A  X  0 , 1 is a tunable parameter  X  t  X  X  As can be seen from Eq. (7) , when the number of agents that inflated their tickets exceeds N , all the PEVs are penalised and receive an equal share of P , reduced 5 by the parameter Z .
Table 2 shows three prototypical allocations. In this example, we suppose that the power to be allocated in a single time slot is P  X  3 kW and that only one PEV ( N  X  1) is allowed to inflate the amount of lottery tickets. We also assume that the step value returned by the function a  X  20  X  is 0.5. The penalisation parameter Z is set to 0.3, and the base commodity is g 1  X  g 2  X  g 3 example (1), no PEV inflates its issued tickets and therefore the power P is equally distributed among the PEVs. In example (2) only PEV 3 reports an inflated amount of tickets. Since based on Eq. (6) the exchange rate r 3 is set to 1.5 (lower than the  X  X  X eal X  X  exchange rate x 3 = g 3  X  20 = 10  X  2), PEV 3 benefits from a bigger share of the available power P . In example (3) both PEVs 2 and 3 report an inflated amount of issued tickets. Given that N  X  1, all the PEVs are penalised and actually receive a power supply that is lower than the power supply that would have been allocated if PEVs 2 and 3 did not inflate the amount of tickets. 5. An induced repeated game
When a PEV reports the amount of tickets that have been issued to compete for a share of the available power P , what is taking place is a game among the various PEVs plugged in a charging spot. In fact, the charging process of the PEVs can be modelled as a repeated n -player game. In each game n players (i.e., the PEVs) simultaneously make their moves (i.e., commu-nicate their amount of tickets x i ( t ) to the substation agent). The utility that player i obtains depends on the share of power o that is allocated to it. As described in the previous section, this amount o i  X  t  X  is calculated based on the joint move of all agents each PEV). Fig. 2 summarises this process. Once such an indivi-dual instance of the game is finished, the PEVs charge their batteries accordingly and, unless they have reached their desired state of charge, join another round of the game at the next time step.

Given that, according to Eq. (7) , o i  X  t  X  is maximised when the amount of issued tickets b x i  X  t  X  to report. This value, due to
Eq. (6) , is given by argmax cally increasing, and laying within the interval  X  0 , 1  X  , the optimal value b x i  X  t  X  exists and is unique (see Appendix A for the proof of report in order to maximise o i  X  t  X  , under the condition that no more than N PEVs do the same. Therefore, a rational player has only two strategies to choose upon: picking the strategy means reporting the same amount as in the previous time step, while the strategy consists of reporting the optimal inflated amount (see
Eq. (9) ) : x  X  t  X   X  x i  X  t 1  X  : x i  X  t  X   X  b x i  X  t  X  X  9  X 
The allocation policy has several parameters that determine the structure of the induced game. In particular, the maximum number of players that are allowed to report an expanded amount of issued tickets  X  N  X  q 9 V t 9  X  determines the number of pure strategy Nash equilibria in which the agents are not penalised.
In these equilibria, exactly N out of 9 V t 9 PEVs report an inflated amount of tickets. Thus, the number of Nash equilibria is equal to the number of subsets of size N of a set with 9 V t 9 elements, which categorised as a sort of minority game ( Arthur, 1994 ), since
PEVs strive to be part of that group of N o 9 V t 9 PEVs that inflate the issued tickets and receive a bigger share of power. Notice that only one of these equilibria (i.e., the one where the N PEVs with highest marginal utilities play ) actually maximises the alloca-tive efficiency.
 tickets, the game takes place. The substation applies the alloca-tion policy Y L to determine how the available power P is shared among the players. Each player is then able to charge for the entire duration D t of the time slot, drawing o i  X  t  X  D t kWh from units of electricity that are stored into the battery after the execution of the game. Table 3 shows an example of a three-player game that is equivalent to the situation outlined in Table 2 , where the values of u i in each cell of the matrix represent the payoffs received by player A i , given a certain combination of actions (either or ) of each of the players A 1 , A 2 and A 6. Experimental evaluation
Y L . We first discuss the experimental set-up, and then analyse the allocation policy regarding (1) its performance at the equilibrium, (2) the dynamics that emerge from the repeated participation of
PEVs in the induced game, and (3) the impact of alternative charging modes on the designability of our policy. The experi-mental set-up is formalised so as to ease the analysis and validation of the proposed allocation policy. 6.1. Experimental set-up scenario with plug-in hybrid electric vehicles as in Gerding et al. (2011) . We assume that PEV regularly needs to be charged at the arrival time in order to drive a desired distance s i (in km) when the PEV is unplugged. Since the cost of driving with the electric engine is lower than the cost of driving with the internal combustion engine, a PEV aims at maximising the distance that it can drive with the electric engine. Let p f be the price of fuel (in the battery is charged at the charging spot (in h = kWh), g c internal combustion engine efficiency (in km/litre), and g e electric efficiency (in km/kWh).
 engine is given by g c i s i  X  h  X  X  10  X 
If the amount of charge stored by the PEV 6 is b i kWh, the PEV will be able to drive b i g e i km using the electric engine and the remaining s i b i g e i km with the internal combustion engine. Thus, the cost of driving s i km is given by g c  X  s i b i g e i  X  X  p e b i  X  h  X  X  11  X  to the amount of km that the PEV is able to drive more cheaply with the electric engine. The PEV utility function is therefore defined as the difference between the cost of driving s i exclusively by the internal combustion engine (Eq. (10) ) and the cost of driving part of s i km by the electric engine (Eq. (11) ) u  X  b i  X  X 
We remark that this utility function does not depend on the amount of km that the PEV owner is willing to drive.

The step function a  X  x i  X  t  X  X  that is used to update the exchange rate is  X  x
From Eq. (13) it is easy to see that, given that amount of tickets that have been issued in the previous time step x i  X  t 1  X  , the bigger the percentage expansion of the amount of issued tickets  X  x this, as well as the fact that there exists a unique value b x determined by the tunable parameter m A R  X  : the bigger the value of m , the faster the step function a  X  x i  X  t  X  X  approaches 1.
The remaining experimental scenario is set up in the following way. Charging occurs within a fixed time window of 12 h (from 8 PM to 8 AM of the next day), divided in time slots of which implies that the induced game is played 72 times during a time window.

For the distribution grid, we assume a small substation providing P  X  10 kW (or equivalently 12.5 kVA) to 10 charging spots. The battery capacity c i of each PEV is uniformly drawn from  X  15 , 25 . The internal combustion engine efficiency g c electric efficiency g e i are uniformly drawn from the interval  X  14 , 28 and  X  3 , 7 respectively. 7 The price of fuel p of electricity at the charging spot p e are set to their average values in Spain at the beginning of 2012, that is, p f  X  1 : 35 h = l and p e  X  0 : 14 h = kWh. 6.2. Equilibrium analysis
The research questions of our interest are: given a particular the players coordinate to play the most efficient equilibrium strategy? Are the associated allocations fair? In this analysis, we first approach these questions in an idealised scenario, where each PEV has full information about the game and is willing to cooperatively play the pure strategy that implements the unique Nash equilibrium that maximises the allocative efficiency, i.e., all PEVs agree beforehand that the N of them with the highest marginal utility (the most The objective of the equilibrium analysis is assessing which kind of trade-off between allocative efficiency and fairness is granted by the proposed policy ( Lottery , Y L ), and its sensitivity to the parameters q and m in order to allow the designer of the policy to enforce the desired trade-off by select ing appropriate values for q and m .
As mentioned before, the structure of the game induced by the allocation policy is determined by the step function parameter report an inflated amount of issued tickets N  X  q 9 V t 9 experiments the parameter q is set to a value in the interval  X  0 , 1 , while the parameter m is set to 0.5, 0.05 and 0.005. For each given combination of q and m , we define the resulting payoff matrix of the induced game. As said before, among the  X  9 possible Nash equilibria, the PEVs coordinate to implement the efficiency maximising equilibrium. At this equilibrium, the N players with the highest valuation of the available power are those that play strategy , while the remaining 9 V t 9 N play strategy . 8
For each parametrisation of the allocation policy, we generate a set of PEVs that play the allocative efficiency maximising equilibrium strategy in all the 9 T 9  X  72 games that take place within the time window. At the end of the time window we compute the allocative efficiency f and the fairness s . The experiment is then repeated 100 times and the results are averaged.

As a matter of comparison, we also compute allocative efficiency and fairness of two others allocation policies. The first one ( Uniform , Y U ) equally distributes the available power P among the plugged PEVs, taking into consideration the maximum power rate of the charging spot (see Eq. (14) )  X  t  X  X  min o max , The second policy  X  MaxVal , Y M  X  distributes the available power P according to the PEV private valuations. Let m  X b P = o max maximum number of charging spots that can receive the highest PEVs that are plugged at time slot t , sorted according to their private valuations, such that v  X  j  X  is the PEV with the j th highest valuation. The allocation Y M  X  X  o 1  X  t  X  o 2  X  t  X  ... o MaxVal policy is therefore defined as in Eq. (15)  X  t  X  X 
This policy is the upper bound for any policy in terms of allocative efficiency. We remark that this policy is purely theoretical, since it is assumed to sort the PEVs according to the valuations they have for the available power, which is PEVs X  private information.
Fig. 4 (a) X (c) plots the allocative efficiency (see Definition 1 )of the population of PEVs for three values of m . In all the figures, the uppermost curve is the efficiency value for the policy Y M this policy has access to the true valuations of the PEVs, it is the policy that maximises the allocative efficiency. The lowest curve is the efficiency value for the policy Y U . The numeric value of the allocative efficiency is the sum of the monetary savings obtained during one time window by the entire set of PEVs, while the value of the fairness is the standard deviation of the individual mone-tary savings.

Depending on the parametrisation of the policy Y L , the efficiency value falls in between these two limits. When no PEV is allowed to report an inflated amount of issued tickets without penalisation ( q  X  0) the policy Y L behaves as Y U . By picking the strategy and reporting the original amount of issued tickets, each PEV receives an equal share of the available power P .
Similarly, when all the PEVs are allowed to report an inflated amount of issued tickets ( q  X  1), the resulting equilibrium is that all of them select strategy and report an inflated amount.
The outcome is that no one actually takes the advantage of the inflation of the issued tickets and Y L again behaves as Y parameter m has a great impact on the resulting allocative efficiency. When m  X  0 : 5, the step function does not offer a significant advantage to the PEVs that report an inflated amount of issued tickets. Thus they only receive a slightly bigger share of the power P , if compared to those PEVs that do not inflate the amount of issued tickets. On the contrary, when m  X  0 : 005 the step function allows a significantly bigger inflation of the amount of issued tickets, which results in considerably bigger shares of P .
For instance, when 40% of the agents are allowed to expand the close to the efficiency value granted by Y M of 32 : 9 h .
Fig. 5 (a) X (c) plots the fairness metric (see Definition 2 ) of the allocations generated by the policies under evaluation. We remark that the greater the value of s , the lower the fairness of the allocation. The uppermost curve is the fairness metric of Y which is of course the least fair policy. The lowest curve is the fairness metric of the most fair policy, Y U . Again, the performance of Y
L falls in between these two limits, depending on the specific parametrisation in use. It is possible to appreciate how for low values of q , the fairness of the allocation is lower. Due to the fact that only those few PEVs with the highest valuations inflate the amount of issued tickets, the resulting allocations tend to be less fair, with few PEVs that experience high utilities, and most PEVs getting low utility values. Again, the parameter m has an impor-tant effect on the fairness of the allocation. If small values of m guarantee higher efficiency values, they also induce less fair allocations. 6.3. Emergent behaviour analysis
The analysis conducted in the previous section showed that when the PEVs coordinate to play the allocative efficiency max-imising equilibrium strategy, the designer of the policy can enforce the desired trade-off between allocative efficiency and fairness by selecting appropriate values for q and m . However, the previous result holds only if each PEV (1) knows the true payoff values of all the other PEVs and (2) cooperates to play the allocative efficiency maximising equilibrium strategy. In a more realistic setting, the true payoff matrix is hardly knowable by the
PEVs, since each of them has incentives to misrepresent the true payoff values in order to be one of the N PEVs that at the equilibrium select strategy . Furthermore, PEVs are interested in their individual payoffs rather than the maximisation of the allocative efficiency of the whole system. In this more realistic scenario, the PEVs can not coordinate beforehand on the equili-brium strategy to play. Instead, they learn how to play the game through repetitive encounters, taking into consideration their beliefs about how their opponents are likely to play. In this case it is possible that at certain stages more than N players select strategy . This will cause the allocation policy to penalise all the
PEVs, according to Eq. (7) , for having exceeded the maximum number of PEVs that are allowed to inflate the amount of issued tickets.
 section is investigating whether the designer is still able to enforce the desired trade-off between allocative efficiency and fairness. We aim at assessing the impact that the penalisation parameter Z used in Eq. (7) has on the resulting equilibrium strategy that emerges when the PEVs know exclusively their own payoff functions and the strategies selected by their opponents after the last game has taken place.

Levine, 1995 ) to let the PEVs learn how to play the game. Let where a  X  j A f , g is the strategy selected by PEV j in a . The share o i of P that is granted by the allocation policy Y L to PEV i depends on the full vector a . Thus the utility of PEV i can be defined as game and does not depend on the fact that the game will be repeated. Let p j  X  a j  X  denote the relative observed frequency of strategy a j A f , g played by PEV j . The values p j  X  X  represent PEV i  X  X  beliefs about PEV j  X  X  mixed strategy. For a given vector a , let p  X  Q j A V will play strategy a  X  j . The expected utility of PEV i is therefore defined as E  X  u i  X 
In smooth fictitious play a PEV does not select the pure best response strategy, instead it selects its strategy with a probability p proportional to the expected utility of that strategy ( Fudenberg and Levine, 1995 )  X  a i  X  X  where t is the  X  X  X emperature X  X  of exploration. Note that as t probability of playing the exact best response strategy approaches 1, while for higher temperature values alternative strategies are selected with higher probability.

In the experiments, the number of PEVs that are allowed to inflate without causing a penalisation is set to 40% of the total ( q  X  0.4), while the step function parameter m is set to 0.05. The learning algorithm is parametrised as follows: the temperature t is initialised to 1 and reduced geometrically by k after each game  X  t 0  X  kt  X  ; the parameter k , which determines how fast the probability of playing the exact best response strategy converges to 1, is drawn from a uniform distribution over the interval  X  0 : 9 , 0 : 99 . An experimental run consists of simulating a total of 90 time windows (i.e., days) of 72 time slots each. 9 At the end of a values. We perform 100 experimental runs and then we average the results (in what follows, error bars represent 95% confidence intervals).

Fig. 6 (a) shows the evolution of the allocative efficiency for different values of the penalisation parameter Z . We remark that when the penalisation is triggered by excessive inflation, depend-ing on the parameter Z only part of the available power P is allocated to the PEVs (see Eq. (7) ). For comparison we also report the efficiency values for the policies evaluated in the previous section ( Uniform and MaxVal ) and the efficiency value that would be obtained by the Lottery policy if the PEVs had reached an agreement to jointly play the allocative efficiency maximising Nash equilibrium. If the allocation policy is designed so as to heavily penalise excessive inflation ( Z  X  0), the resulting alloca-tive efficiency is low at the beginning, since the available power P is not entirely allocated. Notwithstanding, PEVs quickly react and adjust their behaviour due to the penalisation, so that after 30 days the PEVs have adapted their strategy and the resulting allocative efficiency approaches the value of 28 h (see the value for q  X  0.4 in Fig. 4 (b) in Section 6.2 ), equivalent to the Nash equilibrium when PEVs explicitly coordinate their actions so as to maximise the allocative efficiency. If the penalisation is relaxed  X   X  0 : 4  X  , the allocative efficiency that is obtained in the first days is higher than that obtained for Z  X  0. However, each PEV needs more time to learn its best strategy and make the system eventually approach the allocative efficiency of 28 h . Interestingly, if the penalisation is further relaxed ( Z  X  0 : 8), the PEVs are not able to learn a suitable strategy that matches the allocative efficiency of the Lottery policy. In fact, it settles even below the efficiency of the Uniform policy.

Similar dynamics can be appreciated for the evolution of the fairness metric. When Z  X  0, after approximately 30 days the standard deviation of the utility values perceived by the PEVs settles around the value of 2 : 51 h . This is precisely the fairness value reached in the idealised scenario of Section 6.2 (see the value for q  X  0.4 in Fig. 5 (b)), i.e., it coincides with the level of fairness desired at design time. When Z  X  0 : 4, the system needs more time to converge towards the desired fairness value, while for Z  X  0 : 8 the system settles on a value very different from the desired one.

From this analysis, we can conclude that even in a realistic scenario where each PEV only knows its own utility function, the designer is still able to enforce the desired trade-off between allocative efficiency and fairness by selecting an appropriate value for the penalisation parameter Z . Although the PEVs do not explicitly coordinate their strategies, the emergent behaviour is such that the
PEVs with the lowest valuations of the available power select strategy and always report the same amount of issued tickets, while at the same time the N  X  q 9 V t 9 PEVs with the highest valuations inflate the amount of issued tickets by selecting strategy . For example,
Fig. 6 (c) plots the evolution over time of the probability of selecting strategy for Z  X  0. The curves have been obtained in the following way. The group of PEVs is divided in deciles, according to their private value the power the least, while those belonging to the 10th decile are the PEVs that value the power the most. After each experimental run, we store the deciles that the PEVs that on day 90 converged to strategy belong to. The results are then aggregated and averaged for 100 experimental runs. It is possible to appreciate how the penalisation factor creates incentives for the PEVs that belong to the highest deciles to be those that inflate the issued tickets. As a result, the PEVs indirectly coordinate themselves and drive the allocative efficiency of the system towards the value desired by the policy designer. 6.4. Alternative charging modes
In this experimental evaluation we study the effect of the existence of alternative charging modes on the designability of our proposed policy. The experimental results of Section 6.3 showed that the penalisation factor Z  X  0 enables the emergence of an equilibrium whose associated trade-off between allocative efficiency and fairness approaches the value desired by the policy designer, as analysed in Section 6.2 . However, we assumed that
PEV owners only take into account the possibility of charging at home. It is possible that in the near future many public (fast) charging stations will appear in our cities. Although it is reason-able to assume that charging at home is the preferred choice, it has an opportunity cost, that is, the (estimated) utility of the alternative choice that has not been selected.

Let p s be the price of electricity that is paid by the PEV owner at the public charging station (in h = kWh). Similarly to Eq. (12) , the opportunity cost is given by the difference between the cost of driving exclusively by the internal combustion engine and the cost of charging at the public station and then driving part of s km by the electric engine (see Eq. (18) ), i.e. u s i  X  b i  X  X  p f g c
Initially a PEV owner is willing to use her charging spot to charge the battery, since without prior experience this type of charging is preferred. Nonetheless, the PEV owner may change her choice if she estimates that she can increase her utility by selecting the alternative option (i.e., charging at the public station). We model the possibility of changing the preferred mode of charging as follows. Let u i be the moving average of the utility experienced by charging at home in last T days, defined as u i  X  u i  X  b stored in the PEV X  X  battery in the last T days. We assume that the PEV owner is willing to wait y i days before considering alternative choices. The y i parameter models the PEV owner X  X  inertia, that is, the behavioural cost of changing the charging mode. If after y the average utility of having plugged the PEV in the charging spot is lower than the utility of charging the entire battery at the public charge at the public station, thus reducing the number of PEVs that charge at the local distribution grid.
 the population of PEVs that choose to charge at the charging spot evolve over time, as well as the allocative efficiency of the policy. owner evaluates the utility obtained in the last 7 days) and y drawn from a uniform distribution over the interval  X  20 , 60 (i.e., the
PEV owner waits from 20 to 60 days before evaluating the utility of alternative charging modes). The public charging station is assumed to have fast three-phase sockets that provide 50 kW @ 32 A of power, which can recharge a battery of 24 kWh in less than 30 min. Since currently there are very few public charging stations, it is hard to set the price of the electricity p s . Thus we evaluate different scenarios where the price of electricity at the charging station is a multiple of the price of electricity at the private charging spot. the public station is too expensive for the PEV owner, indepen-dently of the performance of the allocation policy. Indeed, with that electricity price, the utility of charging at the public station is always negative, so that the alternative charging mode is not considered by any PEV owner. Even a PEV that does not receive any charging at home prefers to not charge the battery at the public station, since driving entirely with the internal combustion engine is less expensive.

When the price of electricity at the public charging station is lowered  X  p s  X  2 p e  X  0 : 28 h  X  , roughly 20% of the PEVs find more profitable to choose the alternative charging mode (see the shaded area in Fig. 7 (a)). The PEVs that value the power the most are those that keep charging at the charging spot, due to the preferential treatment they receive, which in turn forces the PEVs with lower valuations to consider alternative modes. The effect is that the allocative efficiency of the population of PEVs that stays at the charging spot increases (see the curve  X  X  f  X  X  in Fig. 7 (a)), since the most energy efficient PEVs (i.e., higher h = kWh utility) receive a greater amount of power when less competing PEVs are in the system.

If the price of electricity at the public charging station is lowered even further, down to the price of the charging spot  X  p  X  p e  X  0 : 14 h  X  , the resulting effect is that almost all the PEVs find it preferable to charge at the public station (see the shaded area in Fig. 7 (b)).

From this last analysis we can conclude that the price of power supplied by alternative charging modes can affect the designabi-lity of our allocation policy. In the (likely) case that in the foreseeable future the alternative charging modes remain more expensive and not so widespread (as they are now), the effect of their presence is negligible, since PEV owners will prefer to charge at the private charging spot. In this case, a suitable allocation policy is needed to coordinate the PEV charging and preserve the functionality of the distribution grid. The experimental results support the adequacy of our proposed policy, as it enables the system designer to enforce a desired trade-off between allocative efficiency and fairness even though some PEVs decide that it is preferable for them to charge at a public station. 7. Conclusions
In this paper we put forward an allocation mechanism that automatically coordinates various PEVs that charge their batteries simultaneously. The policy used to determine how the available power P is allocated among the PEVs was inspired by lottery scheduling ( Waldspurger and Weihl, 1994 ). We demonstrated how our allocation policy is capable of balancing allocative efficiency and fairness if PEVs coordinate to play the best equilibrium strategy. From one side it provides preferential treatment to those PEVs that value the available power P the most, which can report an inflated amount of tickets and increase their share of P . On the other side, it guarantees a non-zero share of P to all the PEVs, in order to increase the fairness of the allocation. In a more realistic setting, where each PEV only knows its private payoff function, the designer of the allocation policy can set an appropriate penalisation parameter that makes the desired balance of allocative efficiency and fairness emerge through repeated interactions between the PEVs and the alloca-tion mechanism. Finally, we showed that the designability of our policy is resilient to alternative charging modes, if these remain comparatively more expensive.
 While our approach tackles a problem similar to Clement-Nyns et al. (2010) , Fan (2011) , Vandael et al. (2011) , and Waraich et al. (2009) , it does not rely on truthful behaviour of PEVs, as it can cope with rational and strategic agents. To this respect, it is similar to the work presented in Gerding et al. (2011) , but in our allocation policy modifications to the actual regulatory environment are not needed, since it works in an environment where the price of electricity is regulated and fixed. Furthermore, being an auction, the allocation policy proposed in Gerding et al. (2011) does not take into consideration the fairness of the allocation.

This work can be extended along different lines. If dynamic prices were eventually allowed in power systems, our proposed policy could be easily adapted to work also in this scenario. A possible approach would start by letting the PEVs bid for their share g i of the overall base commodity G that backs the different currencies, rather than pre-assigning equal shares of G . Also, studying whether communication between PEVs enables collusion behaviour could be an interesting extension of this work.

Future work may include an evaluation over a longer time frame, with changing electricity and fuel prices, as well as PEVs that leave and join the systems dynamically. It may also be interesting to evaluate the proposed policy with more complex PEVs X  utility functions and faster learning algorithms. Finally, new decentralised policies and protocols should be studied, where PEVs coordinate the charging of their batteries in a decentralised way without the mediation of a central entity such as the substation. In fact, the proposed mechanism requires the installa-tion of intelligent devices both in the charging spot and the transformer, and decentralised mechanisms could help electricity distribution companies to avoid the corresponding costs. Acknowledgments
Work partially supported by the Spanish Ministry of Science and Innovation through the projects OVAMAH (Grant TIN2009-13839-C03-02; co-funded by Plan E) and AT (Grant CSD2007-0022; CONSOLIDER-INGENIO 2010), and by the Spanish Ministry of Economy and Competitiveness through the project iHAS (Grant TIN2012-36586-C03-02).
 Appendix A. Proof of the uniqueness of ^ x i  X  t  X  Theorem. Let g and r be two positive constants , and a  X  x  X  : R  X  - X  0 , 1  X  a differentiable and strictly monotonically increasing f  X  x  X  X  x has a unique absolute maximum .

Proof. To find the extreme points of f ( x ), we calculate the first derivative of f ( x ) f  X  x  X  X   X  gx
If we equal the first derivative of f ( x ) to 0, we obtain two extreme points x  X  g 2 r a 0  X  x  X  X  and x  X  g 2 r a 0  X  x  X 
Since a  X  x  X  is strictly monotonically increasing, it follows that a 0  X  x  X  4 0 8 x A R  X  . Given that g and r are positive constants, it follows that x 1 is a sum of positive terms. Therefore x 1 extreme point of f ( x ) such that x 1 A R  X  . Now we prove that x the unique extreme point in R  X  . In order to lay within R  X  , x should fulfil the following condition g r a 0  X  x  X  4
Squaring the two terms, we obtain g r  X  a 0  X  x  X  X  2 4 g 4 r 2  X  a 0  X  x  X  X  2 4 g 3 r a  X  x  X  a 0  X  x  X  X  4 g
Finally, simplifying the equation, we obtain a 0  X  x  X  X  1 a  X  x  X  X  o 0
As said before, a  X  x  X  is strictly monotonically increasing, therefore a 0  X  x  X  4 0 8 x A R  X  . Furthermore, by definition a  X  x  X  o 1 8 x follows that the extreme point x 2 cannot lay within in R
To demonstrate that the extreme point x 1 is a maximum, we follow this line of thought. Since a  X  x  X  is a strictly monotonically increasing function in the interval  X  0 , 1  X  , it follows that lim which implies that lim
Given that f  X  0  X  X  0 it follows that x 1 is a maximum if f  X  x  X  4 g
If we reformulate the expression for x 1 as x  X  g 2 r a 0  X  x  X  X  b where b  X  for x 1 being a maximum becomes  X  1 a  X  x  X  X  b 4 g 2 r a 0  X  x  X  X  1 a  X  x  X  X  b 4 g 2 r a 0  X  x  X  we obtain g 4 r 2  X  a 0  X  x  X  X  2 4 g 3 r a  X  x  X  a 0  X  x  X  X  4 g 3 r a 0  X  x  X  4 g a 0  X  x  X  X  1 a  X  x  X  X  4 0 the condition f  X  x 1  X  4 g holds, which implies that x 1 is the unique global maximum of the function f . &amp; References
