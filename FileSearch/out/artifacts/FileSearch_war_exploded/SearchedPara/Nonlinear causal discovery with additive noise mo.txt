 University of Helsinki Causal relationships are fundamental to science because they enable predictions of the consequences of actions [1]. While controlled randomized experiments constitute the primary tool for identifying causal relationships, such experiments are in many cases either unethical, too expensive, or techni-cally impossible. The development of causal discovery methods to infer causal relationships from uncontrolled data constitutes an important current research topic [1, 2, 3, 4, 5, 6, 7, 8]. If the ob-served data is continuous-valued, methods based on linear causal models (aka structural equation models) are commonly applied [1, 2, 9]. This is not necessarily because the true causal relationships are really believed to be linear, but rather it reflects the fact that linear models are well understood and easy to work with. A standard approach is to estimate a so-called Markov equivalence class of directed acyclic graphs (all representing the same conditional independencies) from the data [1, 2, 3]. For continuous variables, the independence tests often assume linear models with additive Gaussian noise [2]. Recently, however, it has been shown that for linear models, non-Gaussianity in the data can actually aid in distinguishing the causal directions and allow one to uniquely identify the gen-erating graph under favourable conditions [7]. Thus the practical case of non-Gaussian data which long was considered a nuisance turned out to be helpful in the causal discovery setting. Gaussianity: When causal relationships are nonlinear it typically helps break the symmetry between the observed variables and allows the identification of causal directions. As Friedman and Nach-man have pointed out [10], non-invertible functional relationships between the observed variables can provide clues to the generating causal model. However, we show that the phenomenon is much more general; for nonlinear models with additive noise almost any nonlinearities (invertible or not) will typically yield identifiable models. Note that other methods to select among Markov equivalent DAGs [11, 8] have (so far) mainly focussed on mixtures of discrete and continuous variables. In the next section, we start by defining the family of models under study, and then, in Section 3 we give theoretical results on the identifiability of these models from non-interventional data. We describe a practical method for inferring the generating model from a sample of data vectors in Section 4, and show its utility in simulations and on real data (Section 5). We assume that the observed data has been generated in the following way: Each observed variable x i is associated with a node i in a directed acyclic graph G , and the value of x i is obtained as a function of its parents in G , plus independent additive noise n i , i.e. where f i is an arbitrary function (possibly different for each i ), x pa ( i ) is a vector containing the elements x j such that there is an edge from j to i in the DAG G , the noise variables n i may consists of a number of vectors x sampled independently, each using G , the same functions f i , and the n i sampled independently from the same densities p n i ( n i ) .
 Note that this model includes the special case when all the f i are linear and all the p n i are Gaussian, yielding the standard linear X  X aussian model family [2, 3, 9]. When the functions are linear but the densities p n i are non-Gaussian we obtain the linear X  X on-Gaussian models described in [7]. The goal of causal discovery is, given the data vectors, to infer as much as possible about the gen-erating mechanism; in particular, we seek to infer the generating graph G . In the next section we discuss the prospects of this task in the theoretical case where the joint distribution p x ( x ) of the observed data can be estimated exactly. Later, in Section 4, we experimentally tackle the practical case of a finite-size data sample. Our main theoretical results concern the simplest non-trivial graph: the case of two variables. The experimental results will, however, demonstrate that the basic principle works even in the general case of N variables.
 Figure 1 illustrates the basic identifiability principle for the two-variable model. Denoting the two variables x and y , we are considering the generative model y := f ( x ) + n where x and n are Figure 1: Identification of causal direction based on constancy of conditionals. See main text for a detailed explanation of (a) X (f). (g) shows an example of a joint density p ( x,y ) generated by a causal model x  X  y with y := f ( x ) + n where f is nonlinear, the supports of the densities p x ( x ) and p n ( n ) are compact regions, and the function f is constant on each connected component of the support of p x . The support of the joint density is now given by the two gray squares. Note that the will also be a valid backward model. both Gaussian and statistically independent. In panel (a) we plot the joint density p ( x,y ) of the observed variables, for the linear case of f ( x ) = x . As a trivial consequence of the model, the relationship would also hold for the conditionals p ( x | y ) for different values of y but, as is well known, for the linear X  X aussian model this is actually the case, as illustrated in panel (c) . Panels (d-f) show the corresponding joint and conditional densities for the corresponding model with a nonlinear function f ( x ) = x + x 3 . Notice how the conditionals p ( x | y ) look different for different values independent) would not be able to fit the joint density. As we will show in this section, this will in fact typically be the case, however, not always.
 To see the latter, we first show that there exist models other than the linear X  X aussian and the in-dependent case which admit both a forward x  X  y and a backward x  X  y model. Panel (g) of Figure 1 presents a nonlinear functional model with additive non-Gaussian noise and non-Gaussian input distributions that nevertheless admits a backward model. The functions and probability den-sitities can be chosen to be (arbitrarily many times) differentiable. Note that the example of panel (g) in Figure 1 is somewhat artificial: p has compact support, and x,y are independent inside the connected components of the support. Roughly speaking, the nonlinearity of f does not matter since it occurs where p is zero  X  an artifical situation which is avoided by the requirement that from now on, we will assume that all probability densities are strictly positive. Moreover, we assume that all functions (including densities) are three times differentiable. In this case, the following theorem shows that for generic choices of f , p x ( x ) , and p n ( n ) , there exists no backward model. Theorem 1 Let the joint probability density of x and y be given by where p n ,p x are probability densities on R . If there is a backward model of the same form, i.e., ential equation for all x,y with  X  00 ( y  X  f ( x )) f 0 ( x ) 6 = 0 : where we have skipped the arguments y  X  f ( x ) , x , and x for  X  ,  X , and f and their derivatives, for all but a countable set of points x  X  R , the set of all p x for which p has a backward model is contained in a 3-dimensional affine space.
 Loosely speaking, the statement that the differential equation for  X  has a 3-dimensional space of solutions (while a priori, the space of all possible log-marginals  X  is infinite dimensional) amounts to saying that in the generic case, our forward model cannot be inverted.
 Gaussian then the existence of a backward model implies linearity of f : Corollary 1 Assume that  X  000 =  X  000 = 0 everywhere. If a backward model exists, then f is linear. The proofs of Theorem 1 and Corollary 1 are provided in the Appendix.
 Finally, we note that even when f is linear and p n and p x are non-Gaussian, although a linear back-ward model has previously been ruled out [7], there exist special cases where there is a nonlinear backward model with independent additive noise. One such case is when f ( x ) =  X  x and p x and p n are Gumbel distributions: p x ( x ) = exp(  X  x  X  exp(  X  x )) and p n ( n ) = exp(  X  n  X  exp(  X  n )) . Although the above results strictly only concern the two-variable case, there are strong reasons to believe that the general argument also holds for larger models. In this brief contribution we do not pursue any further theoretical results, rather we show empirically that the estimation principle can be extended to networks involving more than two variables. Section 3 established for the two-variable case that given knowledge of the exact densities, the true model is (in the generic case) identifiable. We now consider practical estimation methods which infer the generating graph from sample data.
 Again, we begin by considering the case of two observed scalar variables x and y . Our basic method continue as described in the following manner: We test whether a model y := f ( x )+ n is consistent the corresponding residuals  X  n = y  X   X  f ( x ) , and testing whether  X  n is independent of x . If so, we accept the model y := f ( x ) + n ; if not, we reject it. We then similarly test whether the reverse model x := g ( y ) + n fits the data.
 The above procedure will result in one of several possible scenarios. First, if x and y are deemed mutually independent we infer that there is no causal relationship between the two, and no further analysis is performed. On the other hand, if they are dependent but both directional models are accepted we conclude that either model may be correct but we cannot infer it from the data. A more positive result is when we are able to reject one of the directions and (tentatively) accept the other. Finally, it may be the case that neither direction is consistent with the data, in which case we conclude that the generating mechanism is more complex and cannot be described using this model. This procedure could be generalized to an arbitrary number N of observed variables, in the following way: For each DAG G i over the observed variables, test whether it is consistent with the data by constructing a nonlinear regression of each variable on its parents, and subsequently testing whether the resulting residuals are mutually independent. If any independence test is rejected, G i is rejected. On the other hand, if none of the independence tests are rejected, G i is consistent with the data. The above procedure is obviously feasible only for very small networks (roughly N  X  7 or so) and also suffers from the problem of multiple hypothesis testing; an important future improvement would be to take this properly into account. Furthermore, the above algorithm returns all DAGs consistent with the data, including all those for which consistent subgraphs exist. Our current implementation removes any such unnecessarily complex graphs from the output.
 The selection of the nonlinear regressor and of the particular independence tests are not constrained. Any prior information on the types of functional relationships or the distributions of the noise should optimally be utilized here. In our implementation, we perform the regression using Gaussian Pro-cesses [12] and the independence tests using kernel methods [13]. Note that one must take care to avoid overfitting, as overfitting may lead one to falsely accept models which should be rejected. To show the ability of our method to find the correct model when all the assumptions hold we have applied our implementation to a variety of simulated and real data.
 For the regression, we used the GPML code from [14] corresponding to [12], using a Gaussian kernel and independent Gaussian noise, optimizing the hyperparameters for each regression individually. 1 In principle, any regression method can be used; we have verified that our results do not depend significantly on the choice of the regression method by comparing with  X  -SVR [15] and with thin-plate spline kernel regression [16]. For the independence test, we implemented the HSIC [13] with a Gaussian kernel, where we used the gamma distribution as an approximation for the distribution of the HSIC under the null hypothesis of independence in order to calculate the p -value of the test result.
 Simulations. The main results for the two-variable case are shown in Figure 2. We simulated data using the model y = x + bx 3 + n ; the random variables x and n were sampled from a Gaussian distribution and their absolute values were raised to the power q while keeping the original sign. (a) Figure 2: Results of simulations (see main text for details): (a) The proportion of times the forward and the reverse model were accepted, p accept , as a function of the non-Gaussianity parameter q (for b = 0 ), and (b) as a function of the nonlinearity parameter b (for q = 1 ).
 The parameter b controls the strength of the nonlinearity of the function, b = 0 corresponding to the linear case. The parameter q controls the non-Gaussianity of the noise: q = 1 gives a Gaussian, while q &gt; 1 and q &lt; 1 produces super-Gaussian and sub-Gaussian distributions respectively. We used 300 ( x,y ) samples for each trial and used a significance level of 2% for rejecting the null hypothesis of independence of residuals and cause. For each b value (or q value) we repeated the experiment 100 times in order to estimate the acceptance probabilities. Panel (a) shows that our method can solve the well-known linear but non-Gaussian special case [7]. By plotting the acceptance probability of the correct and the reverse model as a function of non-Gaussianity we can see that when the distributions are sufficiently non-Gaussian the method is able to infer the correct causal direction. Then, in panel (b) we similarly demonstrate that we can identify the correct direction for the Gaussian marginal and Gaussian noise model when the functional relationship is sufficiently nonlinear. Note in particular, that the model is identifiable also for positive b in which case the function is invertible, indicating that non-invertibility is not a necessary condition for identification.
 We also did experiments for 4 variables w,x,y and z with a diamond-like causal structure. We took w  X  U (  X  3 , 3) , x = w 2 + n x with n x  X  U (  X  1 , 1) , y = 4 p | w | + n y with n y  X  U (  X  1 , 1) , z = 2 sin x +2 sin y + n z with n z  X  U (  X  1 , 1) . We sampled 500 ( w,x,y,z ) tuples from the model and applied the algorithm described in Section 4 in order to reconstruct the DAG structure. The simplest DAG that was consistent with the data (with significance level 2% for each test) turned out to be precisely the true causal structure. All five other DAGs for which the true DAG is a subgraph were also consistent with the data. Real-world data. Of particular empirical interest is how well the proposed method performs on real world datasets for which the assumptions of our method might only hold approximately. Due to space constraints we only discuss three real world datasets here.
 The first dataset, the  X  X ld Faithful X  dataset [17] contains data about the duration of an eruption and the time interval between subsequent eruptions of the Old Faithful geyser in Yellowstone National Park, USA. Our method obtains a p -value of 0.5 for the (forward) model  X  X urrent duration causes next interval length X  and a p -value of 4 . 4  X  10  X  9 for the (backward) model  X  X ext interval length causes current duration X . Thus, we accept the model where the time interval between the current and the next eruption is a function of the duration of the current eruption, but reject the reverse model. This is in line with the chronological ordering of these events. Figure 3 illustrates the data, the forward and backward fit and the residuals for both fits. Note that for the forward model, the residuals seem to be independent of the duration, whereas for the backward model, the residuals are clearly dependent on the interval length. Time-shifting the data by one time step, we obtain for the (forward) model  X  X urrent interval length causes next duration X  a p -value smaller than 10  X  15 and for the (backward) model  X  X ext duration causes current interval length X  we get a p -value of 1 . 8  X  10  X  8 . Hence, our simple nonlinear model with independent additive noise is not consistent with the data in either direction.
 The second dataset, the  X  X balone X  dataset from the UCI ML repository [18], contains measurements of the number of rings in the shell of abalone (a group of shellfish), which indicate their age, and the length of the shell. Figure 4 shows the results for a subsample of 500 datapoints. The correct model  X  X ge causes length X  leads to a p -value of 0.19, while the reverse model  X  X ength causes age X  comes Figure 3: The Old Faithful Geyser data: (a) forward fit corresponding to  X  X urrent duration causes next interval length X ; (b) residuals for forward fit; (c) backward fit corresponding to  X  X ext interval length causes current duration X ; (d) residuals for backward fit. Figure 4: Abalone data: (a) forward fit corresponding to  X  X ge (rings) causes length X ; (b) residuals for forward fit; (c) backward fit corresponding to  X  X ength causes age (rings) X ; (d) residuals for backward fit. Figure 5: Altitude X  X emperature data. (a) forward fit corresponding to  X  X ltitude causes temperature X ; (b) residuals for forward fit; (c) backward fit corresponding to  X  X emperature causes altitude X ; (d) residuals for backward fit. with p &lt; 10  X  15 . This is in accordance with our intuition. Note that our method favors the correct direction although the assumption of independent additive noise is only approximately correct here; indeed, the variance of the length is dependent on age.
 Finally, we assay the method on a simple example involving two observed variables: The altitude above sea level (in meters) and the local yearly average outdoor temperature in centigrade, for 349 weather stations in Germany, collected over the time period of 1961 X 1990 [19]. The correct model  X  X ltitude causes temperature X  leads to p = 0 . 017 , while  X  X emperature causes altitude X  can clearly be rejected ( p = 8  X  10  X  15 ), in agreement with common understanding of causality in this case. The results are shown in Figure 5. In this paper, we have shown that the linear X  X on-Gaussian causal discovery framework can be gen-eralized to admit nonlinear functional dependencies as long as the noise on the variables remains additive. In this approach nonlinear relationships are in fact helpful rather than a hindrance, as they tend to break the symmetry between the variables and allow the correct causal directions to be iden-tified. Although there exist special cases which admit reverse models we have shown that in the generic case the model is identifiable. We have illustrated our method on both simulated and real world datasets.
 Acknowledgments We thank Kun Zhang for pointing out an error in the original manuscript. This work was supported in part by the IST Programme of the European Community, under the PASCAL2 Network of Ex-cellence, IST-2007-216886. P.O.H. was supported by the Academy of Finland and by University of Helsinki Research Funds.
 A Proof of Theorem 1 Set We conclude Using eq. (5) we obtain and where we have dropped the arguments for convenience. Combining eqs. (7) and (8) yields  X   X  X  Due to eq. (6) this expression must vanish and we obtain DE (4) by term reordering. Given f, X  , we obtain for every fixed y a linear inhomogeneous DE for  X  : where G and H are defined by given by determined by z ( x 0 ) since we can extend eq. (10) to the remaining points. The set of all functions  X  satisfying the linear inhomogenous DE (9) is a 3 -dimensional affine space: Once we have fixed the set of all  X  admitting a backward model is contained in this subspace.
 B Proof of Corollary 1 Similarly to how (6) was derived, under the assumption of the existence of a reverse model one can derive Now using (7) and (8), we obtain which reduces to Substituting the assumptions  X  000 = 0 and  X  000 = 0 (and hence  X  00 = C everywhere with C 6 = 0 since otherwise  X  cannot be a proper log-density) yields Since C 6 = 0 there exists an  X  such that  X  0 (  X  ) = 0 . Then, restricting ourselves to the submanifold { ( x,y )  X  R 2 : y  X  f ( x ) =  X  } on which  X  0 = 0 , we have f 00 = 0 on [ f 00 6 = 0] : a contradiction. Therefore, f 00 = 0 everywhere.
 References
