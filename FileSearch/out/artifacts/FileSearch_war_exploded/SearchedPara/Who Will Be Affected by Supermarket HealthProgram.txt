 The World Health Organization (WHO) reports that in 2014 more than 1.9 bil-lion adults were overweight, and over 600 million were obese [ 1 ]. Being overweight or obese increases the risk of cardiovascular problems, diabetes, and muscu-loskeletal disorders. To address the obesity problem, numerous behavior change programs have been designed, aiming at encouraging participants to maintain a program stakeholders often desire to know to what extent their program influ-ences the participants, and more importantly, how to improve the program to benefit a broader population in the future. Therefore, mining the vast amount of participant behavior data collected by the program and understanding the behavior changes have become critical and timely research tasks.
 The existing studies of health programs mainly report customer demographic statistics and customer survey results, and use statistical tests to examine the overall effect of the programs [ 2  X  4 ]. Although these studies can evaluate the general impact of a health program, they often overlook how the behavior of different types of participants is influenced by the program, which can poten-tially facilitate effective personalized programs. Thus, our aim is to explore in more depth how the participant behavior changes over time and investigate how participants from different segments are affected by the program.
 We propose a systematic approach for tracking the customer behavior changes induced by the health program and evaluate how customers from differ-ent demographic segments (e.g. age and gender) are influenced by the program. The method comprises four specialized modules: we extract customer prefer-ences from their transaction data, construct the temporal preference models, then analyze behavior change since joining the program, and most importantly, quantify the program effectiveness on different types of customers. We evaluate our approach using a large-scale real-life health program deliv-ered by an Australian supermarket chain. The program offered 10 % discount on fresh produce to participants, in order to encourage them to eat healthier. The duration of the discount was 24 weeks, but the purchase data of the par-ticipants for the entire year was collected, which allows us to compare their behavior before, on, and after the program. We analyze the data collected by the program using the proposed method and study how the purchase behavior of different types of customers is affected. We examine four customer segmentation criteria and show that female customers, younger customers, customers who live with their family, and obese customers are more likely to be encouraged by the program. Hence, the contributions of our work are as follows:  X 
We construct a temporal preference model that tracks and visualizes prefer-ence changes of the program participants over time.  X 
We quantify the customer preference changes as well as the program effective-ness on different types of customers.  X 
We evaluate the effectiveness of an Australian health program. Our method and results can be used to inform future personalized health programs. Behavior analytics has been recognized as an indispensable part of business intel-ligence [ 5 , 6 ]. Understanding customer behavior changes allows various stakehold-ers to monitor dynamic business environment and evaluate their policies and marketing campaigns [ 7 , 8 ]. A health program is a specific type of campaign, which promotes a healthier lifestyle and behavior [ 2 ].
 behavior changes, which can be categorized into two groups: (1) incremental approach, that continuously adjusts the model with new transactions [ 9 ], and (2) direct approach, that models the behavior data at different time periods to identify differences [ 7 , 10 ]. Rule-based methods like association rules [ 7 ]and decision trees [ 10 ], are frequently used due to their easy interpretation. The incremental approach is sensitive to noise, while the direct approach can be too coarse-grained to reflect the temporal dynamics. Our goal is to design a model that facilitates direct comparison across multiple time periods  X  instead of just before and after the program  X  and track changes in customer preferences. lyzing patterns of customer preference over time. TimeSVD++ [ 11 ] introduces a time-dependent factor into each user-feature for modeling customer preference changes on the items. In [ 12 ], preference changes are analyzed via Bayesian ten-sor factorization, where the tensor is a three-dimensional array of user-item-time tuples. In contrast, [ 13 ] considers temporal dependence in Bayesian matrix fac-torization to model the frequency of preference changes for different types of cus-tomers. As the base underpinning for our temporal customer preference model, RMGM-OT [ 14 ] takes the advantage of probabilistic topic models to explicitly model the customer preference distributions over item groups; in addition, the method can illustrate how the customer preferences drift over time. This section introduces the proposed method for measuring the effectiveness of a health program. As shown in the flow chart in Fig. 1 , our method consists of four modules: (1) extracting customer preferences from the transaction data, (2) constructing temporal model for customer preferences, (3) analyzing prefer-ence changes over time, and (4) evaluating program influence on different types of customers. The method can visualize customer preferences and provide pro-gram analytics as the output. 3.1 Extracting Customer Preferences The first module extracts the customer preferences from the transaction data. Our program data consists of two parts: (1) transaction data, i.e. purchase records, of 931 participants captured through loyalty cards between 1st January and 31st December, and (2) self-reported survey data addressing their demo-graphic and health information. The original transaction data set covers over 35,600 items from 200 categories. As we are interested in food and drinks rel-evant to the health program, the data set was reduced to 3,394 items from 24 categories, ranging from vegetables and fruits to snacks and soft drinks. Hence, we used 884 out of the 931 customers, who had a sufficient range of categories and number of purchased items in their transaction data. Specifically, each pur-chase record shows the customer ID, item ID, item metadata (name, code, and category), purchased quantity and the time-stamp.
 Given the transaction data set comprising N customers and M items, each transaction record is a tuple ( u i ,v j ,quantity,time ), which indicates that cus-tomer u i purchased quantity of item v j at time . We represent all the transaction tuples as a tensor, X X  X  1 ,...,R } N  X  M  X  T , where each element preference in R levels on v j at t  X  X  1 ,...,T } . The whole time span of the transaction data is evenly partitioned into T periods, and the time index t is determined by the period into which time falls. For example, if each time period corresponds to one month, t = 1 indicates January transactions. Then, we denote X as T preference matrices { X (1) ,..., X ( T ) } corresponding to the T periods; and each X ( t ) contains the preference information of N customers for M items in time period t . The series of preference matrices { X (1) temporal analysis of customer preference changes.
 In our study, the transaction data is partitioned monthly, so the dimension of X is 844 customers  X  3394 items  X  12 months. Each element X preference value based on the aggregated amount of item v In more detail, the sum of amounts bought by customer u i puted and discretized into 5 levels { 1 , 2 , 3 , 4 , 5 } we sort all N  X  T monthly sum values in ascending order; the value smaller than the first 5-quantile (i.e. ranked within the first 20 %) becomes 1  X  the lowest preference level, and the value greater than the first 5-quantile but smaller than the second 5-quantile (i.e. ranked within 20 % X 40 %) becomes 2, and so on. If u did not purchase v j in month t , then X ijt is a missing value. 3.2 Constructing Temporal Model for Customer Preferences The key component of investigating how the health program influences customer behavior is to build a temporal model for customer preferences on all item categories. However, the item-level preference matrix X ( t ) in real-life cases, and the missing values do not necessarily mean the lowest preference level in that period (it is common for customers not to buy certain items at certain periods). Therefore, temporal CF techniques can be exploited to estimate and smooth customer preferences across the time periods. In our study, we are particularly interested in customer preference changes at the category level, rather than at individual item level. Considering the above requirements, we adapt the temporal CF method RMGM-OT [ 14 ] to our problem setting to capture the temporal dynamics of the customer preference for item categories. cally shown in Fig. 2 . In the setting of customer preference analysis, the above factorization results in K latent customer groups and L latent item groups. B is a K  X  L group-level preference matrix, which represents the preferences of K customer groups for L item groups. P  X  [0 , 1] N  X  K can be interpreted as u i  X  X  membership distribution over K customer groups, and k p ik = 1 (soft-membership). Q  X  X  0 , 1 } M  X  L represents the membership information of M items over L item groups. It is worth noting that, in our study, we adopt predefined categories of supermarket products, e.g. vegetables, fruits, and soft drinks, to define the item groups. Thus, v j belongs to only one item category: q jl =1if l is the predefined category; otherwise, q preference over time can be modeled based on { X (1) ,..., X customer-group membership matrix P ( t ) for each time period, while the group-level preference matrix B is shared across all the time periods and the item-group membership matrix Q is predefined. We further assume that the customer-group membership satisfies the Markov property, i.e. the state at t depends on the previous state at t  X  1. Considering the empirical Bayes approach, we can simply use the preceding customer-group membership P ( t  X  bution of the current customer-group membership P ( t ) in the model (shown by the dotted arrows in Fig. 2 ).
 where item categories Q are given. In other words, item latent variables z known in advance and we only need to infer customer latent variables z conditional distribution of z u ij for Gibbs sampling is where  X  and  X  are hyper-parameters, and  X  is the weight of the prior knowledge. The conditional distribution is proportional to the product of two Dirichlet-multinomial distributions: the first is the proportion of preference r in customer-item joint group ( k, l ) and the second is the proportion of prefer-ence records falling in customer group k (for customer u i is worth noting that the prior distribution of p ( t ) i is Dirichlet (  X  )for t =1and Dirichlet (  X  p ( t  X  1) i )for t =2 ,...,T ; so by marginalizing out p pseudo counting  X  p ( t  X  1) i in the second Dirichlet-multinomial distribution. After obtaining the sample z u ij , we can estimate B and P where n klr denotes the number of preference r in customer-item joint group ( k, l ), n ikt denotes the number of preference records of u in time period t , and both n klr and n ikt are counted based on z p
B  X  [0 ,R ] 1  X  L reflects the preferences of customer u i in period t . Therefore, the temporal preferences of N customers can be modeled using 3.3 Analyzing Customer Preference Changes Thus far, the preference change of customer u i has been modeled by p t  X  X  1 ,...,T } . To further understand if the change is in the direction targeted by the health program, we label each item category l as either healthy , neutral or unhealthy . Among the 24 food categories in our transaction data, 5 categories are labeled healthy (vegetables, mushrooms, fruit snacks, fruit desserts, pack-aged salads), 5 are labeled unhealthy (biscuits &amp;cookies, chilled desserts, snacks, soft drinks, confectionery), and the remaining 14 categories are labeled as neu-tral . Our aim is to investigate whether the customer behavior changes due to their participation in the health program, and more specifically, whether their preference for the healthy categories increases.
 Based on the category labels, we let h  X  X  0 , 0 . 5 , 1 } vector, and for each category l  X  X  1 ,...L } Similarly, the indicator vector for unhealthy categories is defined as 1 means the value is 0 for all healthy categories, 1 for all unhealthy categories, and 0.5 for neutral categories. preference p ( t ) i B for the L categories and the healthy indicator h ,andalsothe correlation coefficient between p ( t ) i B and the unhealthy indicator 1 difference between these two correlation coefficients defines the health score for customer u i in time period t as follows where corr ( x , y ) denotes Pearson X  X  correlation coefficient.
 phases: the first includes the periods before the program t and the second includes the remaining periods t  X  X  t p ,...,T customer preferences towards the healthy food categories  X  difference between the average health score in the second phase and the average health score in the first phase. More formally, The positive value of  X  i indicates an increase in customer u healthy categories after joining the program, while a higher value of  X  a greater change in the right direction. Therefore,  X  i is the key measure for evaluating the effect of the program on customer u i . 3.4 Evaluating Program Influence on Customer Segments The values of  X  i for all the customers can provide a general understanding of the health program effect. However, we are also interested in determining the types of customers that are more responsive to the program. This insightful information can inform the design of future personalized programs targeting specific customers.
 features, e.g. geographic, demographic or behavioral [ 15 ]. In our study, the self-reported demographic and health information collected by completing a survey is used for customer segmentation. We consider four features: gender , age , who customers live with (alone, with partner, with family), and Body Mass Index (BMI). All the customers are partitioned into S A segments with respect to the value of an attribute A , such that the customers in segment s the same value of A . If an attribute is numeric, e.g. age, its values are discretized into S A levels.
 able, we split the customers into experimental group and control group according to the duration of their participation in the program. Specifically, the experimen-tal group completed two surveys  X  1) at the start of the program and 2) 12 weeks after the start date, and they participated in the entire program; whereas the control group completed only the first survey, so that they participated only in half of the program or less.
 Overall, the observed changes  X  i in the behavior of individual customers are minor and hard to pick in the short period of one year. Thus, to quantify the effect of the program in customer segment s , we sort all the customers in s accord-ing to their  X  i , and measure the portion of the experimental group customers in experimental group customers have greater preference changes towards healthy categories than the control group customers. We define the effectiveness of the program for a segment s as: where N s is the number of customers in s and counter n is the number of exper-imental group customers in top-n customers. The baseline for eff greater eff s values imply that the experimental group customers are ranked higher than the control group customers, indicating that the program is more effective in segment s . Importantly, eff s is computed for each customer segment and it is used as the main metric for evaluating the effect of the health program. This section presents the results for our case study on how the health program influences the behavior of the program participants. The evaluation involves 884 participants and 3,394 items from 24 categories, as described in Sect. 3.1 .The experimental group comprises 190 customers who participated in the complete program, whereas the remaining 694 customers are in the control group. The program started in May (i.e. t p = 5), so t  X  X  1 ,..., 4 } t  X  X  5 ,..., 12 } is the second phase.
 Following the four-step approach described in Sect. 3 , we convert the transac-tion data into customer preference tensor, and construct the temporal preference model by factorizing  X  X ( t ) = P ( t ) BQ in each month. The parameters are con-figured as follows: the number of customer groups K = 20, the item groups L are the 24 predefined categories, the number of preference levels R =5,  X  is set to 10, and the hyper-parameters  X  and  X  are set to 1 as in [ 14 ]. 4.1 Visualization of Customer Preference Changes We visualize customer group membership p ( t ) i and customer preference p over the 12 months in Fig. 3 . We select three customers who clearly demonstrate different degrees of variability in group membership and category preferences over time.
 The subplots for customer group memberships are shown in the upper row of Fig. 3 . Each column in a subplot indicates the mixed membership of 20 customer groups in one month (sum of each column is 1). Customer 14 had a stable membership over all the time periods, consistently belonging to group 12. On the contrary, customer 36 had a mixed membership in groups 7, 10, and 17. It is interesting to note that the membership in group 17 was identified in June, after joining the program and it was observed till the end of the year. Customer 64 gradually switched from group 20 to group 8 in the middle of the year. ences for all the 24 categories change over the 12 months. Each row in a subplot reflects the fluctuations of the customer preference for a certain item category over the 12 months, and each column indicates the customer preferences for all the 24 item categories in one month. Customer 14 preferred category 23 (pack-aged salads) and did not like categories 13 (cheese), 16 (beef), and 17 (lamb), which implies that this customer purchased more vegetables. As for customer 36, the preference for category 20 (vegetables) was consistently high, while the preference for category 22 (fruit desserts) increased gradually, especially after June. The visualizations, such as those shown in Fig. 3 , can provide an intuitive understanding of temporal preference changes of individual customers. 4.2 Program Effects for Different Types of Customers This section quantifies customer preference changes and the program effective-ness. For the control group, the mean preference change is  X  the experimental group the mean change is  X  i =0 . 055, which is more than twice as much as that of the control group. This observation generally shows that the experimental group had a greater preference change towards healthy categories than the control group.
 eff =0 . 527. To get an insight of the fine-grained program effects, the customers are partitioned into segments according to four different criteria: gender , age , who customers live with ,and BMI . For each segment, we report in Table 1 the size and the program effectiveness eff s . The customers who had not provided their demographic and health information were excluded from this analysis. Segmentation by Gender. As shown in the first section of Table 1 , male cus-tomers account for about 40 % of all the program customers and 37.8 % of the experimental group. The effectiveness of the program is 0.5533 for the female customers, which is higher than 0.4898 observed for the male customers. This implies that the female customers in the experimental group were effectively motivated to purchase healthier food, while the male customers from the exper-imental group were less responsive to the program. Therefore, the program was found to be more effective for female customers .
 Segmentation by Age. The reported age of the participants varied from 19 to 67. The participants are partitioned into four equal-width segments as shown in the second section of Table 1 ). The program effectiveness drops significantly from 0.5844 for customers younger than 30 to 0.4574 for customers older than 50. The difference between these two effectiveness scores supports that different customer segments have different responsivenesses to the program. We notice that the pro-gram effectiveness decreases gradually as the age increases. One possible reason is that it might be easier for younger customers to change their dietary habits. However, this does not imply that customers older than 50 purchase unhealthy food. On the contrary, they might purchase healthier food consistently before and after joining the program, resulting in smaller preference changes. As our effectiveness measure focuses on the  X  X ehavior changes X , the results show that the program did not influence older customers as much as younger customers . Segmentation by Who Customers Live With. Based on the survey ques-tion  X  X ho you live with X , the customers are partitioned into three segments: live alone, live with partner, and live with family. The segment of  X  X iving with their family X  is the largest, comprising 46.95 % of all participants. The program influence on this segment is 0.5555, which is higher than the other two seg-ments. For the customers who live alone or with partner, the effectiveness scores are relatively low, being 0.4929 and 0.5038, respectively. Thus, from the per-spective of who customers live with, the results show that customers living with family achieved a greater preference change towards healthy food than the other customers .
 Segmentation by BMI. The BMI is derived from the height and weight of a person, and its value is classified as underweight, normal, overweight, and obese [ 1 ]. As the proportion of underweight customers is less than 1.5 %, we excluded them from the analysis. It is worth noting that the overweight and obese segments together take up 61.4 % of all customers, which shows the severity of the overweight problem and the necessity of encouraging people to eat healthily. The obese segment achieves the highest effectiveness 0.5705, closely followed by the normal segment with 0.5592, and leaving the overweight segment behind with 0.4787. The effectiveness scores of the obese and normal segments are close, but there is a substantial gap between these segments and the overweight segment. The results suggest that the program was more effective for obese and normal weight customers than for overweight customers.
 Discussion. Our results clearly demonstrate that different types of customers were influenced by the program to a different extent. For the four segmenta-tion criteria, the program was found to be more effective for female customers, younger customers, customers who live with their family, and obese or normal weight customers. However, the program effectiveness across all the segments was relatively low. There are four main possible reasons: (1) the offered 10 % discount on fruits and vegetables may not be attractive enough for customers to notably change their behaviors; (2) the lack of real control group may have undermined the significance of the results, since using the customers, who participated in part of the program as the control group, may not truly represent customers not participating in the program; (3) the actual family size is unknown, so that the results may be inaccurate when comparing customers who purchased food, for example, for a family of 2 vs. for a family of 5; (4) the one-year duration of the program may not be sufficiently long to identify stable behavior changes of the customers. Despite these shortcomings of the program data, the evalua-tion results are encouraging and allow the health program stakeholders to get a fine-grained insight into the impact of the program. This allows tailoring or per-sonalizing future programs, to motivate customers who are not very responsive, such as male customers, senior people and overweight customers in our case. In this paper, we proposed an approach for tracking the customer preferences over time and evaluating the effectiveness of a health program for different types of customer segments defined by demographic and health attributes such as age, gender, living arrangements and BMI. We used data from a large-scale one-year program conducted by an Australian supermarket, which was designed to encour-age customers to build healthy dietary habits. We analyzed how customers from different segments change their preferences over time for various food categories. Overall, the results showed that the program successfully motivated customers to purchase healthier food. The segment-wise effectiveness results demonstrated that different types of customers were influenced to a different extent. We found that female customers, younger customers, customers who live with their family and obese customers were more responsive to the program than their counter-parts. Our results can be used to provide guidelines to enhance future health programs, in order to target and motivate the customers who were less respon-sive in this program and benefit the wider society. Although our method has been designed for a health program, it is a generic method that can be applied to other programs involving transaction records and customer profiles.
