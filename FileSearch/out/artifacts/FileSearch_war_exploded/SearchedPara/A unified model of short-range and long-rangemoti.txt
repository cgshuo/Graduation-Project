 shuangw@stat.ucla.edu We encounter complex dynamic scenes in everyday life. As ill ustrated by the motion sequence depicted in Figure 1, humans readily perceive the baseball p layer X  X  body movements and the faster-moving baseball simultaneously. However, from the computa tional perspective, this is not a trivial problem to solve. The difficulty is due to the large speed diff erence between the two objects, i.e, the displacement of the player X  X  body is much smaller than th e displacement of the baseball be-tween the two frames. Separate motion systems have been prop osed to explain human perception in scenarios like this example. In particular, Braddick [1] pr oposed that there is a short-range motion system which is responsible for perceiving movements with r elatively small displacements (e.g., the player X  X  movement), and a long-range motion system which pe rceives motion with large displace-ments (e.g., the flying baseball), which is sometimes called apparent motion. Lu and Sperling [2] have further argued for the existence of three motion system s in human vision. The first and second-order systems conduct motion analysis on luminance and text ure information respectively, while the third-order system uses a feature-tracking strategy. In th e baseball example, the first-order motion system would be used to perceive the player X  X  movements, but the third-order system would be re-quired for perceiving the faster motion of the baseball. Sho rt-range motion and first-order motion appear to apply to the same class of phenomena, and can be mode led using computational theories that are based on motion energy or related techniques. Howev er, long-range motion and third-order Figure 1: Left panel: Short-range and long-range motion: tw o frames from a baseball sequence illustration of our hierarchical model in one dimension. Ea ch node represents motion at different location and scales. A child node can have multiple parents, and the prior constraints on motion are expressed by parent-child interactions. motion employ qualitatively different computational stra tegies involving tracking features over time, which may require attention-driven processes.
 In contrast to these previous multi-system theories [2, 3], we develop a unified single-system frame-work to account for these phenomena of human motion percepti on. We model motion estimation as an inference problem which uses flexible prior assumption s about motion flows and statistical models for quantifying the uncertainty in motion measureme nt. Our model differs from the tradi-tional approaches in two aspects. First , the prior model is defined over a hierarchical graph, see Figure 1, where the nodes of the graph represent the motion at different scales. This hierarchical structure is motivated by the human visual system that is org anized hierarchically [8, 9, 4]. Such a representation makes it possible to define motion priors an d contextual effects at a range of dif-ferent scales, and so differs from other models of motion per ception based on motion priors [5, 6]. This model connects lower level nodes to multiple coarser-l evel nodes, resulting in a loopy graph structure, which imposes a more flexible prior than tree-str uctured models (eg. [7]). We define a our data likelihood terms allow a large space of possible mot ions, which include both short-range and long-range motion. Locally, the motion is often highly a mbiguous (e.g., the likelihood term allows many possible motions) which is resolved in our model by imposing the hierarchical motion prior. Note that we do not coarsen the image and do not rely on c oarse-to-fine processing [14]. Instead we use a bottom-up compositional/hierarchical app roach where local hypotheses about the motion are combined to form hypotheses for larger regions of the image. This enables us to deal simultaneously with both long-range and short-range motio n.
 We tested our model using two types of stimuli commonly used i n human vision research. The first stimulus type are random dot kinematograms (RDKs), where so me of the dots (the signal) move coherently with large displacements, whereas other dots (t he noise) move randomly. RDKs are one of the most important stimuli used in both physiological and psychophysical studies of motion per-ception. For example, electrophysiological studies have u sed RDKs to analyze the neuronal basis of motion perception, identifying a functional link between t he activity of motion-selective neurons and behavioral judgments of motion perception [15]. Psychophy sical studies have used RDKs to mea-sure the sensitivity of the human visual system for perceivi ng coherent motion, and also to infer how motion information is integrated to perceive global motion under different viewing conditions [16]. We used two-frame RDKs as an example of a long-range motion st imulus. The second stimulus type are moving gratings or plaids. These stimuli have been used t o study many perceptual phenomena. For example, when randomly orientated lines or grating elem ents drift behind apertures, the per-shape and contrast of the apertures [17, 18, 19]. Multiple-a perture stimuli have also recently been used to study coherent motion perception with short-range m otion stimulus [20, 21]. For both types of stimuli we compared the model predictions with human perf ormance across various experimental conditions. the pixel lattice and construct the hierarchy as follows.
 by a factor of 2 along each coordinate direction from level l  X  1 . The edges E of the graph connect nodes at each level of the hierarchy to nodes in the neighbori ng levels. Specifically, edges connect in the 1-D case and with d = 2 . Note that our graph G contains closed loops due to sharing of child nodes.
 the motion, and connect the 0 th level nodes to two consecutive image frames, D = ( I The problem of motion estimation is to estimate the 2D motion field u ( x ) at time t for every pixel site x from input D . For simplicity, we use u l following sections. 2.1 Model formulation We define a probability distribution over the motion field U = { u l G conditioned on the input image pair D : where E on the motion which impose slow and smoothness constraints a t different levels. Energy terms E , { E l u } are defined using L 1 norms to encourage robustness [22]. This robust norm helps d eal with the measurement noise that often occur at motion bounda ry and to prevent over-smoothing at the higher levels. The details of two energy function terms a re described as follows: 1) The Data Term E the L where the first term defines a difference measure between two m easurements centered at x and centered at x term imposes a slowness prior on the motion which is weighted by the coefficient  X  . Note that the first term is a matching term that computes the similarity bet ween I displacement u . These similarity scores at x gives confidence for different local motion hypotheses: higher similarity means the motion is more likely while lowe r means it is less likely. 2) The Hierarchical Prior { E l We define a hierarchical prior on the slowness and spatial smo othness of motion fields. The first term of this prior is expressed by energy terms between nodes at different levels of the hierarchy and enforces a smoothness preference for their states u  X  that the motion of a child node is similar to the motion of its parent. We use the robust L consistency constraint will be penalized moderately. This imposes weak smoothness on the motion field and allows abrupt change on motion boundaries. The seco nd term is a L velocities that encourages the slowness. Figure 2: An illustration of our inference procedure. Left t op panel: the original hierarchical graph with loops. Left bottom panel: the bottom-up process procee ds on a tree graph with multiple copies of nodes (connected by solid lines) which relaxes the proble m. The top-down process enforces the consistency constraints between copies of each node (de noted by dash line connection). Right panel: An example of the inference procedure on two street sc ene frames. We show the estimates from minimizing  X  E ( U ) (bottom-up) and E ( U ) (top-down). The motions are color-coded and also displayed by arrows.
 To be specific, the energy function E weight of the slowness prior. Note that our hierarchical smo othness prior differs from conventional smoothness constraints, e.g., [10], because they impose sm oothness  X  X ideways X  between neighboring pixels at the same resolution level, which requires that the motion is similar between neighboring sites at the pixel level only. Imposing longer range interac tions sideways becomes problematic as it leads to Markov Random Field (MRF) models with a large number of edges. This structure makes it difficult to do inference using standard techniques like bel ief propagation and max-flow/min-cut. By contrast, we impose smoothness by requiring that child node s have similar motions to their parent nodes. This  X  X ierarchical X  formulation enables us to impos e smoothness interactions at different hierarchy levels while inference can be done efficiently by e xploiting the hierarchy. 2.2 Motion Estimation We estimate the motion field by computing the most probable mo tion  X  U = arg max where P ( U | D ) was defined as a Gibbs distribution in equation (1). Performi ng inference on this model is challenging since the energy is defined over a hierar chical graph structure with many closed loops, the state variables U are continuous-valued, and the energy function is non-conv ex. Our strategy is to convert this into a discrete optimization problem by quantizing the motion state space. For example, we estimate the motion at an integer-val ued resolution if the accuracy is suffi-cient for certain experimental settings. Given a discrete s tate space, our algorithm involves bottom-up and top-down processing and is sketched in Figure 2. The al gorithm is designed to be paralleliz-able and to only require computations between neighboring n odes. This is desirable for biological plausibility but also has the practical advantage that we ca n implement the algorithm using GPU type architectures which enables fast convergence. We desc ribe our inference algorithm in detail as follows. i) Bottom-up Pass. We first approximate the hierarchial graph with a tree-struc tured model by making multiple copies of child nodes such that each child no de has a single parent (see [23]). This enables us to perform exact inference on the relaxed model us ing dynamic programming. More specifically, we compute an approximate energy function  X  E ( U ) recursively by exploiting the tree structure: where  X  E ( u 0 states (  X  u L ii) Top-down Pass. Given the top-level motion ( X  u L figuration for other levels using the following top-down pro cedure. The top-down pass enforces all copies of each node have the same optimal state. We minimi ze the following energy function recursively for each node: imposed to the motion estimates at higher levels which provi de context information to disambiguate the motion estimated at lower levels.
 The intuition for this two-pass inference algorithm is that the motion estimates of the lower level nodes are typically more ambiguous than the motion estimate s of the higher level nodes because the higher levels are able to integrate information from larger number of nodes at lower levels (although from the higher-level nodes are usually less noisy and can be used to give  X  X ontext X  to resolve the ambiguities of the lower level nodes. From another perspect ive, this can be thought of as a message-passing type algorithm which uses a specific scheduling sche me [24]. 3.1 The stimuli and simulation procedures Random dot kinematogram (RDK) stimuli consist of two image f rames with N dots in each frame portion CN of dots (the signal dots) are moved coherently to the second f rame with a translational motion. The remaining (1  X  C ) N dots (the noise dots) are moved to random positions in the sec ond frame. The displacement of signal dots are large between the two frames. As a result, the two-frame RDK stimuli are typically considered as an example of long-r ange motion. The difficulty of per-ceiving coherent motion in RDK stimuli is due to the large cor respondence uncertainty introduced by the noise dots as shown in rightmost panel in figure (3).
 Figure 3: The left three panels show coherent stimuli with N = 20 , C = 0 . 1 , N = 20 , C = 0 . 5 and N = 20 , C = 1 . 0 respectively. The closed and open circles denote dots in the first and second frame respectively. The arrows show the motion of tho se dots which are moving coherently. Correspondence noise is illustrated by the rightmost panel showing that a dot in the first frame has many candidate matches in the second frame.
 Barlow and Tripathy [16] used RDK stimuli to investigate how dot density can affect human perfor-mance in a global motion discrimination task. They found tha t human performance (measured by the coherence threshold) vary little with dot density. We te sted our model on the same task to judge RDK stimulus; Second row: 100 dots in the RDK stimulus; Colum n-wise, coherence ratio C = 0 . 0 , 0 . 3 , 0 . 6 , 0 . 9 , respectively. The arrows indicate the motion estimated fo r each dot. the global motion direction using RDK motion stimulus as the input image. We applied our model to estimate motion fields and used the average velocity to ind icate the global motion direction (to the left or to the right). We ran 500 trials for each coherence ratio condition. The dot number varies The model performance was computed for each coherence ratio to fit psychometric functions and to find the coherence threshold at which model performance can r each 75% accuracy. 3.2 The Results Figure (4) shows examples of the estimated motion field for va rious values of dot number N and coherence ratio C . The model outputs provide visually coherent motion estima tes when the coher-ence ratio was greater than 0.3, which is consistent with hum an perception. With the increase of coherence ratio, the estimated motion flow appears to be more coherent.
 To further compare with human performance [16], we examined whether model performance can be affected by dot density in the RDK display. The right plot in fi gure (5) shows the model performance as a function of the coherence ratio. The coherence threshol d, using the criterion of 75% accuracy, showed that model performance varied little with the increa se of dot density, which is consistent with human performance reported in psychophysical experim ents [16, 6]. 4.1 The two types of stimulus The multiple-aperture stimulus consisted of a dense set of s patially isolated elements. Two types of elements were used in our simulations: (i) drifting sine-wa ve gratings with random orientation, and (ii) plaids which includes two gratings with orthogonal ori entations. Each element was displayed through a stationary Gaussian window. Figure (6) shows exam ples of these two types of stimuli. The grating elements are of form P center of the element, and F ( . ) represents a grating , F ( x, y ) = sin ( f x sin(  X  f is the fixed spatial frequency and  X  The grating stimulus is I ( ~x, t ) = P N constant). For the CN signal gratings, the motion ~v noise gratings, we set | ~v The grating orientation angles  X  with dot density. Right panel: Simulations of our model show a similar trend. N = 40, 80, 100, 200, 400 and 800.
 Figure 6: Multi-aperture gratings and plaids. Left column: sample stimuli. Right column: stimuli with the local drifting velocity of each element indicated b y arrows. The stimulus details are shown in the magnified windows at the upper right corner of each imag e.
 The plaid elements combine two gratings with orthogonal ori entations (each grating has the same speed but can have a different motion direction). This leads to plaid element Q ~x F ( x, y ) = sin (  X  f x cos  X  i + f y sin  X  i ) .
 The plaid stimulus is I ( ~x, t ) = P N set to a fixed ~v . For the (1  X  C ) N noise plaids, the directions of ~v but their magnitude | ~v | was fixed. Figure 7: Left two panels: Estimated motion fields of grating and plaids stimuli. Rightmost panel: Psychometric functions of gratings and plaids stimuli. 4.2 Simulation procedures and results The left two panels in Figure (7) show the estimated motion fie lds for the two types of stimulus we studied with the same coherence ratios 0.7. Plaids stimuli p roduce more coherent estimated motion field than grating stimuli, which is understandable. becaus e they have less ambiguous local motion cues.
 We tested our model in an 8-direction discrimination task fo r estimating global motion direction [20]. The model used raw images frames as the input. We ran 300 trials for each stimulus type, and used the direction of the average motion to predict the globa l motion direction. The prediction accu-racy  X  i.e. the number of times our model predicted the correc t motion direction from 8 alternatives  X  was calculated at different coherence ratio levels. This d ifference between gratings and plaids is shown in the rightmost panel of Figure (7), where the psychom etric function of plaids stimuli is always above that of grating stimuli, indicating better per formance. These simulation results of our model are consistent with the psychophysics experiments in [20]. In this paper, we proposed a unified single-system framework that is capable of dealing with both short-range and long-range motion. It differs from traditi onal motion energy models because it does not use spatiotemporal filtering. Note that it was shown in [6 ] that motion energy models are not well suited to the long-range motion stimuli studied in this paper. The local ambiguities of motion are resolved by a novel hierarchical prior which combines sl owness and smoothness at a range of different scales. Our model accounts well for human percept ion of both short-range and long-range motion using the two standard stimulus types (RDKs and grati ngs).
 The hierarchical structure of our model is partly motivated by known properties of cortical organi-zation. It also has the computational motivation of being ab le to represent prior knowledge about motion at different scales and to allow efficient computatio n.
 Acknowledgments This research was supported by NSF grants IIS-0917141, 6135 63 to AY and BCS-0843880 to HL. We thank Alan Lee and George Papandreou for helpful discussi ons.

