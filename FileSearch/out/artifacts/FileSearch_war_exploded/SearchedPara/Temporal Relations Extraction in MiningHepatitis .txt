 Recently, a precious source for hepatiti s study has been given by Chiba university hospital to the data mining community [6]. The hepatitis temporal database collected during twenty years (1982-2001) containing results of 771 patients on 983 laboratory tests. It is a large temporal relational database consisting of six tables of which the biggest has 1.6 million records. In last few years, six problems P1-P6 posed by physicians in hepatitis study using the above database have attracted differen t research groups.

Temporal abstraction (TA) is an approach to temporal pattern detection that aims to derive an abstract description of temporal data by extracting their most relevant features over periods of time [2]. Different from the regular data pro-cessed by the other TA methods [3], the hep atitis data was collected irregularly in long periods, and none of the above methods can be applied to.

Our early work [4] developed a supervised TA technique called abstraction pattern extraction (APE) whose task is to map (to abstract) a given fixed length sequence into one of predefined abstraction patterns. In this work we develop a unsupervised TA technique called temporal relation extraction (TRE) whose task is to find temporal relations in terms of temporal logic [1] among detected temporal patterns, and use these relations together with abstraction patterns to solve problems P1-P2.
 Our focus in this work is on problems P1-P2 among six problems posed by physicians to challenge the KDD community [6]: (P1) Discover the differences in temporal patterns between hepatitis B and C (HBV and HCV); (P2) Evaluate whether laboratory tests can be used to estimate the stage of liver fibrosis (LC (liver cirrhosis) vs. nonLC (non liver cirrhosis)).

For each patient O k the measured values e i on a medical test A j over time data, sequences S jk can be long as observed during twenty years. The starting point of our work is the view on temporal patterns that are a rather broad concept and defined differently in tempo ral data mining. We particularly view temporal patterns in terms of 13 kinds of temporal relations (Figure 1) between two events A and B summarized by Allen in the temporal logic [1]. In [5] a temporal pattern is considered as a set of states together with their interval relationships described in the Allen X  X  interval logic [1]. We consider a temporal pattern as a conjunction/relation of temporal basic patterns (hereafter called basic patterns). In the hepatitis study, we selected 24 typical tests from 983 tests  X  based on the opinion of physicians and the preprocessing/analysis results of different research groups  X  divided into two types: 1. Short-term changed tests (STCT) : GOT, GPT, TTT, and ZTT that charac-2. Long-term changed tests (LTCT) : These characterize the liver reserve capac-Basic patterns in STCT sequences: The abstraction states of STCT include N (normal region), H (high), VH(very high), XH (extreme high), L (low), VL (very low), and XL (extreme low). We call a peak the event that has its value suddenly much higher than that of its neighbors. We define the temporal basic patterns (BP) of a STCT the subsequence characterizing a inflammation period where the sequence suddenly has the high or very high state and with/without peaks. These basic patterns have the form: where &lt; state of test &gt; denotes the abstraction state of the test sequence and the test name, and high value is one value in { H, V H, XH } . For example,  X  GOT = XH &amp; peak  X  means  X  X OT is in extremel y high state with peaks X . Basic patterns in LTCT sequences: The abstraction states of STCT include N (normal), H (high), L(low). We define the temporal basic patterns (BP) of a LTCT the subsequence characterizing the change of states between two state regions. These basic patterns have the form: where state 1 and state 2 are two different values in { N, H, L } and  X  &gt;  X  stands for  X  X hange the state to X . For example,  X  ALB = N&gt;H  X , or more informally  X  ALB = NormalToHigh  X  means  X  X LB changes from normal to high state X . Denote by ( BP, T ) a temporal basic pattern BP that occurs in a time interval are  X  X LB decreases from normal to low state X ,  X  X OT has many peaks in very high state X . In the context of temporal data, we consider only temporal patterns happening in some period of time, and can implicitly write patterns BP instead of ( BP, T ). As defined above, temporal patterns viewed as temporal relations between temporal basic patterns are compound statements such as  X  X attern A happened before pattern B and B happened during pattern C X . This section describes solutions to the problem of finding temporal basic patterns (step 1) and complex temporal patterns in form of temporal relations (step 2) in the framework. The key issue in these steps is that it is hard to determine exactly interval boundaries T in which temporal basic patterns BT occur while deter-mining temporal relations between temporal basic patterns requires comparing their boundaries. 3.1 Finding Basic Patterns After smoothing data, we detect periods of state changing for both STCT and LTCT based on the following criteria: (a) The first point and last point belong to different states; (b) States of the first point and last point are stable for at least 6 months; (c) Intervals between co nsecutive crossing pairs must less than parameter  X  1 or intervals between two crossing pairs are less than  X  3 and there are at least M inP oint crossing pairs between them; ( d) The interval between two consecutive crossing pairs must be less than  X  2 . By the statistics and visualization of the data, together with discussion with physicians, we choose  X  1 =12  X  4 weeks,  X  2 =3  X  12  X  4 weeks and  X  3 =5  X  12  X  4 weeks. basic patterns for STCT and Algorithm 2 in Figure 4 is for LTCT. 3.2 Finding Temporal Relations The step 2 in our framework aims to build a graph or a transaction of possible temporal relations from each object (patient) O k starting from all of its de-tected events. A basic algorithm to do this task was originally given in [1] using constraint propagation technique (the transitive property of temporal events). In this work on hepatitis data, due to the specific features of the data, we develop an appropriate technique based on: (1) Soft matching : at the boundaries of intervals for relations  X  X qual  X ,  X  X eet X ,  X  X tart X ,  X  X inish X , and  X  X verlap X . The boundary points of two events are considered the same (time) if their absolute difference is smaller than a given threshold, or considered as different in  X  X verlap X  relation if their absolute difference is grea ter than a given threshold. (2)  X  X lightly X  is a key constraint for the  X  X efore X  relation, i.e., we consider only relations of the form  X  X  slightly before B X  viewed by some threshold. Our work follows four steps: (1) Created a transactional database for each hep-atitis problem by proposed algorithms described in Section 3; (2) Used software CBA 1 ,ourLUPC 2 and See5 to find rules from the transactional database with default parameters; (3) Filt ered statistically significa nt rules by hypothesis test-ing; (4) Analyzed the findings with/by physicians.
 Rules for hepatitis types HBV and HCV: UsingCBA,wewereableto generate a set of 238 rules, in which 20 rules for HBV and 218 rules for HCV. The overall accuracy of the prediction rule sets on the training data is 89.34%. Contingency table of the rule set on training data is as follows.

Table 1 shows the set of typical rules for describing HBV and HCV. We can observe the component test items in t he temporal events exhibit different temporal patterns for each of HBV and HCV as follows: Observation 1: Even when there are temporal re lations between GOT and GPT, even both GOT and GPT have peaks in High region, the rules in which ALP oscil-late between Normal and Low are for HBV while the ones in which ALP oscillate between High and Normal are for HCV. Some rules support this observation are the numbers: 145 (ALP changes from Low to Normal etc., class HBV), 206 (ALP changes from Normal to Low etc., class HBV), 20 (ALP changes from High to Nor-mal, class HCV) and 202 (ALP changes from Normal to High etc., class HCV). Observation 2: Among patients who have peaks on both GPT and TTT in High regions, T-BIL decreases from High to N ormal in HBV patients, while T-BIL decreases Normal to Low in HCV patients. Some rules support this observation are the numbers: 196 (class HBV), 185 (class HCV), 203 (class HCV), 167 (class HCV) and 25 (class HCV).
 Observation 3: Patients who have temporal relations of peaks in both TTT and ZTT have different state change on TP. In case of HCV , TP moves from High to Normal, meanwhile it changes from Normal to Low for HBV. Some rules support this observation are the numbers: 151 (class HBV), 8 (class HCV) and 2(classHCV).
 Matching with Medline abstracts: We looked for some reported results from medical researches to find evidences fo r and against our findings. We developed a simple search program integrating both keywords and synonyms in the query.
Murawaki et al [7] showed that the main difference between HBV and HCV is that the base state of TTT in HBV is normal, while that of HCV is high. We examined the rule sets and found that our rules are more complicated than that as they also include various temporal rel ations. However, there are many rules of very high coverage and high confidence, TTT appeared to be mostly in High state for HCV but in Normal state for HBV. We showed some rules support this finding in the table with number s: 219, 227 226 and 193. This means that even though our rules are not exactly identical to reported knowledge of medical research, such knowledge is confirmed true in our rule set under certain condition. Rules for liver cirrhosis: LC and non-LC: UsingCBA,wewereableto generate a set of 61 rules, in which 21 rules for LC and 40 rules for non-LC. The overall accuracy of the prediction rule sets on the training data is 96.30%. Contingency table of the rule set on training data is as follows.

Some rules in the set can be seen from the Table 2. Notions in the table are identical to that in Table 1. From the rule sets, we observed the following phenomena: Observation 1: There are more rules for non-LC patients and most of them are of higher precision and coverage. This conforms to the common knowledge of experts that LC is harder to detect.
 Observation 2: Thereweresomelongtermchang ed test items that appeared mostly in LC patients, namely I-BIL and ALB. The following rules for LC pa-tients support this observation: (Rule 15) I-BIL changes from normal to low (coverage: 5 patients, precision: 100%); (Rule 26) I-BIL changes from high to normal and ALB changes from low to normal (coverage: 4 patients, precision: 100%); (Rule 27) ALB changes from low to normal and TTT has peaks in nor-mal state (coverage: 4 patients, precision 100%). From this, we may induce that I-BIL and ALP change their states mostly in LC patients, not in non-LC ones. They can be good indicators for predi cting liver cirrhosis patients. The main contribution of this work is a temporal relation extraction method that allows us to well abstract hepatitis data and discover interesting temporal patterns. It is believed that the temporal relation extraction method, when ap-propriately combined with numerical conditions or domain knowledge in other formalisms, can be well applied to other medical data mining tasks.

