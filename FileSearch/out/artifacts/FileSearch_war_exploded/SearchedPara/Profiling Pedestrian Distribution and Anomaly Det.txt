 Pedestrians movements have a major impact on the dynam-ics of cities and provide valuable guidance to city planners. In this paper we model the normal behaviours of pedestrian flows and detect anomalous events from pedestrian count-ing data of the City of Melbourne. Since the data spans an extended period, and pedestrian activities can change intermittently (e.g., activities in winter vs. summer), we applied an Ensemble Switching Model, which is a dynamic anomaly detection technique that can accommodate systems that switch between different states. The results are com-pared with those produced by a static clustering model (Hy-CARCE) and also cross-validated with known events. We found that the results from the Ensemble Switching Model are valid and more accurate than HyCARCE.
 H.4 [ Information Systems Applications ]: Miscellaneous; D.2.8 [ Software Engineering ]: Metrics Application; Anomaly Detection
The ease of movement of pedestrians is a major challenge for the operation of cities. Understanding patterns of pedes-trian movement provides valuable information to city infras-tructure and transportation planning. Advances in sensor technology have enabled new counting systems that oper-ate continuously with high accuracy. While many projects to monitor pedestrian counts have been initiated, there are still limited efforts in modelling the normal behaviour and detecting interesting events from this data.

In this study we aim to characterize normal behaviour of pedestrian flows in terms of correlations in the load profile by time of day across multiple locations. This knowledge can be used by city planners in catering for pedestrian flows, in assisting business to target their services according to demand, or in understanding the dynamics of cities. We c  X  Twitter data of Manhattan-based users to model the crowd footprint of particular locations. By associating the crowd footprint to the words used in messages, the authors used Latent Dirichlet Allocation [3] to reveal trends and routine behaviour in the city for each day of the week. However, one limitation of this study is the number of topics, corre-sponding to different pedestrian load profiles, needs to be predicted in advance. Moreover, the pedestrian load profile was assumed to be constant throughout the one year span of the collected data, which may affect accuracy.

The studies above either use a short period of collected data or assume a constant state of the load profile, which can cause false alarms in anomaly detection. In this study, we consider the pedestrian distribution as a state-switching system, and we examine how such a dynamic model of nor-mal behaviour can improve anomaly detection in comparison to a more static model of pedestrian behaviour.
We formally define our problem, and then present the clus-tering and anomaly detection techniques used in this study.
Let O denote the set of N observations from time t 1 to t : O = { o i : i = 1 ..N } where o i  X  R d is a vector of d dimensions corresponding to the pedestrian counting values of d different locations.

We aim to find (1) the set of K clusters C = { c i : i = 1 ..K } that partition the dataset O , and (2) the set A H con-taining all anomalies that do not belong to any clusters. However, A H provides a static model of the underlying sys-tem, and does not consider how the clusters change over time. Consequently, we need to develop a clustering model that can cope with nonstationarity, or systems that switch between different states over time. To this end, by using an Ensemble Switching Model, we aim to find the set of anoma-lies A ES while accomodating a dataset O that switches be-tween different states. By evenly dividing O into windows of length w , we identify the different states in the data and select only the relevant states as the basis for anomaly de-tection.

By analysing and comparing A H and A ES we seek to eval-uate to what extent the dynamic Ensemble Switching Model provides greater accuracy in detecting anomalies in compar-ison to static clustering, given the extra logic and resources required to model switching data streams.
HyCARCE (Hyperellipsoidal Clustering for Resource Con-strained Environment) is a grid-based clustering algorithm with low computational complexity of O ( N ) [11]. The algo-rithm can be summarized in 4 steps as follows:
Input : dataset of N d -dimensional records S = { s k : k = 1 ..N } ,s k  X  R d
Ouput : set of K clusters C = { c j : j = 1 ..K } ( K is determined algorithmically)
Step 1 : Divide the input space into a set of fixed-size d -dimension cells and prune the cells with low density.
Step 2 : Fit a hyperellipsoid into each cell that covers at least 95% of the cell data. The hyperellipsoid is defined by: Figure 1: Data preprocessing steps: (a) raw count values, (b) polar transformation and normalization to range [0 , 1] ((  X ,r ) are the polar coordinates)
Since the counting data is not evenly distributed, with a big portion of the observations being skewed towards the low values, the data was preprocessed to reveal its structure more clearly. The steps are illustrated in Figure 1. First, instead of using the absolute counts of pedestrians, we used the differences between successive counts. These values rep-resent the hourly changes in the number of pedestrians. Sec-ond, we apply a polar transformation to separate the values into different segments and to achieve a more even distri-bution. Finally, the data was normalised to the range [0 , 1] and counts during weekends were excluded.

Clustering and anomaly detection were evaluated in dif-ferent stages. Initially, we applied HyCARCE on a small subset of one week of data. Since HyCARCE is the underly-ing clustering method of Ensemble Switching, it is necessary to verify its effectiveness. Subsequently, both HyCARCE and Ensemble Switching were applied on the entire range of data. Finally the two sets of anomalies generated by the two approaches were compared with each other. Since it is infea-sible to verify each of the anomalies detected due to the lack of ground data labels, to compare the performance between the two methods, we selected 15 major events from the cal-endar of the City of Melbourne [2]. These events include New Year X  X  Eve, Christmas Eve, etc., when the pedestrian distribution is expected to be different from the norm, i.e., these pedestrian distributions are considered as anomalies. Each method is assessed by its capability to distinguish the anomalies in accordance with this schedule of events.
HyCARCE successfully modelled the distribution of pedes-trians when applied on one week X  X  worth of data. The clusters are presented in Table 1; for example, HyCARCE groups 7 am of all five days of the week, i.e., (7 , 5) into Clus-ter 4. As illustrated in Figure 2a, it clustered the distri-bution into visually clear groups of 7 am , 8 am , 11 am , 1 pm , 5 pm , 6 pm , 10  X  11 pm , which can be mapped to morning peaks, lunch breaks, afternoon peaks and midnight.

However, when a longer period of data is analysed using clustering, the quality of clustering results start to degrade. Many values are found to be clustered into the wrong group and the meaningful characteristics of the clusters as found in one week X  X  data are no longer observed. Moreover, the states between different weeks vary intermittently, causing super-positions in the data distribution and reducing the clustering accuracy. As an example, the pedestrian activities in a sum-mer week are different from those in a winter week, hence considering these two weeks using a single, static clustering model might ignore the characteristics of each week.  X  By splitting the input into multiple windows, the method is capable of handling superpositions of different data dis-tributions. Figure 2c shows all the anomalies in red. A quick examination shows that although these values are in close proximity, they belong to random hours of different days throughout the year, and arguably do not express any trends or repeating patterns in pedestrian activities.
A total of 15 major events and public holidays were se-lected from the calendar of the City of Melbourne and used as a reference set of anomalous events to evaluate and com-pare the performance of the two methods. Each method was assessed in terms of whether it can detect the reference set of anomalies, and if so, whether the results match closely with the actual schedule of the events. A portion of the evaluation (Jan to Mar 2014) is presented in Table 2. Events Ensemble Switching HyCARCE New Year Day 1-3am 1-2am Australia open 9pm not detected Moomba parade 9am-1pm, 9-10pm 12pm, 9-10pm Formula one 5-8pm 11pm(invalid) Table 2: Anomalies detected during major events from Jan to Mar 2014
Out of 15 events, Ensemble Switching manages to detect correctly 13 anomalies while HyCARCE detects 10 anoma-lies. In addition, the output of Ensemble Switching provides better coverage and match the schedule of the events more accurately. For example, the Moomba parade took place at 11am on 10 th Mar 2014, and it is likely that a higher than normal number of pedestrians would be observed be-fore, during and after the event; hence the anomalies of 9am to 1pm as returned by the Ensemble Switching method are more accurate compared to the HyCARCE result. Although HyCARCE also detects some of the unusual events, many valid anomalies were not detected.
In this paper we applied HyCARCE and Ensemble Switch-ing to pedestrian counting data with the aim of modelling the pedestrian load profile across multiple locations and to extract anomalies, which are then cross-examined with known events. The experiments revealed that the Ensemble Switch-ing Model produces more accurate results in terms of false alarms compared to HyCARCE. The results illustrate that pedestrian distributions can be clustered into meaningful profiles characterizing major activities throughout the day.
The authors would like to thank the support from Na-tional ICT Australia (NICTA).
