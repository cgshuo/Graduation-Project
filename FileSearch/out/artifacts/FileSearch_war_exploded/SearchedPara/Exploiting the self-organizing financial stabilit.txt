 Peter Sarlin n 1. Introduction
Machine learning and artificial intelligence techniques are com-mon means for prediction, modeling and intelligence augmentation in a wide range of engineering applications (e.g., Cheng et al., 2008 ; 2007 ; Xie et al., 2006 ; Zhang and Chau, 2009 ). Yet, the application of such techniques in financial modeling, such as financial stability surveillance, is still in its early beginning. In particular, visual exploration of high-dimensiona l data, while being an important task for the understanding of data structures, is oftentimes a neglected part in financial modeling. A starting point to this has been set by two attempts to map the state of financial stability: a spider-chart published by the In ternational Monetary Fund (IMF) ( Dattels et al., 2010 ; IMF, 2012 ) and a self-organizing financial stability map (SOFSM) published by the European Central Bank (ECB) ( Sarlin and Peltonen, 2011 ; ECB, 2011 ). This paper focuses on enhancing the SOFSM that employs a self-organizing map (SOM) ( Kohonen, 1982 , 2001 ) based method for mapping the state of financial stability onto a two-dimensional plane. 1 The SOFSM allows monitoring economies in the financial stability cycle represented by four stages: pre-crisis, crisis, post-crisis and tranquil states. It uses the SOM to perform a neighborhood-preserving projection onto a grid of nodes with a predefined regular shape. The predefined grid shape facilitates using the SOFSM as a display or basis for additional information, such as visualizing individual data samples or general structural properties of data. This paper attempts to enhance the exploitation of the SOFSM by further developing the visualization and extraction of information on the map.

In Sarlin and Peltonen (2011) , the SOFSM was not only used for visualizing cross-sectional and temporal data on the two-dimensional display, but also for non-linear correlation hunting in relation to all four states, as well as evaluated in terms of out-of-sample predictive capabilities. It was not, however, paired with other techniques for enhanced visualization, information extraction and financial stability surveillance. This paper uses the SOFSM as its basis and enhances the exploitation from four perspectives: 1. Fuzzification of the SOFSM for visualizing temporal belong-ingness to financial stability states of individual data and class distance structures on the map. 2. Probabilistic modeling of state transitions on the SOFSM for visualizing probabilities of transition to financial stability states of individual data and for assessing the general cyclical and temporal structure of the financial stability cycle. 3. Using neighborhoods on the SOFSM and superimposed portfo-lio network topologies to assess the spread of financial distress and shock propagation. 4. Computing distances between data and their mean profiles on the SOFSM to find extreme events and imbalances in econo-mies X  macro-financial conditions.
 metric. Instead of applying a crisp clustering algorithm on the units, as is commonly done (see, e.g., Vesanto and Alhoniemi, 2000 ), we use perfect financial stability states derived from classes in data as representative cluster centers. Then, an adapted version of the membership functions in Cottrell and Letre  X  my (2005) and Sarlin and Eklund (forthcoming) is used to compute class memberships. By a defuzzification of the results using the maximum-membership method, we also provide a crisp cluster-ing. This enhances the visualization capability by enabling assess-ment of temporal belongingness to the financial stability states, where the states are expressed by representative cluster centers and fluctuations in macro-financial conditions are represented by the temporal variation of belongingness. In addition, visualiza-tions of the memberships on a SOM grid enable assessment of the class structures.
 previous works on transition probabilities on the SOM ( Sulkava and 2012 ), we exploit the temporal patterns by computing, summarizing and visualizing probabilities of future state transitions. This enables not only assessing the most likely future state transitions for each node, and thus also pairing to individual data, but also country profiling of low-and high-risk financial stability states. Most notably, while this validates the assumed financial stability cycle, intra cluster differences in transition patterns show that the cycle is not entirely well-behaving or continuous.
 shock propagation from two perspectives: neighborhoods on the
SOFSM and a superimposed portfolio network topology. While the former approach was suggested already in the stand-alone
SOFSM, this paper extends the concept by evaluating the value added in terms of predictive performance. The latter perspective on contagion applies the approach in Sarlin (2012a) by combining a portfolio network topology with a financial stability topology, i.e., superimposing a network of bilateral portfolio exposures on the SOFSM. This enables two approaches for analyzing the spread of financial instabilities: the financial stability topology indicates propagation of financial distress to similar macro-financial con-ditions, while the portfolio network topology indicates contagion through asset-based direct linkages.
 distances between each datum and its mean profile on the SOFSM (best-matching unit, BMU) is an indication of financial imbal-ances. The rationale for this is that the units of the SOM, while being topologically ordered, tend to approximate the probability density function of data ( Kohonen, 2001 ). The distance to a BMU represents thus the fit of a single datum to the multivariate data distribution, i.e., its degree of extremity. When monitoring finan-cial stability, one could assume that large distances represent financial imbalances in macro-financial conditions. Our approach goes beyond applying a pre-defined threshold value on the distance to assess whether or not a datum is an outlier (see, e.g., Vesanto et al. (1998) and Saunders and Gero (2001) ), by setting the threshold to optimize predictive performance. fuzzification, transition probabilities and portfolio network topol-ogy with sample visualizations on or together with the SOFSM.
The usefulness of neighborhood contagion and outlier analysis is tested in terms of their performance in predicting financial crises.
The paper is structured as follows. Section 2 introduces the data, the SOM, the fuzzification, transition probabilities, contagion analysis, outlier detection and the evaluation scheme. We present the enhanced visualization and extraction of information on the
SOFSM in Section 3 , and conclude in Section 4 by presenting our key findings, limitations and future research directions. 2. Methodology
This section presents the data, methods and evaluations used in this paper. 2.1. Data and pre-processing
The data used in this paper are of two sorts: macro-financial indicators with class information and asset-based linkages. The first type of data follow the dataset in Lo Duca and Peltonen (2012) and consist of a set of vulnerability measures commonly used in the macroprudential literature (see, e.g., Alessi and
Detken, 2011 ; Borio and Lowe, 2002 , 2004 ) and binary class information representing pre-crisis, crisis, post-crisis and tranquil periods. The quarterly dataset consists of 28 countries, 10 advanced and 18 emerging economies, spanning from 1990: 1 X 2010:3, that is a panel dataset consisting of both a cross-sectional and a temporal dimension. Hence, a data vector x is formed of a class vector x j ( cl ) A R 4 and an indicator vector x j ( in ) A R 14 for each quarter and country in the sample. To control for cross-country differences and fixed effects, each column of the input data is transformed into its historic country-specific per-centile distribution. The second types of data consist of a network of financial linkages. Portfolio exposures are based upon external assets (equities and bonds) as reported in the Coordinated
Portfolio Investment Survey by the IMF. It is worth noting that exposures of central banks are not included due to the different nature of their holdings. 2.2. Self-organizing maps (SOMs)
The SOM ( Kohonen, 1982 ) is a technique with both clustering and projection capabilities that performs a neighborhood-preserving projection onto a grid of nodes with a predefined regular shape. As the SOM algorithm is well-known and the main emphasis is on exploiting additional information on the SOM, we do not present details of it here  X  for details see Kohonen (2001) .
For its excellent visual representation, the Viscovery SOMine 5.1 package is used as a basis in this study. After an initialization of the reference vectors as to the two principal components, the training process follows two steps. First each input data vector x (where j  X  1,2, y , N ) is paired with its best-matching unit (BMU) m b of all reference vectors m i (where i  X  1,2, y , M ) using Euclidean distance. The second step adjusts each reference vector m the batch updating formula: m i t  X  1  X  X  X  where t is a discrete time coordinate and h ib ( j ) is a decreasing function of neighborhood radii and time. However, we employ a semi-supervised version of the SOM by using data vector x formed of a class vector x j ( cl ) and an indicator vector x steps of training. It is important noting the use of the class and indicator vectors when mapping data onto the SOM. After training a SOM model, only the indicator vector x j ( in ) is used for locating data to their BMUs ( m b ( in ) ). Then, the class values of their BMU ( m b ( cl ) ) are used as estimates of the current state.
The two-dimensional SOM grid describes the topology of a multidimensional space. As all information on the map cannot be visualized in two dimensions, additional information can be shown on own grids. The predefined grid shape of the SOM facilitates this type of visualization linking. For instance, a so-called feature plane can be used for showing the spread of an indicator on the SOM, where cold colors (blue) indicate low and warm colors (red) high values. As these are different views of the same grid, a unique point represents always the same node. 2.3. Fuzzification of SOMs
The SOM is commonly partitioned using a crisp clustering technique (see, e.g., Vesanto and Alhoniemi, 2000 ). However, as we not only have class information, but also utilize a semi-supervised SOM with the classes in the ordering process, we do not have to estimate clusters and their centroids. We adapt a fuzzification of the SOM proposed in Sarlin and Eklund (2011 , forthcoming) for computing class memberships. Thus, we can classify and fuzzify the SOM based on the class vectors x by assuming the following: the number of states C equals the number of classes K , i.e., C  X  K , and the state center c k  X  1,2, y , C ) for each class is a perfect representative state vector, i.e., While there exist other methods for class visualization on the SOM, such as Voronoi regions ( Mayer et al., 2007 ), they fall short in dealing with partial truth, uncertainty and imprecision in class memberships. We follow the approach in Sarlin and Eklund (forthcoming) by computing a membership degree using Eucli-dean distances between nodes and state centers. The fuzzification resembles that in Cottrell and Letre  X  my (2005) , by being imple-mented on second-level state centers instead of directly on the nodes, by not assuming inverse exponential distances and by introducing a fuzzification parameter. In addition, our aim is a visualization rather than a method for imputing missing values which is the key focus of Cottrell and Letre  X  my. Our approach differs from that in Sarlin and Eklund (forthcoming) by only using x j ( cl ) A R 4 for computing the distances. The rationale for this is the focus on distances between mean profiles of classes rather than those between indicators. The SOM is fuzzified by computing the inverse distance between reference vector m i ( cl ) and each state u  X  where y A (1, N ) is a similar fuzzifier as the one used in fuzzy C -means clustering. The fuzzifier y affects the distance metric by setting the extent of overlap between the states, where low values provide crisp results and high fuzzy results. The fuzzifiers y  X  2 and y  X  3 can be seen as benchmark values by resulting in simple and squared Euclidean distances. Eq. (3) extends the approach in Sarlin and Eklund (forthcoming) by also adding a 1 to the denominator to be defined for all distances. We normalize the similarity matrix u ik to the following matrix of state membership degrees for each node: v  X  to fulfill the probabilistic constraint P C k  X  1 v ik  X  1 : In addition to computing membership degrees, we follow previous studies by defuzzifying the results using the maximum-membership method. The crisp states on the SOM can be shown by contours, while nodes X  membership degrees to each state can be visualized on own grids per state, i.e., membership planes. Further, the evolution of individual data can be visualized using line graphs by associating each datum with the membership degrees of its BMU. 2.4. Transition probabilities on SOMs
The standard SOM paradigm does not explicitly address the issue of temporality on the grid. While trajectories have been a common means to illustrate temporal movements, small samples give no indication of overall patterns and large clutter the display. A more general probabilistic model of the temporal variations in a
SOM model has been introduced through node-to-node transition probabilities ( Sulkava and Hollme  X  n, 2003 ; Luyssaert et al., 2004 ;
Fuertes et al., 2010 ). Recently, node-to-cluster transition prob-abilities have been proposed to be computed on SOMs with a second-level clustering and visualized on their own SOM grids ( Sarlin et al., 2012 ). Movements between nodes on the two-dimensional SOM are used to compute probabilities of switching from one place to another in a specified time period. In general, we can compute transition probabilities of switches from each node to every other node. To facilitate visualization, we focus on node-to-state switches by computing p ik , where the transition refers to movements from reference vector i to state k : p t  X  s  X  X  X  n ik  X  t  X  s  X  P C where n ik is the cardinality of data switching from m i to c time coordinate and s is the time span for the switch. The probability of switching to a particular state can again be associated with each of the SOM nodes, and linked to the SOM visualization. That is, we visualize the probabilities on their own transition planes, where color codes show the probability of transition. To summarize the most likely switches, we show maximum transition probabilities (max k  X  p ik  X  ) conditional on switching on an own transition plane, where labels show location and color probability of transition. The evolution of individual data can again be associated to the transition probability of their
BMU and visualized using line graphs. 2.5. Shock propagation on SOMs
The process of some event being transmitted to another entity goes by different names, such as contagion, shock propagation or the spread of an event. We analyze this occurrence through two transmission channels: links between entities and similarities in indicator values. The first approach follows that in Sarlin (2012a) by superimposing a network of bilateral exposures on the SOM.
While the standard SOM provides a, for example, two-dimensional mapping of input data, the SOM does not per se account for relationships or links in data. Visual clustering of network data has been directly performed by applying a stand-alone SOM on data relationships ( Boulet et al., 2008 ). However, we extend the standard SOM with a superimposed network for simultaneous assessment of dependencies in data, such that positions are set by the indicator-based SOM while links are set by the relationships between the entities. Networks of relation-ships are mostly expressed in matrix form, where the link between entities g and l in matrix A is represented by element a . The matrix is of size n 2 , where n is the number of entities.
Matrices of directed graphs, as the one we use, can be read in two directions: rows of A represent the relationship of g to l and columns of A represent the relationship of l to g . To combine
SOMs and network analysis, we superimpose network relations on top of the standard SOM grid by visualizing relationships between entities. Labels of entities under analysis, say g and l , are projected to their BMUs of the SOM based upon their data x and x j  X  l . After that, relations between entities g and l are visualized by edges between the locations of the BMUs of x x on the SOM grid using elements a gl and a lg .
 as previously suggested but not quantitatively tested in the SOFSM ( Sarlin and Peltonen, 2011 ). First, we assign one of the classes K to be the event of interest. Then, instead of using the associated class vector (pre-crisis class) based upon historical data as an estimate of probable future events, we assign the locations of the event of interest in period t to be signals of similar events in that location in period t  X  s , where s is the time span for transmission. 2.6. Outlier analysis with SOMs nodes m i of the SOM, while being topologically ordered, tend to approximate the probability density function of data p ( x ) ( Kohonen, 2001 ). The standard quantization error (QE) can be seen as the correspondence between the nodes and the data.
However, a more meaningful estimate of event rarity is comput-ing the distance of individual data x j to their BMUs m b property of approximating the probability density function, the individual QE represents the fit of a single datum to the multi-variate data distribution. An outlier, and its degree of extremity, can thus be estimated by the distance to the SOM in a multi-dimensional setting, i.e., d j  X  99 x j  X  in  X  m b  X  in  X  commonly applied a pre-defined threshold value on the distance to assess whether or not a datum is an outlier (see, e.g., Vesanto et al. (1998) and Saunders and Gero (2001) ). The approach in the present paper goes, however, beyond using a pre-defined thresh-old by setting the threshold to optimize predictive performance. 2.7. Performance evaluation outliers, is evaluated with a Usefulness measure that incorporates the preferences of a policymaker. We assume the predictive model to issue a signal when the estimated probability of a crisis is above a specified threshold. The signals and non-signals are then collected into a contingency matrix comprising of true positives ( TP ), true negatives ( TN ), false positives ( FP ) and false negatives ( FN ). In this paper, we follow the approach proposed in
Sarlin (2013) by maximizing the usefulness for a policymaker with specific preferences about giving false alarms (type I errors) and missing crises (type II errors) when calibrating an optimal model and threshold for policy action. The used approach extends the measures used in Demirg  X  uc-Kunt and Detragiache (2000) and
Alessi and Detken (2011) . We derive the following loss function for a policymaker:
L  X  m  X  X  m T 1 P 1  X  X  1 m  X  T 2 P 2 ,  X  6  X  where the parameter m sets the policymaker X  X  relative preferences between missing crises and giving false alarms, type I errors
T 1 A [0,1]  X  FN /( TP  X  FN ) represent the proportion of missed crises relative to the number of crises in the sample, type II errors
T 2 A [0,1]  X  FP /( FP  X  TN ) the proportion of false alarms relative to the number of tranquil periods in the sample, and unconditional probabilities P 1 and P 2 correspond to the frequency of pre-crisis and tranquil times. Thus, the preference parameter m defines the risk-aversion between type I and II errors of the policymaker. The policymaker is equally concerned of missing crises and issuing false alarms for a value of m  X  0.5, more concerned about issuing false alarms when m o 0.5, and more concerned about missing crises when m 4 0.5. In this paper, we follow the preferences in the SOFSM by being substantially more concerned of missing a crisis ( m  X  0.8), which also reflects the imbalanced relative costs between missing a crisis and giving a false alarm.
 old is derived by subtracting L ( m ) from the expected value of a best-guess given the preferences and unconditional probabilities fulness by computing the share of usefulness to the available usefulness of the model (min  X  m P 1 , P 2  X  1 m  X  X  ):
U where the Usefulness of the model is compared with the loss of disregarding the model and divided by the available usefulness.
Thereby, the interpretation of the relative Usefulness U r percentage gain relative to not using a model. Finally, the performance of a model is solicited by choosing a threshold on the probability of a crisis such that usefulness U r is maximized. 3. Exploiting the self-organizing financial stability map
The SOFSM uses the SOM for mapping the state of financial stability onto a two-dimensional plane. It uses as inputs a set of indicators commonly used in the ma croprudential literature and class information representing pre-crisis, crisis, post-crisis and tranquil periods. Sarlin and Peltonen (2011) put forward a technical framework for building a two-dimensional financial stability map, evaluate it and test its robustness , as well as show its usefulness for visualizing data. The parameters of the SOFSM are tuned with respect to three aspects: (1) parsimonity and generalization, (2) objective learning on in-sample data, and (3) visualization capabilities. The SOFSM and trajectories for the United States (US) and Euro area conditions can be found in Fig. 1 a, and sample feature planes in Fig. 1 b. This section applies the extensions described in
Section 2 to the SOFSM for the following four tasks: (1) fuzzification of the map, (2) probabilistic mode ling of state transitions, (3) con-tagion analysis and (4) outlier detection. The extensions of the
SOFSM, and their usefulness, are illustrated with sample visualiza-tions and predictive performance. 3.1. Fuzzification of the SOFSM We employ the distance-and class-based fuzzification of the
SOFSM. Class information is accounted for by setting the number of states equal to the number of classes, i.e., four, and their centers as perfect states of the financial stability cycle: pre-crisis, crisis, post-crisis and tranquil states. The choice of C  X  4 is hence not a free parameter as it is specified from the number of classes K .We end up using squared Euclidean distances ( y  X  2) since that allows for fuzzy, but not entirely erased, state borders. While the differences between the most extreme choices are significant, the results are stable for values close to y  X  2. In Fig. 2 , member-ships to each state are shown on membership planes, where also the defuzzified crisp states are shown by contour lines (as well as on all other grids, e.g., Fig. 1 ). The crispest part is the upper right corner of the tranquil state, whereas the rest have more overlap.
Fig. 3 shows how the fuzzification can be turned into line graphs for the trajectories in Fig. 1 , where membership in states and their variation over time represent fluctuation in the current state of financial stability. The line graphs clearly depict increases in memberships in pre-crisis states prior to crises. 3.2. Transition probabilities on the SOFSM
We exploit temporal variation on the SOFSM by employing probabilistic modeling of state transitions. The transition prob-abilities are computed for node-to-state switches and visualized on own transition planes ( Fig. 4 ), and summarized as maximum transition probabilities conditional on switching, where labels show location and color probability. We have tested a wide range of time spans ( s  X  {6,12,18,24,48}), but chose for analysis a time span of 18 months ( s  X  18). Hence, transition probabilities repre-sent the likelihood of switching to a state within 18 months. The rationale behind choosing s  X  18 is that the SOFSM is also calibrated for optimal performance in terms of predicting vulner-able states 18 months prior to a crisis. Moreover, the transition patterns are considerably robust to changes in s . The length of movements increases with increases in s , as expected, while the directions of movements are stable.

Most notably, while the transition patterns validate the assumed financial stability cycle, the cycle is shown not to be entirely well-behaving or continuous. For instance, the SOFSM shows high probability of transition to the crisis state on the border between the tranquil and pre-crisis states ,aswellasduringextremetranquil times. We also perform a similar line graph representation as that for the fuzzification, but instead with indications of future states.
Fig. 5 , while depicting probabilities according to the financial stability cycle, illustrates the crisis indications in the extreme part of the tranquil state and a rise of new instabilities in 2010. 3.3. Shock propagation on the SOFSM
We assess transmission of shocks on the SOFSM with two methods: a portfolio network topology and SOM neighborhoods.
This enables analyzing spread of financial instabilities from two points of views: contagion via asset-based linkages and propaga-tion of financial distress to similar macro-financial conditions. of financial links in 2010 with the US as its center. Nodes of each economy are located in their BMUs and their size is scaled as to the sum of exposures to other economies. The thickness of the edges represents the size of external exposure to total exposures per economy, where the color of the edge indicates the address of the exposure holder. Indeed, Fig. 6 combines the state of financial stability, or probability of a crisis, with the systemic relevance of each economy. The size of financial linkages to high-risk econo-mies (e.g., Brazil and Mexico) enlighten about both past and present: high levels of previous financial stress in the US may have impacted their current state and they still have a high risk of current and future shock propagation from the US.

While crises are often transmitted through asset-based con-tagion channels, such as financial linkages, they may also be propagated through similarities in macro-financial conditions.
Independent of location on the map, an economy in the neighbor-hood of countries in crisis could through contagion experience a similar wave of financial distress. This is particularly important when dealing with data of changing nature, as it does not necessitate macro-financial conditions to follow patterns during historical crises. Thus, an economy in the upper left part of Fig. 6 , say Mexico, could propagate financial instabilities to countries with similar macro-financial vulnerabilities, e.g., Argentina and
Brazil. While this is particularly useful for visual real-time surveillance, we can also test this by letting locations of crises in period t be signals of crises in that location in period t  X  1. More precisely, we create a leading indicator that signals a crisis in node m b in period t  X  1 if a country that experienced a crisis in t was located in m b in period t . Table 1 shows the predictive performance of neighborhoods on the SOFSM with forecast horizons of 6 X 48 months, where a horizon of 24 months outper-forms the rest. A policymaker with m  X  0.8 derives the largest usefulness. While the table confirms the usefulness of detecting transmission of crisis, the nature of the contagion measures suggest that they are rather complements than substitutes to standard early-warning models. 3.4. Outlier analysis with the SOFSM
We assess whether or not, and to what extent, distances between each data vector and its BMU is an indication of financial imbalances. The rationale for this is that large distances are by definition extreme events with respect to the data distribution on the SOFSM. Table 1 shows the predictive performance of QEs on the SOFSM with forecast horizons of 6 X 48 months. The table illustrates that, while the aim is conceptually different, outliers do not provide equally good means to predict financial instabilities than contagion does. The predictive capability improves with shorter forecast horizons and yields the largest usefulness for a horizon of 6 months. The measure is most useful for a policy-maker with m  X  0.7. This reflects the fact that the measure is binary rather than a probability on which a threshold is chosen to optimize usefulness. Moreover, as the imbalance may be located in different states of the financial stability cycle, it provides only information of possible impending instabilities rather than infor-mation on the exact timing of a crisis. 4. Conclusions
This paper has enhanced the exploitation of the SOFSM by the means of four tasks: (1) fuzzification of the map, (2) probabilistic modeling of state transitions, (3) contagion analysis and (4) outlier detection. To illustrate the usefulness of the extensions, we have provided some sample visualizations and tested their predictive performance.

This could, however, be extended along several directions. For transition probabilities, different time spans (e.g., moving averages) and regions (e.g., early warning nodes) may also be applied, as appropriate for the given task. Neighborhood con-tagion could as well use different definitions of neighborhood functions. When detecting outliers, one could decide to solely focus on imbalances in specific locations, such as financial stability states. These questions are, however, dependent upon the questions being asked and the task one is attempting to solve, and could hence be varied within the framework in this paper.
The present paper does not, however, deal with changes in cluster structures. A limitation is hence the assumption of a stationary financial stability cycle. An important issue in early-warning modeling is the changing nature of crises due to, e.g., financial innovation. Hence, a key question remains: How should models be adapted to events that potentially surpass historical experience? These suggestions, among other things, set the directions for future research and work in progress.
 References
