 Qinfeng Shi javen.shi@adelaide.edu.au Chunhua Shen chunhua.shen@adelaide.edu.au Rhys Hill rhys.hill@adelaide.edu.au Anton van den Hengel anton.vandenhengel@adelaide.edu.au The margin separating classes of data is a key con-cept in many existing classification algorithms includ-ing support vector machines (SVMs) (Cortes &amp; Vap-nik, 1995; Crammer &amp; Singer, 2001) and Boosting (Schapire &amp; Freund, 1998). These classifiers are fun-damentally involved in identifying and characterising such margins, and are described in terms of the accu-racy and generality with which they do so.
 Random projections have attracted much attention within a range of fields including signal processing (Donoho, 2006; Baraniuk et al., 2007), and cluster-ing (Schulman, 2000), largely due to the fact that distances are preserved under such transformations in certain circumstances (Dasgupta &amp; Gupta, 2002). Random projections have also been applied to classi-fication for a variety of purposes (Balcan et al., 2006; Duarte et al., 2007; Shi et al., 2009a;b; 2010). How-ever, whether margin is preserved has not been well studied.
 Our primary contributions here are to establish the conditions under which margins are preserved after random projection, and to show that error free margins are preserved for both binary and multiclass problems if these conditions are met. We also demonstrate that our results hold for one-parameter multiclass classifi-cation, which explains the approach used in Shi et al. (2009a;b).
 In this vein we build upon the work of Balcan et al. (2006) which provided a lower bound on the number of dimensions required if a random projection was to have a given probability of maintaining half of the orig-inal margin in the data. Although an important step, Balcan et al. (2006) do not solve the problem because the resulting formulation demands infinite many pro-jections in order to guarantee the preservation of an error free margin.
 A typical definition of margin for a binary classification problem is as follows.
 Definition 1 (Margin) The dataset S = { ( x i  X  R ,y i  X  { X  1 , +1 } ) } m i =1 is said linearly separable by margin  X  if there exists a unit length u  X  R d such that for all ( x ,y )  X  S , The maximum (among all  X  ) smallest (among all data) margin is Unfortunately this margin is not preserved af-ter random projection, which we demonstrate by showing a counter-example, depicted in Fig-ure 1. We construct a dataset of 4 data points ( x 1 ,y 1 ) , ( x 2 ,y 2 ) , ( x 3 ,y 3 ) , ( x 4 ,y 4 ), where y and y 3 = y 4 =  X  1, and x 1 = (  X  1 , 1) , x 2 = (1 , 1) , x (  X  1 ,  X  1) , x 3 = (1 ,  X  1). Let R  X  R 1 , 2 be a random ma-trix that maps x onto a 1 dimensional subspace. If the projected data R x are to be linearly separable then the subspace onto which they are projected (a line) must lie within the grey area between the two dashed lines in Figure 1(a). If R is chosen randomly from a uniform distribution then probability that the pro-jected data is linearly separable (by a positive margin) is the angle separating the dashed lines divide by  X  . If we expand x along horizontal line (pushing x 1 and x 3 to the left, x 2 and x 4 to the right while keeping their vertical coordinates unchanged), the grey area angle shrinks as shown in Figure 1(b). In fact, if we push x to infinitely far away, the angle reduces to 0 while keeping the original margin  X  unchanged. This means that there exist data with positive margin, such that the chance of the projected data being linearly sepa-rable is close to zero. 2.1. Error-allowed margin Balcan et al. (2006) studied the problem of margin preservation under random projection for binary clas-sification. In doing so they derived a formula for the probability that a margin would be decreased by less than half under a particular projection. They pro-vided two margin definitions below, using dataset S as in Definition 1 and data distribution D .
 Definition 2 (Normalised Margin) A dataset S is linearly separable by margin  X  if there exists u  X  R such that for all ( x ,y )  X  S , Definition 3 (Error-allowed Margin) A data dis-tribution D is linearly separable by margin  X  with error  X  , if there exists u  X  R d , such that Definition 2 describes a normalised version of the more traditional margin, and it is this normalised version which we refer to as the margin henceforth.
 Definition 3 describes a margin over a distribution rather than a dataset. Balcan et al. (2006) showed that if the original data has normalised margin  X  then as long as the number of projections for an appropriate constant c , the projected data (now n dimensional) has margin  X / 2 with error  X  , with prob-ability at least 1  X   X  . Definition 3 shows that a pos-itive margin implies  X  = 0, which by (2) implies that n = +  X  . Thus in order to preserve a positive mar-gin in the projected data one needs infinitely many random projections. In this section, we will establish the conditions for er-ror free margin preservation. Extension to error al-lowed margin will be briefly discussed at the end of this section.
 In order to give an indication that angles and margins might be preserved we first tackle the simpler question of whether the mean is preserved.
 Lemma 4 (Mean preservation) For any w , x  X  R , any random Gaussian matrix R  X  R n,d whose en-tries R ( i,j ) = 1  X  n r ij where the r ij s are i.i.d. random variables from N (0 , 1) , we have Proof of Lemma 4.
 The above is based solely on the fact that the { r are independent with zero mean and unit variance. The fact that the mean is preserved is a necessary condition for margin preservation, although the fol-lowing proves that angle and margin are preserved do not depend on it. Due to the 2-stability of the Gaus-sian distribution, we know that P d j =1 r `j w j = k w k z We thus see that  X  R w , R x  X  = 1 n k w kk x k P n ` =1 z There are two possible cases:  X  If w = x , then P n ` =1 z 2 ` has a chi-square distribu- X  If w 6 = x , P n ` =1 z ` z 0 ` is a sum of product normal Theorem 5 (Angle preservation) For any w , x  X  R , any random Gaussian matrix R  X  R n,d as defined above, for any  X  (0 , 1) , if  X  w , x  X  &gt; 0 , then with probability at least the following holds  X  1  X  With angle preservation, one can easily show inner product preservation by multiplying k R w kk R x k in (4) which, however, results in a looser bound.
 This theorem is one of our main results, and underpins the analysis to follow. The proof is deferred to Sec-tion 4. This theorem shares similar insight as Magen (2007), in which Magen showed that random projec-tions preserve volumes and distances to affine spaces. A similar result on inner product is obtained in Ar-riaga &amp; Vempala (2006, Corollary 2).
 Since acute angles are provably preserved, we are now ready to see whether the margin is also pre-served. Proving margin preservation requires proving that there exists a parameter vector v  X  R n such that the dataset S after random projection can still be sep-arated by a certain margin. The proof is achieved essentially by showing that R u is one such parameter vector v . Using angle preservation from Theorem 5 and the union bound yields the following theorem. Theorem 6 (Binary preservation) Given any random Gaussian matrix R  X  R n,d as defined above, if the dataset S = { ( x i  X  R d ,y i  X  { X  1 , +1 } ) } m linearly separable by margin (the normalised margin in Definition 2)  X   X  (0 , 1] , then for any  X ,  X  (0 , 1) and any with probability at least 1  X   X  , the dataset S 0 = { ( R x R n ,y i  X  X  X  1 , +1 } ) } m Proof of Theorem 6. By definition, for all ( x ,y )  X  Theorem 5 and the union bound, we have Let  X  = 6 m exp (  X  n 2 ( 2 2  X  3 3 )), then solving for n gives the required bound on n .
 Note that in Theorem 6, the lower bound of the mar-gin after random projection can become negative for certain values of . A negative margin implies that the projected data are not linearly separable. Since it is a lower bound (not a upper bound), the impli-cation in this case is only that the separability of the projected data can no longer be guaranteed with high probability.
 When the lower bound is positive, Theorem 6 indi-cates that margin separability for binary classifica-tion is preserved with high probability under random projection. This may seem at odds with our initial counter-example, but the difference lies in the distinc-tion between Definition 1 and Definition 2. In the counter-example, pushing x s apart reduces the proba-bility of achieving a separable projection (as indicated by the margin defined in Definition 1) to zero. How-ever, during this process the margin as defined in Def-inition 2 is also shrinking to zero, and thus that it is only this diminished margin which need be preserved. We now consider the multiclass case, and specifically the widely accepted definition of the multiclass margin from Crammer &amp; Singer (2001). The straightforward multiclass extension of the counter-example shown in Figure 1 shows that the multiclass margin is not always preserved under random projection. As in the binary classification case, we thus introduce the normalised multiclass margin.
 Definition 7 (Normalised Multiclass Margin) The multiclass dataset S = { ( x i  X  R d ,y i  X  Y = all ( x ,y )  X  S For the purposes of the discussion to follow we will as-sume the multiclass dataset S to be as in Definition 7. The smallest maximum  X  can be found via As we will see a special case of the above is used in the one-parameter method in Shi et al. (2009a;b) whereby u reduces to a single vector.
 Theorem 8 (Multiclass margin preservation) For any multiclass dataset S and any Gaussian random matrix R , if S is linearly separable by margin  X   X  (0 , 1] , then for any  X ,  X  (0 , 1) and any with probability at least 1  X   X  , the dataset S { ( R x i  X  R n ,y i  X  Y } m i =1 is linearly separable by margin  X  Proof of Theorem 8. By the margin definition, for all ( x ,y )  X  S Take any single ( x ,y )  X  S , we have by Theorem 5 and union bound that
Pr
Pr  X  y 0 6 = y, By the union bound, with probability at least 1  X  6 Lm exp (  X  n 2 ( 2 2  X  3 3 )), for all ( x ,y )  X  S , we have quired lower bound on n .
 Note the above result can be easily extended to the widely accepted definition of the multiclass un-normalised margin from Crammer &amp; Singer (2001) by bounding the distortion on k R u y kk R x k and k R u y 0 kk R x k . However, larger multiclass unnor-malised margin does not mean smaller angle ( i.e. larger normalised margin), thus may not provide tighter preservation.
 The definition of the multiclass margin in Definition 7 assumes the existence of a set { u y  X  R d } y  X  Y . We now consider whether the margin is preserved in the case where there exists only a single parameter vector u . Theorem 9 (One-parameter method) For any multiclass dataset S , and any random Gaussian matrix R , denote by R y  X  R n,d the y -th sub-matrix of R , that is R = [ R 1 ,  X  X  X  , R y ,  X  X  X  , R L ] . If S is linearly separable by margin  X   X  (0 , 1] , then for any  X ,  X  (0 , 1] and any there exists a parameter vector v  X  R n , such that Proof of Theorem 9 . By the margin definition there exists { w y  X  R d } y  X  Y , such that for all ( x ,y )  X  S , Without loss of generality we assume that w y has unit length 1 for all y . So now This can be rewritten as  X  u , x  X  e y  X  X  X  X  u , x  X  e y 0  X  =  X  x  X  e y  X  x  X  e y 0 where u is a concatenation of all w y i.e. u = [ w 1 ,  X  X  X  , w the y -th location and zeros in all others, and  X  is the tensor product. Define z x ,y 0 = x  X  e y  X  x  X  e y 0 . Applying Theorem 5 to u and z x ,y 0 , we have for a given ( x ,y ) and a fixed y 0 6 = y , with probability at least 1  X  6 exp (  X  n 2 ( 2 2  X  3 3 )), that the following holds, By the union bound over m samples and the L  X  1 y 0 s Letting v = R u , we have Setting  X  = 6 m ( L  X  1) exp (  X  n 2 ( 2 2  X  3 3 )) gives the re-quired bound on n .
 Theorem 9 shows the existence of a parameter vec-tor under which the margin is preserved up to an or-der O (  X / with L . The gain is thus that the memory requirement is independent of the number of classes .
 Error allowed margin The error free margin preservation results presented above apply only to lin-early separable data. Real data are often not linearly separable, but the result applies none the less to any linearly separable subset of the data. Given that what has been developed is a theoretical result intended to guide the selection of an appropriate projection dimen-sion the fact that it applies to every linearly separable subset of the data is likely to suffice in most cases. Our results can be easily extended to error allowed margin, however, in both binary and multiclass cases, by the addition of a controllable tolerance . The probability of preserving the error allowed margin can be bounded below by bounding above the chance of the subset of data being not linearly separable (thus error allowed) and the chance of the complement subset being lin-early separable under projection. To prove angle preservation as in Theorem 5, we will use the following tail bound, which also appears in a different form in the simplified proof of the Johnson-Lindestrauss Lemma in Dasgupta &amp; Gupta (2002). Lemma 10 (Tail bound) For any x  X  R d , any ran-dom Gaussian matrix R  X  R n,d as defined above, for any  X  (0 , 1) , Proof of Theorem 5 . From Lemma 10 and the union bound, we know that (1  X  )  X  holds with probability at least 1  X  4 exp (  X  n 2 ( 2 2  X  When (7) holds, due to the fact that increasing the length of two unit length vectors ( i.e. from R x k R x k the norm of their difference 2 , we have We thus see that The first inequality is due to (7), the second inequality is a property of any acute angle. Applying Lemma 10 to the vector ( x k x k  X  w k w k ), we see that holds with a given probability.
 Letting  X  denote the angle between w and x we have Similarly is bounded below and above by two terms involving k side bounds, we get (4). Here we have applied Lemma 10 to 3 vectors, namely x , w , and ( x k x k  X  w k w k ), thus by the union bound, the probability that the above holds is at least 1  X  6 exp (  X  n 2 ( 2 2  X  3 3 )). For completeness, we show the proof of Lemma 10 be-low.
 Proof of Lemma 10. By Lemma 4 and letting w = x , we have E ( k R x k 2 ) = k x k 2 . Due to the 2-stability of the Gaussian distribution, we know P square distributed with n -degrees of freedom. Apply-ing the standard tail bound of the chi-square distribu-tion, we have
Pr k R x k 2  X  (1  X  ) k x k 2  X  exp Here we used the inequality ln(1  X  )  X   X   X  2 / 2. Similarly, we have Pr k R x k 2  X  (1 + ) k x k 2  X  exp )) .
 Here we used the inequality ln(1 + )  X   X  2 / 2 + 3 / 3. The experiments detailed below offer an empirical val-idation in support of the theoretical analysis above, and a demonstration of its application to SVMs. 5.1. Angle and inner product preservation Figure 2 shows the results of simulations whereby we randomly generate two vectors w and x  X  R d , d = 300. We then generate 2 , 000 random Gaussian matrices of the form specified in Theorem 5. Each such matrix is used to project the data into n dimensions where n = { 30 , 60 , 90 ,..., 300 } . We vary  X  { 0 . 1 , 0 . 3 } and compute the empirical rejection probability for angle preservation P 1 = 1  X  Pr (1  X  )  X  and the empirical rejection probability for the inner product preservation The simulations cover two cases, first where the vectors x and w are separated by an acute angle ( i.e.  X  = k w kk x k &gt; 0), and second where the angle is obtuse ( i.e.  X  &lt; 0).
 In the acute angle (  X  &gt; 0) case we generate two pairs and plot the empirical rejection probability in Figure 2. In Figure 2(a), we can clearly see that the rejection probability more rapidly approaches zero for { w 1 , x 1 } than { w 2 , x 2 } . This aligns with the theoretical anal-ysis above in that we we would expect a more acute angle to imply a better angle preservation under ran-dom projection, and thus that fewer projections would be required to achieve a reasonable separation. It is also expected that the rejection probability decreases as and n increase.
 Likewise, the inner product is preserved under ran-dom projection if the angle is acute as is visible in Figure 2(b). It is interesting to see that for the same  X  , and n , the empirical rejection probability for the angle preservation is significantly smaller than that for inner product preservation.
 In the obtuse angle ( i.e.  X  &lt; 0) case, we gener-ate two pairs of vectors with  X  w 3 , x 3  X  ) =  X  0 . 062 and  X  w 4 , x 4  X  ) =  X  0 . 0165 and plot the empirical rejection probability in Figure 2 (c) and (d). Clearly the em-pirical rejection probability does not shrink towards zero, thus both the angle and the inner product are not preserved.
 5.2. Margin preservation Margins We generated L parallel hyperplanes, where the L is the number of classes. Each class con-sists of 5 data points x  X  R 100 from a hyperplane. We then generated 100 random Gaussian matrices. We used the random matrices to project the data, and then computed both the normalised margin and un-normalised margin. The empirical rejection probabil-ity where  X  0 is the new margin and  X  is the original mar-gin, was also computed. We show the plots for both binary and multiclass ( L = 3) cases. As we can see in Figure 3, that the empirical rejection probability de-creases ( i.e. margins are preserved with higher prob-ability) as the number of projection n increases. Implications for SVMs As has been shown, the results above can be applied even in the case where the data are linearly inseparable, as is often the case in real classification problems. Testing of this method shows that it exhibits a smaller testing error on in the TiCC handwritten digit dataset (van der Maaten, 2009), for example, than the multiclass SVM (Cram-mer &amp; Singer, 2001) algorithm in liblinear (Fan et al., 2008). We conjecture that this is due to the signifi-cantly reduced dimensionality specifically as a result of the application of the one-parameter method. Pro-jecting features to a lower dimensional space can signif-icantly reduce the model capacity such as VC dimen-sion (Vapnik, 1995). Thus the consequent generalisa-tion bounds can be reduced if the margin preservation is good.
 We have provided an analysis of margin distortion un-der random projections, described the conditions un-der which margins are preserved, and given bounds on the margin distortion. We have shown particularly that margin preservation is closely related to acute an-gle (cosine) preservation and inner product preserva-tion. In doing so we saw that the smaller acute angle, the better the preservation of the angle and the in-ner product. When the angle is well preserved, the margin is well preserved too. Because of this, the nor-malised margin is more informative than the unnor-malised margin. We have also provided a theoretical underpinning for classification methods which use ran-dom projection to achieve multiclass classification with a single model parameter vector.
 In contrast to previous work in the area (Balcan et al., 2006) we have shown that it is possible to provide bounds on error free margin preservation without re-quiring an infinite number of projections, and have done so for arbitrary tolerances, rather than only for half of the original margin. In addition, all of the above has been achieved for multiclass rather than solely bi-nary classifiers. It is worth pointing out that our er-ror free margin is defined on a dataset as traditional margin concepts whereas Balcan et al. (2006) X  X  error allowed margin is defined on a data distribution. Though we only showed results for random Gaus-sian matrix, similar bounds can be achieved for sub-Gaussian distribution as long as a tail bound similar to Lemma 10 holds (see Achlioptas, 2003).
 The bounds derived above are conservative, however, as they are based on the union bound over all of the data. The margin is primarily determined by the data on the boundary, however. Even a small distortion of data near the boundary may change the margin sig-nificantly, whereas distortion of the data far from the boundary is far less likely to do so. It thus seems likely that the margin bound can be further tightened by taking into account the data distribution.
 This work is supported by the Australian Research Council DECRA grant DE120101161. We thank An-ders Eriksson for discussion on the counter-example, and Maria-Florina Balcan and Avrim Blum for dis-cussion on error-allowed margin.

