 In image retrieval, most existing approaches that incorpo-rate local features produce high dimensional vectors, which lead to a high computational and data storage cost. More-over, when it comes to the retrieval of generic real-life im-ages, randomly generated patches are often more discrimi-nant than the ones produced by corner/blob detectors. In order to tackle these problems, we propose a novel method incorporating local features with a hybrid sampling (a com-bination of detector-based and random sampling). We take three large data collections for the evaluation: MIRFlickr, ImageCLEF, and a collection from British National Geo-logical Survey. The overall performance of the proposed approach is better than the performance of global features and comparable with the current state-of-the-art methods in content-based image retrieval. One of the advantages of our method when compared with others is its easy implementa-tion and low computational cost. Another is that hybrid sampling can improve the performance of other methods based on the  X  X ag of visual words X  approach.
 H.3.3 [ Information Search and Retrieval ]: Retrieval models Algorithms, Experimentation, Performance Content-based image retrieval and representation, Local fea-tures, Global features, Keypoints, Interest points detectors, Sparse sampling, Dense sampling, Random sampling, Lo-cal descriptors, Co-occurrence matrix, Colour moments, K-means algorithm, Vector quantization
Recently, content-based image retrieval (CBIR) based on local features has become popular. Global approaches find it hard to capture the local patterns in content of an image. When it comes to retrieval by texture for example, real-life images often consist of small patches of uniform texture. A popular approach to characterize the local patterns is based on  X  X ag of visual words X  or  X  X ag of features X  1 .
Most of these methods, however, produce high dimen-sional vectors. This, in turn, requires the application of dimensionality reduction techniques which leads to higher computational cost. Moreover, most existing approaches (in the retrieval of generic real-life images) are based on interest points detectors, but quite often more discriminant image patches are generated at random (see [ ? ]).

To tackle this problem, we propose a novel and simple to implement method based on local features. Based on the observation that quite often randomly generated sam-ple points are more discriminant than the points detected by corner (blob) detector, we decide to develop a hybrid sampling technique. Points detected by corner (blob) de-tector tend to concentrate on objects, while randomly gen-erated points help to capture properties of the background. A comparison between random, dense, pure corner-based, and hybrid sampling shows the superiority of our method. The evaluation is performed on three large data collections: ImageCLEF 2007, MIRFlickr 25000 and an image collection from British National Geological Survey (BGS). We also test the influence of the spatial information on the retrieval per-formance and compare the global features with the local methods.

For the description of the image patches around the sam-ple points, we propose to use: co-occurrence matrix com-puted at eight different orientations, and three colour mo-ments to capture the local colour properties. Co-occurrence matrix has proven to be an effective way of texture repre-sentation. By considering multiple orientations, we make it invariant to rotation. Colour moments are fairly insensitive to changes in viewpoint, and their computation is trivial. In order to make them retain light-independent properties we switch from RGB to HSV colour space. Moreover, patches characterized by colour moments are also able to capture the local textural information.
The terms  X  X ag of visual words X  and  X  X ag of features X  will be used interchangeably in this paper.
The  X  X ag of features X  (B.O.F.) approach based on SIFT detector and descriptor and its application to nude images detection is described in [ ? , ? , ? , ? ].

Authors of [ ? ] incorporated and tested some methods de-rived from textual information retrieval domain into CBIR: term weighting, stop word removal, feature selection. They also conducted experiments to test the influence of the vo-cabulary size (number of clusters) and spatial information on the retrieval performance.

The method proposed in [ ? ] learns the similarity measure and uses a random sampling technique to retrieve previ-ously unseen objects. The algorithm is based on random-ized binary trees (a combination of scale invariant feature transform and geometry) and randomly selected rectangu-lar regions of random size.

Nowak and others ([ ? ]) compare different sampling tech-niques (corner detectors, random sampling, dense sampling). The experimental results showed that the number of sam-pled patches significantly influenced the retrieval perfor X  mance. Surprisingly, for a large number of patches the key-points detected by corner/blob detector tend to lose their discriminative power. However, there was no comparison with a combination of random and detector-based sampling.
The novel descriptor proposed in [ ? ] uses Gaussian filter banks to characterize local patches. The method seems to outperform SIFT but only on a specific small data collection.
Finally, Athanasakos et al. ([ ? ]) undermine the surpris-ingly good retrieval performance reported so far by various researchers, claiming that the methods were finely-tuned for collection specific properties. That is why it is so important to test the models on different data collections. Our local features algorithm comprises following stages:
A sampling technique can have a significant influence on the retrieval performance. The most commonly used sam-pling methods are based on corner/blob detectors. However, as we shall see, this kind of sampling may not be the best choice for the generic real-life image retrieval. Other meth-ods include dense and random sampling.

As mentioned before, the hybrid sampling method com-bines Shi and Tomasi corner detection with a random num-ber generator. The Shi and Tomasi method is based on the Harris corner detector. For the detailed description of the algorithm the reader is referred to [ ? ].

We apply the afore-mentioned detector but generate each second sample point at random. This method will take into account the properties of the foreground as well as the prop-erties of the background which are especially important in the retrieval of images depicting natural scenes.
Other sampling techniques implemented for comparison purposes are: corner detector only, purely random and dense sampling. In case of the latter one, each image is divided into the same number of identical rectangular subimages.
We characterize each local patch in an image as an eight orientation co-occurrence matrix and three colour moments in HSV colour space.

The co-occurrence matrix describes the way certain gray X  scale pixel intensities occur in relation to other grayscale pixel intensities. It counts the number of such patterns. The most discriminating statistics extracted from co-occurrence matrix are: contrast, inverse difference moment, entropy, energy, homogeneity, and variance.

The method based on three colour moments assumes that the distribution of colour can be treated as probability dis-tribution. Three statistics extracted from individual colour channels are mean, standard deviation and skewness. The first moment can be interpreted as an average colour value, the second as a square root of the variance of the distri-bution, and the third as the measure of asymmetry in the distribution. Colour moments can also capture the textural properties of an image and are fairly insensitive to viewpoint changes. By computing them in HSV colour space we can make the statistics insensitive to illumination changes. The similarity between histograms is calculated based on Minkowski X  X  fractional distance measure. It was experimen-tally proven (see [ ? ]) that the fractional measures from Minkowski X  X  family of distances yield good results in CBIR.
The global features implemented for comparison purposes are: colour histogram in HSV (Hue, Saturation and Value) colour space, texture features based on co-occurrence ma-trix, colour moments and methods based on edge detectors which incorporate Canny edge detector and our novel detec-tor based on bilateral filtering (image smoothing that pre-serves the edges), four directional derivatives and threshold-ing. The distribution of edges is captured by co-occurrence matrices. Table 1: ImageCLEF2007 results, 250 sample points Table 2: ImageCLEF2007 results, 900 sample points The data collections used for experimental purposes were ImageCLEFphoto2007, MIRFlickr and BGS (British Geo-logical Survey).

ImageCLEFphoto2007 consists of 20000 everyday real X  world photographs. There are 60 query topics consisting of example images that do not belong to the collection. The ground truth data is provided for each topic.

The MIRFlickr collection comprises 25000 images from the Flickr website which are freely redistributable for re-search purposes. For a detailed description of the collection the reader is referred to [ ? ].
 The last data collection consists of 7432 images from BGS. Some of the categories are obviously very difficult for the visual features to capture. This is due to the highly abstract categories with semantic meaning like X  X conomic geology X  X r  X  X eological hazards X .

For each of the two latter collections, 100 query images are randomly selected from the collection, and the ground truth is approximated based on the sharing of same categories between images. We retrieve 1000 images for each query and compute the Mean Average Precision (MAP) based on the ground truth data and general topics.
We experiment with the following sampling techniques: pure corner-based, random, dense and hybrid. Most exist-ing approaches set the number of keypoints to be between 300 and 1400. The larger number of sample points is ex-pected to give more accurate results, but the trade-off is the higher computational cost. In our experiments, we tested two different settings: 250 and 900 respectively. For each sampled point in an image, a 10 10 square patch around it is characterized as a multidimensional vector by applying a local descriptor. The impact of the spatial information is taken into account by dividing an image into 9 sub-images of equal size. Each image patch has 9 and 12 dimensions accordingly, and the codebook size is 40.
Tables 1 and 2 illustrate the performance of our local fea-tures on the ImageCLEF2007 data collection, for 250 and 900 sample points accordingly.

In term of the MAP, for the relatively small number of sample points, the best performing method is the one with hybrid sampling. When the number of sample points in-creases, however, the discriminative power of randomly sam-pled patches grows and the set of keypoints detected by cor-ner detector gets saturated. In other words, the corner de-tector is unable to find more discriminative patches. That is why the best performing method, for 900 sample points, is the one incorporating random sampling. We can also ob-serve that it is desirable to have a large number of sample points which improves the overall performance of local fea-tures. Nevertheless, the larger the number of local patches is, the higher the computational and the storage costs will be.

We have also tested the influence of the spatial informa-tion on the retrieval performance. For a small number of sample points, the inclusion of spatial information improves the retrieval performance. Thus, the MAP for the local fea-tures with random sampling and 250 patches increases to MAP 0.0427. However, when the number of sample points is high, e.g. 900, the spatial information can even hamper the retrieval. For instance, the retrieval performance of local features with random sampling, spatial information included and 900 patches, drops to MAP 0.045.

The influence of the number of sample points and the in-clusion of spatial information on retrieval performance vali-dates the findings reported in [ ? ]. It turns out that when it comes to content based retrieval of generic real-life images, the sophisticated sampling methods are effective only if the number of sample points is relatively low. Otherwise, simple random sampling is the best one due to its ability of finding a higher number of discriminative image patches.
The local features with a different descriptor based on the co-occurrence matrix (with hybrid sampling and 250 sample points) performed worse, obtaining MAP 0.011.

According to [ ? ], the best performing global method ob-tained MAP 0.026. They conducted their experiments on ImageCLEF 2008 collection which consists of the same 20000 images and same 60 topics as ImageCLEF 2007. Thus, in this case, the MAP of the local features is almost twice as high as MAP of the global methods.

The performance of local features with different sampling techniques on MIRFlickr dataset is quite similar (Table 3). It is rather surprising, considering the differences in perfor-mance on individual queries. This suggests that the combi-nation of the features with different sampling should improve the results. This will be investigated further in the future.
Figure 1 presents the retrieval results for the global fea-tures. The MAP of local features with hybrid sampling is also depicted for comparison purposes. We can observe that the local features performed better on this image collection with our hybrid sampling approach (local hybrid) being the best in term of MAP.

The local features with a different descriptor based on the co-occurrence matrix (with hybrid sampling) performed worse, obtaining MAP 0.599.

The best results for BGS data collection are obtained by the local features with hybrid sampling as shown in Ta-ble 4. The difference between this best performing method and others (approximately 17% of improvement over the most commonly used corner/blob detector-based sampling) is more significant than the difference on the ImageCLEF and MIRFlickr collections.

Figure 2 depicts the MAP for global features and the best performing local method (hybrid sampling). Again, the local features outperformed the global ones. Figure 1: Global versus local features, MIRFlickr.
The local features with a different descriptor based on the co-occurrence matrix (with hybrid sampling) performed worse, obtaining MAP 0.159.

In this paper we propose a novel method based on the local features, incorporating an easy to implement descriptor and a hybrid sampling technique. We systematically compare different sampling methods: hybrid (a combination of ran-dom and detector-based sampling), purely random, purely detector-based and dense on three large data collections.
Our approach is easy to implement, not sophisticated, with low computational and data storage cost (mostly be-cause our vectors are low dimensional), and the hybrid sam-pling technique can be used in other methods based on the  X  X ag of visual words X  to improve the retrieval performance. Moreover, the evaluation of the proposed method has been conducted on three different large data collections without changing the initial setup. In this way we avoid X  X ine-tuning X  of parameters to the specific data collections. This makes the results more general and reliable.

We plan to extend our evaluation of different sampling techniques to various other detectors and descriptors, such as Scale Invariant Feature Transform (SIFT). We will ex-tend the experiments to different numbers of sample points and measure the influence of the codebook size on retrieval performance.
This work is funded in part by the Scottish Northern Re-search Partnership and the UK X  X  Engineering and Physical Sciences Research Council (grant number: EP/F014708/2). [1] D.G. Lowe. Object recognition from local [2] K. Mikolajczyk, C. Schmidt. A performance evaluation [3] T. Lindeberg. Scale-space. Encyclopedia of Computer [4] A.P.B. Lopes, S.E.F. De Avila, A.N.A. Peixoto, R.S. [5] J. Yang, Y.G. Jiang, A.G. Hauptmann, C.W. Ngo. [6] E. Nowak, F. Jurie. Learning visual similarity [7] E. Nowak, F. Jurie, B. Triggs. Sampling strategies for [8] T. Li, I. S. Kweon. A semantic region descriptor for [9] K. Athanasakos, V. Stathopoulos, J.M. Jose. A [10] H. Liu, D. Song, S. Ruger, R. Hu, V. Uren.
 [11] R. Collins. Lecture 06: Harris Corner Detector. [12] M. Grubinger, P. Clough, A. Hanbury, H. Muller. [13] M.J. Huiskes, M.S. Lew. The MIR flickr retrieval [14] S. Overell, A. Llorente, H. Liu, R. Hu, A. Rae, J. Zhu, [15] J. Shi, C. Tomasi. Good features to track. IEEE
