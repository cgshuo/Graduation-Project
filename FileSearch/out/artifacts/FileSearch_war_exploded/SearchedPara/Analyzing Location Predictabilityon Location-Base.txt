 With the proliferation of smart phones and the development of positioning tech-nologies, users can obtain location information more easily than ever before. This development has triggered a new kind of social network service -location-based social networks (LBSNs). In a LBSN, people can not only track and share location-related information of an individual, but also leverage collabora-tive social knowledge learned from them .  X  X heck-in X  is such user-generated and location-related information, being u sed to represent the process of announcing and sharing users X  current locations in LBSNs.

In this paper, we are interested in predicting users X  future check-in locations based on their location histories accumulated in LBSNs. In particular, we at-tempt to determine at which Point Of Interest (POI), such as a clothing store or a western restaurant, a user will chec k in next. Though this problem has been recently investigated [1,2,3], there is little study on the limit of predictability, i.e., to what degree the next check-in locations are predictable, and its correla-tion with users X  demographics. We believe this study will bring valuable insights to the design of prediction algorithms and help to understand users X  behavior from both social and physical perspectives.

The limit of location predictability was first studied on cell tower location se-quences in [4]. The authors discovered a 93% potential predictability in human mobility. However, a check-in trace is quite different from a cell tower trace in the following three aspects. First, check-in is a proactive behavior comparing to the passive recording of cell t ower traces. In other words, a user might not check in at boring places where he has actually been but may check in at locations where there is no visiting behavior. Therefore, check-in locations are usually discontin-uous, and many important mobility patterns could have been lost. Second, the spatial granularity of check-in location s is much finer than cell tower locations (e.g., a point location versus an area of one square kilometers). Thus there are more candidate locations to choose for check-in so that it is much more difficult to predict next check-in location. Last but not least, users are equipped with rich profile information and social relationships, since their check-ins are usually shared on different social networks. This would be helpful for developing more accurate algorithms. In our work, we analyze the problem of check-in location prediction in the presence of these characteristics.

To study the limit of location predictability, we begin with estimating the entropy of an individual check-in trace by first considering an individual check-in trace as a sample of underlying stochastic processes and then calculating the entropy of stochastic processes. We then leverage Fano X  X  inequality [5] to transform the estimated entropy into the limit of predictability for each user. The limit of check-in location predictability is measured for each user on two large-scale check-in datasets from Jiepang and Gowalla with 36M and 6M check-ins, respectively. As a result, we find 25% and 38% potential predictability on these two datasets, respectively.

However, according to our observation, the variance of location predictability among population is large. It implies there is large diversity of human mobility patterns among population. To better understand such large diversity, we can study the difference in predictability of users with different demographics. Par-ticularly, we will perform correlation analysis between predictability and demo-graphics. This task can be more easily done than ever before since users have been already equipped with rich profile information on social networks, includ-ing gender, age, social relationship and so on. By conducting case studies on these check-in datasets, we show that the demographics including users X  gender, age and influence (measured as the number of followers) as well as the repetitiveness of check-ins (measured as the ratio of the number of check-ins to locations) are sig-nificantly correlated with location predictability. More specifically, the mobility of students is higher predictable since their activity areas are usually constrained around the campus and their mobility patterns tend to be more regular; the users with high social influence are hard to predict because they don X  X  usually repeat to check in at those familiar locations. In this case, it is evident that incorporating demographics into the prediction task could be beneficial. The limit of location predictability was first studied in [4] on cell tower data, on which they derived an upper bound of predictability from the entropy of the individual location sequence and found a 93% potential predictability in human mobility. They also studied on a lower bound, Regularity, which pre-dicted the next location as the most freq uently visited location at given hour of week. Following them, in [6], the authors studied the predictability from mo-bile sensor data and also found a high potential predictability on mobile sensor data. And in [7] the authors investigated the scaling effects on the predictability using the high resolution GPS trajectories and derived another equivalent sta-tistical quantities to the predictability. In their conclusion, they stated that high predictability was still present at the very high spatial/temporal resolutions. Al-though all these work focused on the analysis of the limit of predictability, their mobility data differs from ours in the following two major aspects. First, the check-in trace is more discontinuous si nce a user might not check in many places which he has actually visited. Second, the spatial granularity of check-ins is even finer than physical locations since there might be many different semantic loca-tions in the same physical location. These properties lower the check-in location predictability and only achieve a 25%-40% potential predictability.

As for the correlation between mobility patterns and demographics, in [8], the authors analyzed mobility patterns based on the travel diaries of hundreds of volunteers and figured out people with different occupation had distinct mobil-ity patterns. In particular, students and employees were more tending to move among those frequented locations than r etirees. From the perspective of pre-dictability, it seems that students and employees were more easily predicted. The direct correlation between predictability and users X  demographics was also studied in [4] on cell tower traces logged by hundreds of volunteers with some demographics. They concluded that there were no significant gender-or age-based differences. Differen t from theirs, we perform analysis on check-in traces of hundreds of thousands of users on social networks, where users are usually equipped with rich profile information. The results of analysis show that user X  X  demographics including age, gender, social influence and so on, are significantly correlated with location predictability. We perform our analysis on two check-in datasets. The first check-in dataset is from Jiepang, which is a Chinese location-based social network similar to Foursquare. For the sake of protecting privacy, in these LBSNs, users X  historical check-ins are not shown to strangers. Thus we cannot directly obtain users X  check-ins from these LBSNs without becoming their friends. However, users may share their check-ins as tweets on other social networking platforms, such as Weibo and Twitter. For example, Jiepang check-ins are synchronized on Weibo as a particular type of tweets (called loc ation tweets). Thus these check-ins can be crawled from these social networking platforms via their open APIs. Some check-in datasets were also crawled in this way [2,3].

We crawled 36,143,085 Jiepang check-ins at 1,000,457 POIs from 454,375 users via the Weibo API from March. 2011 to March. 2013, where each user has 80 check-ins and check in at 47 POIs on average. If we distribute these check-ins into their date, we find that each user only make 1.5 check-ins each day on average. If we distribute these POIs into 3 km 2 regions, each region owns 13 POIs on average and up to 13,068 POIs in the maximal case. In addition, users on Weibo may fill their profile information more precisely so we also crawled these data, including age, gender, and social relationship as well as tags.

The other check-in dataset, used in [9] and crawled from Gowalla from Feb. 2009 to Oct. 2010, contains 6,423,854 check-ins at 1,280,969 POIs from 107,092 users, where each user has 60 check-ins and check in at 37 POIs on average. If we distribute these check-ins into their date, we find that each user only make 2.1 check-ins each day on average. If we distribute these POIs into 3 km 2 regions, each region owns 7 POIs on average and up to 3,940 POIs in the maximal case.
Based on the above statistics, it is eas ily observed that the frequency of check-ins is significantly smaller than calling or messaging (SMS) and that location density on check-in datasets is significantly higher than cell towers since each cell tower covers a 3-km 2 perception area on average.

In order to guarantee that the entropy of location sequence is well estimated, we only reserve those users with more than 50 check-ins. As a result, 144,053 and 27,693 users are then kept on Jiepang and Gowalla, respectively. All remaining users on Jiepang have gender information while 53,377 out of them have age information. Moreover, they have 3.9 tags and 15 followees on average. Based on the filtered datasets, we per form extensive analysis after presenting the limits of predictability and then compare them with cell tower traces. Assume we predict the n th check-in location L n for user u , given her past lo-perspective, we need to model the probability distribution of L n given h n  X  1 , i.e., P ( L n | h n  X  1 ). In the context of prediction, we choose the location  X  l with the maximum probability Intuitively, if the distribution of P ( L n | h n  X  1 ) is flat, the prediction  X  l with the maximum probability has a low likelihood of being correct; if the distribution peaks at location  X  l significantly, then the prediction can be made with high confi-dence. Thus the probability at  X  l (denoted as  X  ( h n  X  1 )) contains the full predictive power including the potential long range dependency. Summing  X  ( h n  X  1 )overall possible sequences of length n  X  1, the predictability at the n th location is defined as where P ( h n  X  1 ) is the probability of observing h n  X  1 .

After averaging the predictability over all time indices and taking the limit, each user X  X  predictability  X  is defined as
The limit that  X  can reach is estimated by firs t calculating the entropy of a user X  X  check-in location sequence using non-parametric approaches, and then transforms the estimated entropy into the limit of  X  using Fano X  X  inequality [5]. 4.1 Entropy of Check-in Location Sequence The history of check-in locations of a us er can be considered as one sample path of its underlying stochastic process, e.g., Markov process. Therefore, the entropy estimation of the location history is equivalent to deriving the entropy rate of the stochastic process. According to the definition of entropy, the entropy rate of a stationary stochastic process L = { L i } is defined as, where S ( L i | H i  X  1 ) is the conditional entropy of L i given H i  X  1 , which is a random variable corresponding to h i  X  1 (i.e., the past location sequence of length i  X  1). If the stochastic process lacks any long range temporal correlations, i.e., the probability of being at location l and N is the number of locations. In this case, the user moves around N locations according to previous visiting frequency, which we named as the MostFreq algorithm. Another special entropy of interest is the random entropy S rand =log 2 N , obtained when P ( l )= 1 N .Inthiscase, the user moves around N locations randomly, which we named as the Random algorithm. It is obvious that 0  X  S  X  S unc  X  S rand &lt;  X  .

One practical way of calculating the entropy of the user X  X  location history is to fix a underlying stochastic process model and then estimate its parameters, e.g., transition probability of first-order Markov process, and finally derive the entropy rate. This method follows a parametric way and somewhat over-specific. From the non-parametric perspective it can also be achieved to use an estimator based on Lempel-Ziv data compression [10]. This method doesn X  X  assume the stochastic process model and thus is more general. In [10], the authors discussed three kinds of LZ estimators and proved that they can converge to the real entropy of a time series when the length o f observation sequence is approaching infinity. They applied them to calculate the entropy of English texts (number of bits storage). One estimator for a time series with n stepsisdefinedasfollows: where  X  i i is the length of the shortest substring starting at position i which doesn X  X  previously appear from position 1 to i  X  1.

To get the real entropy for any user, her location must be recorded contin-uously (e.g., hourly). However, the cell tower traces used in [4] only contain locations when a person uses her phone, e.g., she sends a short text message or makes a call, and thus exhibits discontinuity and bursting characteristics in temporal dimension. To handle bursting, the authors merged locations within the same hour. To deal with discontinuity, they first studied the relationship between the entropy of discontinuous location history and the degree of discon-tinuity, and then extrapolated the entropy where the degree of discontinuity was zero. However, in addition to discontinuity and bursting, check-ins are at the granularity of POIs instead of regions in the cell tower traces. POIs are physical coordinates with semantic labels so that it is possible for different POIs to share the same physical coordinates. Thus POIs are even finer-grained than physical coordinates. For instance, shops in the same building share the physical loca-tion. As the check-in POIs within the same hour may have different semantic labels, it is difficult to merge them so tha t the subsequent extrapolation cannot be applied. Instead, we can simply use the entropy calculated from the check-in history. This is reasonable to some extent since the benefit of extrapolation re-sults from imputing unseen locations while imputing unseen check-in location is more difficult than imputing physical locations.
Next we measure three entropy quantities S , S unc and S rand for each user, and show their probability distribution across users on Jiepang and Gowalla separately in Figure 1. Compared to the r esults obtained from cell tower traces, there is no big gap between P ( S )and P ( S rand ) on both check-in datasets. In-deed, P ( S rand ) peaks around 5 . 8 on both check-in datasets, indicating if we assume users moved randoml y, their next locations can be found on average in any of 2 5 . 8 =56 locations. However, P ( S ) peaks around 5 . 59 and 4 . 83 on Jiepang and Gowalla, respectively. In other words, if we make a prediction with the help of their past history, we reduce less than 2 bits of uncertainty and must choose among 2 5 . 59 =48 and 2 4 . 83 =28 locations on average, respectively, which is much larger than the corresponding number (2 0 . 8 =1 . 74) obtained from cell tower traces. Therefore, the prediction of check-in location is more difficult than the cell tower location. To get deep understanding on the difficulty of prediction on LBSNs, we compile statistics on what percentage of transition across loca-tions will repeat. The result indicates that there are only 3.4% and 6.5% repeti-tive transitions across locations on Jiepang and Gowalla, respectively. This may be because users X  proactive check-in behaviour renders checking in at locations without actual visit and missing check-ins at locations where they often go. To continue analyzing Figure 1, we o bserve that the difference between P ( S rand ) and P ( S )ontheJiepangcheck-indatasetissmallerthanontheGowallacheck-in dataset, which means that check-in location prediction on Jiepang is more difficult. This is in line with the previous results that there are larger repetitive transitions across locations on Gowalla than on Jiepang. Comparing P ( S unc ) with P ( S rand ), there is only a small gap on the Jiepang check-in dataset, which indicates that a large number of locations are checked in only once since the average times of users X  check-in at POIs is less than 2. The extra part of P ( S ) over P ( S unc ) can be explained by the temporal correlation between locations in the location sequence and thus helps us to understand the effect of the sequen-tial patterns. Due to their small gap, we could foresee the limited benefit from sequential patterns in the check-in traces. 4.2 Limit Analysis and Discussions As soon as we get three quantities of entropy, we can transform them to the limit of their corresponding prediction algorithms. For the aforementioned predictabil-ity  X  , it satisfies Fano X  X  inequality. That is, if a user with entropy S moves be-tween N locations, her predictability  X  meets this condition  X   X   X  max ,where  X  max is the root of following equation S
F ( p )=(1 which is concave and monotonically decreases with p when p  X  [ 1 N , 1). Therefore, the satisfaction of  X   X   X  max only requires S F (  X  )  X  S = S F (  X  max ) since it is easily verified that  X   X  1 N and  X  max  X  1 N . Based on the concavity and monotonicity properties of S F ( p ) as well as Jensen X  X  inequality, S F (  X  )  X  S is equivalent to S F (  X  ( h n  X  1 ))  X  S ( L n | h n  X  1 ). The latter inequality is simply the well-known Fano X  X  inequality when the probability of error prediction is 1  X   X  ( h
Since  X  max  X  1 N , Eq (6) has a unique root. We can leverage any root finding algorithm, e.g., Newton X  X  method to find the solution of  X  max . Similarly from S rand and S unc , we can determine  X  rand and  X  unc , which are limits of Random and MostFreq, respectively.
After determining  X  max ,  X  unc and  X  rand foreachuserusingEq(6),we demonstrate their distribution over all users in Figure 2. We can see that  X  max on the Jiepang and Gowalla check-in datasets peaks around 0.25 and 0.38, re-spectively, which means that no matter how good the algorithm is, its accuracy can not be larger than 25% and 38%, resp ectively when using their individual check-in history. In addition, we can see that the variance of  X  max is larger than that obtained from cell tower traces and thus the predictability in terms of check-in location varies more from person to person. In other words, some people show high regularity while others do not.  X  unc shows a similar trend to  X  but is left shifted and more narrowly distributed. Thus  X  unc shows more universal patterns across user population than  X  max . This observation agrees with the phenomena that users check in at the most locations only once.

Although there is 25%-38% potential predictability on the check-in data, there are two assumptions behind. The first is not to impute unseen check-in loca-tions. The reason of making this assumption is that it is difficult to impute unseen check-in locations in practice. Th e second assumption is not to resort to other information, such as check-ins of friends and similar users. This assumption mainly results from the dominated effect of individual check-in history according to our observation and the conclusion in [1,2]. In the future, we can relax the second assumption to consider these information so as to get a higher limit of pre-dictability. Although the potential predictability is much lower than that of cell tower traces, it is still a theoretically tight bound, which is difficult to achieve in practice. In order to approach this bound, according to the definition of entropy, we should leverage all orders of sequential patterns, from 0 order (MostFreq) to possibly highest (the number of all check-ins) order. In practice, significant high-order sequential patterns are difficult to discover due to limited check-in history, so the combination of 0 order and other low order sequential patterns can be a possible way of designing prediction algorithm [3]. Additionally, for the sake of approaching this bound, according to Fano X  X  inequality, the probability of error 1  X   X  ( h n  X  1 ) should be distributed as uniformly as possible over all lo-cations except the most possible one  X  l . To achieve this, we can introduce other information, such as the time of next check-in, to increase  X  ( h n  X  1 ). After calculating the limit of location predictability based on individual check-in history, we further study the correlation between location predictability and sev-eral users X  demographics. Such study is important since it could provide evidence for the demographic-based advertisement targeting and the demographic-boosted prediction task. In this study, the demographics are split into two categories: cat-egorical and numerical. Categorical demographics include gender and age group. Numerical demographics include number of locations, number of check-ins, and number of followers. The age information is numerical in practice, but we quan-tized it into the following ordinal groups, i.e.,  X  &lt; 19 X ,  X 19-23 X ,  X 24-28 X ,  X 29-33 X ,  X 34-38 X ,  X  &gt; 38 X  for better visualization. Since the ages of most users are distributed within [19 , 38], users both younger than 19 and older than 38 are aggregated into separate groups.

For categorical variables, we perform analysis of variance (ANOVA) test for the statistical correlation between a demographic measure and user X  X  predictabil-ity. For numerical variables, since we don X  X  know the concrete form of their cor-relation, we calculate a non-parametric correlation, i.e., Kendall rank correlation coefficient, and perform non-parametric hypothesis test, i.e., tau test, to see the significance of their correlation.

Before performing ANOVA test, we first check the assumption of ANOVA test on the categorical variables and predictability. The result of testing shows the assumption can be satisfied with a p-value smaller than 1e-10. The result of ANOVA test is shown in Table 1. From this table, we observe that the correlation of predictability with the categorical demographics including gender and age group is significant. And gender is more correlated with predictability, which indicates that male users and female users show different degree of predictability. In order to see how these categorical variables are correlated with predictability, we draw the box plot of predictability with respect to these categorical variables and show them in Figure 3. From them, we have the following observations: 1) male users show higher regularity than female users. According to the statistics of the categories of POIs, the four most frequent check-in categories from female users are residential, coffee shop, shopping mall and chaffy dish while the four most frequented check-in categories made b y male users are residential, airport, office building and subway station. Thus this observation sounds reasonable. 2) young users (age &lt; 24) are easier to predict. This is because these young users are mainly students at school so that their check-ins are constrained around their campus. According to the statistics of the POI categories, three most frequent check-in categories by these young users are teaching building, dormitory and campus. According to the analysis to the tags of each user, 10% of these young users are tagged by  X  students  X  while only 1% of elder users are such tagged.
Next we study the correlation between numerical variables and predictability and show the results of tau test in Table 2. From this table, we can answer the following two questions. 1) Are users with larger social influence harder to predict? We measure social influence as the number of followers (#F) in this paper. Users with more followers are more cautious about their reputation so that they will not check in at those boring locations, such as home, subway station. According to this table (last column), the answer to this question is yes and thus the immediately preceding expla nation is justified. 2) which of these three factors, the number of locations (#L), the number of check-ins (#C) and the ratio of the number of check-ins to the number of locations which we name as CLR , are consistently and significantly correlated to predictability? From this table, we see that the correlation between predictability and the number of locations is significant but not consistent on Jiepang (positively correlated) and Gowalla (negatively correlated). More discussions are provided in Figure 4 and in the subsequent paragraphs. As for the number of check-ins and its ratio CLR to the number of locations, they are both significantly correlated to the limit of location predictability on both datasets from the perspectives of statistics testing. However, CLR is more strongly correlated with location predictability than the number of locations. The principle reason is that the larger number of check-ins doesn X  X  necessarily indicate mo re repetitive patterns since some users like to check in at many neighbour locations which they didn X  X  visit in practice.
To find how predictability covariates with the number of locations and CLR , we plot them together with predictability in Figure 4. We can see that the rela-tionship between the limit of predictability and the number of location is really inconsistent on the two check-in datasets according to Figure 4(a). Specifically, when the number of locations is larger than 52, predictability of users from Jiepang is increasing while on Gowalla it is keeping comparatively stable. The reason behind may be that Jiepang users who check in at more locations may also check in more at their regular locations. To justify, we compute the corre-lation between the number of check-ins and the ratio of the number of check-ins to the number of locations ( CLR ). We find that on Jiepang there exists posi-tive Kendall rank correlation (  X  =0 . 155) between them while on Gowalla they are negatively correlated (  X  =  X  0 . 208). This means that when checking in at more locations, the average number of check-ins at locations is increasing on Jiepang. This implies that these users also check in more at these familiar loca-tions. However, a contrast trend is observed on Gowalla. Thus, the correlation between predictability and the number of locations on check-ins seems incompat-ible with the result discovered in [4], that regularity was inversely proportional to N  X  1 4 ,where N is the number of locations. However, according to Figure 4(b), the correlation between the limit of location predictability and CLR is consis-tently positive on both datasets. This indicates larger CLR could imply more repetitive patterns so that users X  behaviour can be more accurately predicted. We have analyzed check-in location predictability on two large scale check-in datasets from Jiepang and Gowalla, and found 25% and 38% potential pre-dictability respectively. Then we have studied the correlation between location predictability and users X  demographics. The results show that the check-in be-haviour of the male users and the young students are more higher predicted. By comparing the correlation between location predictability and the number of lo-cations on two check-in datasets, we have not observed the universal correlation between them. In other words, the number o f locations is not directly correlated to location predictability. However, the number of check-ins and its ratio to the number of locations was significantly and positively correlated to predictability, but the degree of the ratio X  X  correlation to predictability is stronger.
In the future, we will extend our predictability analysis from a single user to user groups and study location predictability in the presence of both real friendship on social network and virtual friendship based on location visiting history. This analysis can be helpful to predict check-ins at novel locations where users have never visited before.

