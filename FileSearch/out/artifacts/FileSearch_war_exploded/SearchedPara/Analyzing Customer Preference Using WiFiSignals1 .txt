 Na Pang 12 , Dali Zhu 12 , Weimiao Feng 12 , Wenjing Rong 12 , and Yinlong Liu 12 Analyzing customer preference using WiFi infrastructure should ideally meet the following four goals: Privacy protection: The system should not result in privacy leakage for cus-Device-free: It should not require the customer to carry on-body sensors or High accuracy: It should not only do coarse grained customer activity recogni-Deployment: It should be easily deployable on Commercial Off-The-Shelf If the above four requirements are satisfied, accurate analytics of customer pref-erence is available to provide critical insights to retail store owner in terms of arrangement of products and efficiency of services. It can be used to recommend customer with some of their potentially interesting items.
 vacy protection, device-free, high accuracy, and deployment. As illustrated in Table 1, computer vision based systems such as Microsoft Kinect [15], Leap [1], and Pharos [11], require the line-of-sight (LOS) with adequate lighting, and bring the new concern in privacy disclosure. Wearable sensor based systems cause inconvenience in occasions such as bathing and swimming, and it leads to extra cost [17]. Recently, researchers exploit the characteristics of wireless sig-nals to  X  X ear X  talking [20] and  X  X ee X  keystrokes by human users [6]. WiTrack [4] designs Frequency Modulated Carrier Wave (FMCW) signals to achieve 3D mo-tion tracking. Wi-Vi [5] leverages an inverse synthetic aperture radar (ISAR) to track moving user through walls. WiHear [20] adopts specialized directional antennas and stepper motors to obtain variations of CSI for hearing talking. However, those specialized devices used in these systems imply high start-up costs. Rasid [12] analyzed the Received Signal Strength (RSS) features for hu-man activity recognition. However, the performance of RSS based techniques suffer from degradation due to indoor interference or multipath fading. tomer preference. We extract the fine-grained Channel State Information (CSI) to analyze the multipath channel features of OFDM subcarriers. The time se-ries of CSI values can reflect the unique characteristics of different activities. To translate this idea into a working system entails several technical challenges:  X  How to derive the CSI affected by customer activity under the subtle signal changes?  X  Which features should be extracted from the time series of CSI values?  X  How to differentiate between different customer activities during the various statistical features from the CSI values? erence analytic system, called PreFi (Customer Pre ference using WiFi ). After calculating various statistical features to create CSI profiles of the activity, K-nearest neighbour (kNN) classifier and majority voting scheme are adopted to analyze customer preference under both line-of-sight (LOS) and non-line-of-sight (NLOS) situations. Unlike cameras, PreFi does not require lighting and works in dark just as well as in light. It requires no dedicated sensor, nor the supervised learning of WiFi signals for pre-defined activities. Experiment results in different scenarios including apartment, meeting room and toilet demonstrate that PreFi can achieve great performance. More specifically, a higher average accuracy of PreFi is observed to be as high as 91 . 4%, and the false positive rate is as low as 5%. In summary, the main contributions are as follows:  X  By exploiting Channel State Information (CSI), we validate the feasibility of non-invasive analyzing customer preference using WiFi signals.  X  We extract CSI features to characterize the difference between multiple cus-tomer.  X  We implement PreFi using COTS WiFi devices and evaluate in different sce-narios. The experiments show that PreFi can analyze customer preference walking in real time, robust to environmental change.
 Channel State Information . Section 3 presents the details of analyzing customer preference using CSI. Experiment and evaluation are presented in Section 4. Section 5 presents the limitations and discussion of our paper. Section 6 discusses the related work. Finally, in Section 7 we conclude our paper. In a wireless network, channel state information (CSI) is used to estimate the channel properties of the wireless communication, and it represents the wireless phenomenon of fading, scattering, and power decay. We consider a flat-fading communications system with N t and N r antennas of the transmitter and the receiver, respectively. The received signals x ( t ) at symbol time t can be expressed in matrix form as where s ( t ) is N t vector of transmit signals at time t , and w ( t ) is N r vector of noise. H ( t ) is the N r  X  N t channel matrix of complex fading coefficients. The estimated H for N sub-carriers can be expressed as where 6 H i is the phase information and | H i | is the amplitude information, respectively. Interface Card (NIC) such as Intel 5300 for 3  X  2 CSI streams of 30 subcarriers in each stream.
 where h i,j is the CSI value for the i th stream of the j th subcarrier. Each CSI stream is the CSI values captured from each transmitter-receiver pair. 3.1 CSI Preprocessing The CSI values extracted from commercial WiFi cards contain noises from var-ious sources. PreFi firstly removes the high-frequency noise through a low-pass filter. Then Principal Component Analysis (PCA) denoising scheme is used to correlate the CSI fluctuations caused by human body activity on the filtered sub-carriers. We extract the first twenty PCA components from the 180 CSI streams and discard the rest, which are mostly noisy components.
 tomer X  X  state, a customer is asked to stand, walk, take items, and put item back while the CSI value is being captured. Figure 1 shows the filtered CSI values of walking, taking item, and putting item back. We experimentally observed that different customer activity results in different CSI variance for each transmit-receive antenna pair, and the CSI variation is larger when the customer is walking than that when the customer is standing. 3.2 Feature Extraction Considering that the length of each normal customer activitiy is no longer than 2 seconds. We choose a sliding window of 4 s in length, moving with a step of 0.2 s. There would be 21 subsegments in a 8 s CSI variance, which will be further features are extracted to characterize the activity as shown in Table 2. 3.3 Classification PreFi uses the obtained notable features to characterize customer activity. Dy-namic time warping (DTW) method is adopted to calculate the distance between features of different activities. It is a dynamic programming based method for achieving minimum distance alignment between different waveforms. DTW han-dles waveforms with different lengths and provides a non-linear mapping of one waveform to another by minimizing the distance between different waveforms. Compared with Eu-clidean distance, DTW determines the minimum distance even through they are distorted or shifted versions of each other [14]. PreFi trains an ensemble of k-nearest neighbour (kNN) classifiers using those features from all TX-RX antenna pairs. Majority voting scheme is used to obtain final result. 4.1 Device and Network WiFi network device. The laptop is with Intel 5300 NIC running Ubuntu 10 . 04, and the router is set as an access point (AP) which runs on 5 GHz with band-width channels of 20 MHz as the transmitter. We chose the 5 GHz band because The laptop has two antennas while the access point has three antennas. We ex-tract the CSI values of 30 Orthogonal Frequency Division Multiplexing (OFDM) subcarriers from IEEE 802 . 11 data frames using a modified driver as described in [10]. The pair of WiFi devices communicate with 100 pkts/s . We use MAT-LAB to analyze the CSI data. 4.2 Experimental Methodology We then evaluate the performance of PreFi in typical environments: (a) a retail store with an entrance and inside store scenarios. (b) a laboratory covering an area of around 9  X  10 m 2 , with plenty of exhibitions. The transmitter and the the receiver, and the green circular represents the transmitter, while the red pentagram represents the location in which the user performs activity. A total of 7 typical daily customer activities in retail store scenario and 5 walking activities Table 3. 4.3 Feasibility of Customer Preference Analysis The accuracy of PreFi  X  X  customer preference analysis is evaluated by asking Figure 4 show that PreFi can get average accuracy of 86 . 5% around the retail store, with an average false positive rate of 4.5%. The results in Figure 5 indicate that overall PreFi has an average accuracy of 88 . 4% in the laboratory, with an average false positive rate of 3.2%. Figure 4c and Figure 5c plot the confusion matrix for the customer activities identification in two scenarios. The results indicate that PreFi can distinguish a set of retail store and laboratory activities with satisfied accuracy. The laboratory environment is in higher accuracy than the retail store environment. The reason is that while we adopt PCA to discover the correlations between CSI streams, the environment is still faced with complex electromagnetic interference, especially for the door of etail store. The accuracy indicates that PreFi is robust in different environments. 4.4 Impact of Multiple APs The meeting room is chosen to evaluate the performance under different dis-tances between the transmitter which is abbreviated to Tx and the receiver which is abbreviated to Rx. The Tx and Rx are placed at opposite sides of the table with distances from 2 to 8 meters. The accuracy in Figure 6 is over 86% when the distance is shorter than 6 meters. It is clear that shorter distance re-sults in higher accuracy, because the received WiFi signals are stronger with shorter communication distances, providing more reliable extraction of CSI to capture the human body movements.
 of different AP densities. The APs are placed at the corner of retail store, labo-ratory, where the receiver laptop is at the center of the scenarios. The Figure 7 shows that the system accuracy increases to 88 . 2% on average when there is three APs, and reaches 91 . 4% on average when the device hears four APs. The reason is that there will be more direct path measurements when more APs are included. Non-invasive abnormal activity sensing based purely on physical layer informa-tion with COTS WiFi infrastructures is a challenging task. The current imple-mentation of PreFi , however, is faced with the following two limitations: 1. Presence of multiple humans: When there are multiple humans moving at 2. Requiring walking: The second limitation is that PreFi analyzes the vari-Existing research work on customer activity recognition can be categorized into three groups: computer vision based, wearable sensor based, and wireless signal based sensing systems. 6.1 Computer Vision based Activity Sensing Popular vision-based sensing systems such as Xbox Kinect [15] and Leap [1] use depth cameras or infra-red LED to achieve 3D human computer interactions. However, the requirement of LOS, the sensitivity to lighting conditions and the introduced privacy disclosure remain practical concerns. Besides, there are many blind areas such as the stairwells and toilets in which mounting the camera is inconvenient or even illegal [19]. 6.2 Wearable Sensor based Activity Sensing Wearable sensor based systems sense the sound, velocity or acceleration on three axises by embedding sensors in belt, coat, or watch [16]. TEXIVE [8] lever-ages smartphone sensors to sense texting operations and driving simultaneously. BodyScope [24] records the sounds to classify activities, such as speaking and laughing. However, additional sensors need to be installed or worn, which is difficult for many people to comply with [2]. 6.3 Wireless Signal based Activity Sensing According to the source of wireless signals, it can be classified in three types.  X  Radio Frequency based Sensing: Doppler radar can be used to measure the speeds of human body. WiTrack [4] designs Frequency Modulated Carrier
Wave (FMCW) signals to achieve 3D motion tracking. Wi-Vi [5] leverages an inverse synthetic aperture radar (ISAR) to track moving user through walls.
However, those specialized devices imply high start-up costs.  X  RSS based Sensing: Received Signal Strength (RSS) fingerprints can be utilized for activity sensing. WiGest [3] leverages RSS values to sense in-air human hand motions. Sigg et al. [18] use software radio to improve the granularity of activity sensing. However, they can only provide coarse-grained recognition due to multi-path fading.  X  CSI based Sensing: Recently, Channel State Information (CSI) are increas-ingly adopted to fine-grained activity sensing since it discriminates multi-path characteristics [13, 21, 25]. WiFigure [13], [7], and [9] have demonstrated the viability of micro-movement sensing with high accuracy. WifiU [22] captures fine-grained gait patterns to identify humans. However, they need the super-vised learning of WiFi signals for pre-defined activities.
 high accuracy , deployment . The abnormal activity should be dynamic, rather than static so that a frequently observe activity can not be abnormal. In this paper, we presented PreFi , a non-invasive WiFi-based abnormal activ-ity sensing system with only two commodity off-the-shelf (COTS) WiFi devices. PreFi does not have the requirement of additional hardware, dedicated wearable sensors, or a supervised learning of wireless signals, and can work under both LOS and NLOS conditions. Non-invasive abnormal activity sensing based purely on physical layer information with COTS WiFi infrastructures is a challenging task. While further improvements are discussed, we believe that PreFi has made some progress by proposing an abnormal activity sensing system that simulta-neously satisfies the privacy protection , device-free , accuracy , deployment , and comprehensiveness capability .

