 Online stores providing subscription services need to extend user subscription periods as long as possible to increase their profits. Conventional recommendation methods recommend items that best coincide with user X  X  interests to maximize the purchase probability, which does not necessarily con-tribute to extend subscription periods. We present a novel recommendation method for subscription services that max-imizes the probability of the subscription period being ex-tended. Our method finds frequent purchase patterns in the long subscription period users, and recommends items for a new user to simulate the found patterns. Using survival analysis techniques, we efficiently extract information from the log data for finding the patterns. Furthermore, we infer user X  X  interests from purchase histories based on maximum entropy models, and use the interests to improve the recom-mendations. Since a longer subscription period is the result of greater user satisfaction, our method benefits users as well as online stores. We evaluate our method using the real log data of an online cartoon distribution service for cell-phone in Japan.
 H.2.8 [ Database Management ]: Database Applications X  Data Mining ; I.2.6 [ Artificial Intelligence ]: Learning; I.5.1 [ Pattern Recognition ]: Model X  Statistical Algorithms Recommendation, User Purchase Pattern, Subscription Ser-vice, Maximum Entropy, Survival Analysis Copyright 2006 ACM 1-59593-339-5/06/0008 ... $ 5.00.
Recommender systems are widely used by online stores [13] because they can improve both user convenience and prof-its. The charges that online store users pay relate to the type of service they use and these can be categorized as ei-ther measured or subscription services. With a measured service, users pay for purchased items individually. With a subscription service, users pay for the periodic (e.g. monthly or yearly) use of, for example, magazines, music, movies, software, and cell-phone services. To increase profits, online stores providing measured services need to encourage users to purchase many items. On the other hand, online stores providing subscription services need to encourage users to extend their subscription periods. Therefore, the desired user behavior for online stores are different between mea-sured and subscription services.

Recommendation is one way to influence user behavior for online stores. Since the desired user behavior differs for measured and subscription services, online stores should rec-ommend items using different strategies. Conventional rec-ommendation methods recommend items that best coincide with user X  X  interests to maximize the purchase probability [5, 8, 11]. With a measured service, these methods can in-crease profits. With a subscription service, however, those methods do not necessarily extend subscription periods, and therefore do not necessarily increase profits.

In this paper, we propose a novel recommendation method that maximizes the probability of the subscription period be-ing extended. Our method finds frequent purchase patterns in long subscription period users, and recommends items for a new user to simulate the found patterns. For example, we may find a pattern in long subscription period users, in which they purchase items from a wide variety of genres. Since the difficulties involved in changing user purchase be-havior differ depending on user X  X  interests, we take user X  X  interests into consideration so that we can make effective recommendations. To find the patterns, we use Cox pro-portional hazards models with survival analysis techniques. To estimate user X  X  interests, we use maximum entropy mod-els. Then, we combine the found patterns and the estimated user X  X  interests in a probabilistically principled framework. Since a longer subscription period is the result of higher user satisfaction, our method benefits both users and on-line stores. Therefore, our method can be seen as a tool for customer relationship management (CRM) [2]. CRM is im-portant in terms of improving relationships between online stores and the users.
A number of recommendation methods have been pro-posed, such as collaborative filtering [11], content filtering [8], and their hybrids [5]. Collaborative filtering is a method for predicting user X  X  interests using other user X  X  interests. Content filtering predicts interests using item information. These approaches recommend items that best coincide with user X  X  interests to maximize the purchase probability. Our aim, which is to extend subscription periods, is different from theirs.

The prediction of subscription periods and the identifi-cation of users that unsubscribe within a period of time, which are known as churn analysis, have been studied by various researchers using survival analysis and data mining techniques [1, 9, 14]. Customer Lifetime Value (LTV) is re-lated to the subscription period. LTV is usually defined as a combination of two components: tenure (or subscription period) and value over time [7]. In subscription services, the value does not change over time because of the fixed charge per given period, and LTV corresponds to the subscription period. Models of LTV have been proposed to facilitate CRM [7]. But they are not used for recommendations.
Piatetsky-Shapiro and Masand [10] and Rosset et al. [12] proposed models for estimating the effects of marketing ac-tivity on subscription periods or LTV. A recommendation can be considered a marketing activity. By focusing on the recommendation of items, our method becomes an auto-matic recommendation framework that can learn from the log data.
The log data usually possessed by online stores providing subscription services are the subscription and the purchase logs. The subscription log consists of the subscribed time, the status (still subscribing or already unsubscribed) and, where relevant, the unsubscribed time of each user. The purchase log consists of the user, the item, and the time of each purchase.
 Consider a set of users U = { u n } N n =1 and a set of items S = { s i } V i =1 .Eachuser u n has subscription period t n status e n ( e n = 1 if unsubscribed, e n = 0 if subscribing). The subscription period t n is obtained from the subscription log as follows: where d start n is the subscribed time of user u n , d end unsubscribed time of user u n ,and d end is the last time at which the log was modified.

Each user is represented by the sequence of purchased the sequence of user u n . The sequence is obtained from the purchase log. We have two sets of features of pur-chase history x ( u n )and y ( u n ,s j ), where x ( u n )isusedfor estimating the user subscription period, and y ( u n used for estimating the user X  X  interests. Examples of fea-tures include: whether the user has purchased item s i ,and whether the user has purchased item s i next to item s j .We rewrite a set of features x ( u n ) in the form of a column vector x n =( x 1 ( u n ) ,x 2 ( u n ) ,... ) T for convenient notation, where x ( u n )isthe j -th feature of x ( u n ). We use the subscription periods at which items are purchased for treating purchase histories as time-dependent variables when we estimate the subscription periods.
Our method recommends item s  X  i that maximizes P ( l | u, r which is the probability of extending the subscription period of user u when item s i is recommended, as follows: where l represents an event that the subscription period is extended, and r i represents an event that item s i is recom-mended. We can also recommend m highest P ( l | u, r i )items, if we want to recommend m items. In real applications, can-didates for recommendation would be a subset of item set S , for example, only items not yet purchased by the user.
Let s j be the item purchased by user u when item s i is rec-ommended. If the recommendation does not influence the user purchase behavior, it is natural to think that the rec-ommendation does not influence the subscription period, ei-ther. Therefore, we assume that extending subscription pe-riod l and recommendation r i are independent conditioned on purchased item s j and user u . By using this assump-tion, P ( l | u, r i ) can be decomposed into two components: Q ( l | u, s j ), which is the probability of the subscription pe-riod being extended when user u purchases item s j ,and R ( s j | u, r i ), which is the probability of item s j being pur-chased when item s i is recommended to user u , as follows: We estimate Q ( l | u, s j )and R ( s j | u, r i ) using Cox propor-tional hazards models and maximum entropy models, re-spectively. We summarize th e framework of our method in Figure 1.
It is generally considered that the subscription period de-pends on the purchase history. Let x be the feature vector of the purchase history of user u ,andwereferto x as the purchase history for the simplicity. We estimate the exten-sion probability given the purchased item Q ( l | u, s j )fromthe hazard function h ( t | x ), which is the rate that users with pur-chase history x subscribing until t unsubscribe at t .Wees-timate h ( t | x ) using survival analysis techniques [4]. If users are still subscribing, we cannot know their true subscription period. These samples are called censored samples. Us-ing survival analysis techniques, we can effectively estimate h ( t | x ) using information found in the data including cen-sored samples.

We assume Cox proportional hazards models for h ( t | x )as follows: where  X  is the unknown parameter vector,  X  T is the trans-pose of  X  ,and  X  0 ( t ) is the baseline hazard function, which represents the hazard function for users with x = 0 .We employ Cox proportional hazards models since the global optimum of the estimation is guaranteed and Q ( l | u, s j be written in a closed form as described below.

The log partial likelihood with Breslow approximation [4] is defined as follows: where D ( t ) is the set of users unsubscribed at t and | its size, R ( t ) is the set of users subscribing at t ,and the feature vector of user u at t . We can estimate unknown parameters  X  by maximizing the log partial likelihood using optimization methods such as quasi-Newton methods [6].
In Cox proportional hazards models, features that have high exp(  X   X  b )( &gt; 1) are characteristic purchase patterns in the long subscription users, and features that have low exp(  X   X  b )( &lt; 1) are characteristic patterns in the short sub-scription users. These patterns a re informative for the online store, for example, to understand the relationship between purchase histories and subscription periods, or to determine new items to be distributed for extending subscription peri-ods.
We explain the estimation of Q ( l | u, s j ), which is the prob-ability of extending the subscription period when user u pur-chases item s j , using hazard function h ( t | x ). Let purchase history of user u ,and x + s j be the updated pur-chase history when item s j is purchased. For the simplicity, we refer to the user when item s j is purchased as u + s j assume that either one of u or u + s j unsubscribed at t while the other being still subscribing. At t , the hazard function probability that u is the one who unsubscribed at t is equal to the probability of extending the subscription period when user u purchases item s j as follows: which is a sigmoid function. We can recommend an item that maximizes Q ( l | u, s j ), however, users may not purchase recommended items. In this c ase, the recommendation is useless as regards extending subscription periods. There-fore, we need to consider whether the recommended item is purchased by the user taking user X  X  interests into consider-ation.
We explain the estimation of R ( s j | u, r i ), the probabil-ity that user u purchases item s j when item s i is recom-mended to user u .Let R ( s j | u ) be the probability that user u purchases item s j without recommendations, where P the probability of item s i being purchased. We assume that the probability increase  X  times as follows: where Z ( u, r i )=1+(  X   X  1) R ( s i | u ) is the normalization term, and  X   X  1.  X  represents the recommendation effect on user purchase behavior, and depends on the way the recom-mendation is presented in the online store, such as the size or position.

If an item matches the user X  X  interests, the probability of the user purchasing the item is high, and if it does not match, the probability is low. Therefore, R ( s j | u )represents the degree of coincidence between the interests of user u and item s j . Since conventional recommendation methods suggest items that coincide with user X  X  interests, we can use conventional methods to obtain R ( s j | u ). We employ maxi-mum entropy models [5], which estimate a probabilistic dis-tribution that maximizes entropy under the constraints of the given data. Maximum entropy models can integrate arbitrary features such as purchase histories and user at-tributes. In maximum entropy models, the probability that user u purchases item s j is: where Z ( u )= tion term, y c is a feature of the purchase history,  X  c is an unknown parameter, and c is an index of each feature. The log likelihood of the maximum entropy model is: where s n k is the k -th item in the purchase sequence of user u ,and u n k is the purchase history of user u n before the k -th item is purchased. We can estimate unknown parameters Cox proportional hazards models, h ( t | x ) .  X  that maximize log likelihood L (  X  ) by using optimization techniques such as quasi-Newton methods. In maximum en-tropy models, we can obtain the global optimum solution. By using a Gaussian prior with a zero mean on unknown pa-rameters  X  , overfitting can be reduced [3]. We use a Gaus-sian prior in our experiments.
We evaluated our method with the log data of an online cartoon distribution service for cell-phones in Japan. With this service, users pay monthly to read cartoons on their cell-phones. Our method is applicable since the service em-ploys a subscription log and a purchase log, and extension of the subscription period increases the profit of the online store. Some cartoons have several volumes, and some users purchased an item more than once. We regarded a cartoon that had several volumes as one item, and the unit time was a day. This service began on 16 August 2004, and the last modification date of the log was 28 October 2005.
With our method, we assume that we can estimate sub-scription periods more precisely using purchase histories. To evaluate this assumption, we compared the Cox proportional hazards models h ( t | x )=  X  0 ( t )exp(  X  T x ) that use purchase histories described in Section 3.3 and models that do not use purchase histories h ( t )=  X  0 ( t ). We used as features whether user u has purchased item s j next to item s i : where we omitted features that occurred fewer than ten times in the purchase histories.

We used three sets of learning and test samples. The learning samples were the log data up to 30 June 2005, 31 July 2005 and 31 August 2005. The test samples were the log data of subscribers on the end date of the learning samples, and the end date of the test samples was 28 October 2005. The number of subscribers, unsubscribers and features were as shown in Table 1.

For the evaluation measurements, we used the average log partial likelihood, which is the log partial likelihood divided by the number of unsubscribers. The higher average log partial likelihood for the test samples indicates the higher predictive performance of the model. Table 2 shows the results. The average log partial likelihoods for the test sam-ples of the Cox proportional hazards models were higher than the model that does not use purchase histories. This result shows that Cox proportional hazards models can pre-dict subscription periods more precisely by using purchase histories. We evaluated the maximum entropy models described in Section 3.5, which estimate the probability that user u pur-chases item s j , R ( s j | u ). We used first-order Markov tran-sitions as features, since we considered the last purchased item revealed the user X  X  interests: We used three sets of learning and test samples. The learn-ing samples were the log data up to 30 June 2005, 31 July 2005 and 31 August 2005, from which we omitted transi-tions to the same item. The test samples were the log data from the end date of the learning samples to 28 October 2005, from which we omitted transitions to the same item and transitions that contained items that had not been dis-tributed during the learning sample period. The number of transitions and items were as shown in Table 3. We com-pared maximum entropy models with uniform distributions and multinomial distributions. Uniform distributions do not use the information in the log data at all. Multinomial dis-tributions use the information of the purchased number of each item by all users, but do not consider the individual in-terests. The unknown parameters of the multinomial distri-bution were estimated by the maximum likelihood method.
We used the average log likelihood for the evaluation mea-surements. Table 4 shows the results. The average log likelihoods of the maximum entropy models for the test samples were higher than uniform and multinomial distri-butions. This means that maximum entropy models can predict user purchase behavior and interest more precisely by using purchase histories. mum entropy model.
In Section 4.1, we showed that Cox proportional hazards models can predict subscription periods, and in Section 4.2, we revealed that maximum entropy models can predict user purchase behavior. Here, we examined the effectiveness of our method by simulation. We simulated user behavior us-ing the Cox proportional hazards model and the maximum entropy model that were estimated using the log data from 16 August 2004 to 28 October 2005. The log data comprised 107 items.

The function of Algorithm 1 is to generate a subscrip-tion period t ,where u is the sequence of purchased items, u s j is the updated sequence when item s j is purchased,  X  is an empty sequence, Bernoulli (  X  ) is the Bernoulli distri-bution with success probability  X  ,and M ultinomial (  X  )is the multinomial distribution of one event with j  X  X  success probability  X  j . First, from line 3 to 4 in Algorithm 1, we decide whether the user unsubscribes or not in unit time using the unsubscription probability in unit time of a sub-scriber h ( t | x ). Second, from line 7 to 8, we decide whether the user purchases or not in unit time using the purchase probability in unit time, g . We assumed that g is constant over subscription period t . The first item that the user pur-chases is determined according to R ( s j ), where R ( s j probability of purchasing item s j first (line 10). If the user has purchased some items, we make a recommendation using our method (line 12), and the item that the user purchases is determined according to R ( s j | u, r  X  i ) (line 13). We estimated unknown parameters  X  0 ( t ), g and R ( s j ) using the log data by the maximum likelihood method.

We compared our method with following recommendation methods: Algorithm 1 Simulate a user in a subscription service 1: Set t  X  0, u  X   X  2: loop 3: Sample r 1  X  Bernoulli ( h ( t | x )) 4: if r 1 is success then 5: break 6: end if 7: Sample r 2  X  Bernoulli ( g ) 8: if r 2 is success then 9: if u =  X  then 10: Sample s j  X  M ultinomial ( R ( s j )) 11: else 12:  X  i  X  arg max i P ( l | u, r i ) 13: Sample s j  X  M ultinomial ( R ( s j | u, r  X  i )) 14: end if 15: Set u  X  u + s j 16: end if 17: Set t  X  t +1 18: end loop 19: Output t We generated 100 , 000 user subscription periods with rec-ommendations by each method in 1  X   X   X  10. We set the maximum subscription period as 365 days. Figure 2 shows the average subscription periods. Our method was more successful than the others in extending subscription periods. The subscription periods became longer with increases in  X  . This result indicates that if recommendations can influence Figure 2: The average subscription periods in simu-lations with parameters estimated from the log data. on user behavior, or  X &gt; 1, our method can extend subscrip-tion periods, and subscription periods can be extended even further by improving the influence of the recommendations. Q Recommend extended subscription periods, although the effect was smaller than with our method. This is because Q Recommend may recommend items that have no probabil-ity of being purchased by the user. On the other hand, our method suggests items taking user X  X  interests into account to improve the recommendations. R Recommend only slightly extended subscription periods because of little correlation between the subscription periods and the user X  X  interests.
In this paper, we proposed a novel recommendation method that encourages users to extend their subscription periods for online stores providing subscription service. We used basic features in the experiments to make the novelty of our framework easy to understand. Our method can use other features such as long distance dependencies or user attributes. Since our method is divided into two modules: the estimation of subscription periods and the estimation of user X  X  interests, it can be further enhanced using survival analysis or collaborative filtering techniques. For example, we can combine our approach with content filtering to es-timate user X  X  interests. Online stores providing measured services are eager to prevent their users from switching to other stores. Therefore, our method can also be used for recommendations in measured services by considering the subscription period as a period of continuous use of the on-line store.

Although we have obtained encouraging results to date, some directions remain in which we must extend our ap-proach before it can become a useful tool for recommenda-tion. First, it is important to improve the Cox proportional hazards model and the feature selection for finding infor-mative purchase patterns in long subscription period users. Second, we need to estimate the influence of recommenda-tions on user purchase behavior from the log data automat-ically. This can be estimated by using the log data of pur-chase histories with and without recommendations. Finally, we want to apply our method to an online store and show how it can extend the subscription periods of real users. [1] W. H. Au, K. C. C. Chan, and X. Yao. A novel [2] M.J.A.BerryandG.S.Linoff. Data Mining [3] S. F. Chen and R. Rosenfeld. A Gaussian prior for [4] M. Cleves, W. W. Gould, and R. Gutierrez. An [5] X. Jin, Y. Zhou, and B. Mobasher. A maximum [6] D. C. Liu and J. Nocedal. On the limited memory [7] D.R.Mani,J.Drew,A.Betz,andP.Datta.Statistics [8] R. J. Mooney and L. Roy. Content-based book [9] M. C. Mozer, R. Wolniewicz, D. B. Grimes, [10] G. Piatetsky-Shapiro and B. Masand. Estimating [11] P. Resnick, N. Iacovou, M. Suchak, P. Bergstrom, and [12] S. Rosset, E. Neumann, U. Eick, and N. Vatnik. [13] J. B. Schafer, J. A. Konstan, and J. Riedl.
 [14] Y. Shono, Y. Takada, N. Komoda, H. Oiso,
