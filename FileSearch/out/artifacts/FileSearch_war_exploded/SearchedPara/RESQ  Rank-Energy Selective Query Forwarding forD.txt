 Selective query forwarding is a promising technique to help scale high-quality and cost-efficient query evaluation in dis-tributed search systems. The basic idea is simple. After a local site receives a query, it determines non-local sites to forward the query to and returns an aggregation of local and non-local results. We introduce X  RESQ  X , a hybrid rank-energy selective query forwarding model. The novel contri-bution of RESQ is to simultaneously consider both ranking quality and energy costs when making forwarding decisions. Using a large-scale query log and publicly-available energy price time series, we demonstrate the ability of RESQ for-warding to achieve favorable tradeoffs between the possibil-ity of returning high ranking query results and savings in temporally-and spatially-varying energy prices.
 H.3.3 [ Information Storage Systems ]: Information Re-trieval System Algorithms, Experimentation, Performance Distributed IR, energy, query forwarding, linear program
Scaling high-quality, cost-effective query evaluation is crit-ical to search system performance. In distributed search systems, selective query forwarding helps improve scalabil-ity by determining which non-local sites a locally-received query should be forwarded to. A recent approach by Cam-bazoglu et al. [1] increases forwarding efficiency when partial (or  X  X on-replicated X ) indexes are employed by locally com-puting an upper bound on the maximum possible ranking of a non-local result for a locally-received query. Based on of-fline results from non-local indexes, a local site only forwards Figure 1: Energy price temporal and spatial varia-tion: (top) NYISO energy prices [7], 15 minute in-tervals; (bottom) EIA energy prices by country [9]. a query to sites that might have a result that would rank within its top-k results. On the other hand, Kayaaslan et al. [6] selectively forward queries in a replicated search sys-tem (i.e., evaluations over full indexes) to reduce operating costs based on differences in site energy prices and avail-able query processing capacity. Local sites forward queries to non-local sites with cheaper energy prices with probabil-ities proportional to the fraction of the local workload that the non-local site could process after evenly distributing its available capacity to sites with higher energy prices.
We propose RESQ (pronounced  X  X escue X ), a hybrid rank-energy selective query forwarding model that obtains the scalability of non-replicated systems and the cost savings of energy-aware approaches. Our idea is to selectively forward queries such that the result ranking guarantee (see Sec. 2) in a non-replicated, geographically-distributed search system is maximized given a budget for spatially-and temporally-varying energy prices, such as those illustrated in Fig. 1. Besides a novel simultaneous consideration of result quality and energy costs, RESQ  X  X  design complements existing work well (e.g., dynamic energy prices, cf. [1]; and non-replicated indexes, cf. [6]). Experiments with query and electricity data demonstrate the merit of RESQ X  X  balanced approach (e.g., an 87% ranking guarantee with 46% energy savings).
In the following, we describe RESQ forwarding (Sec. 2), evaluate its performance (Sec. 3), and summarize (Sec. 4).
We consider a distributed search system consisting of a set of sites S = { S 1 ,S 2 ,...,S n } distant geographically and a partitioned index I where each partial index I i is assigned toasite S i .Whenaquery q is issued to a local site S l , 1  X  l  X  n , the objective is to select a subset of non-local sites to forward q to such that the sum of the non-local result ranking upper bounds r i for evaluating q over I i the  X  X anking guarantee X ) is maximized given the local site X  X  energy price budget.
Formulated as a linear program, RESQ forwarding deci-sions for q maximize the total non-local result rankings: subject to a per-query, site-specific cost constraint C l where c i ( q )=  X  i  X | q | X  p i (and is explained below), and the feasibility constraints: The function c i (  X  ) is the cost to evaluate a query q with | q | terms over index I i at site S i where the spatially-and temporally-varying energy price energy is p i .Asite-specific constant  X  i relates units of energy to query complexity. The x i  X  X  0 , 1 } indicate whether S i will be forwarded q (i.e., whether results from S i will be included in the final aggre-gate returned results).

For S l to obtain actual r i values from non-local site S the query is required to be forwarded and executed (i.e., all sites must execute the query, and the savings from se-lective query forwarding are obviated). Therefore, selective query forwarding uses  X  r i , a locally-computed upper bound on the non-local result rankings (e.g., [1]). However, to sim-plify notation, we use r i instead of  X  r i . Also, local site necessarily has x l = 0 because all non-local ranking esti-mates are relative to the results from evaluating q at S l vector of x i values over all search sites S i ,1  X  i  X  n resents a solution in RESQ forwarding. The price function may consider non-monetary costs as well (e.g., latency or load capacity). However, as defaulting to local evaluation is possible [6], we limit c i to electricity-related costs. an independent, site-tunable parameter that RESQ only as-sumes to be in R + . Consistent with [6], we assume a stable energy price during forwarding and evaluation of an individ-ual query. Lastly, the LP problem is amenable to existing techniques for combinatorial optimization. Upon receiving a query, a (local) search site implements RESQ forwarding in an online, distributed manner. Intu-itively, selecting the (non-local) search sites to forward a query can be viewed as a two-step process: locally bound-ing the non-local result rankings, and optimally selecting the to-be-forwarded-to (non-local) sites based on a tradeoff between ranking quality and energy costs. The RESQ for-warding process is detailed in Algorithm 1, and an example
Query q
Figure 2: An illustration of RESQ forwarding. is illustrated in Fig. 2. The algorithm begins when a site (e.g., S L in Fig. 2) receives a query q at time t .Thelocal site, i.e., the site that received the query, updates the cost information (e.g., p i and  X  i ) about all of the non-local sites (e.g., S 1 ,...,S 8 in Fig. 2), and computes the c i s(Line1). The assumption is that each site receives up-to-date electric-Algorithm 1 RESQ Forwarding Require: ( q,t ), a query q with a timestamp t . 1: { c i ( q ) } | S | i =1  X  UpdateCosts( t ) 2: { r i ( q ) } | S | i =1  X  BoundRankings( q ) 4: R =  X  5: for i =1  X  X  S | do 6: if x i =1 then 7:  X  R  X  Forward( q,S i ) 8: R  X  Merge(  X  R, R ) 9: end if 10: end for 11: return TopK( R ) ity cost information (e.g., site-to-site broadcast or approxi-mation from historical data [6]). Next, upper bounds on the quality of results that could be returned by non-local sites are locally computed (Line 2). Bounding helps eliminate  X  X alse-positive sites, X  i.e., non-local sites that cannot con-tribute results that rank higher than those from the local index. For example, in Fig. 2, S L computes upper bounds (via, for example, [1]) that imply that only S 1 , S 3 , S and S 6 (i.e., the sites enclosed in the blob-like boundary) could possibly return at least one result (if they locally eval-uated q ) with a ranking high enough to make it into the global top-k result set (in contrast to S 2 , S 7 ,and S have upper bounds on their result rankings that are too low to appear in S L  X  X  local top-k ). With the sites guaranteed to be false-positives not selected (i.e., the sites outside the boundary), S L solves the LP problem as formulated in Sec. 2.1 (Line 3). C denotes the set of constraints from Eq. 2 and Eq. 3. For readability, Algorithm 1 does not reflect a possi-ble new value for | S | after eliminating false-positive sites in the previous line (e.g., the call to BoundRankings reduces | S | from 8 to 5 implicitly); in our formulation, the simple solution is to append constraints of x i =0to C for each excluded site (e.g., in Fig. 2, x 2 = x 7 = x 8 = 0). After LPSolve , x 1 = x 3 = x 4 = x 6 = 1, which indicates the sites that might contribute results to the global top-k (i.e., the enclosed sites). This subset (i.e., the shaded, enclosed sites) contributes the maximum result ranking upper bounds (i.e., might have at least one document within the top-k ranking) for a budget-restricted energy cost. The global result set is initialized in Line 4. In Lines 5 X 10, the query q is for-warded (Line 7) to each member of the subset of plausible non-local sites (Line 6). The results returned to S L , denoted  X  R , are then merged into R (Line 8). Finally, in Line 11, the top-k results in R are delivered to the query originator.
The evaluation of RESQ focuses on the tradeoff between ranking quality and energy cost. The reason is that RESQ is a hybrid selective query forwarding algorithm. Using the AOL query log [8] and NYISO electricity prices [7], we make direct comparisons between RESQ, and realistic rank-and energy-only baselines. We describe our experimental setup, methodology, and results in the subsections that follow.
We simulate a non-replicated distributed search system that supports the RESQ forwarding model using Java. We use a combination of the AOL query log [8] and New York In-dependent System Operator (NYISO) day-ahead zonal mar-ket electricity pricing data [7]. The log contains approxi-mately 36 , 000 , 000 query events (queries or subsequent re-sult click-throughs) from over 650 , 000 users. Although con-troversial, the AOL query log is publicly-available and used widely (e.g., [2], [3], and [5]), which simplifies comparisons to past and future results. Existing research has also inves-tigated how to effectively anonymize such query logs (e.g., [4]). For privacy, we do not consider the linguistic meaning of the terms, and we do not attempt to deanonymize users. The electricity data contains publicly-available price reports from a particular New York region in 15-minute intervals for a 1-week duration starting on November 7, 2011. Previous studies (e.g., [6]) have used similar data.

For reproducibility, the code, data, and raw figure values from our study are available online at https://github.com/ resqforwarding/resq .
We train five sites (or data centers) using term frequencies from approximately 18 , 000 , 000 queries, i.e., about half of the query log. The number of data centers is consistent with related studies (e.g., [1]). Testing data are constructed by randomly sampling batches of 1 , 000 , 000 queries from the remaining queries that were not used for training. Each testing set is preprocessed using standard methods. During tests, each data center has a different electricity price series. When a site processes a query, the corresponding electricity price is assigned using the 24-hour time stamp of the query.
Our experiments consist of multiple configurations. Each configuration consists of two settings: a diversity level that represents the variability in the upper bounds on the result rankings from each site, and an energy budget for a local data center that corresponds to C in Eq. 2. We evaluate each configuration using 10 testing sets. The results are av-Figure 3: Average performance curves over all con-figurations for RESQ and baseline B rank . eraged, and 95% confidence intervals are computed. The diversity levels produce result rankings that generate 10 av-erage standard deviations over the approximately 1 , 000 , queries in each testing set with a Pearson correlation coeffi-cient of almost 1. The budget values are the first five mul-tiples of the average weekly energy price. Results over all configurations are reported.
We implement RESQ as presented in Sec. 2.2 and eval-uate it under each of the configurations. We also evalu-ate two baseline selective query forwarding algorithms. The first, denoted B rank , represents the ranking-only approach in [1], which is summarized in Sec. 1. The second, denoted B energy , greedily forwards to non-local sites in increasing order of energy price until a cost budget is exceeded.
The performance of RESQ relative to baseline B rank is illustrated in Fig. 3. The horizontal axis indicates the di-versity in partial indexes, as described in Sec. 3.2. The vertical axis, denoted  X   X  , represents the difference between the ratio of ranking quality upper bounds (or  X  X uarantee factor X ) and the ratio of cumulative energy cost, denoted and  X  e , respectively. The intuition for combined considera-tion of both measures is analogous to F-measure. Formally,  X  functions r and c are notational conveniences that refer to the cumulative result rankings and energy costs in Eq. 1 and Eq. 2, respectively, for RESQ or the baselines. A value of  X  r = 1 indicates that result rankings from RESQ are equivalent to B rank . On the other hand, small values of  X  e indicate low energy costs relative to B rank .Recallthat the rank baseline forwards based on ranking quality only. Intuitively, experiments with large positive values of  X   X  dicate preservation of ranking quality while reducing energy costs. The results demonstrate that RESQ maintains favor-able percentages of the baseline ranking guarantees while reducing energy costs substantially over a range of index di-versity levels and energy cost budgets. For example, with a budget of 2  X  , i.e., twice the average weekly energy price, RESQ achieves 76% of the original ranking guarantee at 54% of the energy cost. When compared to B energy ,energy consumption for a forwarding algorithm should be close to Figure 4: Average performance curves over all con-figurations for RESQ and baseline B energy . Table 1: B rank and B energy  X  r -values for low-, mid-, and high-performing budgets and diversity levels. the greedy baseline. Under such scenario, the best case is  X  e = 1. The intuition is that the energy cost constraint may be considered to be tuned to a desired cost. On the other hand, an increase in ranking quality over the base-line is still desirable. Therefore, we let  X   X  =  X  e  X   X  r  X  the performance curves in Fig. 4, RESQ leverages relatively small differences in energy costs for substantially increased improvement in ranking quality. For example, under an en-ergy budget of 2  X  , RESQ has an energy cost 7% closer to the budget, while increasing the ranking quality by 14%. The improvement is consistent across the parameter settings.
We note that ranking quality thresholding techniques can-not guarantee zero false-positive sites without all non-local sites evaluating a query (which obviates the need for selec-tive query forwarding). Indeed, it is possible that the locally-aggregated results contain only local-results in the global top-k . For example, as mentioned in Sec. 2.2, the non-local sites selected for forwarding might return results that all score lower than documents at the local site. Therefore, the ratio of the result rankings is more relevant to RESQ than the false-positives associated with the underlying threshold-ing technique (e.g., [1]). We examine RESQ  X  X  result rank-ing ratios in Table 1. The  X  r values using the baselines B rank and B energy are presented across all diversity levels (denoted L ) and energy budgets (denoted  X  ) under which low-, medium-, and high-performing (as read from left to right, respectively) ranking quality and energy cost tradeoffs were obtained (e.g.,  X  r values for B rank when  X  = 4 corre-spond to the mid-performing curve 4  X  in Fig. 3). The steady increase in proportion of the baseline ranking result thresh-olds is evident across all settings of  X  and L .Recallthat is inverted for B energy , which makes the decreasing values in the right half of the table indicate better performance. Al-though important to the overall performance illustrated in Fig. 3 and Fig. 4, we omit the  X  e values because they did not show substantial intra-column variation. The reason is that the coarse granularity of energy budgets relative to site en-ergy prices made sites similarly expensive under a particular budget. In this aspect, the results obtained are pessimistic, as the hybrid nature of RESQ allows for maximal savings under nuanced variance in energy prices or budgets. We also point out that a decrease in ranking guarantee is not necessarily equivalent to a downgrade in ranking quality. In-deed, the results of such systems are a function of retrieved document scores, with properties of the underlying bounds determining the possible quality of results aggregated at a local site.
We introduced RESQ ,anovelhybridrank-energyselec-tive forwarding model that simultaneously considers rank-ing quality and energy costs in non-replicated distributed search systems. Experiments with a widely-used query log and publicly-available energy price series demonstrate that RESQ forwarding achieves favorable tradeoffs between the possibility of returning high ranking query results and the costs due to temporally-and spatially-varying energy prices. [1] B. B. Cambazoglu, E. Varol, E. Kayaaslan, C. Aykanat, [2] M. J. Carman, F. Crestani, M. Harvey, and M. Baillie. [3] S. Gurajada and S. K. P. Index tuning for query-log [4] Y. Hong, X. He, J. Vaidya, N. Adam, and V. Atluri. [5] J. Huang and E. N. Efthimiadis. Analyzing and [6] E. Kayaaslan, B. B. Cambazoglu, R. Blanco, F. P. [7] New York Independent System Operator (NYISO). [8] G. Pass, A. Chowdhury, and C. Torgeson. A picture of [9] U.S. Energy Information Administration (EIA).
