 The field of natural language generation (NLG) is one of the last areas of computational linguistics to embrace statistical methods. Over the past decade, statistical NLG has followed two lines of research. The first one, pioneered by Langkilde and Knight (1998), introduces statistics in the generation pro-cess by training a model which reranks candi-date outputs of a handcrafted generator. While their HAL OGEN system uses an n-gram language model trained on news articles, other systems have used hierarchical syntactic models (Bangalore and Rambow, 2000), models trained on user ratings of utterance quality (Walker et al., 2002), or align-ment models trained on speaker-specific corpora (Isard et al., 2006).

A second line of research has focused on intro-ducing statistics at the generation decision level, by training models that find the set of genera-tion parameters maximising an objective function, e.g. producing a target linguistic style (Paiva and Evans, 2005; Mairesse and Walker, 2008), gener-ating the most likely context-free derivations given a corpus (Belz, 2008), or maximising the expected reward using reinforcement learning (Rieser and Lemon, 2009). While such methods do not suffer from the computational cost of an overgeneration phase, they still require a handcrafted generator to define the generation decision space within which statistics can be used to find an optimal solution.
This paper presents B AGEL (Bayesian networks for generation using active learning), an NLG sys-tem that can be fully trained from aligned data. While the main requirement of the generator is to produce natural utterances within a dialogue sys-tem domain, a second objective is to minimise the overall development effort. In this regard, a major advantage of data-driven methods is the shift of the effort from model design and implementation to data annotation. In the case of NLG systems, learning to produce paraphrases can be facilitated by collecting data from a large sample of annota-tors. Our meaning representation should therefore (a) be intuitive enough to be understood by un-trained annotators, and (b) provide useful gener-alisation properties for generating unseen inputs. Section 2 describes B AGEL  X  X  meaning represen-tation, which satisfies both requirements. Sec-tion 3 then details how our meaning representation is mapped to a phrase sequence, using a dynamic Bayesian network with backoff smoothing.

Within a given domain, the same semantic concept can occur in different utterances. Sec-tion 4 details how B AGEL exploits this redundancy to improve generation performance on sparse datasets, by guiding the data collection process using certainty-based active learning (Lewis and Catlett, 1994). We train B AGEL in the informa-tion presentation domain, from a corpus of utter-ances produced by 42 untrained annotators (see Section 5.1). An automated evaluation metric is used to compare preliminary model and training configurations in Section 5.2, while Section 5.3 shows that the resulting system produces natural and informative utterances, according to 18 hu-man judges. Finally, our human evaluation shows that training using active learning significantly im-proves generation performance on sparse datasets, yielding results close to the human gold standard using a fraction of the data. B
AGEL uses a stack-based semantic representa-tion to constrain the sequence of semantic con-cepts to be searched. This representation can be seen as a linearised semantic tree similar to the one previously used for natural language under-standing in the Hidden Vector State model (He and Young, 2005). A stack representation provides useful generalisation properties (see Section 3.1), while the resulting stack sequences are relatively easy to align (see Section 5.1). In the context of dialogue systems, Table 1 illustrates how the input dialogue act is first mapped to a set of stacks of semantic concepts, and then aligned with a word sequence. The bottom concept in the stack will typically be a dialogue act type , e.g. an utterance providing information about the object under dis-cussion ( inform ) or specifying that the request of the user cannot be met ( reject ). Other con-cepts include attributes of that object (e.g., food , area ), values for those attributes (e.g., Chinese , riverside ), as well as special symbols for negat-ing underlying concepts (e.g., not ) or specifying that they are irrelevant (e.g., dontcare ).
The generator X  X  goal is thus finding the most likely realisation given an unordered set of mandatory semantic stacks S m derived from the input dialogue act. For example, s = inform ( area ( centre )) is a mandatory stack associated with the dialogue act in Table 1 (frame 8). While mandatory stacks must all be conveyed in the output realisation, S m does not contain the optional intermediary stacks S i that can refer to (a) general attributes of the object under discus-sion (e.g., inform ( area ) in Table 1), or (b) to concepts that are not in the input at all, which are associated with the singleton stack inform (e.g., phrases expressing the dialogue act type, or clause aggregation operations). For example, the stack sequence in Table 1 contains 3 intermediary stacks for t = 2 , 5 and 7 .

B AGEL  X  X  granularity is defined by the semantic annotation in the training data, rather than external linguistic knowledge about what constitutes a unit of meaning, i.e. contiguous words belonging to the same semantic stack are modelled as an atomic observation unit or phrase . 1 In contrast with word-level models, a major advantage of phrase-based generation models is that they can model long-range dependencies and domain-specific idiomatic phrases with fewer parameters. Dynamic Bayesian networks have been used suc-cessfully for speech recognition, natural language understanding, dialogue management and text-to-speech synthesis (Rabiner, 1989; He and Young, 2005; Lef ` evre, 2006; Thomson and Young, 2010; Tokuda et al., 2000). Such models provide a principled framework for predicting elements in a large structured space, such as required for non-trivial NLG tasks. Additionally, their probabilistic nature makes them suitable for modelling linguis-tic variation, i.e. there can be multiple valid para-phrases for a given input.

B AGEL models the generation task as finding the most likely sequence of realisation phrases R  X  = ( r tory semantic stacks S m , with |S m |  X  L . B AGEL must thus derive the optimal sequence of semantic stacks S  X  that will appear in the utterance given S m , i.e. by inserting intermediary stacks if needed and by performing content ordering. Any num-ber of intermediary stacks can be inserted between two consecutive mandatory stacks, as long as all their concepts are included in either the previous or following mandatory stack, and as long as each stack transition leads to a different stack (see ex-ample in Table 1). Let us define the set of possi-ble stack sequences matching these constraints as Seq ( S m )  X  X  S = ( s 1 ...s L ) s.t. s t  X  X  m  X  X  i } .
We propose a model which estimates the dis-stacks are in bold. tribution P ( R |S m ) from a training set of real-isation phrases aligned with semantic stack se-quences, by marginalising over all stack sequences in Seq ( S m ) :
Inference over the model defined in (1) requires the decoding algorithm to consider all possible or-derings over Seq ( S m ) together with all possible realisations, which is intractable for non-trivial do-mains. We thus make the additional assumption that the most likely sequence of semantic stacks S  X  given S sation phrase sequence:
The semantic stacks are therefore decoded first using the model in Fig. 1 to solve the argmax in (3). The decoded stack sequence S  X  is then treated as observed in the realisation phase, in which the model in Fig. 2 is used to find the real-isation phrase sequence R  X  maximising P ( R | S  X  ) over all phrase sequences of length L = | S  X  | in our vocabulary:
In order to reduce model complexity, we fac-torise our model by conditioning the realisation phrase at time t on the previous phrase r t  X  1 , and the previous, current, and following semantic stacks. The semantic stack s t at time t is assumed Figure 1: Graphical model for the semantic decod-ing phase. Plain arrows indicate smoothed proba-bility distributions, dashed arrows indicate deter-ministic relations, and shaded nodes are observed. The generation of the end semantic stack symbol deterministically triggers the final frame. to depend only on the previous two stacks and the last mandatory stack s u  X  X  m with 1  X  u &lt; t :
While dynamic Bayesian networks typically take sequential inputs, mapping a set of seman-tic stacks to a sequence of phrases is achieved by keeping track of the mandatory stacks that were visited in the current sequence (see stack set tracker variable in Fig. 1), and pruning any se-quence that has not included all mandatory input stacks on reaching the final frame (see observed stack set validator variable in Fig. 1). Since the number of intermediary stacks is not known at de-coding time, the network is unrolled for a fixed number of frames T defining the maximum num-ber of phrases that can be generated (e.g., T = 50 ). The end of the stack sequence is then deter-mined by a special end symbol, which can only be emitted within the T frames once all mandatory stacks have been visited. The probability of the re-sulting utterance is thus computed over all frames up to the end symbol, which determines the length L of S  X  and R  X  . While the decoding constraints enforce that L &gt; |S m | , the search for S  X  requires comparing sequences of different lengths. A con-sequence is that shorter sequences containing only mandatory stacks are likely to be favoured. While future work should investigate length normalisa-tion strategies, we find that the learned transition probabilities are skewed enough to favour stack sequences including intermediary stacks.

Once the topology and the decoding constraints of the network have been defined, any inference al-gorithm can be used to search for S  X  and R  X  . We use the junction tree algorithm implemented in the Graphical Model ToolKit (GMTK) for our exper-iments (Bilmes and Zweig, 2002), however both problems can be solved using a standard Viterbi search given the appropriate state representation. In terms of computational complexity, it is impor-tant to note that the number of stack sequences Seq ( S m ) to search over increases exponentially with the number of input mandatory stacks. Nev-ertheless, we find that real-time performance can be achieved by pruning low probability sequences, without affecting the quality of the solution. 3.1 Generalisation to unseen semantic stacks In order to generalise to semantic stacks which have not been observed during training, the re-alisation phrase r is made dependent on under-specified stack configurations, i.e. the tail l and the head h of the stack. For example, the last stack in Table 1 is associated with the head centre and the tail inform ( area ) . As a re-sult, B AGEL assigns non-zero probabilities to re-alisation phrases in unseen semantic contexts, by backing off to the head and the tail of the stack. A consequence is that B AGEL  X  X  lexical realisa-tion can generalise across contexts. For exam-ple, if reject ( area ( centre )) was never ob-served at training time, P ( r = centre of town | s = reject ( area ( centre ))) will be estimated by backing off to P ( r = centre of town | h = centre ) . B AGEL can thus generate  X  X here are no venues in the centre of town X  if the phrase  X  X entre of town X  was associated with the con-cept centre in a different context, such as inform ( area ( centre )) . The final realisation model is illustrated in Fig. 2: Figure 2: Graphical model for the realisation phase. Dashed arrows indicate deterministic re-lations, and shaded node are observed. Figure 3: Backoff graphs for the semantic decod-ing and realisation models.

Conditional probability distributions are repre-sented as factored language models smoothed us-ing Witten-Bell interpolated backoff smoothing (Bilmes and Kirchhoff, 2003), according to the backoff graphs in Fig. 3. Variables which are the furthest away in time are dropped first, and par-tial stack variables are dropped last as they are ob-served the most.

It is important to note that generating unseen se-mantic stacks requires all possible mandatory se-mantic stacks in the target domain to be prede-fined, in order for all stack unigrams to be assigned a smoothed non-zero probability. 3.2 High cardinality concept abstraction While one should expect a trainable generator to learn multiple lexical realisations for low-cardinality semantic concepts, learning lexical realisations for high-cardinality database entries (e.g., proper names) would increase the number of model parameters prohibitively. We thus divide pre-terminal concepts in the semantic stacks into two types: (a) enumerable attributes whose val-ues are associated with distinct semantic stacks in our model (e.g., inform ( pricerange ( cheap )) ), and (b) non-enumerable attributes whose values are replaced by a generic symbol before train-ing in both the utterance and the semantic stack (e.g., inform ( name ( X ) ). These symbolic values are then replaced in the surface realisation by the corresponding value in the input specification. A consequence is that our model can only learn syn-onymous lexical realisations for enumerable at-tributes. A major issue with trainable NLG systems is the lack of availability of domain-specific data. It is therefore essential to produce NLG models that minimise the data annotation cost.

B AGEL supports the optimisation of the data collection process through active learning, in which the next semantic input to annotate is de-termined by the current model. The probabilis-tic nature of B AGEL allows the use of certainty-based active learning (Lewis and Catlett, 1994), by querying the k semantic inputs for which the model is the least certain about its output real-isation. Given a finite semantic input space I representing all possible dialogue acts in our do-main (i.e., the set of all sets of mandatory seman-tic stacks S m ), B AGEL  X  X  active learning training process iterates over the following steps:
The number of utterances to be queried k should depend on the flexibility of the annotators and the time required for generating all possible utterances in the domain. B
AGEL  X  X  factored language models are trained us-ing the SRILM toolkit (Stolcke, 2002), and de-coding is performed using GMTK X  X  junction tree inference algorithm (Bilmes and Zweig, 2002). Since each active learning iteration requires gen-erating all training utterances in our domain, they are generated using a larger clique pruning thresh-old than the test utterances used for evaluation. 5.1 Corpus collection We train B AGEL in the context of a dialogue system providing information about restaurants in Cambridge. The domain contains two dia-logue act types: (a) inform : presenting infor-mation about a restaurant (see Table 1), and (b) reject : informing that the user X  X  constraints can-not be met (e.g.,  X  X here is no cheap restaurant in the centre X ). Our domain contains 8 restau-rant attributes: name , food , near , pricerange , postcode , phone , address , and area , out of which food , pricerange , and area are treated as enumerable. 3 Our input semantic space is ap-proximated by the set of information presentation dialogue acts produced over 20,000 simulated di-alogues between our statistical dialogue manager (Young et al., 2010) and an agenda-based user simulator (Schatzmann et al., 2007), which results in 202 unique dialogue acts after replacing non-enumerable values by a generic symbol. Each di-alogue act contains an average of 4.48 mandatory semantic stacks.
 As one of our objectives is to test whether B
AGEL can learn from data provided by a large sample of untrained annotators, we collected a corpus of semantically-aligned utterances using Amazon X  X  Mechanical Turk data collection ser-vice. A crucial aspect of data collection for NLG is to ensure that the annotators under-stand the meaning of the semantics to be con-veyed. Annotators were first asked to provide an utterance matching an abstract description of the dialogue act, regardless of the order in which the constraints are presented (e.g., Offer the venue Taj Mahal and provide the information type(restaurant), area(riverside), food(Indian), near(The Red Lion) ). The order of the constraints in the description was randomised to reduce the effect of priming. The annotators were then asked to align the attributes (e.g., Indicate the region of the utterance related to the concept  X  X rea X  ), and the attribute values (e.g., Indicate only the words related to the concept  X  X iverside X  ). Two para-phrases were collected for each dialogue act in our domain, resulting in a total of 404 aligned ut-terances produced by 42 native speakers of En-glish. After manually checking and normalising the dataset, 4 the layered annotations were auto-matically mapped to phrase-level semantic stacks by splitting the utterance into phrases at annotation boundaries. Each annotated utterance is then con-verted into a sequence of symbols such as in Ta-ble 2, which are used to estimate the conditional probability distributions defined in (6) and (8). The resulting vocabulary consists of 52 distinct se-mantic stacks and 109 distinct realisation phrases, with an average of 8.35 phrases per utterance. 5.2 BLEU score evaluation We first evaluate B AGEL using the BLEU auto-mated metric (Papineni et al., 2002), which mea-sures the word n-gram overlap between the gen-erated utterances and the 2 reference paraphrases over a test corpus (with n up to 4). While BLEU suffers from known issues such as a bias towards statistical NLG systems (Reiter and Belz, 2009), it provides useful information when comparing sim-ilar systems. We evaluate B AGEL for different training set sizes, model dependencies, and active learning parameters. Our results are averaged over a 10-fold cross-validation over distinct dialogue acts, i.e. dialogue acts used for testing are not seen at training time, 5 and all systems are tested on the same folds. The training and test sets respectively contain an average of 181 and 21 distinct dialogue acts, and each dialogue act is associated with two paraphrases, resulting in 362 training utterances. Figure 4: BLEU score averaged over a 10-fold cross-validation for different training set sizes and network topologies, using random sampling.
 Results: Fig. 4 shows that adding a dependency on the future semantic stack improves perfor-mances for all training set sizes, despite the added model complexity. Backing off to partial stacks also improves performance, but only for sparse training sets.

Fig. 5 compares the full model trained using random sampling in Fig. 4 with the same model trained using certainty-based active learning, for different values of k . As our dataset only con-tains two paraphrases per dialogue act, the same dialogue act can only be queried twice during the active learning procedure. A consequence is that the training set used for active learning converges towards the randomly sampled set as its size in-creases. Results show that increasing the train-ing set one utterance at a time using active learn-ing ( k = 1 ) significantly outperforms random sampling when using 40, 80, and 100 utterances ( p &lt; . 05 , two-tailed). Increasing the number of utterances to be queried at each iteration to k = 10 results in a smaller performance increase. A possi-Figure 5: BLEU score averaged over a 10-fold cross-validation for different numbers of queries per iteration, using the full model with the query selection criterion (9). Figure 6: BLEU score averaged over a 10-fold cross-validation for different query selection cri-teria, using the full model with k = 1 . ble explanation is that the model is likely to assign low probabilities to similar inputs, thus any value above k = 1 might result in redundant queries within an iteration.

As the length of the semantic stack sequence is not known before decoding, the active learn-ing selection criterion presented in (9) is biased towards longer utterances, which tend to have a lower probability. However, Fig. 6 shows that normalising the log probability by the number of semantic stacks does not improve overall learn-ing performance. Although a possible explanation is that longer inputs tend to contain more infor-mation to learn from, Fig. 6 shows that a base-line selecting the largest remaining semantic input at each iteration performs worse than the active learning scheme for training sets above 20 utter-ances. The full log probability selection criterion defined in (9) is therefore used throughout the rest of the paper (with k = 1 ). 5.3 Human evaluation While automated metrics provide useful informa-tion for comparing different systems, human feed-back is needed to assess (a) the quality of B AGEL  X  X  outputs, and (b) whether training models using ac-tive learning has a significant impact on user per-ceptions. We evaluate B AGEL through a large-scale subjective rating experiment using Amazon X  X  Mechanical Turk service.

For each dialogue act in our domain, partici-pants are presented with a  X  X old standard X  human utterance from our dataset, which they must com-pare with utterances generated by models trained with and without active learning on a set of 20, 40, 100, and 362 utterances (full training set), as well as with the second human utterance in our dataset. See example utterances in Table 3. The judges are then asked to evaluate the informativeness and nat-uralness of each of the 8 utterances on a 5 point likert-scale. Naturalness is defined as whether the utterance could have been produced by a human, and informativeness is defined as whether it con-tains all the information in the gold standard utter-ance. Each utterance is taken from the test folds of the cross-validation experiment presented in Sec-tion 5.2, i.e. the models are trained on up to 90% of the data and the training set does not contain the dialogue act being tested.
 Results: Figs. 7 and 8 compare the naturalness and informativeness scores of each system aver-aged over all 202 dialogue acts. A paired t-test shows that models trained on 40 utterances or less produce utterances that are rated significantly lower than human utterances for both naturalness and informativeness ( p &lt; . 05 , two-tailed). How-ever, models trained on 100 utterances or more do not perform significantly worse than human utter-ances for both dimensions, with a mean difference below .10 over 202 comparisons. Given the large sample size, this result suggests that B AGEL can successfully learn our domain using a fraction of our initial dataset.

As far as the learning method is concerned, a paired t-test shows that models trained on 20 and 40 utterances using active learning significantly outperform models trained using random sam-pling, for both dimensions ( p &lt; . 05 ). The largest increase is observed using 20 utterances, i.e. the naturalness increases by .49 and the informative-ness by .37. When training on 100 utterances, the effect of active learning becomes insignificant. In-learning with 20 utterances, Rand = random sampling. Figure 7: Naturalness mean opinion scores for dif-ferent training set sizes, using random sampling and active learning. Differences for training set sizes of 20 and 40 are all significant ( p &lt; . 05 ). terestingly, while models trained on 100 utterances outperform models trained on 40 utterances using random sampling ( p &lt; . 05 ), they do not signifi-cantly outperform models trained on 40 utterances using active learning ( p = . 15 for naturalness and p = . 41 for informativeness). These results sug-gest that certainty-based active learning is benefi-cial for training a generator from a limited amount of data given the domain size.

Looking back at the results presented in Sec-tion 5.2, we find that the BLEU score correlates with a Pearson correlation coefficient of .42 with the mean naturalness score and .35 with the mean informativeness score, over all folds of all systems tested ( n = 70 , p &lt; . 01 ). This is lower than previous correlations reported by Reiter and Belz (2009) in the shipping forecast domain with non-expert judges ( r = . 80 ), possibly because our do-main is larger and more open to subjectivity. Figure 8: Informativeness mean opinion scores for different training set sizes, using random sampling and active learning. Differences for training set sizes of 20 and 40 are all significant ( p &lt; . 05 ). While most previous work on trainable NLG re-lies on a handcrafted component (see Section 1), recent research has started exploring fully data-driven NLG models.

Factored language models have recently been used for surface realisation within the OpenCCG framework (White et al., 2007; Espinosa et al., 2008). More generally, chart generators for different grammatical formalisms have been trained from syntactic treebanks (White et al., 2007; Nakanishi et al., 2005), as well as from semantically-annotated treebanks (Varges and Mellish, 2001). However, a major difference with our approach is that B AGEL uses domain-specific data to generate a surface form directly from se-mantic concepts, without any syntactic annotation (see Section 7 for further discussion). This work is strongly related to Wong and Mooney X  X  W ASP  X  1 generation system (2007), which combines a language model with an in-verted synchronous CFG parsing model, effec-tively casting the generation task as a translation problem from a meaning representation to natu-ral language. W ASP  X  1 relies on G IZA ++ to align utterances with derivations of the meaning repre-sentation (Och and Ney, 2003). Although early experiments showed that G IZA ++ did not perform well on our data X  X ossibly because of the coarse granularity of our semantic representation X  X uture work should evaluate the generalisation perfor-mance of synchronous CFGs in a dialogue system domain.

Although we do not know of any work on ac-tive learning for NLG, previous work has used active learning for semantic parsing and informa-tion extraction (Thompson et al., 1999; Tang et al., 2002), spoken language understanding (Tur et al., 2003), speech recognition (Hakkani-T  X  ur et al., 2002), word alignment (Sassano, 2002), and more recently for statistical machine translation (Blood-good and Callison-Burch, 2010). While certainty-based methods have been widely used, future work should investigate the performance of committee-based active learning for NLG, in which examples are selected based on the level of disagreement be-tween models trained on subsets of the data (Fre-und et al., 1997). This paper presents and evaluates B AGEL , a sta-tistical language generator that can be trained en-tirely from data, with no handcrafting required be-yond the semantic annotation. All the required subtasks X  X .e. content ordering, aggregation, lex-ical selection and realisation X  X re learned from data using a unified model. To train B AGEL in a di-alogue system domain, we propose a stack-based semantic representation at the phrase level, which is expressive enough to generate natural utterances from unseen inputs, yet simple enough for data to be collected from 42 untrained annotators with a minimal normalisation step. A human evaluation over 202 dialogue acts does not show any differ-ence in naturalness and informativeness between B
AGEL  X  X  outputs and human utterances. Addition-ally, we find that the data collection process can be optimised using active learning, resulting in a significant increase in performance when training data is limited, according to ratings from 18 hu-man judges. 6 These results suggest that the pro-posed framework can largely reduce the develop-ment time of NLG systems.

While this paper only evaluates the most likely realisation given a dialogue act, we believe that B
AGEL  X  X  probabilistic nature and generalisation capabilities are well suited to model the linguis-tic variation resulting from the diversity of annota-tors. Our first objective is thus to evaluate the qual-ity of B AGEL  X  X  n-best outputs, and test whether sampling from the output distribution can improve naturalness and user satisfaction within a dialogue.
Our results suggest that explicitly modelling syntax is not necessary for our domain, possi-bly because of the lack of syntactic complexity compared with formal written language. Never-theless, future work should investigate whether syntactic information can improve performance in more complex domains. For example, the reali-sation phrase can easily be conditioned on syntac-tic constructs governing that phrase, and the recur-sive nature of syntax can be modelled by keeping track of the depth of the current embedded clause. While syntactic information can be included with no human effort by using syntactic parsers, their robustness to dialogue system utterances must first be evaluated.

Finally, recent years have seen HMM-based synthesis models become competitive with unit se-lection methods (Tokuda et al., 2000). Our long term objective is to take advantage of those ad-vances to jointly optimise the language genera-tion and the speech synthesis process, by combin-ing both components into a unified probabilistic concept-to-speech generation model.

