 REGULAR PAPER Sanjay Chawla  X  Pei Sun Abstract We propose a measure, spatial local outlier measure (SLOM), which captures the local behaviour of datum in their spatial neighbourhood. With the help of SLOM, we are able to discern local spatial outliers that are usually missed by global techniques, like  X  X hree standard deviations away from the mean X . Furthermore, the measure takes into account the local stability around a data point and suppresses the reporting of outliers in highly unstable areas, where data are too heterogeneous and the notion of outliers is not meaningful. We prove several properties of SLOM and report experiments on synthetic and real data sets that show that our approach is novel and scalable to large datasets.
 Keywords Spatial local outlier  X  Spatial neighbourhood  X  Oscillating parameter  X  R-trees index  X  Complexity 1 Introduction and related work Of all the data-mining techniques, outlier detection seems closest to the defini-tion of discovering nuggets of information in large databases. When an outlier is detected and determined to be genuine, it can provide insights that can radically change our understanding of the underlying process. We give a historical example of how the discovery of outliers led to a better understanding and prediction of global weather patterns known as El Ni  X  no and La Ni  X  na.
 extreme variations in surface pressure over the equator close to Australia are corre-lated with monsoon rainfall and drought in India and other parts of the world. This variation is captured in a measure, which is now called the Southern Oscillation Index (SOI). The SOI is defined as the normalized surface air-pressure difference between the islands of Tahiti and Darwin, Australia. As shown in the upper graph in Fig. 1 (reprinted from McFadden (2002)), when the SOI index attains outlier values, i.e. when it is two or more standard deviations away from the mean, the sea surface temperature over the Pacific Ocean also rises and falls sharply (lower graph). Thus, a SOI of two standard deviations below the mean corresponds to a rise in surface temperature and is known as El Ni  X  no. The opposite phenomenon, i.e. when SOI is two or more standard deviations above the mean, which corre-sponds to a fall in surface temperature, is known as La Ni  X  na. Notice how, in 1998, the sea surface temperature reached more than 3  X  C above normal and was one of most dramatic El Ni  X  no years in recorded history. Also notice that the relationship between SOI and El Ni  X  no is sharper than that between SOI and La Ni  X  na. serve as a trigger for unlocking secrets about the underlying process that has gen-erated the data.
 definition  X  X n outlier is an observation which deviates so much from other obser-vations as to arouse suspicions that it was generated by a different mechanism X . Several different approaches have been taken in order to operationalize this defi-nition. For example, it is standard to use variations of the Chebyshev X  X  inequality, where  X  and  X  are the mean and variance of a random variable, X , which mod-els the underlying mechanism. When additional information is available, like the distributional assumption of X , this inequality can be sharpened. For example, when X follows a normal distribution, it can be shown that 99.7% of the data lies between three standard deviations, as opposed to 88.8% given by the general Chebyshev X  X  inequality.
 outlier, which was free of any distributional assumptions and was readily general-izable to multidimensional datasets. They gave the following definition of DB(p, of the objects in T lies at a greater distance than D from o  X .
 liers  X  X hree standard deviations away from the mean X . For example, if the dataset T is generated from a normal distribution, with mean  X  and standard deviation  X  , D = 0 . 13  X  . Similar extensions were shown for other well-known distributions, including the Poisson.
 several methods and algorithms (Aggarwal and Yu 2001; Bay and Schwabacher 2003; Angiulli and Pizzuti 2002; Knorr and Ng 1998; Ramaswamy et al. 2000) have been proposed to detect distance-based outliers. However, the outliers de-tected by these methods and algorithms are global outliers. Breunig et al. (2000) argued that, in some situations, local outliers are more important than global out-liers. They proposed the concept of a local outlier factor (LOF), which defines how isolated an object is with respect to its surrounding neighbourhood rather than the whole dataset. Papadimitriou et al. (2003) have also proposed a method, local cor-relation integral (LOCI), to detect local outliers. Their method is similar to LOF except that they use a different definition to define the local neighbourhood. ified because of the qualitative difference between spatial and nonspatial dimen-sions. The attributes that comprise the nonspatial dimensions intrinsically charac-terise the data while the spatial dimensions provide a locational index to the object and are not intrinsic to the object. However, the physical neighbourhood plays a very important role in analysis of spatial data. For example, in Fig. 2 , the data value 8 indexed at location ( 8 , 1 ) is an outlier; however, the same value 8 indexed at ( 3 , 8 ) is not an outlier.
 spatial outlier is a spatially referenced object whose nonspatial attribute values are significantly different from those of other spatially referenced objects in its spatial neighbourhood X .
 cation, using spatial relationships such as distance or adjacency. Comparisons be-tween spatially referenced objects are based on nonspatial attributes. and graph-based outliers. The only difference between them is that they use differ-ent spatial neighbourhood definitions. Multidimensional space-based outliers use Euclidean distances to define spatial neighbourhoods, while graph-based outliers use graph connectivity.
 is the spatial neighbourhood of o . Now, a Chebyshev inequality-like approach liers. Indeed, this is the state of the art (Lu et al. 2003a, 2003b; Shekhar et al. 2001, 2003).
 outliers but may not be able to discover local outliers, which are likely to be of more interest. For example, again consider the data value 8 indexed at location ( 8 , 1 ) in Fig. 2 . Clearly, this point is a local outlier as it forms a local maxima that, even after transformation, it still is within three standard deviations from the mean.
 outliers. In fact, our method will go further and associate a SLOM score with each data point. The SLOM defines the degree of outlierness of each point very much along the lines proposed by Breunig et al. (2000). However, besides the qualitative difference between spatial and nonspatial attributes, spatial data exhibits spatial autocorrelation (nonindependence) and heteroscedasticity (nonconstant variance), both of which must be factored into SLOM. 1.1 Problem definition Together, these two constraints imply that the IID (identical and independent dis-tribution) assumption cannot be assumed to hold in the context of spatial data. 1.2 Key insights and contributions 1. The first insight that guides our approach can be described with the help of an example. Consider the cell with value 8 indexed at location ( 8 , 1 ) in Fig. 2 .
Clearly, in the local neighbourhood, 8 is an outlier. An obvious way to capture the relationship between a point and its neighbours is to define a measure d ( o ) for each point o as where dist ( o , p ) is a definition of (Euclidean) distance between the nonspatial components of o and p and N ( o ) are the neighbouring points of o .
 ence of o can overwhelm p  X  X  relationship with its other neighbours. In or-der to factor out the effect of o on p , a modified measure,  X  d ( o ) ,isdefinedas follows: spatial distance between o and its neighbours. Then define points in the neighbourhood of this point, 0 =  X  d ( p )&lt; d ( p ) = 1 . then  X  d suppresses the effect of o in its neighbourhood. The following two the-orems hold under some conditions. They formalise the relationships between d and  X  d . A proof is given in the Appendix.

The definition of  X  d is similar to that of trimmed mean , where a certain percent-age of the largest and smallest values around the mean are removed (Wilcox 2003). The trimmed mean is less sensitive to outliers like the median but re-tains some of the averaging behaviour of the mean.
 2. The second insight that underpins our approach is that outliers that are in unsta-ble areas should have lower precedence than outliers in stable areas. Stability around a point o can be captured using the variance; however, we have used a statistic that can be deterministically bounded. In particular, we have defined a statistic  X  that captures the net oscillation with respect to the average value around o (details in Sect. 2). For example, Fig. 3 shows the plot of  X  d around than Fig. 3 b . 3. Another novel contribution of our work is related to system integration. All the spatial data remain database in situ. We manage this by exploiting the growing list of spatial features that are now standard features in commercial database systems, such as Oracle9i. In particular, we use R-trees to access the database and spatial sql to retrieve data based on spatial relationships.
 initions that will culminate in the definition of the spatial local outlier measure (SLOM). Along the way, we will explain how each component of SLOM ad-dresses spatial autocorrelation and heteroscedasticity. In Sect. 3, we analyse the complexity of our method and describe two database strategies to efficiently inter-act with the database in order to reduce the I/O overhead. In Sect. 4, we report the results of our experiments on synthetic and real data sets. In Sect. 5, we conclude with a summary and directions for future work. 2 Definitions We now formally define SLOM and prove several properties. Recall that our ob-jective is to design a measure that can capture both spatial autocorrelation and heteroscedasticity (nonconstant variance). We have already defined  X  d in Sect. 1, which factors out the effect of spatial autocorrelation, and now define  X  ,which penalises for oscillating behaviour around a potential outlier.
 like the method used in Breunig et al. (2000). However, this definition has two drawbacks. of an object o . of SLOM = X  .

We begin by quantifying the average of a  X  d in its neighbourhood. 3. We are ready to define SLOM. For a point o , A high value of SLOM indicates that the point is a good candidate for an outlier. The  X  d term is analogous to the expectation of the first derivative of a smooth random variable, while the  X  term is analogous to the standard deviation of the first derivative of a smooth random variable.
 Lemma 1 Fo r a l l o  X  S , 1 /( | N + ( o ) | X  2 )( 1 + dimensionality of the nonspatial attributes.
 Proof After step 4 of computing  X ( o ) , the maximum value of  X ( o ) is | N + ( o ) |  X  2. This happens when  X  d ( p ) is the only value that is greater than (or smaller than) avg ( N + ( o )) . The minimum value of  X ( o ) is 0. After step 5, the maximum value of  X ( o ) becomes 1, and the minimum value becomes 1 / | N + ( o ) | X  2. In step 6, the maximum value of avg {  X  d ( p ) | p  X  N ( o ) } is So, after step 6, the maximum value of  X ( o ) becomes 1 and the minimum value becomes 1 /( | N + ( o ) | X  2 )( 1 + Lemma 2 Fo r a l l o  X  S , 0  X  SLOM(o)  X  Proof The value of  X  d ( o ) is between 0 and value of  X ( o ) is between 1 ( | and  X ( o ) , so its value must be between 0 and 3 Complexity analysis For distance-based outlier detection (Knorr and Ng 1998), the key step is a method to search for nearest neighbours. This search must be performed on the complete dataset and is the computational bottleneck, especially in high-dimensional space. tial information, which is usually bounded by three dimensions. Here, we can use a spatial R-tree index in order to perform this step efficiently.
 neighbours ( k  X  8 for a 2D grid), the calculation of SLOM for the full data set involves the following steps: can take advantage of the summary statistics (min, max, avg) that are stored in the database catalogue. Thus, this step can be done in one database pass and the computational cost is O ( Nd ) ,where d is the number of nonspatial dimensions. 2. To compute  X  d ( o ) , we need to find the spatial neighbours of each object and calculate the distance between them. The cost of a single k-NN query using an R-tree is O ( k log N ) , and the cost of computing the nonspatial distance is round of nearest neighbour queries followed by a summation to compute the neighbourhood average of  X  d ( o ) . The cost of this step is thus O ( Nk log N + dN ) . 4. To compute the SLOM, we multiply the  X  d and  X  for each object. The cost is 5. Finally, we sort the objects by SLOM and report the top-n outliers, for which the cost is O ( N log N ) . 6. Thus, the final cost of the whole operation is O ( Nk log N + kd N ) . data set can be quite large and complicated, especially if the spatial objects are complex polygons (like the boundaries of countries). Even though the R-tree index can speed up the processing of the nearest neighbour search, finding the k nearest neighbours is still a very time-consuming task. We have two options in order to avoid accessing the original spatial data twice (steps 2 and 3 above). ory when we compute  X  d . Then, when computing  X ( O ) , we can access this infor-mation from memory rather than the database. The prerequisite for this is that the main memory should be large enough to hold all relevant information.
 hood information and store it into a table beforehand. When computing  X  d and  X  , we visit this table instead of the original table that stores the spatial information. Because spatial data enjoys slow updates, this is a very attractive option and can result in huge savings in the running time as we can amortise the cost of creating the neighbourhood table over subsequent k-NN queries. 4 Experiments, results and analysis We have carried out detailed experiments on synthetic and real datasets in order to 1. Test whether SLOM can pick up local outliers and suppress the reporting of global outliers in unstable areas. Intuitively, a point is a global outlier, if its de-termination, that it is an outlier, depends on a comparison with all other points in the data set. A point is classified as a local outlier if its determination is based on a comparison with points in its neighbourhood. 2. Compare the SLOM approach with the family of methods to discover spatial outliers proposed in Lu et al. (2003a) and Shekhar et al. (2001, 2003). 3. Test how the running time changes as we vary the number of nearest neighbours used in the experiments.
 in order to carry out the data-mining exercise. In particular, all the spatial k-NN queries are carried out inside the database.
 coming a standard component in commercial and open source DBMS, like Oracle and Postgres, respectively. In particular, these systems provide an R-tree structure to index spatial data and also support extensions of SQL to formulate queries that involve spatial relationships. We used Oracle9i to store all spatial and nonspatial data.
 spatial objects that directly touch its boundaries are defined to be its neighbours. We use the following SQL statement to generate the neighbourhood information: information of each object and an R-tree index is created on it to speed up the processing of this query.
 nearest neighbours, then the following SQL statement can be use to generate the neighbourhood information: 4.1 Results on a synthetic dataset We have created a synthetic data set consisting of one nonspatial attribute in order to explain and compare our method with the prototype method proposed in Lu et al. (2003b) and Shekhar et al. (2001, 2003). We will refer to this method as f defined on the spatial set S , the neighbourhood effect can be captured by the of a statistical test on g , inspired from Chebyshev X  X  inequality, to determine the outliers of f .
 matrix. We used a Gaussian generator to produce the values of nonspatial at-tribute, and they are listed in Fig. 2 . The location of some values were deliberately changed so that all the zeros appeared at the lower-left corner and an 8 showed up at the location ( 8 , 1 ) .
 and SLOM are listed in Table 1 .The  X  d , SLOM and the SLZ matrices are showninFigs. 4 , 5 and 6 , respectively. The objects located at positions ( 0 ( 6 they are located in unstable areas. This can be seen from their SLOM val-are captured as outliers by SLOM but not by SLZ. This means they are local but not global outliers. Again, their SLOM values are 0.17 and 0.25, respec-tively.
 4.2 Results on a real dataset X  X art one consists of spatial and nonspatial information about all the counties in the United States. The two-dimensional spatial information is used to define the spatial neigh-bourhood. For a specific county, all the counties that directly touch its boundaries are defined as its neighbours in this experiment. In order to make the results easily comprehensible, we have selected two nonspatial attributes: area and population density.
 a different effect on the SLOM values. We have standardized the values of each minimum and maximum values of that attribute, respectively.
 large areas or large population densities. However, they are truly local outliers. For example, the area of the Yukon X  X oyukuk county in Alaska is almost twice as big as the area of any of its neighbouring counties, and its population density (except for the North Slope county) is three times smaller. For urban areas, notice that Philadelphia is more outlierish compared with the Bronx even though it has a bigger area and smaller population density, again because its neighbourhood is relatively more stable. 4.3 Results on a real dataset X  X art two The second real data set that we have used is from the U.S. Census Bureau as well. The two-dimensional spatial information is the same as the data set one. We have selected four nonspatial attributes: the proportion of people identified as African American, American Indian (including Eskimo and Aleut), Asian (including Pa-cific Islander), and of Hispanic origin. We standardized them by using the same method introduced in Part One.
 SLOM values and their neighbouring counties is listed in Table 3 . Menominee of Wisconsin, Rolette of North Dakota, Glacier of Montana, Thurston of Ne-The first four counties are dominated by the population of American Indian, Eskimo, or Aleut. The proportions are 0.942, 0.703, 0.595, 0.464, respectively, while in their neighbouring counties, the proportion of American Indian, Eskimo, African American, with proportion 0.836.
 than the proportion of American Indian, Eskimo, or Aleut in the second, third and fourth counties in the Table 3 , the SLOM value is lower than those of these three counties. This is because Petersburg is located in an unsta-ble region X  X ts neighbouring counties also have a high proportion of African Americans.
 Not surprisingly, Menominee and Rolette appear in this list. This means that they are both global and local outliers.
 top five outliers. None of the counties listed in Table 3 and Table 4 were flagged as outliers.
 4.4 Break-up of the total running time The total running time of our algorithm mainly consists of two parts: the time to search the nearest neighbours (NN Search) and the time to calculate the SLOM values that most of the running time is consumed by the nearest-neighbour search. 5 Summary and future work We have proposed a new measure, spatial local outlier measure (SLOM), which captures both spatial autocorrelation and spatial heteroscedasticity (nonconstant variance). The effects of spatial autocorrelation are factored out by a new mea-sure,  X  d , which reduces the effects of outliers on its neighbours. The variance of a neighbourhood is captured by  X ( o ) , which quantifies the oscillation and instability of an area around o . The use of  X  instead of standard deviation was motivated by a desire to deterministically bound a variance-like measure. We have compared our approach with the current state-of-the-art methods and have shown that SLOM is sharper in detecting local outliers. Local outliers may be more interesting than global outliers because they are likely to be less known and therefore more sur-prising. Another novel feature of our approach is related to system integration. The spatial data never leaves the database and we use an R-tree index to carry out nearest neighbour queries directly in the database.
 and discover potentially useful patterns like the Southern Oscillation Index (SOI). Appendix References
