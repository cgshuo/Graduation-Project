 Rank ers such as humans, search engines, and classiers, output full or partial rankings representing preference relations over n items. The absence of numeric scores or the lack of calibration between existing numeric scores output by the rank ers necessitates modeling rankings rather than numeric scores. To effecti vely analyze rank ed data, a statistical model has the follo wing desiderata. (1) Handle efciently a very lar ge number of items n by reverting to partial rather than full rankings. (2) Probability assignment to full and partial rankings should be coherent and contradiction-free. (3) Conduct inference based on training data consisting of partial rankings of dif ferent types. (4) Correct retrie val of the underlying process as training data increases (statistical consistenc y). (5) In the case of lar ge n con vergence of the estimator to the underlying process can be extremely In this paper , we present a model achie ving the abo ve requirements without any parametric assump-tions on the underlying generati ve process. The model is based on the non-parametric Parzen win-dow estimator with a Mallo ws kernel on permutations. By considering partial rankings as censored data we are able to dene the model on both full and partial rankings in a coherent and contradiction-free manner . Furthermore, we are able to estimate the underlying structure based on data containing partial rankings of dif ferent types. We demonstrate computational efcienc y for partial rankings, even in the case of a very lar ge n , by exploiting the combinatorial and algebraic structure of the lat-tice of partial rankings. We start belo w by revie wing basic concepts concerning partially rank ed data (see [1] for further details) and the Mallo ws model and then proceed to dene our non-parametric estimator . We conclude by demonstrating computational efcienc y and some experiments. A permutation is a bijecti ve function : f 1 ;:::;n g ! f 1 ;:::;n g associating with each item i 2 f 1 ;:::;n g a rank ( i ) 2 f 1 ;:::;n g . In other words, ( i ) denotes the rank given to item i and 1 ( i ) denotes the item assigned to rank i . We denote a permutation using the follo wing vertical bar notation 1 (1) j 1 (2) jj 1 ( n ) . For example, the permutation (1) = 2 ; (2) = 3 ; (3) = 1 would be denoted as 3 j 1 j 2 . In this notation the numbers correspond to items and the locations of the items in their corresponding compartments correspond to their ranks. The collection of all permutations of n items forms the non-Abelian symmetric group of order n , denoted by S n , using function composition as the group operation = . We denote the identity permutation by e . The concept of inversions and the result belo w, tak en from [7], will be of great use later on. Denition 1. The inver sion set of a permutation is the set of pair s whose car dinality is denoted by i ( ) def = j U ( ) j .
 For example, i ( e ) = j;j = 0 , and i (3 j 2 j 1 j 4) = jf (1 ; 2) ; (1 ; 3) ; (2 ; 3) gj = 3 . Pr oposition 1 (e.g., [7]) . The map 7! U ( ) is a bijection.
 When n is lar ge, the enormous number of permutations raises dif culties in using the symmetric group for modeling rankings. A reasonable solution is achie ved by considering partial rankings which correspond to cosets of the symmetric group. For example, the subgroup of S n consisting of all permutations that x the top k positions is denoted S 1 ;:::; 1 ;n k = f 2 S n : ( i ) = i; i = 1 ;:::;k g : The right coset S 1 ;:::; 1 ;n k = f : 2 S 1 ;:::; 1 ;n k g is the set of permutations consistent with the ordering of on the k top-rank ed items. It may thus be interpreted as a partial ranking of the top k items, that does not contain any information concerning the relati ve ranking of Figure 1 (left) displays the set of permutations that corresponds to a partial ranking of the top 2 out of 4 items. We generalize this concept to arbitrary partial rankings using the concept of composition. Denition 2. A composition of n is a sequence =( 1 ;:::; Note that in contrast to a partition, in a composition the order of the inte gers matters. A com-position = ( 1 ;:::; r ) corresponds to a partial ranking with 1 items in the rst position, 2 items in the second position and so on. For such a partial ranking it is kno wn that the rst set of 1 items are to be rank ed before the second set of 2 items etc., but no further infor -mation is con veyed about the orderings within each set. The partial ranking S 1 ;:::; 1 ;n k of the top k items is a special case corresponding to = (1 ;:::; 1 ;n k ) . More formally , let N 1 = f 1 ;:::; 1 g ;N 2 = f 1 + 1 ;:::; 1 + 2 g ; ;N r = f 1 + + r 1 + 1 ;:::;n g : Then the subgroup S contains all permutations for which the set equalities ( N i ) = N i ; 8 i holds (all permutations that only permute within each N i ). A partial ranking of type is equi valent to a coset S = f : 2 S ; 2 S n g and the set of such partial rankings forms the quotient space S n = S . The vertical bar notation described abo ve is particularly con venient for denoting partial rankings. We list items 1 ;:::;n separated by vertical bars, indicating that items on the left side of each vertical bar are preferred to (rank ed higher than) items on the right side of the bar . For example, the partial items not separated by a vertical line is meaningless, and for consistenc y we use the con ventional ordering e.g., 1 j 2 ; 3 j 4 rather than 1 j 3 ; 2 j 4 .
 The set of all partial rankings which includes all full rankings 2 S n , is a subset of all possible partial orders on f 1 ;:::;n g . While the formalism of partial rankings in W n cannot realize all partial orderings, it is suf ciently powerful to include man y useful naturally occurring orderings as special cases. Furthermore, as demonstrated in later sections, it enables simplication of the otherwise overwhelming computa-tional dif culty . Special cases include the follo wing partial rankings. In the cases abo ve, we often have a situation where n is lar ge (or even approaching innity as in the third example abo ve) but k is of manageable size. Traditionally , data from each one of the special cases abo ve was modeled using dif ferent tools and was considered fundamentally dif ferent. That problem was aggra vated as dif ferent special cases were usually handled by dif ferent communities such as statistics, computer science, and information retrie val.
 In constructing a statistical model on permutations or cosets, it is essential to relate one permutation to another . We do this using a distance function on permutations d : S n S n ! R that satises the usual metric function properties, and in addition is invariant under item relabeling or right action of the symmetric group [1] d ( ; ) = d ( ; ) 8 ;; 2 S n . There have been man y propositions for such right-in variant distance functions, the most popular of them being Kendall' s tau [3] where I ( x ) = 1 for x &gt; 0 and I ( x ) = 0 otherwise. Kendall' s tau d ( ; ) can be interpreted as the number of pairs of items for which and have opposing orderings (called disconcordant pairs) or the minimum number of adjacent transpositions needed to bring 1 to 1 (adjacent transposition ips a pair of items having adjacent ranks). By right invariance, d ( ; ) = d ( 1 ;e ) which, for Kendall' s tau equals the number of inversions i ( 1 ) . This is an important observ ation that will allo w us to simplify man y expressions concerning Kendall' s tau using the theory of permutation inversions from the combinatorics literature. The Mallo ws model [5] is a simple model on permutations based on Kendall' s tau distance using a location parameter and a spread parameter c (which we often treat as a constant) The normalization term doesn' t depend on and has the closed form as sho wn by the fact that d ( ; ) = i ( 1 ) and the follo wing proposition.
 Pr oposition 2 (e.g., [7]) . For q &gt; 0 , P Model (3) has been moti vated on axiomatic grounds by Mallo ws and has been a major focus of statistical modeling on permutations. A natural extension to partially rank ed data is to consider a partial ranking as censored data equi valent to the set of permutations in its related coset: Fligner and Verducci [2] have sho wn that in the case of = (1 ;:::; 1 ;n k ) the abo ve summation has a closed form expression. Ho we ver, the apparent absence of a closed form formula for more general partial rankings pre vented the widespread use of the abo ve model for lar ge n and encouraged more ad-hoc and heuristic models [1, 6]. This has become especially noticeable due to a new sur ge of interest, especially in the computer science community , in partial ranking models for lar ge n . The ranking lattice presented next enables extending Fligner and Verducci' s closed form to a more general setting which is critical to the practicality of our non-parametric estimator . Partial rankings S relate to each other in a natural way by expressing more general, more specic or inconsistent ordering. We dene belo w the concepts of partially ordered sets and lattices and then relate them to partial rankings by considering the set of partial rankings W n as a lattice. Some of the denitions belo w are tak en from [7], where a thorough introduction to posets can be found. Figure 1: A partial ranking corresponds to a coset or a set of permutations (left). The Hasse diagram of W 3 . Some lines are dotted for 3D visualization purposes (right).
 Denition 3. A partially order ed set or poset ( Q; ) , is a set Q endowed with a binary relation satisfying 8 x;y;z 2 Q (i) ree xibility: x x , (ii) anti-symmetry: x y and y x ) x = y , and (iii) transitivity: x y and y z ) x z .
 We write x y when x y and x 6 = y . We say that y covers x when x y and there is no z 2 Q such that x z y . A nite poset is completely described by its covering relation. The planar Hasse diagram of ( Q; ) is the graph connecting the elements of Q as nodes using edges that correspond to the covering relation. An additional requirement is that if y covers x then y is dra wn higher than x . Two elements x;y are comparable if x y or y x and otherwise are incomparable. The set of partial rankings W n dened in (1) is naturally endo wed with the partial order of ranking renement i.e. if renes or alternati vely if we can get from to by dropping vertical lines [4]. Figure 1 (right) sho ws the Hasse diagram of W 3 .
 A lower bound z of two elements in a poset x;y satises z x and z y . The greatest lower bound of x;y or inmum is a lower bound of x;y that is greater than or equal to any other lower bound of x;y . Inmum, and the analogous concept of supremum are denoted by x ^ y and x _ y or
V f x 1 ;:::;x k g and W f x 1 ;:::;x k g respecti vely . Two elements x;y 2 W n are consistent if there exists a lower bound in W n . Note that consistenc y is a weak er relation than comparability . For inconsistent and incomparable. Using the vertical bar notation, two elements are inconsistent iff there exists two items i;j that appear on opposing sides of a vertical bar in x;y i.e. x = i j j while y = j j i . A poset for which ^ and _ always exist is called a lattice. Lattices satisfy man y useful combinatorial properties -one of which is that the y are completely described by the ^ and _ operations. While the ranking poset is not a lattice, it may be turned into one by augmenting it with a minimum element ^ 0 .
 Pr oposition 3. The union ~ W Proof. Since ~ W n is nite, it is enough to sho w existence of ^ ; _ for pairs of elements [7]. We begin by sho wing existence of x ^ y . If x;y are inconsistent, there is no lower bound in W n and therefore the unique lower bound ^ 0 is also the inmum x ^ y . If x;y are consistent, their inmum may be obtained as follo ws. Since x and y are consistent, we do not have a pair of items i;j appearing as i j j in x and j j i in y . As a result we can form a lower bound z to x;y by starting with a list of numbers and adding the vertical bars that are in either x or y , for example for x = 3 j 1 ; 2 ; 5 j 4 and construction it contains all preferences (encoded by vertical bars) in x and y . It remains to sho w that for every other lower bound z 0 to x and y we have z 0 z . If z 0 is comparable to z , z 0 z since remo ving any vertical bar from z results in an element that is not a lower bound. If z 0 is not comparable to z , then both z;z 0 contain the vertical bars in x and vertical bars in y possibly with some additional ones. By construction z contains only the essential vertical bars to mak e it a lower bound and hence z 0 z , contradicting the assumption that z;z 0 are non-comparable. By Proposition 3.3.1 of [7] a poset for which an inmum is always dened and that has a supremum element is necessarily a lattice. Since we just pro ved that ^ always exists for ~ W n and 1 ;:::;n = W ~ W n , the proof is complete. PSfrag replacements Figure 2: Censored data in the Hasse diagram of ~ W n corresponding to two partial rankings with the same (left) and dif ferent (right) number of vertical bars. The two big triangles correspond to the Hasse diagram of Figure 1 (right) with permutations occup ying the bottom level. The censored data approach to partial ranking described by Equation (5) may be generalized to arbitrary probability models p on S n . Extending a probability model p on S n to ~ W n by dening it to be zero on ~ W n n S n and considering the partial ranking model The function g , when restricted to partial rankings of the same type G = f S : 2 S n g constitutes a distrib ution over G . The relationship between p and g may be more ele gantly described through M  X  obius inversion on lattices: for the functions p;g : ~ W n ! [0 ; 1] dened abo ve we have where : ~ W n ~ W n ! R is the M  X  obius function of the lattice ~ W n [7].
 construct a statistical model on partial rankings directly without reference to an underlying permuta-tion model, e.g. [1, 6]. Ho we ver, doing so may lead to contradicting probabilities in the permutation level i.e. there exists no distrib ution p on S n consistent with the specied values of g at g ( S ) and g ( S ) , 6 = . Figure 2 illustrates this problem for partial rankings with the same (left) and dif ferent (right) number of vertical bars. Verifying that no contradictions exist involv es solving a length y and complicated set of equations. The alternati ve we present of starting with a permutation model p : S n ! R and extending it to g via the M  X  obius inversion is a simple and effecti ve way of avoiding such lack of coherence.
 Identifying partially rank ed training data D = f S parametric Parzen windo w estimator based on the Mallo ws kernel is where we used the fact that j S Model (8) and its partial ranking extension (9) satisfy requirement 3 in Section 1 since D contains partial rankings of possibly dif ferent types. Similarly , by the censored data interpretation of partial rankings, the y satisfy requirement 2. Requirement 4 holds as m;c ! 1 by standard properties of the Parzen windo w estimator . Requirement 5 holds since ^ g in (9) restricted to G = f S : 2 S n g becomes a consistent model on a much smaller probability space. Requirement 1 is demonstrated in the next section by deri ving an efcient computation of (9). In the case of a very lar ge number of items reverting to partial ranking of type is a crucial element. The coherence between ^ p , ^ g and the nature of D are important factors in modeling partially rank ed data. In the next section we sho w that even for n ! 1 (as is nearly the case for web-search), the required computation is feasible as it depends only on the comple xity of the composition characterizing the data D and the partial rankings on which ^ g is evaluated. Computational efcienc y of the inner summations in Equations (8)-(9) is crucial to the practical application of the estimators ^ p; ^ g . By considering how the pairs constituting i ( ) decompose with respect to certain cosets we can obtain efcient computational schemes for (8),(9) .
 Pr oposition 4. The following decomposition of i ( ) with respect to a composition holds Proof. First note that by the right invariance of Kendall' s tau d ( ; ) = i ( 1 ) , we have i ( ) = i ( 1 ) and we may decompose i ( 1 ) instead of i ( ) . The set appearing in the denition of a k ( ) contains all label pairs ( s;t ) that are inversions of 1 and that appear in the k -compartment of the decomposition . The set appearing in the denition of b inversions of 1 and for which s and t appear in the l and k compartments of respecti vely . Since any inversion pair appear in either one or two compartments, the decomposition holds. Decomposition (10) is actually a family of decompositions as it holds for all possible compo-sitions . For example, i ( ) = 4 for = 4 j 1 j 3 j 2 2 S 4 2 = 1 ; 4 j 2 ; 3 , with inversions a ( ) = 1 . The second compartment 2 ; 3 contains the inversion (3 ; 2) and so a 2 ( ) = 1 . The cross compartment inversions are (4 ; 3) ; (4 ; 2) making b sum over all representati ves of the coset 2 S the cross compartmental inversions b constant while the within-compartmental inversions a leads to powerful extensions of Proposition 2 which in turn lead to efcient computation of (8), (9) . Pr oposition 5. For 2 S Proof.

X Abo ve, we used two ideas: (i) disconcordant pairs between two dif ferent compartments of the coset S are invariant under change of the coset representati ve, and (ii) the number of disconcordant pairs within a compartment varies over all possible choices enabling the replacement of the summa-tion by a sum over a lower order symmetric group.
 depends on . The remaining terms depend only on the partial ranking type and thus may be pre-computed and tab ulated for efcient computation. The follo wing two corollaries generalize the well kno wn Proposition 2 to arbitrary cosets enabling efcient computation of (8), (9). Table 1: Computational comple xity for computing Equation (9) for each training example. Notice the independence of the comple xity terms from n .
 Cor ollary 1. P Proof. Using group theory , it can be sho wn that the set equality ( S ) = S ( ) holds. As a result, P Cor ollary 2. The partial ranking extension corr esponding to the Mallows model p is p ( S ) = Proof. Using Corollary 1 we have p ( S ) = X Despite its daunting appearance, the expression in Corollary 2 can be computed relati vely easily . The fraction does not depend on or and in fact may be considered as a normalization constant that may be easily pre-computed and tab ulated. The remaining term is relati vely simple and depends on the location parameter and the coset representati ve . Corollary 2 and Proposition 6 belo w (whose proof is omitted due to lack of space), pro vide efcient computation for the estimators (8), (9) . The comple xity of computing (14) and (8) , (9) for some popular partial ranking types appears in Table 1. Pr oposition 6.
 Figure 3 (top left) compares the average test log-lik elihood between the Mallo ws model and the non-parametric model with dif ferent c as a function of training size averaged over 10 cross validations. We use fully rank ed AP A election data (rankings are ballots for ve AP A presidential candidates), and during each iteration, 30% of the examples are randomly selected for testing. The parameters of the Mallo ws model are estimated by maximum lik elihood. The gure illustrates the adv antage of using a non-parametric estimator over the parametric Mallo ws model given enough training data. Also note when c increases, the non-parametric model approaches the empirical histogram thus per -forming worse for small datasets and better for lar ge datasets. To visualize the adv antage of the non-parametric model over the Mallo ws model we display in Figure 3 (bottom row) their estimated probabilities by scaling the vertices of the permutation polytope proportionally . The displayed poly-tope has vertices corresponding to rankings of 4 items and whose edges correspond to an adjacent transposition (K endall' s tau distance is the shortest path between two vertices). In this case the four rank ed items are mo vies no. 357, 1356, 440, 25 from the EachMo vie dataset containing rankings of 1628 mo vies. Note how the probabilities assigned by the Mallo ws model (left) form a unimodal function centered at 2 j 1 j 3 j 4 while the non-parametric estimator (right) disco vers the true modes 2 j 3 j 1 j 4 and 4 j 1 j 2 j 3 that were undetected by the Mallo ws model. Figure 3 (top right) demonstrates modeling partial rankings of a much lar ger n . We used 10043 rankings from the Jester dataset which contains user rankings of n = 100 jok es. We kept the partial ranking type of the testing data x ed at (5 ;n 5) and experimented with dif ferent censoring of the training data. The gure illustrates the slo wer consistenc y rate for fully rank ed training data and the statistical benet in censoring full rankings in the training data. This striking statistical adv antage demonstrates the achie vement of property 5 in Section 1 and is independent of the computational adv antage obtained from censoring the training data. Figure 3: Top row: Average test log-lik elihood as a function of the training size: Mallo ws model vs. non-parametric model for AP A election data (left) and non-parametric model with dif ferent partial ranking types for Jester data (right). Bottom row: Visualizing estimated probabilities for EachMo vie data by permutation polytopes: Mallo ws model (left) and non-parametric model for c = 2 (right). In this paper , we demonstrate for the rst time a non-tri vial effecti ve modeling frame work satisfying properties 1-5 in Section 1. The key component is our ability to efciently compute (14) for simple partial ranking types and lar ge n . Table 1 indicates the resulting comple xity scales up with comple x-ity of the composition k but is independent of n which is critical for modeling practical situations of k n partial rankings. Experiments sho w the statistical adv antage of the non-parametric partial ranking modeling in addition to its computational feasibility .

