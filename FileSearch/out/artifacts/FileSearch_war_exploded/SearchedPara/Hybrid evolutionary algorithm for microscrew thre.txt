 1. Introduction
At present several prototypes of microfactories have been developed. For example, a desktop machining microfactory (Okazaki and Kitahara, 2000 ; Ooyama et al., 2000 ) developed by the Mechanical Engineering Laboratory in Japan combines machine tools such as lathe, milling machine, press machine and assembly machines such as a transfer arm and a two-fingered hand. This portable microfactory has external dimensions of 625 490 380 mm 3 . Swiss researchers developed methods of precision motion control and microhandling principles for future microfactories ( Bleuler et al., 2000 ). Methodology of sequential generations was proposed to create the required microequipment (Kussul et al., 1996). According to this methodology, the microequipment of each new generation has smaller dimensions and has to be produced using the microequipment of the previous generations. This approach, called  X  X  X icro Equipment Technology X  X  (MET), allows use of low cost components in each generation of microequipment as well as creation of microfactories that are capable of producing low cost microdevices ( Kussul et al., 2002 ).
Creation and evolutionary development of microfactories assumes automation of the mass manufacturing of microparts.
In the same manner, the quality control of both microfactory components and produced microparts should be automated.
Particularities of quality control of microparts make proble-matic application of the quality control methods used for conventional size mechanical parts due to smaller tolerances of microparts in comparison with the conventional parts that require utilization of expensive precise and ultra-precise machine tools ( Kussul et al., 2002 ). Quality control of micromechanical parts such as microscrews requires estimation of parameters of the produced micropart. Once the parameters of the micropart are estimated several criteria can be used for the quality control. For example, estimated parameter values can be compared to theoretical ones or parameter ratios can be matched with a theoretical model.

In this paper we describe a hybrid evolutionary algorithm for estimation of parameters characterizing microscrew thread quality. The proposed method may also be used for parameter estimation of different types of microparts, for example, gears, shafts, etc.

This paper is organized as follows. In Section 2 we discuss the problem of microscrew thread parameter estimation. In Section 3 we present the detailed description of the proposed methodology. Section 4 is dedicated to the experimental results. Discussion and conclusions are presented in Sections 5 and 6. 2. Microscrew thread parameter estimation problem
Knowing parameters characterizing thread quality is an important problem in mechanics. For example, according to Russia X  X  oil industry statistics 50%, of the tubing string failures happen because of the breakages of threaded joints ( Proskurkin, 2003). Field performance control is one of the ways to avoid accidents. Such quality control is important because (according to the same statistics) 80% of the total number of accidents of the down-the-hole equipment happen because of the tubing string failures ( Proskurkin, 2003 ). Therefore, there is a great variety of methods for thread parameter estimation in mechanics: from simple thread gauges to complex optical comparators that use digital readouts ( Adams, 2003 ; Farago and Curtis, 1994 ). Most of these methods are ineffective for the scale of dimensions typical for microparts.

Mechanical methods that use thread gauges do not allow automation of the thread parameter estimation process. More-over, these methods are difficult to apply because, at present, the relative precision of produced microscrews is smaller than the one of screws of conventional dimensions. Therefore, the profile of the real microscrew thread does not correspond completely to the profile of the theoretical thread model due to inaccuracies of manufacturing.

Optical comparators use overlay charts clipped to the screen of the comparator on which an image of a threaded product is projected and aligned to the shape of the chart to see if it meets the specification. Such comparators are ineffective for the same reasons.
The most suitable methods for micromechanics evaluate thread quality from binary images of the thread contour that is extracted from the image of the microscrew thread made with projection lighting ( Vorobel X  et al., 2004 ). Thread parameter estimation is performed using the continuous line that represents the extracted thread contour. One of the most recent methods uses the Hough transform to detect segments of straight lines on the sides of the thread teeth ( Vorobel X  et al., 2004 ). This method allows estimation of the parameters of the thread for each pitch independently. However, this approach has several drawbacks.
First, it is necessary to select a partition of the phase space empirically, which makes process automation impossible. Second, the method does not account for stains (for example, caused by dust particles that stick to the surface of the microscrew) which distort the image substantially. Due to sensitivity of the Hough transform to noise, an image contaminated by dust specks would require application of additional approximation methods in problematic areas.

Another alternative is a machine vision system for micropart manufacturing proposed in ( Baidyk and Kussul, 2004 ). Limited receptive area neural classifier was used to recognize the shape of microscrews. The system had to recognize the shape of each microscrew and to provide necessary information to correct the manufacturing process in case of need. The prototype of the system was tested on shape recognition of 3 mm microscrews.
Artificially created shape distortions were made by incorrect positioning of the cutter during manufacturing. The best recogni-tion rate of 92.5% suggests that this method is promising although still needs improvement.

In this paper we propose a novel method for microscrew thread parameter estimation that avoids the described problems and allows automation of the quality control of microscrews. 3. Hybrid evolutionary algorithm for microscrew thread parameter estimation 3.1. Data collection and preprocessing
The proposed method of microscrew thread parameter estimation uses a machine vision system utilizing one web camera mounted on an optical microscope. Captured images of microscrews are then used to extract the continuous binary contours of the thread profile (further defined as  X  X  X eal contours X  X ).
Next, the shapes of the real contours are approximated by segments of strait lines to form  X  X  X heoretical contours X  X . following way: first, Roberts X  Cross edge detection operator (Roberts, 1965) with a pixel value threshold of 45 is applied to the image. Second, edge thickening algorithm of cellular logic (Baidyk and Kussul, 1999 ) is applied to the extracted edge in order to fill the possible discontinuities. Third, edge thinning algorithm of cellular logic ( Baidyk and Kussul, 1999 ) is applied to thin the resulting continuous contour up to a width of 1 pixel.
The black circle indicates a stain on the image caused by a dust particle. Such stains can distort the extracted contour of the thread profile ( Fig. 1 b and c). The possibility of staining requires a method that is tolerant to noisy data. 3.2. Theoretical contour two parameters: the pitch and the height of the fundamental triangle ( Fig. 2 ). Intuitively it seems logical to use the mathematical model of the metric thread as a theoretical contour, however, it would not account for shape distortions possible during manufacturing.
 parameters of the theoretical contour ( Table 1 , Fig. 3 ). thread parameters) are considered dependent in the metric thread model, but we will consider them independent. Ratios between the experimentally found parameter values with the ones of the mathematical thread model can be used as criteria of thread quality.

Since a microscrew and its real contour can have random position and inclination, three more parameters are required to unambiguously determine the position of the theoretical contour in the rectangular coordinate system (Table 1 , position parameters).
Thus, the estimation procedure is realized in a seven-parameter space. 3.3. Hybrid evolutionary algorithm
The evolutionary algorithm (EA) is a stochastic optimization technique based on biological mechanisms of natural evolution (Back et al., 2000 ). EA is robust to distorted data, and is able to explore multimodal or non-continuous search spaces. EA quickly finds a near-optimal solution, so it is widely used to solve optimization problems that are difficult to solve by other methods (Back et al., 2000 ).

In our model of the EA each new offspring was born from one parent with the influence of the mutations. Each individual in the population was presented as a set of seven genes. Each gene corresponded to the value of one of the seven thread parameters and was coded as a floating-point number. Initial population was created stochastically with values of seven thread parameters being chosen randomly from a predefined range for each individual.

The area between the real and the theoretical contours were used as a fitness function. This area ( Fig. 4 ) was calculated by the following formula: F  X  where x R Min and x R Max are the minimal and maximal values of the real contour abscissa, respectively; C R [ x ] and C T the corresponding ordinate values of the real and the theoretical contour, respectively.

The fitness function (1) works properly only in cases when the theoretical contour completely covers the axis of abscissas and is not suitable in the case when the theoretical contour has more than one ordinate value for one abscissa value. For example, this fitness function would not work in the case of microgears.
To make the proposed method applicable to a wider range of microparts we propose another fitness function. The drawback of the universal fitness function is that it requires more processing power than (1). The universal fitness function calculates the Euclidian distance from each point of the real contour to the nearest point of the theoretical contour and uses the sum of all such distances as the fitness value (2).
 F  X  where N R and N T are the number of points in the real and the and the ordinate values of the i th point of the real contour and x [ j ] and y T [ j ] are the abscissa and the ordinate values of the j th point of the theoretical contour. The universal fitness function (2) requires more than N T times more operations than fitness function (1).

The evolutionary process used dynamic mutations, i.e. genes were changed stochastically within an interval that narrows over time according to the following formula: P 0  X  P  X  1  X  x Z = SV  X  ;  X  3  X  where P 0 is a modified parameter value; P is a parameter value before modification; x is a normally distributed random variable with a mean of 0 and standard deviation 1; Z is a random variable that takes values of 1 and 1 with 0.5 probability; SV is a positive scale variable which increases with each new generation, thus decreasing the search space and therefore making the solution more precise.

We also used an elitism technique, i.e. a fixed number of the best individuals from the previous generation were passed to the next generation without changes.

Combining EA with local search methods to form hybrid evolutionary algorithms (HEA) may be advantageous (Goldberg, 1989 ). EA quickly converges to a near-optimal solution, but it shows poor accuracy in reaching the optimum precisely. Local search (LS) methods are very likely to stop at a solution that is the closest one to the starting point. If an LS method is started near the global optimum it would reach a solution very close to optimal in a good time.
Traditional HEAs apply LS methods to every solution found by an EA. It is computationally expensive and biases the population toward the local optima. The following hybridization method requires less computing power: from the population of solutions being evolved by EA, several best individuals are selected and LS method is applied to them. Solutions found by LS are re-inserted into the population and EA continues its work. In this case, EA is just slightly perturbed while the local search method allows one to decrease the time needed to reach the optimal solution and improve accuracy. Another possible hybridization technique is called post-hybridization ( Gudla and Ganguli, 2005 ) and consists in application of a LS method to some of the best individuals obtained by EA termination of EA. A good review of hybridization methods can be found in ( Gudla and Ganguli, 2005 ; Yen and Lee, 1997).

In this paper we propose to use a multidimensional mini-mization method based on the inverse parabolic interpolation as a
LS method for post-hybridization of EA. The flow chart of the proposed HEA is presented in Fig. 5 .

The parameter optimization in the proposed HEA is performed in two consecutive steps. First EA is run in order to find an area of the search space with high fitness values and then the local search method is applied to the best set of parameters found by EA. Such
HEA, in contrast to LS methods, does not require a precise initial guess and finds good solutions faster than the simple EA. 3.4. Local search method
The multidimensional minimization method based on inverse parabolic interpolation was used as a LS method in the proposed
HEA. The choice of the LS method was influenced by the following reasoning ( Press et al., 2007 ). All multidimensional minimization methods can be divided in two categories on the basis of whether they use only evaluations of the function to be minimized or its gradient as well. Fitness function (1) is not differentiable so we are limited to use methods that do not use gradients. Almost all such methods use one-dimensional minimization which can be described as follows: given an input a function of N variables f and
N -dimensional vectors P (starting point) and n (direction) find the scalar l that minimizes f ( P + l n ), then replace P by P + l n , and replace n by l n . A multidimensional minimization can be implemented by the following simple scheme: take the unit vectors as a set of directions and by means of the chosen one-dimensional minimization method move along the first direction to its minimum; then move along the second direction to its minimum, and so on, cycling through the whole set of directions as many times as necessary, until the function value stops decreasing.
 golden section search, inverse parabolic interpolation and their combinations, for example, Brent X  X  method ( Press et al., 2007 ). In our case we assume that EA stops at least near to the global extreme of the fitness function and that the fit ness function is approximately parabolic in every direction in the neighborhood of the global extreme. The argumentation to make such an assumption is the following: proposed fitness function (1) is a numerical representation of the integral F A  X  existence of a derivative of th e fitness function with unknown analytic form. The smoothness of th e fitness function suggests that it can be approximated in the neighborhood of the global extreme with the first three terms of the Taylor X  X  series which means that it is approximately parabolic in this neighborhood. Then the abscissa value that corresponds to the extreme (minimum) of the parabola fitted through any three points ought to lie at least very near to the abscissa of the global minimum. Therefore, the inverse parabolic interpolation should behave well under given assumptions.
Let us describe in detail one cycle of the proposed local search method applied to the best set of parameters p  X  X  p i ; i  X  1 ; 7  X  found by the EA. 1. For a  X  p i ; i  X  1 ; 7  X  calculate the boundary values by the following formulas: p L i  X  p i  X  1 1 =  X  2  X  SV  X  X  ( p R i  X  p i  X  1  X  1 =  X  2  X  SV  X  X  ( where p i L and p i R stand for the left and the right boundary values, respectively; p i Min and p i Max stand for the minimum and the maximum possible values of p i ; SV is a non-negative scale variable with a value increasing with each new cycle of multidimensional minimization method. 2. Build theoretical contours for two sets of parameters p that consist of the same components as p except for p i that is replaced by p i L and p i R , respectively; and calculate fitness function values F ( p L ) and F ( p R ). If F ( p L ) o F ( p )or F ( p then replace set p by one of the two sets p L or p R that corresponds to the smaller value of the fitness function.
Otherwise calculate the abscissa value corresponding to the minimum of the parabola fitted through F ( p L ), F ( p ) and F ( p the following formula: p i  X  p i then the set p remains unchanged. Otherwise, replace p with the set p n that consists of the same components as p except for p that is replaced by p i n . 3. Take parameter p i +1 if i  X  1 ; 6 and repeat from 1, otherwise finish the minimization cycle.

The local search method stops when the sum of the absolute values of shifts in all the parameters for one cycle is smaller than some predefined threshold value or the maximum number of minimization cycles is reached. 4. Results
The main goal of the performed experiments was to check the effectiveness and the speed of the proposed method in the microscrew parameter estimation as well as to make certain of the method X  X  robustness to noise in the image. Another goal was to compare the proposed HEA with the simple EA in order to estimate the performance gain achieved by hybridization.
Experiments were performed on the image database of 10 microscrews with a diameter of 2 mm and a pitch of 0.4 mm. Pixel dimensions of the database images were of 480 640 pixels. The proposed HEA and EA were implemented in software in Borland C++ Builder 6.0 and tested on a computer with an AMD Athlon 64 X2 6000+3.0 GHz processor and 2 GB RAM. The following set of parameters was used during all the experiments: the number of individuals in generation is 1000; the number of best fitted individuals used to create a new generation is 100; the number of best fitted individuals to be passed to the next generations without changes (elitism technique) is 100; the number of runs of the inverse parabolic minimization based LS method is 10. Time needed to create one generation, build corresponding theoretical contours, calculate fitness function values and select best fitted individuals with given parameters was approximately 1.2 s. Time needed for execution of 10 runs of LS method was approximately 12 s.
 Same experiments were performed utilizing simple EA and HEA. For each number of generations 50 experiments were performed to obtain statistically reliable results. Comparison of results obtained for different numbers of generations for the worst case scenario, the distorted real contour ( Fig. 1 ), is presented in Table 2 . The distorted real contour ( Fig. 1 )is approximated to show that the proposed method is robust to the noise in the image and therefore to the distorted data. Paired t -test ( Montgomery, 2004 ) was used to evaluate significance of difference in mean fitness function values obtained utilizing EA and HEA with an alternative of mean fitness function value for EA being higher than the one for HEA. P -values are presented in Table 2 .

Dependency of the mean value of fitness function that represents deviation between the real and the theoretical contours on the number of generations is approximately hyper-bolic both for EA and HEA. Graphical representation of this dependency is presented in Fig. 6 .

Examples of the distorted real contour ( Fig. 1 ) approximation for different numbers of generations are presented in Figs. 7 X 9 . 5. Discussion
The use of HEA improves the results for all tested numbers of generations ( Table 2 ). The mean rate of improvement depends on the number of generations with the most significant improve-ment (75.14%) achieved for the lowest number of EA generations (5). Results of paired t -test indicate that this improvement is significant for all the numbers of generations except of two highest ones (75, 100).

Taking into account that in our experiments HEA takes as much time as EA with 10 additional generations we can conclude that impact of the LS is large but rather short-lived. That is, hybridization is most effective in terms of time expenditure for lower numbers of generations. However, even in cases of the higher number of generations the proposed hybridization tech-nique allows to improve the obtained results. The final decision on balance between the number of EA generations and the number of LS runs is based on current time constraints. For example, utilization of the higher number of runs of the LS method may be advantageous for tasks with no strict time constraints. In our case, the time needed to manufacture one of the microscrews that were used in experiments is approximately 2 min. Therefore, even with the demand of work-ing in real-time the highest precision of parameter estimation can be assured.

To increase the convergence speed and, therefore, ensure suitability of the proposed method for real-time thread estima-tion of the microscrews produced by a microfactory we used hard selection allowing survival of only the best fitted individuals. Such selection affects the balance between exploration and exploita-tion towards exploitation forcing the search process into the gradient direction and resulting in a path oriented, exploiting search ( Back and Hoffmeister, 1991 ). Exploration of the search space in our case is ensured by stochastic creation of initial population and the mutation mechanism.

At this point of time there is no publicly available image database of microscrew threads. Creating our image database we tried to keep it as consistent as possible with the ones used in
Vorobel X  et al. (2004) and Baidyk and Kussul (2004) in terms of size of the microscrews (2 X 3 mm), the way of taking pictures (web camera mounted on an optical microscope), etc., in order to make the obtained results comparable.

Namely, the thread estimation method that is most suited for micromechanics is Hough transform-based method ( Vorobel X  et al., 2004 ). Both methods perform thread parameter estimation using the continuous line that represents the thread contour extracted from a binary image but the Hough transform-based method requires empirical phase space partitioning which makes the estimation automation impossible. The method proposed in this paper does not pose any problem for automatic implementa-tion. Furthermore, while Hough transform is sensitive to noise and may not work well with the images distorted with stains (for example, caused by dust particles) in this paper we show an example of our method performing successfully on such a distorted image.
 method is fast and effective in estimating thread parameters of microscrews and robust to the noise in the images. These properties make our method suitable for creation of automated systems of real-time non-destructive quality control of both microfactory components and produced microparts. 6. Conclusions
In this paper we propose a novel approach to the problem of microscrew thread parameter estimation based on a hybrid evolutionary algorithm that combines a stochastic evolutionary algorithm with deterministic inverse parabolic interpolation. The proposed method was tested on real data obtained from the image database of 10 microscrews with a diameter of 2 mm and a pitch of 0.4 mm. This method may also be used for parameter estimation of different types of microparts, such as microgears, etc.
The task of parameter estimation of microparts is complicated by lower relative precision which renders many traditional methods of quality control virtually useless. Application of machine vision systems is also complicated because of the stains on images caused by dust particles that distort the image substantially. The proposed method is tolerant to both lower relative precision and staining of the image.

Experimental results show that the proposed method is fast and effective and may be used in automated systems of real-time non-destructive quality control of microscrews.
 Acknowledgments The authors gratefully acknowledge E. Kussul and T. Baidyk,
National Autonomous University of Mexico, for the constructive discussions and helpful comments. The authors gratefully acknowledge Neil Bruce, National Autonomous University of Mexico, for his aid in preparation of this paper.
 References
