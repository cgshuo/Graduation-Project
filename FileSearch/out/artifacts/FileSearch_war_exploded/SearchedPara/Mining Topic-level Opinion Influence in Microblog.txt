 This paper proposes a Topic-Level Opinion Influence Model (TOIM) that simultaneously incorporates topic factor, user opinions and social influence in a unified probabilistic model with two stages learning processes. In the first stage, topic factor and user influence are integrated to generate users X  influential relationship based on different topics; in the sec-ond stage, users X  historical messages and social interaction records are leveraged by TOIM to construct their historical opinions and neighbors X  opinion influence through a statisti-cal learning process, which can be further utilized to predict users X  future opinions on some specific topics. We evaluate our TOIM on a large-scaled dataset from Tencent Weibo , one of the largest microbloggings website in China. The ex-perimental results show that TOIM can better predict users X  opinion than other baseline methods.
 H.2.8 [ Database Management ]: Data Mining; J.4 [ Computer Applications ]: Social and Behavioral Science Opinion Mining, Sentiment Analysis, Social Influence, Topic Modeling
Opinion mining, or sentiment analysis, aims to classify polarity of a document into positive or negative. There X  X e two important factors that should be taken into considera-tions. One, opinions and topics are closely related . The on line discussions around some entities, or objects, often cover a mixture of features/topics related to that entity with dif-ferent preferentials. Different opinions may be expressed by users towards different topics, where users may like some entities but dislike others in the same topic. Two, users X  opinions are subject to social influence. The rise of social media puts the sentiment analysis in the context of social network. Users not only express their individual opinions, but also exchange opinions with others. In the context of opinion mining, social influence refers to the phenomenon that one is inclined to agree (positive influence) or disagree (negative influence) with his/her neighbors X  opinions with different degrees, depending on the influence strengths.
Several opinion mining related studies are in line with our work. Mei et. al [8] proposed Topic-Sentiment Mix-ture (TSM) model that can reveal latent topical facets in a Weblog collections, and their associated sentiments. Lin et. al [5] proposed a joint sentiment/topic (JST) model based on LDA that can detect topic and sentiment simultaneously. Both TSM and JST tried to model topic and sentiment at the same time but social influence is not considered. Our paper tries to incorporate topic modeling, social influence and sentiment analysis into a two-stages model to classify users X  polarities .

We show a typical scenario of topic level opinion influ-ence analysis on Tencent Microblog (The largest Chinese Microblogging Website) in Figure 1. Like Twitter, Weibo users can post messages of up to 140 Chinese characters and follow other users to read their messages. Followers can re-ply to other users X  messages by leaving their own comments, whose opinions can be mined from the comments. Two types of entities (user and message) and multiple types of rela-tions (user posts/comments on message, user replies to an-other user) constitute a heterogenous network built on Ten-cent Weibo. Specifically, Lucy comments on both Lee and Peggy X  X  messages and replies to both of them on the visual effect aspect of the movie Titanic 3D . Given the topological and text information, we aim to generate a topic opinion in-fluence ego-network, with Lucy at the center influenced by Lee and Peggy. Their historical opinion distributions over positive/negative opinion, as well as type ( agree means pos-itive influence while disagree means negative influence) and strength (agree/disagree probability) of the opinion influ-ence between Lucy and Lee/Peggy are calculated. Finally, how can we predict Lucy X  X  further opinion by jointly consid-ering her own opinion preference and opinion influence from Lee and Peggy? To solve the problem in Figure 1, we propose a Topic-level Opinion Influence Model (TOIM) with two stages. In the first stage, we simultaneously incorporate topic factor and social influence in a unified probabilistic model; in the sec-ond stage, users X  historical messages and social interaction records are leveraged by TOIM to construct their historical opinions and neighbors X  opinion influence through a statis-tical learning process, which can be further utilized to pre-dict users X  future opinions towards some specific topics. Our main conclusions include:
This paper is organized as follows: Section 2 defines the problem. Section 3 explains the mechanism of TOIM and illustrates the process of model learning process. Section 4 shows the experimental results and case studies. Section 5 lists related literature and Section 6 concludes the study.
In this section, we formally define our problem of predict-ing a user X  X  opinion regarding certain topic by jointly con-sidering the user X  X  historical opinion and opinion influence from the neighbors. Our problem starts with a Heteroge-neous Social Network on Tencent Weibo, where nodes in-clude all users (i.e. followers and followees) and all messages (i.e. posts and comments), and edges include all actions from users to messages (i.e. post and comment) and all con-nections from users to users (i.e. reply). Specifically, given a query object, a sub-graph G = ( U,M,A,E ) can be extracted from the Heterogeneous Social Network where U = { u i } V is a set of users once posted or commented on messages about the object, M = { m i } D i =1 is a set of messages posted or commented from u i  X  U , A = { ( u i ,m i ) | u i  X  U,m is a set of edges indicating u i posted or commented on m and E = { ( u i ,u j ) | u i ,u j  X  U } is a set of edges indicating u replied to u i . Based on G , we list several formal definitions as follows:
DEFINITION 1. [ Vocabulary ] All distinct words from M constitute a vocabulary W = { w i } X i =1 . According to the word property, we further define noun vocabulary W N = { n where n i is a noun and opinion vocabulary W O = { ow i } where ow j is an adjective or verb. The intuition is that a noun represents a topic while an adjective or verb indicates an opinion of the noun
DEFINITION 2. [ Opinion Words ] In a sentence, the opinion on a noun is often expressed by verbs or adjective. E.g. I like iphone4, Adele is a marvelous singer. Such words are called opinion words . We use O ( n i ) to denote the opinion word of a noun n i and O ( n i )  X  W O . DEFINITION 3. [ Topic-User-Opinion Distribution ] Different users show different opinions towards the same topic. We define a topic-user-opinion distribution  X  = {  X  prefers opinion o j given topic t k and o j  X  X  X  1 , +1 } .
DEFINITION 4. [ Topic Opinion Neighbors ] For user u , all users that u i replied to regarding to topic t k constitute a set ON ( u i ,t k ) which is called u i  X  X  topic opinion neighbors around t k . Each user u j  X  ON ( u i ,t k ) can influence u opinion on t k .

DEFINITION 5. [ Topic-Opinion Influence ] For any u j  X  ON ( u i ,t k ) , the influence of u j on u i can be mea-where  X  k i,j,agree denotes the probability that u i agrees with u  X  X  opinion and  X  k i,j,disagree denotes the probability that u disagrees with u j  X  X  opinion on topic t k .

The most important four parameters are  X (user-topic dis-tribution),  X (topic-noun distribution),  X  and  X , which bind the user, topic, opinion and influence in an integrated model; we use a two stage probability based learning process to learn this model. Our task can be reduced to the following two steps:
We use gibbs sampling [10] to estimate  X  (User-Topic dis-tributions) and  X  (Topic-Noun distributions), with two prior hyperparameters  X  and  X  , respectively. Assuming that u posted a message and u j replied to u i by adding a comment. If the l th noun found in u i  X  X  message is n h , we sample a topic for u i based on Equation 1.
 where z l = t k denotes the assignment of the l th noun in topic t and z  X  l denotes all topic assignments not including n h C xz and C  X  l zw denote the number of times topic z is assigned to user x , and noun w is assigned to topic z respectively, not including the current assignment for the l th noun. For user u j , if n h also occurs in u j  X  X  replying message, n also assigned to topic t k and t k is assigned to user u j all other nouns in u j  X  X  replying message, the assignment of words and topics are the executed as the same probability as shown in Equation 1. The final  X  and  X  can be estimated by:
Message level sentiment analysis captures the opin-ion word O ( n i ) for a noun n i and judge the polarity of O ( n i ) in the context of a message. First, a parse tree(http://code.google.com/p/fudannlp/downloads/list) is constructed to exhibit the syntactic structure of a sentence and dependency relations between words. Consequently, O ( n i ) can be spotted by analyzing the structure of parse tree. Second, the polarity of O ( n i ) is judged by searching a corpus of Chinese sentimental words lexicon provided by Ts-inghua NLP group(http://nlp.csai.tsinghua.edu.cn/site2/), which consists of 5,567 positive and 4,479 negative words. Besides, negation word and adversative relation are also con-sidered.

Based on our experiment, the number of n i  X  O ( n i ) pairs are usually small, due to the short and noisy feature of mi-croblog messages. In order to overcome the limitation of data sparsity, we consider the statistical co-occrrence rela-tions from all messages we collected. For each distinct noun n i  X  W N , we find out all adjectives/verbs ow i  X  W O that co-occur with n i in all messages and pick out the top 20 most frequent co-occurrent ow 1 ,...,ow 20 , which constitutes a set OS ( n j ). For each ow j  X  OS ( n j ), we define a statistical dependence(SD) : where CO ( n i ,o j ) denotes the total number of co-occurent frequency of n i and ow j , and AV EDIS ( n i ,ow j ) denotes the average distance of n i and ow j in all their co-occurrent messages. Then, given a message, if O ( n i ) is not found for n i through parse tree, we can calculate SD ( n i ,ow j shown in Equation 3 and finally obtain a O ( n i ):
User-level opinion regarding a topic can be easily obtained through aggregation of all message-level opinion records. Tan et. al [11] applies Factor Graph to predict users X  opinion towards different aspects of a certain event, but they do not consider obtaining users X  opinions from their shared information by applying semantic analysis technol-ogy, they also do not take topic information into consid-erations. In this paper, we define two counters C C i,  X  1 , i = 1 ,...,V,k = 1 ,...,K to record the number of times that user u i expresses positive or negative opinions towards topic t k by scanning all u i  X  X  messages. Then  X  can be esti-mated as:
In addition, we define another two counters C k i,j,agree C i,j,disagree to record the number of times u i and u j agree or disagree on topic k by scanning all their  X  X ost-reply X  mes-sages. Then  X  can be estimated as: the strength of tie is also important to determine the opinion influence from neighbors, regardless of positive or negative influence. Especially, for u i  X  ON ( u j ,t k ), we calculate the strength of relation by:
In many cases, given a pair u i and u j , though both of their opinions can be detected, their agreement could not be judged, for example, user A supports object X while user B supports Y on the same topic Z , if X and Y are opposite, then A disagrees with B , else, A agrees with B . To solve the problem, a pair corpus CoE is generated by ap-plying Topic Models and manual annotation, which consists of 2,104 pairs of objects. If object X and Y are opposite, then CoE ( X,Y ) = 0, otherwise CoE ( X,Y ) = 1.

There also exist many cases that CoE ( X,Y ) are not found; for those situations, other information is utilized to detect the agree/disagree relationship between two users, in addition to the content of their messages. Based on [3, 11], users X  popularity, the communication frequency and inter-esting similarity between two users will have a high impact on their opinion influences, thus a metric Opinion Agreement Index (OAI) is introduced to quantify the opinion influence between u i on u j , when their information is insufficient. Due to the limitation of space, the detail is omitted.
Our ultimate goal is to predict a user X  X  opinion about a topic given his/her own opinion preference and his/her neighbor X  X  opinion. First, we need to estimate four parame-ters  X ,  X ,  X  and  X . A gibbs-sampling based parameter esti-mation algorithm is proposed, where topic modeling, senti-ment analysis and influence analysis are interwoven together, parse tree and OAI are used to detect the opinion polarity. When the iteration is done, the four parameters are calcu-lated.

Based on the learning results, we would like to predict users X  opinion towards some objects with different topic dis-tributions (eg, a new movie, the trend of stock price, a fa-mous person et al.). Two factors are taken into consideration for opinion prediction. First, the historical records of topic preference and opinion distribution learned from TOIM; Sec-ond, the historical opinions of neighbors and their influence types and strengths learned from TOIM. The prediction re-sult is sampled from a sum-of-weighted probability combin-ing the two factor together as a random process. Details are omitted due to the space limitation. The whole data set from Tencent Weibo is crawled from Oct 07, 2011 to Jan 05, 2012, which contains about av-erage 40,000,000 daily messages. Three objects that are popular among Tencent Weibo during the 3 months are se-lected: Muammar Gaddafi, The Flowers of War (Chinese movie),Chinese economics , which are denoted by O 1 to O 3 The statistics are summarized in Table 1. For each object, all messages are ranked based on temporal order and the last 200 hundred are selected as testing data. Then we have total number of 1,000 messages as testing data. The rest messages are used for training.
Three algorithms are selected as baseline methods for comparison with TOIM: SVM (Support Vector Machine: http://svmlight.joachims.org/), CRF (Conditional Random Field) and JST (Joint Sentiment Topic). SVM and CRF are supervised algorithms, so we construct the training data by using parse tree and opinion detection technology to auto la-bel 5,746 messages with standard grammar structures, The attributes adopted for labelling include user name, topic in-formation, key words and their grammar related words, such as verbs, adjectives. For CRF, we adopt the code provided by Tang, et al [13] in 2011. JST is developed based on Lin X  X  work [5], the parameters assignment is the same with TOIM. None of the above three algorithms consider the topic-level social influences as TOIM does. We also apply Map-Reduce strategy to improve the efficiency of TOIM. The precision is used to compare the prediction performance for all four algorithms. All algorithms are implemented using C++ and all experiments are performed on a servers cluster with 36 machines, all the data is stored in HDFS system for Map-Reduce processing. Figure 2 shows that the precision of TOIM correlates with the number of topics. Specifically, the precision rises as the number of topics becomes larger (Because a small number of topics can not accurately de-tect users X  specific topic preferences), with the maximum value around 75%. By contrast the precisions of the other three algorithms are lower than TOIM and do not exhibit correlation with the number of topics(They are assigned as an attribute without considering the logic relationships with other variables).
TOIM can be applied to detect and analyze the public opinions around some topics. We use O 3 as a case study example.
 Figure 3 shows the relation between public opinion and Chinese economic. Specifically, Figure 3(a) exhibits the pos-itive/negative opinion distribution of random selected 1,000 active users over the economics topic under O 3 . Obviously, many users are more concerned about development of Chi-nese economics, although China has achieved great economic success. Such concern corresponds to some important prob-lems of Chinese economics, like extremely high house price Total 2,350,372 959,918 145,327 O 1 320,176 114,382 24,382 O 2 591,433 243,876 31,432
O 3 742,853 298,764 38,796 and larger gap between rich and poor. Figure 3(b) shows that the changes of all users X  positive attitude toward the topic finance market under O 3 , has a high correlation with China Hushen-300 Index (An important Financial Index in China) shown in Figure 3(c). It implies that the public opin-ions can reflect the real financial situation. Since the introduction of LDA model [2], various extended LDA models have been used for topic extraction from large-scale corpora. Rosen-Zvi et al. [10] introduced the Author-Topic (AT) model, which includes authorship as a latent variable. Ramage et al. [9] introduced Labeled LDA to su-pervise the generation of topics via user tags. Topic models can also be utilized in sentiment analysis to correlate senti-ment with topics [8].
Most of related researches mainly focused on identification of sentimental object [6], or detection of object X  X  sentimental polarity [14] without considering the topic aspects. Mei et. al [8] and Lin et. al [5] incorporated topic models and senti-ment analysis without considering the social influence. Our work attempts to integrate topic models, sentiment analy-sis and social influence together into a two-stage probability model.
Social influence analysis has been a hot research topic in social network research, including the existence of social in-fluence [1], the influence maximization problem [4], and the influence at topic level [7, 12]. Those researches provide us a new perspective to investigate opinion mining from social influence perspective.
In this paper, we study a novel problem of social opinion influence on different topics in Tencent microblog. We pro-posed a Topic-level Opinion Influence Model (TOIM) to for-malize this problem in a unified framework with two stages. in the first stage, we combine topics with users X  influence to construct topic based influential relationship; in the sec-ond stage, Users X  historical messages and social interaction records are leveraged by TOIM to construct their historical opinions and neighbors X  opinion influence, which can be fur-ther utilized to predict users X  future opinions towards some specific topics. We experiment on Tencent Weibo and the results show that the proposed TOIM can effectively model social opinion influence and topic simultaneously and clearly outperforms baseline methods for opinion prediction. 2 (c) O 3
This paper is supported by China Post Doc Fund-ing(2012M510027). National Basic Research Program of China(No.2011CB302302). He Gaoji Project, Ten-cent Company(No.2011ZX-01042-001-002). The National Natural Science Foundation of China(NSFC Program No.71072037). [1] A. Anagnostopoulos, R. Kumar, and M. Mahdian.
 [2] D. M. Blei, A. Y. Ng, and M. I. Jordan. Latent [3] P. H. C. Guerra, A. Veloso, W. M. Jr., and [4] D. Kempe, J. Kleinberg, and E. Tardos. Maximizing [5] C. Lin and Y. He. Joint sentiment/topic model for [6] H. Liu, Y. Zhao, B. Qin, and T. Liu. Comment target [7] L. Liu, J. Tang, J. Han, M. Jiang, and S. Yang. [8] Q. Mei, X. Ling, M. Wondra, H. Su, and C. Zhai. [9] D. Ramage, D. Hall, R. Nallapati, and C. D. Manning. [10] M. Rosen-Zvi, T. Griffiths, M. Steyvers, and [11] C. Tan, L. Lee, J. Tang, L. Jiang, M. Zhou, and P. Li. [12] J. Tang, J. Sun, C. Wang, and Z. Yang. Social [13] X. Xin, J. Li, J. Tang, and Q. Luo. Academic [14] Z. Zhai, B. Liu, H. Xu, and P. Jia. Constrained lda for
