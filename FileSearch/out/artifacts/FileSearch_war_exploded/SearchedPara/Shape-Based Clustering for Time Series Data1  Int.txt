 Time series data mining is increasingly an active research area since time series data are ubiquitous, appearing in various domains including medicine [15], ge-ology [13], etc. One of its main mining tasks is clustering, which is a method to seperate unlabeled data into their natural groupings. In many applications related to time series data [14], k -means clustering [2] is g enerally used with the Euclidean distance function and amplitude averaging (arithmetic mean) as an averaging method.

Although the Euclidean distance is popular and simple, it is not suitable for time series data because its distance between two sequences is calculated in one-to-one manner. As a result, k -means with Euclidean d istance does not clus-ter well because time shifting among data sequences in the same class usually occurs. In time series mining, especially in time series classification, Dynamic Time Warping (DTW) [1] distance has b een proved to give more accurate re-sults than Euclidean distance. Unfortunately, k -means clustering with the DTW distance still does not work practically [8][7] because current averaging function does not return a characteristic-preserving averaging result. Traditional k -means clustering fails to return a correct clustering result since this cluster centers do not reflect characteristics of the data, as shown in Fig. 1. In this work, we will demonstrate that our proposed method can resolve this problem.
We propose a novel method called Shape-based Clustering for Time Series (SCTS) which incorporates k -means clustering and DTW distance measure, to-gether with our new averaging method, called Ranking Shape-based Template Matching Framework (RSTMF) extended from Shape-based Template Match-ing Framework (STMF) [10] for classification. Unlike STMF, our RSTMF uses distances from clustering to approxim ate an order of sequences to be averaged, giving a few orders of magnitude speedup comparing to STMF. Our evaluation also shows that our proposed method outperforms other well-known clustering techniques in terms of accuracy and criterion based on known ground truth. In addition, the accuracy of our proposed method can future improve when a global constraint [11] is utilized in distance calculation and data averaging.
The rest of the paper is organized as follows. In section 2 and 3, we offer back-ground knowledge and related works. In section 4, we explain our new frame-work for time series clustering, which is Shape-based Clustering for Time Series (SCTS). The experiments and results are shown in section 5. Finally, conclusions areprovidedinsection6. This section provides background knowledge on k -means clustering, Dynamic Time Warping (DTW) distance measure, and global constraint. 2.1 K -means Clustering K -means clustering [2] is a well-known and very simple partitioning clustering algorithm. Its algorithm tries to group similar data into the same cluster by using an objective function that minimizes a sum of squared errors between a cluster center to its members. The algorithm is done as follows: 1. Initialize k cluster centers. 2. Measure the similarity between each data and all cluster centers and assign data into the most similar cluster. 3. Calculate a new cluster center of every cluster using an averaging function. 4. Repeat steps 2 and 3 until the cluster membership does not change. K -means clustering consists of two maj or subroutines, which are a distance function to measure the similarity between data sequences and an averaging function to return a new cluster center. Generally, most time series clustering works use Euclidean distance and amplitude averaging method. However, both cluster centers and their cluster members are inaccurate. In this work, we resolve this problem by using the DTW distance measure with our newly proposed averaging method called RSTMF. 2.2 Dynamic Time Warping (DTW) Distance Measure DTW distance [1] is an accurate similarity measurement which is generally used for time series data [9], especially in classification [6]. An optimal align-ment and distance between two sequences P = p 1 ,...,p i ,...,p n and Q = q 1 ,...,q j ,...,q m can be determined as follows.

DTW distance is computed through dynamic programming to discover the minimum cumulative distance of each element in n  X  m matrix. In addition, the warping path between two sequences ca n be found by tracing back from the last cell.

In this work, DTW distance is used to measure the similarity between each time series data and cluster cente rs to give more accurate results. 2.3 Global Constraint The global constraint is used when we need to limit the amount of warping in the DTW alignment. In some applications such as speech recognition [12], two data sequences are considered the same class when only small time shifting occurs; so, the global constraint is used to align the sequences more precisely. The Sakoe-Chiba band [12], one of the most popular global constraints, has been originally proposed for speech community and also has been used in various tasks in time series mining [11]. The size of the warping window is defined by r (as shown in Fig. 2), the percentage of the time series X  length, which is symmetric in both above and on the right of a diagonal. In this work, we will show in experiments that the global constraint plays an important role in improving the accuracy. In the past few decades, there are many clus tering techniques proposed to cluster time series data [5], for example, agglomerative hierarchical clustering [13], which merges most similar objects until all obj ects are in the cluster. However, this technique is still inaccurate, especially when outliers are present.
Another popular clustering technique is partitional clustering, which tries to minimize an objective function. The well-known algorithms are k -medoids and k -means clustering, which are different in their approaches to find new cluster centers. For k -medoids clustering application [4], DTW distance is used as a similarity measure among data sequences, and a sequence with minimum sum of distance to the rest of the sequences in the cluster is selected as a new cluster center. However, medoid is not always a centroid of a cluster, so the sequences can be assigned to wrong clusters.

In contrast to k -medoids clustering, k -means clustering mo stly uses Euclidean distance as a distance metric, and an a rithmetic mean or amplitude averaging is simply used to find a new cluster center [14]. Although the DTW distance is more appropriate for time series data, there currently is no DTW averaging method that provides a satisfied averaging result.

According to this, many research works have tried to improve the quality of the averaging result. Shape-based Template Matching Framework (STMF) [10] was recently introduced to average time series sequences. Table 1 shows the algorithm of this framework; the most similar pair of sequences is averaged by Cubic-spline Dynamic Time Warping (CDTW) algorithm (in line 6).
Given C 1 and C 2 as the most similar sequences, first, we find the warping path between these two sequences. The variables c 1 i and c 2 j are elements of C 1 and C 2 , which are warped. The averaged sequence Z , which has coordinates z k x and z k y can be computed as follows.
In equations 3 and 4,  X  c 1 and  X  c 2 are the weight of the sequences C 1 and C 2 , respectively. After we get the result, a number of points in the averaged sequence is re-sampled by using cubic-spline interpolation [10]. As shown in Fig. 3a), the averaging result from DTW averaging gives a sequence with 9 unequally spaced data points, whereas in Fig. 3b), the sequence is resampled with cubic spline interpolation to obtain a sequence of 7 equally spaced data points.
However, according to this framework, finding the most similar pair for each time of averaging is enormously computationally expensive because the DTW dis-tance of every pair of the sequences must be computed. Therefore, our RSTMF will mainly focus on improving its time complexity by estimating an order of sequences before averaging while maintaining the accuracy of the averaging results. In this paper, we propose Shape-based Clustering for Time Series (SCTS) by incorporating k -means clustering and DTW distan ce, together with a novel aver-aging function, Ranking Shape-based Template Matching Framework (RSTMF). Although STMF can still be used to determine a cluster center, it is computation-ally expensive; therefor e, computational time of k -means clustering significantly increase.
 We provide an overview of the proposed clustering algorithm in Table 2; the DTW distance is used instead of the Euc lidean distance in a membership as-signment process. After we finished assi gning each data sequence into the most similar cluster, RSTMF is utilized to av erage all of the sequences within each cluster until all cluster centers are u pdated. Unlike STMF, RSTMF approxi-mates an order of averaged sequences by looking at the Dist value, which is the DTW distance between data sequences in M and all cluster centers in C . Accordingly, RSTMF can provide the average sequence by using less compu-tation time than that of STMF, which calculates the distance between every pair of data and the most similar pair of sequences is averaged, making it very computationally expensive.

Table 3 shows our RSTMF averaging algorithm, which determines a cluster center by using Cubic-spline Dynamic Time Warping (CDTW) [10] to average a pair of time series sequences. RSTMF utilizes Dist to approximate a similarity distance between every sequence pair, defined by dist approx .Afterthat,CDTW is used to average a pair of sequences with the minimum dist approx value. Then, we update S and continue the averaging until only one sequence remains.
In RSTMF algorithm, the dist approx between each pair of the sequences can be computed by using the Dist value. Suppose P and Q are data sequences Dist Dist is a number of cluster. By applying the triangular inequality theorem, p k and q k are assumed to be two sides of a triangle. Then, the which is another side of the triangle, can be approximated by equation 5 and collected into S .
After finishing an averaging of two sequences, we insert the resulting sequence into M and delete these two sequences. Then, we update S by using the algorithm in Table 4.
By using the dist approx and the UPDATE method, our RSTMF can achieve large speedup because we c an estimate an order of the sequences before aver-aging. In contrast, the original STMF needs to calculate the DTW distance to select the most similar pair of the se quences every time of averaging. In this work, we evaluate our method by comparing it with other clustering techniques, which are typical k -means clustering with the Euclidean distance and amplitude averaging function, k -medoids clustering with the DTW distance [4], and k -hierarchical clustering [13] using both the Euclidean and the DTW distance. We compare our SCTS using RSTMF with that using the original STMF. Our experiments are evaluated on ten datasets from the UCR datasets classification/clustering archive [3] in diverse domains, as shown in Table 5.
We execute each algorithm for 40 times wi th random initial cluster centers, and the k value is set to the a number of classes in each dataset. With the luxury of labeled datasets used in all experiments, an accuracy, which is the number of correctly assigned data sequences in all clu sters, is used evaluation. Fig. 4 shows the accuracy of our proposed method, co mparing other well-known clustering methods mentioned above. According t o the results, our method outperforms others in almost all datasets.
To re-emphasize our finding, we also use another criterion based on known ground truth [5] to measure a similarily between two sets of clusters, i.e., ground-truth clusters and results from clustering algorithms. Suppose G and C are sets of k ground truth clusters and the clusters from our clustering technique. The similarity between G and C is calculated by the following equations.
In Fig. 5, we compare our proposed work with the general k -means clustering and the k -medoids clustering using this criterion. The results show that the clusters obtained from our method are more similar to the ground-truth clusters because the RSTMF averaging method does give the new cluster centers that represent the overall charactheristic of the data within each cluster.
Furthermore, RSTMF can reduce the time complexity by a few orders of magnitude (as shown in Fig. 6a), while still providing comparable accuracy to STMF (as shown in Fig. 6b).
In some cases, it appears that SCTS with DTW distance achieves a lower accuracy than the general k -means clustering. In an attempt to alleviate this drawback, we experiment on the global constraint parameter of DTW, Sakoe-Chiba band. We can improve the cluster ing accuracy, comparing with the orig-inal k -means clustering (warping window size is 0%). Fig. 7 shows the accuracy of our proposed RSTMF and STMF, which are comparable, as warping win-dow sizes vary. In almost datasets, the larger warping window size does not always provide the better accuracy; so, the appropriate warping window size is around 20%. However, in some dataset such as ECG, the wider warping win-dow can lead to pathological warping and make the accuracy of clustering de-creases. In this paper, we propose time series data clustering technique called Shape-based Clustering for Time Series (SCTS), which incorporates k -means clustering with a novel averaging method called Ranking Shape-based Template Matching Framework (RSTMF).

Comparing with the other well-known clustering algorithms, our SCTS yields better cluster results in terms of both a ccuracy and the criterion based on known ground truth because our RSTMF averaging function provides cluster centers that preserve characteristics of data s equences within the cluster (as shown in Fig. 8). Furthermore, RSTMF does gives a comparable sequence averaging result while consuming much less computational time than STMF in a few orders of magnitude; therefore, RSTMF is practically applied in clustering algorithm. We also used global constraint to increase an accuracy of our clusters. The results show that our SCTS can provide more a ccurate clustering when the width of warping window is about 20% of time series length. Acknowledgements. This research is partially supported by the Thailand Research Fund (Grant No. MRG5380130), the Thailand Research Fund given through the Royal Golden Jubilee Ph.D. Program (PHD/0141/2549 to V. Nien-nattrakul and C.A. Ratanamahatana), and CU Graduate School Thesis Grant.
